<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <script>if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode)) window.location.href="https://support.dmeng.net/upgrade-your-browser.html?referrer="+encodeURIComponent(window.location.href); </script>
    
    
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Regular.woff2" as="font">
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Bold.woff2" as="font">
    
    
    
        <link rel="shortcut icon" href="/ios.github.io/./././images/userImage.JPG">
    

    
    
        
<link rel="stylesheet" href="/ios.github.io/css/mdui.min.v1.0.0.css">

    
    
<link rel="stylesheet" href="/ios.github.io/css/main.css">
<link rel="stylesheet" href="/ios.github.io/css/iconfont.css">


    
    

    
        <script data-ad-client="ca-" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    












          


    
    
    <title>
        
            WeatherKit 使用文档 | 猪会飞的博客
        
    </title>
    
    
<meta name="generator" content="Hexo 8.1.1"></head>
<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-teal mdui-theme-accent-blue">
  
  <header class="mdui-appbar mdui-appbar-fixed">
  <div id="toolbar" class="mdui-toolbar mdui-color-theme">
    <button class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', swipe: true}"><i class="iconfont icon-menu"></i></button>
    <a href="/ios.github.io/" class="mdui-typo-headline">猪会飞的博客</a>
    <a href="/ios.github.io/" class="header-subtitle mdui-typo-headline"></a>
    <div class="mdui-toolbar-spacer"></div>
    <button class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#search'}" mdui-tooltip="{content: 'search'}"><i class="iconfont icon-search"></i></button>
  </div>
</header>

<div class="mdui-dialog" id="search">
  
    <div class="search-form">
      <input type="search" class="search-form-input" placeholder="请输入关键字" onfocus="listenSearchFunc()">
    </div>
    <div class="search-result" data-resource="/ios.github.io/search.xml"></div>
  
</div>

  <aside id="sidebar" class="mdui-drawer">
    <div class="mdui-tab" mdui-tab>
        <a href="#sidebar-tab1" id="sidebartab" class="mdui-ripple mdui-tab-active">站点概览</a>
        <a href="#sidebar-tab2" id="sidebartab" class="mdui-ripple">关于</a>
    </div>

    
    <div id="sidebar-tab1" class="mdui-p-a-1">
        <div class="mdui-list">
            
                
                <a href="/ios.github.io/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-home"></i>
                    </div>
                    <div class="mdui-list-item-content">主页</div>
                </a>
            
                
                <a href="/ios.github.io/archives/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-archive"></i>
                    </div>
                    <div class="mdui-list-item-content">归档</div>
                </a>
            
                
                <a href="/ios.github.io/tags/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-bookmark"></i>
                    </div>
                    <div class="mdui-list-item-content">标签</div>
                </a>
            
                
                <a href="/ios.github.io/about/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-user"></i>
                    </div>
                    <div class="mdui-list-item-content">关于</div>
                </a>
            
            <div class="mdui-list-item mdui-ripple">
                <div class="mdui-list-item-icon">
                    <i class="iconfont icon-moon"></i>
                </div>
                <div class="mdui-list-item-content">夜间模式</div>
                <label class="mdui-switch" id="darkmode">
                  <input type="checkbox" id="nightmode_switch"/>
                  <i class="mdui-switch-icon"></i>
                </label>
            </div>           
        </div>
    </div>

    
    <div id="sidebar-tab2" class="mdui-p-a-1">
        <div class="sidebar-overview">
            <div class="sidebar-avatar">
                
                    <img src="/ios.github.io/./././images/userImage.JPG"/>
                
            </div>
            <div class="sidebar-author-name">猪会飞</div>
            <div class="sidebar-description"></div>
        </div>
        <div class="sidebar-links">
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-mail"></i></span>
                    <a href="mailto:2839029331@qq.com" class="mdui-chip-title">E-Mail</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-github"></i></span>
                    <a target="_blank" rel="noopener" href="https://github.com/YCCIT123" class="mdui-chip-title">GitHub</a>
                </div>
            
        </div>
        <ul class="mdui-list" mdui-collapse="{accordion: true}">
            <li class="mdui-collapse-item">
                <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-link"></i>
                    </div>
                    <div class="mdui-list-item-content">友情链接</div>
                    <div class="mdui-collapse-item-arrow">
                        <i class="mdui-list-item-icon iconfont icon-angle-down"></i>
                    </div>
                </div>
                <ul id="linksList" class="mdui-collapse-item-body mdui-list mdui-list-dense">
                    
                        <a target="_blank" rel="noopener" href="https://garybear.cn/hexo-theme-meadow/" class="mdui-list-item mdui-ripple">
                            Meadow说明文档
                        </a>
                    
                </ul>
            </li>
        </ul>
    </div>

    <div class="mdui-divider"></div>
    
    
</aside>
  
  <main id="main-contain" class="mdui-container mdui-m-t-5">
    <article id="article" class="mdui-card mdui-p-b-2 mdui-m-b-5">
  <header class="mdui-card-media">
    
    
      <div class="post-header"> 
  <a class="post-header-title" href="/ios.github.io/2025/12/03/WeatheKit%20%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/">WeatherKit 使用文档</a>
  <div class="post-header-meta">
    <span>
      <span class="iconfont icon-calendar"></span>
      发布于:&nbsp;2025-12-03
    </span>
    <span>
      <span class="iconfont icon-calendar-check"></span>
      更新于:&nbsp;2025-12-04
    </span>
    <span>
      <span class="iconfont icon-folder"></span>
      分类于:&nbsp;
    </span>
    
  </div>
</div>   
    



    
    
    <div class="mdui-card-menu">
    
      <button class="mdui-btn mdui-btn-icon mdui-text-color-teal" mdui-menu="{target: '#share_menu', align: 'right'}"><i class="iconfont icon-share"></i></button>
      <ul class="mdui-menu" id="share_menu">
        <li class="mdui-menu-item">
          <a href="http://service.weibo.com/share/share.php?appkey=&title=WeatherKit 使用文档&url=https://yccit123.github.io/ios.github.io/2025/12/03/WeatheKit%20%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/&pic=https://yccit123.github.io/ios.github.io/ios.github.io/./././images/userImage.JPG&searchPic=false&style=simple" target="_blank" class="mdui-ripple">分享到 Weibo</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://twitter.com/intent/tweet?text=WeatherKit 使用文档&url=https://yccit123.github.io/ios.github.io/2025/12/03/WeatheKit%20%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/&via=猪会飞" target="_blank" class="mdui-ripple">分享到 Twitter</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://yccit123.github.io/ios.github.io/2025/12/03/WeatheKit%20%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/" target="_blank" class="mdui-ripple">分享到 Facebook</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://plus.google.com/share?url=https://yccit123.github.io/ios.github.io/2025/12/03/WeatheKit%20%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/" target="_blank" class="mdui-ripple">分享到 Google+</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://yccit123.github.io/ios.github.io/2025/12/03/WeatheKit%20%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/&title=WeatherKit 使用文档" target="_blank" class="mdui-ripple">分享到 LinkedIn</a>
        </li>
        <li class="mdui-menu-item">
          <a href="http://connect.qq.com/widget/shareqq/index.html?site=猪会飞的博客&title=WeatherKit 使用文档&summary=&pics=https://yccit123.github.io/ios.github.io/ios.github.io/./././images/userImage.JPG&url=https://yccit123.github.io/ios.github.io/2025/12/03/WeatheKit%20%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/" target="_blank" class="mdui-ripple">分享到 QQ</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://telegram.me/share/url?url=https://yccit123.github.io/ios.github.io/2025/12/03/WeatheKit%20%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/&text=WeatherKit 使用文档" target="_blank" class="mdui-ripple">分享到 Telegram</a>
        </li>
      </ul>
    
  </div>
  </header>
  
  
  
  
  <div class="post-tags">
    
      <i class="iconfont icon-tag">
        <a rel="tag" href = /ios.github.io/tags/%E5%AE%98%E6%96%B9API/ >官方API</a>
      </i>
    
  </div>

  
  <div class="mdui-card-content mdui-typo mdui-p-x-4">
    <h1 id="WeatherKit-使用文档"><a href="#WeatherKit-使用文档" class="headerlink" title="WeatherKit 使用文档"></a>WeatherKit 使用文档</h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h2><p>WeatherKit 是 Apple 提供的官方天气服务框架，允许开发者轻松获取实时天气数据、天气预报和历史天气信息。该框架支持 iOS 16+、iPadOS 16+、macOS 13+ 和 watchOS 9+，为跨平台天气应用开发提供了统一的解决方案。</p>
<p>WeatherKit 提供了丰富的天气数据类型和简单易用的 API 接口，包括：</p>
<ul>
<li>实时天气状况</li>
<li>每日天气预报</li>
<li>每小时天气预报</li>
<li>分钟级降水预报（部分地区支持）</li>
<li>历史天气数据</li>
<li>天气数据归因信息</li>
</ul>
<p>通过集成 WeatherKit，开发者可以快速构建功能丰富、数据准确的天气应用。</p>
<h2 id="2-配置要求"><a href="#2-配置要求" class="headerlink" title="2. 配置要求"></a>2. 配置要求</h2><p>要使用 WeatherKit 框架，需要进行以下配置：</p>
<h3 id="2-1-项目配置"><a href="#2-1-项目配置" class="headerlink" title="2.1 项目配置"></a>2.1 项目配置</h3><ol>
<li><strong>最低系统版本</strong>：在 Xcode 项目中，确保目标平台版本为 iOS 16.0+、iPadOS 16.0+、macOS 13.0+ 或 watchOS 9.0+</li>
<li><strong>添加 WeatherKit 能力</strong>：在项目的 <code>Signing &amp; Capabilities</code> 面板中添加 <code>WeatherKit</code> capability</li>
<li><strong>添加位置权限描述</strong>：在 <code>Info.plist</code> 文件中添加以下键值对：<ul>
<li><code>NSLocationWhenInUseUsageDescription</code>：当应用在前台使用时访问位置的描述</li>
<li><code>NSLocationAlwaysAndWhenInUseUsageDescription</code>（可选）：用于后台获取天气数据时的位置权限描述</li>
</ul>
</li>
</ol>
<h3 id="2-2-权限设置"><a href="#2-2-权限设置" class="headerlink" title="2.2 权限设置"></a>2.2 权限设置</h3><p>WeatherKit 需要位置权限才能提供基于位置的天气数据。应用需要请求用户授权访问位置信息。建议只请求必要的权限：</p>
<ul>
<li>对于仅在前台使用的天气应用，请求 <code>When In Use</code> 权限即可</li>
<li>对于需要后台更新天气数据的应用，可以请求 <code>Always</code> 权限</li>
</ul>
<p>通过合理的权限请求策略，可以提高用户授权率，同时保护用户隐私。</p>
<h2 id="3-核心组件"><a href="#3-核心组件" class="headerlink" title="3. 核心组件"></a>3. 核心组件</h2><h3 id="3-1-WeatherService"><a href="#3-1-WeatherService" class="headerlink" title="3.1 WeatherService"></a>3.1 WeatherService</h3><p><code>WeatherService</code> 是 WeatherKit 的核心类，用于获取所有天气数据。它采用单例设计模式，通过 <code>shared</code> 属性访问：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 WeatherService 单例</span></span><br><span class="line"><span class="keyword">let</span> weatherService <span class="operator">=</span> <span class="type">WeatherService</span>.shared</span><br></pre></td></tr></table></figure>

<p><code>WeatherService</code> 提供了以下主要方法：</p>
<h3 id="3-1-1-weather-for-including"><a href="#3-1-1-weather-for-including" class="headerlink" title="3.1.1 weather(for:including:)"></a>3.1.1 weather(for:including:)</h3><p><strong>功能</strong>：获取指定位置的实时天气数据和预报数据。</p>
<p><strong>方法签名</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">weather</span>(</span><br><span class="line">    <span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>,</span><br><span class="line">    <span class="params">including</span> <span class="params">dataTypes</span>: <span class="type">WeatherData</span>.<span class="keyword">Type</span><span class="operator">...</span></span><br><span class="line">) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">WeatherKit</span>.<span class="type">Weather</span>&lt;<span class="type">WeatherKit</span>.<span class="type">WeatherData</span>.<span class="keyword">Type</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>location</code>：要获取天气数据的位置，类型为 <code>CLLocation</code></li>
<li><code>dataTypes</code>：要获取的数据类型，可变参数，可选值包括 <code>.current</code>、<code>.daily</code>、<code>.hourly</code>、<code>.minute</code></li>
</ul>
<p><strong>返回值</strong>：包含请求的所有天气数据的元组，元组中的每个元素对应请求的数据类型。</p>
<p><strong>使用示例</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前天气、每日预报和每小时预报</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherData</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> (current, daily, hourly) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .current, .daily, .hourly</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用当前天气数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;当前温度：<span class="subst">\(Int(current.temperature.value.rounded()))</span>°C&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;天气状况：<span class="subst">\(current.condition.description)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用每日预报数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;未来7天预报：&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> day <span class="keyword">in</span> daily.forecast &#123;</span><br><span class="line">                <span class="keyword">let</span> date <span class="operator">=</span> day.date.formatted(date: .abbreviated, time: .omitted)</span><br><span class="line">                <span class="keyword">let</span> high <span class="operator">=</span> <span class="type">Int</span>(day.highTemperature.value.rounded())</span><br><span class="line">                <span class="keyword">let</span> low <span class="operator">=</span> <span class="type">Int</span>(day.lowTemperature.value.rounded())</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(date)</span>: 最高<span class="subst">\(high)</span>°C，最低<span class="subst">\(low)</span>°C&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用每小时预报数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;未来24小时预报：&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> hour <span class="keyword">in</span> hourly.forecast.prefix(<span class="number">24</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> time <span class="operator">=</span> hour.date.formatted(date: .omitted, time: .shortened)</span><br><span class="line">                <span class="keyword">let</span> temp <span class="operator">=</span> <span class="type">Int</span>(hour.temperature.value.rounded())</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(time)</span>: <span class="subst">\(temp)</span>°C&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong>：</p>
<ul>
<li>分钟级降水预报（<code>.minute</code>）仅在部分地区可用</li>
<li>每日预报默认返回未来7天的数据</li>
<li>每小时预报默认返回未来12小时的数据</li>
</ul>
<h3 id="3-1-2-historicalWeather-for-including-from-to"><a href="#3-1-2-historicalWeather-for-including-from-to" class="headerlink" title="3.1.2 historicalWeather(for:including:from:to:)"></a>3.1.2 historicalWeather(for:including:from:to:)</h3><p><strong>功能</strong>：获取指定时间范围的历史天气数据。</p>
<p><strong>方法签名</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">historicalWeather</span>(</span><br><span class="line">    <span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>,</span><br><span class="line">    <span class="params">including</span> <span class="params">dataTypes</span>: <span class="type">WeatherData</span>.<span class="keyword">Type</span><span class="operator">...</span>,</span><br><span class="line">    <span class="params">from</span> <span class="params">startDate</span>: <span class="type">Date</span>,</span><br><span class="line">    <span class="params">to</span> <span class="params">endDate</span>: <span class="type">Date</span></span><br><span class="line">) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">WeatherKit</span>.<span class="type">HistoricalWeather</span>&lt;<span class="type">WeatherKit</span>.<span class="type">WeatherData</span>.<span class="keyword">Type</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>location</code>：要获取历史天气数据的位置，类型为 <code>CLLocation</code></li>
<li><code>dataTypes</code>：要获取的历史数据类型，可变参数，可选值包括 <code>.current</code>、<code>.daily</code>、<code>.hourly</code></li>
<li><code>startDate</code>：历史数据的起始日期</li>
<li><code>endDate</code>：历史数据的结束日期</li>
</ul>
<p><strong>返回值</strong>：包含指定时间范围内历史天气数据的元组。</p>
<p><strong>使用示例</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取过去7天的历史天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchHistoricalWeatherData</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 设置时间范围（过去7天）</span></span><br><span class="line">            <span class="keyword">let</span> endDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">            <span class="keyword">let</span> startDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .day, value: <span class="operator">-</span><span class="number">7</span>, to: endDate)<span class="operator">!</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> historicalWeather <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.historicalWeather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .daily,</span><br><span class="line">                from: startDate,</span><br><span class="line">                to: endDate</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用历史每日数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;过去7天历史天气：&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> day <span class="keyword">in</span> historicalWeather.daily.forecast &#123;</span><br><span class="line">                <span class="keyword">let</span> date <span class="operator">=</span> day.date.formatted(date: .abbreviated, time: .omitted)</span><br><span class="line">                <span class="keyword">let</span> high <span class="operator">=</span> <span class="type">Int</span>(day.highTemperature.value.rounded())</span><br><span class="line">                <span class="keyword">let</span> low <span class="operator">=</span> <span class="type">Int</span>(day.lowTemperature.value.rounded())</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(date)</span>: 最高<span class="subst">\(high)</span>°C，最低<span class="subst">\(low)</span>°C&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取历史天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong>：</p>
<ul>
<li>历史数据的时间范围有限制，具体取决于 WeatherKit 服务的支持</li>
<li>无法获取分钟级的历史降水数据</li>
</ul>
<h3 id="3-1-3-historicalWeather-for-at-including"><a href="#3-1-3-historicalWeather-for-at-including" class="headerlink" title="3.1.3 historicalWeather(for:at:including:)"></a>3.1.3 historicalWeather(for:at:including:)</h3><p><strong>功能</strong>：获取指定位置在特定时间点的历史天气数据。</p>
<p><strong>方法签名</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">historicalWeather</span>(</span><br><span class="line">    <span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>,</span><br><span class="line">    <span class="params">at</span> <span class="params">timestamp</span>: <span class="type">Date</span>,</span><br><span class="line">    <span class="params">including</span> <span class="params">dataTypes</span>: <span class="type">WeatherData</span>.<span class="keyword">Type</span><span class="operator">...</span></span><br><span class="line">) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">WeatherKit</span>.<span class="type">HistoricalWeather</span>&lt;<span class="type">WeatherKit</span>.<span class="type">WeatherData</span>.<span class="keyword">Type</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>location</code>：要获取历史天气数据的位置，类型为 <code>CLLocation</code></li>
<li><code>timestamp</code>：要获取历史天气数据的特定时间点</li>
<li><code>dataTypes</code>：要获取的历史数据类型，可变参数，可选值包括 <code>.current</code></li>
</ul>
<p><strong>返回值</strong>：包含指定时间点历史天气数据的元组。</p>
<p><strong>使用示例</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取昨天此时的历史天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchYesterdayWeather</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 设置时间点（昨天的这个时间）</span></span><br><span class="line">            <span class="keyword">let</span> yesterday <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .day, value: <span class="operator">-</span><span class="number">1</span>, to: <span class="type">Date</span>())<span class="operator">!</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> historicalWeather <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.historicalWeather(</span><br><span class="line">                for: location,</span><br><span class="line">                at: yesterday,</span><br><span class="line">                including: .current</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用历史数据</span></span><br><span class="line">            <span class="keyword">let</span> date <span class="operator">=</span> yesterday.formatted(date: .abbreviated, time: .shortened)</span><br><span class="line">            <span class="keyword">let</span> temp <span class="operator">=</span> <span class="type">Int</span>(historicalWeather.current.temperature.value.rounded())</span><br><span class="line">            <span class="keyword">let</span> condition <span class="operator">=</span> historicalWeather.current.condition.description</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(date)</span> 的天气：<span class="subst">\(temp)</span>°C，<span class="subst">\(condition)</span>&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取历史天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-4-search-for"><a href="#3-1-4-search-for" class="headerlink" title="3.1.4 search(for:)"></a>3.1.4 search(for:)</h3><p><strong>功能</strong>：根据关键词搜索位置，返回匹配的位置列表。</p>
<p><strong>方法签名</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">search</span>(</span><br><span class="line">    <span class="params">for</span> <span class="params">searchTerm</span>: <span class="type">String</span></span><br><span class="line">) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; [<span class="type">WeatherKit</span>.<span class="type">WeatherLocation</span>]</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>searchTerm</code>：搜索关键词，可以是城市名、地区名、邮政编码等</li>
</ul>
<p><strong>返回值</strong>：匹配的位置列表，每个位置包含名称、坐标等信息。</p>
<p><strong>使用示例</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据城市名搜索位置</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">searchLocation</span>(<span class="params">for</span> <span class="params">cityName</span>: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> searchResults <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.search(for: cityName)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 显示搜索结果</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;搜索结果：&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> result <span class="keyword">in</span> searchResults &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;名称：<span class="subst">\(result.name)</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;坐标：<span class="subst">\(result.location.coordinate.latitude)</span>, <span class="subst">\(result.location.coordinate.longitude)</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;国家：<span class="subst">\(result.country <span class="operator">??</span> <span class="string">&quot;未知&quot;</span>)</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;行政区划：<span class="subst">\(result.administrativeArea <span class="operator">??</span> <span class="string">&quot;未知&quot;</span>)</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;---&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用第一个搜索结果获取天气数据</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> firstResult <span class="operator">=</span> searchResults.first &#123;</span><br><span class="line">                <span class="keyword">let</span> (current, <span class="keyword">_</span>, <span class="keyword">_</span>) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                    for: firstResult.location,</span><br><span class="line">                    including: .current</span><br><span class="line">                )</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(firstResult.name)</span> 当前温度：<span class="subst">\(Int(current.temperature.value.rounded()))</span>°C&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;搜索位置失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-5-attribution"><a href="#3-1-5-attribution" class="headerlink" title="3.1.5 attribution"></a>3.1.5 attribution</h3><p><strong>功能</strong>：获取天气数据的归因信息，用于显示版权声明。</p>
<p><strong>方法签名</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> attribution: <span class="type">WeatherKit</span>.<span class="type">WeatherAttribution</span> &#123; <span class="keyword">get</span> <span class="keyword">async</span> <span class="keyword">throws</span> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回值</strong>：包含天气数据归因信息的 <code>WeatherAttribution</code> 对象。</p>
<p><strong>使用示例</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取并显示天气数据归因信息</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherAttribution</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.attribution</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用归因信息</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;法律声明：<span class="subst">\(attribution.legalText)</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> logoURL <span class="operator">=</span> attribution.logoLightURL &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;亮色背景 Logo URL：<span class="subst">\(logoURL)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> logoURL <span class="operator">=</span> attribution.logoDarkURL &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;暗色背景 Logo URL：<span class="subst">\(logoURL)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> privacyURL <span class="operator">=</span> attribution.privacyPolicyURL &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;隐私政策 URL：<span class="subst">\(privacyURL)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> termsURL <span class="operator">=</span> attribution.termsOfServiceURL &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;服务条款 URL：<span class="subst">\(termsURL)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取归因信息失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong>：</p>
<ul>
<li>根据 Apple 的要求，使用 WeatherKit 数据的应用必须显示归因信息</li>
<li>归因信息包括法律声明、Logo 和相关链接</li>
</ul>
<p>所有天气数据获取方法都是异步的，需要在异步上下文中调用，如 Swift 的 <code>Task</code> 中。</p>
<h3 id="3-2-天气数据类型"><a href="#3-2-天气数据类型" class="headerlink" title="3.2 天气数据类型"></a>3.2 天气数据类型</h3><ul>
<li><strong>CurrentWeather</strong>: 当前天气状况，包括温度、湿度、风向、气压等实时数据</li>
<li><strong>DayWeather</strong>: 每日天气预报，包括最高&#x2F;最低温度、降水概率、日出&#x2F;日落时间等</li>
<li><strong>HourWeather</strong>: 每小时天气预报，包括温度变化、降水概率、风速等</li>
<li><strong>MinuteWeather</strong>: 分钟级降水预报（某些地区支持），提供未来1小时内的逐分钟降水预测</li>
<li><strong>WeatherAttribution</strong>: 天气数据来源归因，用于显示天气数据的版权信息</li>
<li><strong>Forecast<T></strong>: 天气预报容器，用于包含多个时间点的天气数据</li>
</ul>
<h3 id="3-3-天气状态中文映射"><a href="#3-3-天气状态中文映射" class="headerlink" title="3.3 天气状态中文映射"></a>3.3 天气状态中文映射</h3><p>WeatherKit 使用 <code>WeatherCondition</code> 枚举表示天气状态，以下是完整的中文映射表：</p>
<table>
<thead>
<tr>
<th>WeatherCondition</th>
<th>中文描述</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>clear</strong></td>
<td>晴天</td>
<td>天空晴朗，无云或极少云</td>
</tr>
<tr>
<td><strong>partlyCloudy</strong></td>
<td>多云</td>
<td>天空部分多云</td>
</tr>
<tr>
<td><strong>cloudy</strong></td>
<td>阴</td>
<td>天空多云</td>
</tr>
<tr>
<td><strong>overcast</strong></td>
<td>阴云密布</td>
<td>天空完全被云覆盖</td>
</tr>
<tr>
<td><strong>foggy</strong></td>
<td>雾</td>
<td>能见度降低的雾天</td>
</tr>
<tr>
<td><strong>windy</strong></td>
<td>大风</td>
<td>风力较强</td>
</tr>
<tr>
<td><strong>breezy</strong></td>
<td>微风</td>
<td>风力适中</td>
</tr>
<tr>
<td><strong>rainy</strong></td>
<td>雨天</td>
<td>有降雨</td>
</tr>
<tr>
<td><strong>snowy</strong></td>
<td>雪天</td>
<td>有降雪</td>
</tr>
<tr>
<td><strong>sleety</strong></td>
<td>雨夹雪</td>
<td>雨和雪混合</td>
</tr>
<tr>
<td><strong>haily</strong></td>
<td>冰雹</td>
<td>有冰雹</td>
</tr>
<tr>
<td><strong>blizzard</strong></td>
<td>暴风雪</td>
<td>强烈的降雪天气</td>
</tr>
<tr>
<td><strong>tropicalStorm</strong></td>
<td>热带风暴</td>
<td>热带地区的风暴天气</td>
</tr>
<tr>
<td><strong>hurricane</strong></td>
<td>飓风</td>
<td>强烈的热带气旋</td>
</tr>
<tr>
<td><strong>thundery</strong></td>
<td>雷暴</td>
<td>伴有雷电的天气</td>
</tr>
<tr>
<td><strong>tornado</strong></td>
<td>龙卷风</td>
<td>强烈的旋转气流天气</td>
</tr>
</tbody></table>
<h2 id="4-使用示例"><a href="#4-使用示例" class="headerlink" title="4. 使用示例"></a>4. 使用示例</h2><h3 id="4-1-导入框架"><a href="#4-1-导入框架" class="headerlink" title="4.1 导入框架"></a>4.1 导入框架</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WeatherKit</span><br><span class="line"><span class="keyword">import</span> CoreLocation <span class="comment">// 用于位置获取</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-请求天气数据"><a href="#4-2-请求天气数据" class="headerlink" title="4.2 请求天气数据"></a>4.2 请求天气数据</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在异步上下文中调用</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeather</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 获取当前天气、每日预报和每小时预报</span></span><br><span class="line">            <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .current, .daily, .hourly</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用获取到的天气数据</span></span><br><span class="line">            updateUI(</span><br><span class="line">                current: currentWeather,</span><br><span class="line">                daily: dailyForecast,</span><br><span class="line">                hourly: hourlyForecast,</span><br><span class="line">                location: location</span><br><span class="line">            )</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="comment">// 处理错误</span></span><br><span class="line">            showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-请求包含分钟级降水的天气数据"><a href="#4-3-请求包含分钟级降水的天气数据" class="headerlink" title="4.3 请求包含分钟级降水的天气数据"></a>4.3 请求包含分钟级降水的天气数据</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherWithMinuteForecast</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 获取当前天气、每日预报、每小时预报和分钟级降水预报</span></span><br><span class="line">            <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast, minuteForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .current, .daily, .hourly, .minute</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用分钟级降水预报</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> firstMinute <span class="operator">=</span> minuteForecast.forecast.first &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;未来1分钟降水概率：<span class="subst">\(Int(firstMinute.precipitationChance <span class="operator">*</span> <span class="number">100</span>))</span>%&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-获取历史天气数据"><a href="#4-4-获取历史天气数据" class="headerlink" title="4.4 获取历史天气数据"></a>4.4 获取历史天气数据</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchHistoricalWeather</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 定义历史时间范围（过去7天）</span></span><br><span class="line">            <span class="keyword">let</span> endDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">            <span class="keyword">let</span> startDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .day, value: <span class="operator">-</span><span class="number">7</span>, to: endDate)<span class="operator">!</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取历史天气数据</span></span><br><span class="line">            <span class="keyword">let</span> historicalWeather <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.historicalWeather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .daily,</span><br><span class="line">                from: startDate,</span><br><span class="line">                to: endDate</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用历史天气数据</span></span><br><span class="line">            <span class="keyword">for</span> dayWeather <span class="keyword">in</span> historicalWeather.daily.forecast &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(dayWeather.date)</span>: 最高温 <span class="subst">\(Int(dayWeather.highTemperature.value.rounded()))</span>°，最低温 <span class="subst">\(Int(dayWeather.lowTemperature.value.rounded()))</span>°&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            showError(<span class="string">&quot;获取历史天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-获取特定时间点的历史天气"><a href="#4-5-获取特定时间点的历史天气" class="headerlink" title="4.5 获取特定时间点的历史天气"></a>4.5 获取特定时间点的历史天气</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchHistoricalWeatherForSpecificTime</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 定义特定的历史时间点（昨天的这个时间）</span></span><br><span class="line">            <span class="keyword">let</span> historicalDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .day, value: <span class="operator">-</span><span class="number">1</span>, to: <span class="type">Date</span>())<span class="operator">!</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取特定时间点的历史天气</span></span><br><span class="line">            <span class="keyword">let</span> historicalWeather <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.historicalWeather(</span><br><span class="line">                for: location,</span><br><span class="line">                at: historicalDate,</span><br><span class="line">                including: .current</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用历史天气数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;昨天此时的温度：<span class="subst">\(Int(historicalWeather.current.temperature.value.rounded()))</span>°&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            showError(<span class="string">&quot;获取历史天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-处理天气数据"><a href="#4-6-处理天气数据" class="headerlink" title="4.6 处理天气数据"></a>4.6 处理天气数据</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">updateUI</span>(</span><br><span class="line">    <span class="params">current</span>: <span class="type">CurrentWeather</span>,</span><br><span class="line">    <span class="params">daily</span>: <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;,</span><br><span class="line">    <span class="params">hourly</span>: <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;,</span><br><span class="line">    <span class="params">location</span>: <span class="type">CLLocation</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// 更新当前温度</span></span><br><span class="line">    temperatureLabel.text <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(Int(current.temperature.value.rounded()))</span>°&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新天气状况描述</span></span><br><span class="line">    conditionLabel.text <span class="operator">=</span> current.condition.description</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新今日最高/最低温度</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> today <span class="operator">=</span> daily.forecast.first &#123;</span><br><span class="line">        <span class="keyword">let</span> high <span class="operator">=</span> <span class="type">Int</span>(today.highTemperature.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> low <span class="operator">=</span> <span class="type">Int</span>(today.lowTemperature.value.rounded())</span><br><span class="line">        highLowLabel.text <span class="operator">=</span> <span class="string">&quot;H:<span class="subst">\(high)</span>°  L:<span class="subst">\(low)</span>°&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-7-位置获取与授权"><a href="#4-7-位置获取与授权" class="headerlink" title="4.7 位置获取与授权"></a>4.7 位置获取与授权</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置位置管理器</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">setupLocationManager</span>() &#123;</span><br><span class="line">    locationManager.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    locationManager.desiredAccuracy <span class="operator">=</span> kCLLocationAccuracyHundredMeters</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求位置权限和位置信息</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">requestLocation</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> status <span class="operator">=</span> locationManager.authorizationStatus</span><br><span class="line">    <span class="keyword">switch</span> status &#123;</span><br><span class="line">    <span class="keyword">case</span> .notDetermined:</span><br><span class="line">        locationManager.requestWhenInUseAuthorization()</span><br><span class="line">    <span class="keyword">case</span> .authorizedWhenInUse, .authorizedAlways:</span><br><span class="line">        locationManager.requestLocation()</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        showError(<span class="string">&quot;定位权限被拒绝，无法获取天气&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 位置更新回调</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">locationManager</span>(<span class="keyword">_</span> <span class="params">manager</span>: <span class="type">CLLocationManager</span>, <span class="params">didUpdateLocations</span> <span class="params">locations</span>: [<span class="type">CLLocation</span>]) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> location <span class="operator">=</span> locations.first <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    fetchWeather(for: location)</span><br><span class="line">    reverseGeocode(location: location) <span class="comment">// 获取城市名</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-8-使用城市名获取天气"><a href="#4-8-使用城市名获取天气" class="headerlink" title="4.8 使用城市名获取天气"></a>4.8 使用城市名获取天气</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherByCityName</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 创建城市名查询</span></span><br><span class="line">            <span class="keyword">let</span> searchQuery <span class="operator">=</span> <span class="string">&quot;Beijing&quot;</span></span><br><span class="line">            <span class="keyword">let</span> searchResults <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.search(for: searchQuery)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取第一个搜索结果的位置</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> firstResult <span class="operator">=</span> searchResults.first <span class="keyword">else</span> &#123;</span><br><span class="line">                showError(<span class="string">&quot;未找到该城市&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用搜索结果的位置获取天气</span></span><br><span class="line">            <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.weather(</span><br><span class="line">                for: firstResult.location,</span><br><span class="line">                including: .current, .daily, .hourly</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用天气数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(firstResult.name)</span> 当前温度：<span class="subst">\(Int(currentWeather.temperature.value.rounded()))</span>°&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-9-使用多个位置获取天气数据"><a href="#4-9-使用多个位置获取天气数据" class="headerlink" title="4.9 使用多个位置获取天气数据"></a>4.9 使用多个位置获取天气数据</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherForMultipleLocations</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 定义多个位置</span></span><br><span class="line">            <span class="keyword">let</span> beijingLocation <span class="operator">=</span> <span class="type">CLLocation</span>(latitude: <span class="number">39.9042</span>, longitude: <span class="number">116.4074</span>)</span><br><span class="line">            <span class="keyword">let</span> shanghaiLocation <span class="operator">=</span> <span class="type">CLLocation</span>(latitude: <span class="number">31.2304</span>, longitude: <span class="number">121.4737</span>)</span><br><span class="line">            <span class="keyword">let</span> locations <span class="operator">=</span> [beijingLocation, shanghaiLocation]</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 批量获取天气数据</span></span><br><span class="line">            <span class="keyword">for</span> location <span class="keyword">in</span> locations &#123;</span><br><span class="line">                <span class="keyword">let</span> (currentWeather, <span class="keyword">_</span>, <span class="keyword">_</span>) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.weather(</span><br><span class="line">                    for: location,</span><br><span class="line">                    including: .current</span><br><span class="line">                )</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;位置 <span class="subst">\(location.coordinate.latitude)</span>, <span class="subst">\(location.coordinate.longitude)</span> 当前温度：<span class="subst">\(Int(currentWeather.temperature.value.rounded()))</span>°&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-10-显示天气数据归因信息"><a href="#4-10-显示天气数据归因信息" class="headerlink" title="4.10 显示天气数据归因信息"></a>4.10 显示天气数据归因信息</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">showWeatherAttribution</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.attribution</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 在 UI 中显示归因信息</span></span><br><span class="line">            <span class="keyword">let</span> attributionLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">            attributionLabel.text <span class="operator">=</span> attribution.legalText</span><br><span class="line">            attributionLabel.font <span class="operator">=</span> .systemFont(ofSize: <span class="number">12</span>)</span><br><span class="line">            attributionLabel.textColor <span class="operator">=</span> .secondaryLabel</span><br><span class="line">            attributionLabel.textAlignment <span class="operator">=</span> .center</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加到视图中</span></span><br><span class="line">            view.addSubview(attributionLabel)</span><br><span class="line">            <span class="comment">// 设置约束...</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 或者使用归因链接</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> attributionURL <span class="operator">=</span> attribution.privacyPolicyURL &#123;</span><br><span class="line">                <span class="keyword">let</span> attributionButton <span class="operator">=</span> <span class="type">UIButton</span>(type: .system)</span><br><span class="line">                attributionButton.setTitle(<span class="string">&quot;天气数据来源&quot;</span>, for: .normal)</span><br><span class="line">                attributionButton.addTarget(<span class="keyword">self</span>, action: <span class="keyword">#selector</span>(openAttributionLink), for: .touchUpInside)</span><br><span class="line">                <span class="comment">// 设置约束...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取归因信息失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">openAttributionLink</span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try?</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.attribution,</span><br><span class="line">       <span class="keyword">let</span> attributionURL <span class="operator">=</span> attribution.privacyPolicyURL &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.shared.open(attributionURL)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-天气数据详细说明"><a href="#5-天气数据详细说明" class="headerlink" title="5. 天气数据详细说明"></a>5. 天气数据详细说明</h2><h3 id="5-1-CurrentWeather"><a href="#5-1-CurrentWeather" class="headerlink" title="5.1 CurrentWeather"></a>5.1 CurrentWeather</h3><p><code>CurrentWeather</code> 包含当前天气的详细信息，是 WeatherKit 中最常用的天气数据类型之一。</p>
<h4 id="5-1-1-属性详细说明与使用示例"><a href="#5-1-1-属性详细说明与使用示例" class="headerlink" title="5.1.1 属性详细说明与使用示例"></a>5.1.1 属性详细说明与使用示例</h4><table>
<thead>
<tr>
<th align="left">属性</th>
<th>类型</th>
<th>描述</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>date</strong></td>
<td>Date</td>
<td>当前天气的时间戳</td>
<td><code>let time = currentWeather.date.formatted(date: .omitted, time: .shortened)</code></td>
</tr>
<tr>
<td align="left"><strong>temperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>当前温度</td>
<td><code>let temp = Int(currentWeather.temperature.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>feelsLikeTemperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>体感温度</td>
<td><code>let feelsLike = Int(currentWeather.feelsLikeTemperature.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>condition</strong></td>
<td>WeatherCondition</td>
<td>天气状况</td>
<td><code>let condition = currentWeather.condition</code></td>
</tr>
<tr>
<td align="left"><strong>description</strong></td>
<td>String</td>
<td>天气状况的文本描述</td>
<td><code>let desc = currentWeather.description</code></td>
</tr>
<tr>
<td align="left"><strong>humidity</strong></td>
<td>Double</td>
<td>相对湿度（0-1）</td>
<td><code>let humidity = Int(currentWeather.humidity * 100)</code></td>
</tr>
<tr>
<td align="left"><strong>dewPoint</strong></td>
<td>Measurement<UnitTemperature></td>
<td>露点温度</td>
<td><code>let dewPoint = Int(currentWeather.dewPoint.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>wind</strong></td>
<td>Wind</td>
<td>风向和风速</td>
<td>见下方详细说明</td>
</tr>
<tr>
<td align="left"><strong>gust</strong></td>
<td>Measurement<UnitSpeed></td>
<td>阵风风速</td>
<td><code>let gustSpeed = Int(currentWeather.gust.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>pressure</strong></td>
<td>Measurement<UnitPressure></td>
<td>气压</td>
<td><code>let pressure = Int(currentWeather.pressure.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>visibility</strong></td>
<td>Measurement<UnitLength></td>
<td>能见度</td>
<td><code>let visibility = Int(currentWeather.visibility.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>uvIndex</strong></td>
<td>UVIndex</td>
<td>紫外线指数</td>
<td><code>let uvIndex = Int(currentWeather.uvIndex.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>uvIndexDescription</strong></td>
<td>String</td>
<td>紫外线指数描述</td>
<td><code>let uvDesc = currentWeather.uvIndexDescription</code></td>
</tr>
<tr>
<td align="left"><strong>cloudCover</strong></td>
<td>Double</td>
<td>云覆盖率（0-1）</td>
<td><code>let cloudCover = Int(currentWeather.cloudCover * 100)</code></td>
</tr>
<tr>
<td align="left"><strong>ceiling</strong></td>
<td>Measurement<UnitLength></td>
<td>云底高度</td>
<td><code>let ceiling = Int(currentWeather.ceiling.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>precipitation</strong></td>
<td>Precipitation</td>
<td>当前降水情况</td>
<td>见下方详细说明</td>
</tr>
<tr>
<td align="left"><strong>precipitationChance</strong></td>
<td>Double</td>
<td>降水概率（0-1）</td>
<td><code>let precipChance = Int(currentWeather.precipitationChance * 100)</code></td>
</tr>
<tr>
<td align="left"><strong>precipitationType</strong></td>
<td>PrecipitationType</td>
<td>降水类型</td>
<td><code>let precipType = currentWeather.precipitationType</code></td>
</tr>
<tr>
<td align="left"><strong>sunrise</strong></td>
<td>Date?</td>
<td>今日日出时间</td>
<td><code>let sunrise = currentWeather.sunrise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td align="left"><strong>sunset</strong></td>
<td>Date?</td>
<td>今日日落时间</td>
<td><code>let sunset = currentWeather.sunset?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td align="left"><strong>moonPhase</strong></td>
<td>MoonPhase</td>
<td>月相</td>
<td><code>let moonPhase = currentWeather.moonPhase</code></td>
</tr>
<tr>
<td align="left"><strong>moonRise</strong></td>
<td>Date?</td>
<td>今日月出时间</td>
<td><code>let moonRise = currentWeather.moonRise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td align="left"><strong>moonSet</strong></td>
<td>Date?</td>
<td>今日月落时间</td>
<td><code>let moonSet = currentWeather.moonSet?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td align="left"><strong>solarZenith</strong></td>
<td>Double</td>
<td>太阳天顶角</td>
<td><code>let solarZenith = currentWeather.solarZenith</code></td>
</tr>
<tr>
<td align="left"><strong>solarElevation</strong></td>
<td>Double</td>
<td>太阳高度角</td>
<td><code>let solarElevation = currentWeather.solarElevation</code></td>
</tr>
<tr>
<td align="left"><strong>apparentTemperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>表观温度</td>
<td><code>let apparentTemp = Int(currentWeather.apparentTemperature.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>airQuality</strong></td>
<td>AirQuality?</td>
<td>空气质量指数</td>
<td>见下方详细说明</td>
</tr>
<tr>
<td align="left"><strong>pollen</strong></td>
<td>Pollen?</td>
<td>花粉指数</td>
<td>见下方详细说明</td>
</tr>
</tbody></table>
<h4 id="5-1-2-完整使用示例"><a href="#5-1-2-完整使用示例" class="headerlink" title="5.1.2 完整使用示例"></a>5.1.2 完整使用示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理并显示当前天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">displayCurrentWeather</span>(<span class="keyword">_</span> <span class="params">currentWeather</span>: <span class="type">CurrentWeather</span>) &#123;</span><br><span class="line">    <span class="comment">// 格式化日期和时间</span></span><br><span class="line">    <span class="keyword">let</span> dateFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">    dateFormatter.dateStyle <span class="operator">=</span> .medium</span><br><span class="line">    dateFormatter.timeStyle <span class="operator">=</span> .short</span><br><span class="line">    <span class="keyword">let</span> formattedDate <span class="operator">=</span> dateFormatter.string(from: currentWeather.date)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 温度相关数据</span></span><br><span class="line">    <span class="keyword">let</span> currentTemp <span class="operator">=</span> <span class="type">Int</span>(currentWeather.temperature.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> feelsLikeTemp <span class="operator">=</span> <span class="type">Int</span>(currentWeather.feelsLikeTemperature.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> dewPointTemp <span class="operator">=</span> <span class="type">Int</span>(currentWeather.dewPoint.value.rounded())</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 天气状况</span></span><br><span class="line">    <span class="keyword">let</span> condition <span class="operator">=</span> currentWeather.condition</span><br><span class="line">    <span class="keyword">let</span> conditionDesc <span class="operator">=</span> currentWeather.description</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 湿度和云覆盖率</span></span><br><span class="line">    <span class="keyword">let</span> humidityPercentage <span class="operator">=</span> <span class="type">Int</span>(currentWeather.humidity <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">let</span> cloudCoverPercentage <span class="operator">=</span> <span class="type">Int</span>(currentWeather.cloudCover <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 风向和风速</span></span><br><span class="line">    <span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Int</span>(currentWeather.wind.speed.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> windDirection <span class="operator">=</span> currentWeather.wind.direction</span><br><span class="line">    <span class="keyword">let</span> windDirectionCompass <span class="operator">=</span> getCompassDirection(from: windDirection)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 紫外线指数</span></span><br><span class="line">    <span class="keyword">let</span> uvIndex <span class="operator">=</span> <span class="type">Int</span>(currentWeather.uvIndex.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> uvIndexDesc <span class="operator">=</span> currentWeather.uvIndexDescription</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 降水信息</span></span><br><span class="line">    <span class="keyword">let</span> precipChance <span class="operator">=</span> <span class="type">Int</span>(currentWeather.precipitationChance <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">let</span> precipType <span class="operator">=</span> currentWeather.precipitationType</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 日出日落时间</span></span><br><span class="line">    <span class="keyword">let</span> sunriseTime <span class="operator">=</span> currentWeather.sunrise<span class="operator">?</span>.formatted(time: .shortened) <span class="operator">??</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    <span class="keyword">let</span> sunsetTime <span class="operator">=</span> currentWeather.sunset<span class="operator">?</span>.formatted(time: .shortened) <span class="operator">??</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 输出所有数据</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== 当前天气 ===&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;时间：<span class="subst">\(formattedDate)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;温度：<span class="subst">\(currentTemp)</span>°C，体感温度：<span class="subst">\(feelsLikeTemp)</span>°C&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;天气状况：<span class="subst">\(conditionDesc)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;湿度：<span class="subst">\(humidityPercentage)</span>%，露点温度：<span class="subst">\(dewPointTemp)</span>°C&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;风向：<span class="subst">\(windDirectionCompass)</span>，风速：<span class="subst">\(windSpeed)</span> km/h&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;云覆盖率：<span class="subst">\(cloudCoverPercentage)</span>%&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;紫外线指数：<span class="subst">\(uvIndex)</span> - <span class="subst">\(uvIndexDesc)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;降水概率：<span class="subst">\(precipChance)</span>%，降水类型：<span class="subst">\(precipType)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;日出：<span class="subst">\(sunriseTime)</span>，日落：<span class="subst">\(sunsetTime)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;================&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将风向角度转换为罗盘方向</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCompassDirection</span>(<span class="params">from</span> <span class="params">degrees</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> directions <span class="operator">=</span> [<span class="string">&quot;北&quot;</span>, <span class="string">&quot;东北&quot;</span>, <span class="string">&quot;东&quot;</span>, <span class="string">&quot;东南&quot;</span>, <span class="string">&quot;南&quot;</span>, <span class="string">&quot;西南&quot;</span>, <span class="string">&quot;西&quot;</span>, <span class="string">&quot;西北&quot;</span>]</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>((degrees <span class="operator">+</span> <span class="number">22.5</span>) <span class="operator">/</span> <span class="number">45.0</span>) <span class="operator">%</span> <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> directions[index]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-3-注意事项"><a href="#5-1-3-注意事项" class="headerlink" title="5.1.3 注意事项"></a>5.1.3 注意事项</h4><ul>
<li>体感温度（<code>feelsLikeTemperature</code>）考虑了温度、湿度、风速等因素，更能反映人体实际感受</li>
<li>紫外线指数（<code>uvIndex</code>）范围为 0-11+，数值越高紫外线越强，建议根据指数采取相应的防护措施</li>
<li>降水类型（<code>precipitationType</code>）可能为 <code>.none</code>（无降水）、<code>.rain</code>（雨）、<code>.snow</code>（雪）、<code>.sleet</code>（雨夹雪）或 <code>.hail</code>（冰雹）</li>
<li>空气质量（<code>airQuality</code>）和花粉指数（<code>pollen</code>）仅在部分地区可用</li>
<li>月相（<code>moonPhase</code>）是一个枚举值，表示当前月相阶段</li>
</ul>
<h3 id="5-2-DayWeather"><a href="#5-2-DayWeather" class="headerlink" title="5.2 DayWeather"></a>5.2 DayWeather</h3><p><code>DayWeather</code> 包含每日天气预报数据，用于显示未来几天的天气趋势。</p>
<h4 id="5-2-1-属性详细说明与使用示例"><a href="#5-2-1-属性详细说明与使用示例" class="headerlink" title="5.2.1 属性详细说明与使用示例"></a>5.2.1 属性详细说明与使用示例</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>date</strong></td>
<td>Date</td>
<td>预报日期</td>
<td><code>let date = dayWeather.date.formatted(date: .abbreviated, time: .omitted)</code></td>
</tr>
<tr>
<td><strong>temperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>当日平均温度</td>
<td><code>let avgTemp = Int(dayWeather.temperature.value.rounded())</code></td>
</tr>
<tr>
<td><strong>highTemperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>最高温度</td>
<td><code>let highTemp = Int(dayWeather.highTemperature.value.rounded())</code></td>
</tr>
<tr>
<td><strong>lowTemperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>最低温度</td>
<td><code>let lowTemp = Int(dayWeather.lowTemperature.value.rounded())</code></td>
</tr>
<tr>
<td><strong>feelsLikeTemperatureHigh</strong></td>
<td>Measurement<UnitTemperature></td>
<td>最高体感温度</td>
<td><code>let feelsLikeHigh = Int(dayWeather.feelsLikeTemperatureHigh.value.rounded())</code></td>
</tr>
<tr>
<td><strong>feelsLikeTemperatureLow</strong></td>
<td>Measurement<UnitTemperature></td>
<td>最低体感温度</td>
<td><code>let feelsLikeLow = Int(dayWeather.feelsLikeTemperatureLow.value.rounded())</code></td>
</tr>
<tr>
<td><strong>condition</strong></td>
<td>WeatherCondition</td>
<td>主要天气状况</td>
<td><code>let condition = dayWeather.condition</code></td>
</tr>
<tr>
<td><strong>description</strong></td>
<td>String</td>
<td>天气状况的文本描述</td>
<td><code>let desc = dayWeather.description</code></td>
</tr>
<tr>
<td><strong>precipitationChance</strong></td>
<td>Double</td>
<td>降水概率（0-1）</td>
<td><code>let precipChance = Int(dayWeather.precipitationChance * 100)</code></td>
</tr>
<tr>
<td><strong>precipitationAmount</strong></td>
<td>Measurement<UnitLength></td>
<td>预计降水量</td>
<td><code>let precipAmount = dayWeather.precipitationAmount.value</code></td>
</tr>
<tr>
<td><strong>precipitationType</strong></td>
<td>PrecipitationType</td>
<td>主要降水类型</td>
<td><code>let precipType = dayWeather.precipitationType</code></td>
</tr>
<tr>
<td><strong>precipitationHours</strong></td>
<td>Int</td>
<td>预计降水小时数</td>
<td><code>let precipHours = dayWeather.precipitationHours</code></td>
</tr>
<tr>
<td><strong>rainAmount</strong></td>
<td>Measurement<UnitLength></td>
<td>预计降雨量</td>
<td><code>let rainAmount = dayWeather.rainAmount.value</code></td>
</tr>
<tr>
<td><strong>snowAmount</strong></td>
<td>Measurement<UnitLength></td>
<td>预计降雪量</td>
<td><code>let snowAmount = dayWeather.snowAmount.value</code></td>
</tr>
<tr>
<td><strong>wind</strong></td>
<td>Wind</td>
<td>主要风向和风速</td>
<td><code>let windSpeed = Int(dayWeather.wind.speed.value.rounded())</code></td>
</tr>
<tr>
<td><strong>windGust</strong></td>
<td>Measurement<UnitSpeed></td>
<td>最大阵风风速</td>
<td><code>let gustSpeed = Int(dayWeather.windGust.value.rounded())</code></td>
</tr>
<tr>
<td><strong>humidity</strong></td>
<td>Double</td>
<td>平均相对湿度（0-1）</td>
<td><code>let humidity = Int(dayWeather.humidity * 100)</code></td>
</tr>
<tr>
<td><strong>pressure</strong></td>
<td>Measurement<UnitPressure></td>
<td>平均气压</td>
<td><code>let pressure = Int(dayWeather.pressure.value.rounded())</code></td>
</tr>
<tr>
<td><strong>visibility</strong></td>
<td>Measurement<UnitLength></td>
<td>平均能见度</td>
<td><code>let visibility = Int(dayWeather.visibility.value.rounded())</code></td>
</tr>
<tr>
<td><strong>uvIndex</strong></td>
<td>UVIndex</td>
<td>最高紫外线指数</td>
<td><code>let uvIndex = Int(dayWeather.uvIndex.value.rounded())</code></td>
</tr>
<tr>
<td><strong>uvIndexDescription</strong></td>
<td>String</td>
<td>紫外线指数的文本描述</td>
<td><code>let uvDesc = dayWeather.uvIndexDescription</code></td>
</tr>
<tr>
<td><strong>cloudCover</strong></td>
<td>Double</td>
<td>平均云覆盖率（0-1）</td>
<td><code>let cloudCover = Int(dayWeather.cloudCover * 100)</code></td>
</tr>
<tr>
<td><strong>sunrise</strong></td>
<td>Date?</td>
<td>日出时间</td>
<td><code>let sunrise = dayWeather.sunrise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>sunset</strong></td>
<td>Date?</td>
<td>日落时间</td>
<td><code>let sunset = dayWeather.sunset?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>moonRise</strong></td>
<td>Date?</td>
<td>月出时间</td>
<td><code>let moonRise = dayWeather.moonRise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>moonSet</strong></td>
<td>Date?</td>
<td>月落时间</td>
<td><code>let moonSet = dayWeather.moonSet?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>moonPhase</strong></td>
<td>MoonPhase</td>
<td>月相</td>
<td><code>let moonPhase = dayWeather.moonPhase</code></td>
</tr>
<tr>
<td><strong>astroSunrise</strong></td>
<td>Date?</td>
<td>天文日出时间</td>
<td><code>let astroSunrise = dayWeather.astroSunrise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>astroSunset</strong></td>
<td>Date?</td>
<td>天文日落时间</td>
<td><code>let astroSunset = dayWeather.astroSunset?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>astroMoonRise</strong></td>
<td>Date?</td>
<td>天文月出时间</td>
<td><code>let astroMoonRise = dayWeather.astroMoonRise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>astroMoonSet</strong></td>
<td>Date?</td>
<td>天文月落时间</td>
<td><code>let astroMoonSet = dayWeather.astroMoonSet?.formatted(time: .shortened)</code></td>
</tr>
</tbody></table>
<h4 id="5-2-2-完整使用示例"><a href="#5-2-2-完整使用示例" class="headerlink" title="5.2.2 完整使用示例"></a>5.2.2 完整使用示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理并显示每日天气预报数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">displayDailyForecast</span>(<span class="keyword">_</span> <span class="params">dailyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== 每日天气预报 ===&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> dayWeather <span class="keyword">in</span> dailyForecast.forecast &#123;</span><br><span class="line">        <span class="comment">// 日期格式化</span></span><br><span class="line">        <span class="keyword">let</span> dateFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        dateFormatter.dateStyle <span class="operator">=</span> .full</span><br><span class="line">        <span class="keyword">let</span> formattedDate <span class="operator">=</span> dateFormatter.string(from: dayWeather.date)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 星期几</span></span><br><span class="line">        <span class="keyword">let</span> weekdayFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        weekdayFormatter.dateFormat <span class="operator">=</span> <span class="string">&quot;EEEE&quot;</span></span><br><span class="line">        <span class="keyword">let</span> weekday <span class="operator">=</span> weekdayFormatter.string(from: dayWeather.date)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 温度数据</span></span><br><span class="line">        <span class="keyword">let</span> highTemp <span class="operator">=</span> <span class="type">Int</span>(dayWeather.highTemperature.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> lowTemp <span class="operator">=</span> <span class="type">Int</span>(dayWeather.lowTemperature.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> feelsLikeHigh <span class="operator">=</span> <span class="type">Int</span>(dayWeather.feelsLikeTemperatureHigh.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> feelsLikeLow <span class="operator">=</span> <span class="type">Int</span>(dayWeather.feelsLikeTemperatureLow.value.rounded())</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 天气状况</span></span><br><span class="line">        <span class="keyword">let</span> condition <span class="operator">=</span> dayWeather.condition</span><br><span class="line">        <span class="keyword">let</span> conditionDesc <span class="operator">=</span> dayWeather.description</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 降水信息</span></span><br><span class="line">        <span class="keyword">let</span> precipChance <span class="operator">=</span> <span class="type">Int</span>(dayWeather.precipitationChance <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">let</span> precipAmount <span class="operator">=</span> dayWeather.precipitationAmount.value</span><br><span class="line">        <span class="keyword">let</span> precipType <span class="operator">=</span> dayWeather.precipitationType</span><br><span class="line">        <span class="keyword">let</span> precipHours <span class="operator">=</span> dayWeather.precipitationHours</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 风向和风速</span></span><br><span class="line">        <span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Int</span>(dayWeather.wind.speed.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> windDirection <span class="operator">=</span> dayWeather.wind.direction</span><br><span class="line">        <span class="keyword">let</span> windDirectionCompass <span class="operator">=</span> getCompassDirection(from: windDirection)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 紫外线指数</span></span><br><span class="line">        <span class="keyword">let</span> uvIndex <span class="operator">=</span> <span class="type">Int</span>(dayWeather.uvIndex.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> uvIndexDesc <span class="operator">=</span> dayWeather.uvIndexDescription</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 日出日落时间</span></span><br><span class="line">        <span class="keyword">let</span> sunriseTime <span class="operator">=</span> dayWeather.sunrise<span class="operator">?</span>.formatted(time: .shortened) <span class="operator">??</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">        <span class="keyword">let</span> sunsetTime <span class="operator">=</span> dayWeather.sunset<span class="operator">?</span>.formatted(time: .shortened) <span class="operator">??</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 输出每日天气预报</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>日期：<span class="subst">\(formattedDate)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;星期：<span class="subst">\(weekday)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;温度：<span class="subst">\(highTemp)</span>°C / <span class="subst">\(lowTemp)</span>°C&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;体感温度：<span class="subst">\(feelsLikeHigh)</span>°C / <span class="subst">\(feelsLikeLow)</span>°C&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;天气状况：<span class="subst">\(conditionDesc)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;降水概率：<span class="subst">\(precipChance)</span>%&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> precipAmount <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;降水量：<span class="subst">\(precipAmount.roundTo(places: <span class="number">1</span>))</span> mm，降水类型：<span class="subst">\(precipType)</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;预计降水小时数：<span class="subst">\(precipHours)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;风向：<span class="subst">\(windDirectionCompass)</span>，风速：<span class="subst">\(windSpeed)</span> km/h&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;紫外线指数：<span class="subst">\(uvIndex)</span> - <span class="subst">\(uvIndexDesc)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;日出：<span class="subst">\(sunriseTime)</span>，日落：<span class="subst">\(sunsetTime)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-------------------&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;===================&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将 Double 四舍五入到指定小数位</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Double</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">roundTo</span>(<span class="params">places</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> divisor <span class="operator">=</span> pow(<span class="number">10.0</span>, <span class="type">Double</span>(places))</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">self</span> <span class="operator">*</span> divisor).rounded() <span class="operator">/</span> divisor</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将风向角度转换为罗盘方向</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCompassDirection</span>(<span class="params">from</span> <span class="params">degrees</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> directions <span class="operator">=</span> [<span class="string">&quot;北&quot;</span>, <span class="string">&quot;东北&quot;</span>, <span class="string">&quot;东&quot;</span>, <span class="string">&quot;东南&quot;</span>, <span class="string">&quot;南&quot;</span>, <span class="string">&quot;西南&quot;</span>, <span class="string">&quot;西&quot;</span>, <span class="string">&quot;西北&quot;</span>]</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>((degrees <span class="operator">+</span> <span class="number">22.5</span>) <span class="operator">/</span> <span class="number">45.0</span>) <span class="operator">%</span> <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> directions[index]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-注意事项"><a href="#5-2-3-注意事项" class="headerlink" title="5.2.3 注意事项"></a>5.2.3 注意事项</h4><ul>
<li><code>DayWeather</code> 默认返回未来7天的天气预报</li>
<li>降水量相关属性（<code>precipitationAmount</code>、<code>rainAmount</code>、<code>snowAmount</code>）的值可能为0，表示无降水</li>
<li><code>precipitationType</code> 可能为 <code>.none</code>，表示当日无降水</li>
<li>天文日出日落时间（<code>astroSunrise</code>、<code>astroSunset</code>）与实际日出日落时间（<code>sunrise</code>、<code>sunset</code>）可能略有不同，前者不考虑大气折射</li>
<li>月相（<code>moonPhase</code>）是一个枚举值，表示当前月相阶段，如新月、上弦月、满月、下弦月等</li>
</ul>
<h3 id="5-3-HourWeather"><a href="#5-3-HourWeather" class="headerlink" title="5.3 HourWeather"></a>5.3 HourWeather</h3><p><code>HourWeather</code> 包含每小时天气预报数据，用于显示未来数小时的天气变化趋势。</p>
<h4 id="5-3-1-属性详细说明与使用示例"><a href="#5-3-1-属性详细说明与使用示例" class="headerlink" title="5.3.1 属性详细说明与使用示例"></a>5.3.1 属性详细说明与使用示例</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>date</strong></td>
<td>Date</td>
<td>预报时间</td>
<td><code>let time = hourWeather.date.formatted(date: .omitted, time: .shortened)</code></td>
</tr>
<tr>
<td><strong>temperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>温度</td>
<td><code>let temp = Int(hourWeather.temperature.value.rounded())</code></td>
</tr>
<tr>
<td><strong>feelsLikeTemperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>体感温度</td>
<td><code>let feelsLike = Int(hourWeather.feelsLikeTemperature.value.rounded())</code></td>
</tr>
<tr>
<td><strong>condition</strong></td>
<td>WeatherCondition</td>
<td>天气状况</td>
<td><code>let condition = hourWeather.condition</code></td>
</tr>
<tr>
<td><strong>precipitationChance</strong></td>
<td>Double</td>
<td>降水概率（0-1）</td>
<td><code>let precipChance = Int(hourWeather.precipitationChance * 100)</code></td>
</tr>
<tr>
<td><strong>precipitationAmount</strong></td>
<td>Measurement<UnitLength></td>
<td>降水量</td>
<td><code>let precipAmount = hourWeather.precipitationAmount.value</code></td>
</tr>
<tr>
<td><strong>precipitationType</strong></td>
<td>PrecipitationType</td>
<td>降水类型（雨、雪、冰雹等）</td>
<td><code>let precipType = hourWeather.precipitationType</code></td>
</tr>
<tr>
<td><strong>wind</strong></td>
<td>Wind</td>
<td>风向和风速</td>
<td><code>let windSpeed = Int(hourWeather.wind.speed.value.rounded())</code></td>
</tr>
<tr>
<td><strong>humidity</strong></td>
<td>Double</td>
<td>相对湿度（0-1）</td>
<td><code>let humidity = Int(hourWeather.humidity * 100)</code></td>
</tr>
<tr>
<td><strong>pressure</strong></td>
<td>Measurement<UnitPressure></td>
<td>气压</td>
<td><code>let pressure = Int(hourWeather.pressure.value.rounded())</code></td>
</tr>
<tr>
<td><strong>visibility</strong></td>
<td>Measurement<UnitLength></td>
<td>能见度</td>
<td><code>let visibility = Int(hourWeather.visibility.value.rounded())</code></td>
</tr>
<tr>
<td><strong>uvIndex</strong></td>
<td>UVIndex</td>
<td>紫外线指数</td>
<td><code>let uvIndex = Int(hourWeather.uvIndex.value.rounded())</code></td>
</tr>
<tr>
<td><strong>cloudCover</strong></td>
<td>Double</td>
<td>云覆盖率（0-1）</td>
<td><code>let cloudCover = Int(hourWeather.cloudCover * 100)</code></td>
</tr>
<tr>
<td><strong>sunrise</strong></td>
<td>Date?</td>
<td>日出时间（仅当日小时）</td>
<td><code>let sunrise = hourWeather.sunrise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>sunset</strong></td>
<td>Date?</td>
<td>日落时间（仅当日小时）</td>
<td><code>let sunset = hourWeather.sunset?.formatted(time: .shortened)</code></td>
</tr>
</tbody></table>
<h4 id="5-3-2-完整使用示例"><a href="#5-3-2-完整使用示例" class="headerlink" title="5.3.2 完整使用示例"></a>5.3.2 完整使用示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理并显示每小时天气预报数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">displayHourlyForecast</span>(<span class="keyword">_</span> <span class="params">hourlyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== 每小时天气预报 ===&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只显示未来24小时的预报</span></span><br><span class="line">    <span class="keyword">let</span> next24Hours <span class="operator">=</span> hourlyForecast.forecast.prefix(<span class="number">24</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> hourWeather <span class="keyword">in</span> next24Hours &#123;</span><br><span class="line">        <span class="comment">// 时间格式化</span></span><br><span class="line">        <span class="keyword">let</span> timeFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        timeFormatter.dateStyle <span class="operator">=</span> .abbreviated</span><br><span class="line">        timeFormatter.timeStyle <span class="operator">=</span> .short</span><br><span class="line">        <span class="keyword">let</span> formattedTime <span class="operator">=</span> timeFormatter.string(from: hourWeather.date)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 小时</span></span><br><span class="line">        <span class="keyword">let</span> hourFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        hourFormatter.dateFormat <span class="operator">=</span> <span class="string">&quot;HH:mm&quot;</span></span><br><span class="line">        <span class="keyword">let</span> hour <span class="operator">=</span> hourFormatter.string(from: hourWeather.date)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 温度数据</span></span><br><span class="line">        <span class="keyword">let</span> temp <span class="operator">=</span> <span class="type">Int</span>(hourWeather.temperature.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> feelsLike <span class="operator">=</span> <span class="type">Int</span>(hourWeather.feelsLikeTemperature.value.rounded())</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 天气状况</span></span><br><span class="line">        <span class="keyword">let</span> condition <span class="operator">=</span> hourWeather.condition</span><br><span class="line">        <span class="keyword">let</span> conditionDesc <span class="operator">=</span> hourWeather.description</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 降水信息</span></span><br><span class="line">        <span class="keyword">let</span> precipChance <span class="operator">=</span> <span class="type">Int</span>(hourWeather.precipitationChance <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">let</span> precipAmount <span class="operator">=</span> hourWeather.precipitationAmount.value</span><br><span class="line">        <span class="keyword">let</span> precipType <span class="operator">=</span> hourWeather.precipitationType</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 风向和风速</span></span><br><span class="line">        <span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Int</span>(hourWeather.wind.speed.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> windDirection <span class="operator">=</span> hourWeather.wind.direction</span><br><span class="line">        <span class="keyword">let</span> windDirectionCompass <span class="operator">=</span> getCompassDirection(from: windDirection)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 湿度和云覆盖率</span></span><br><span class="line">        <span class="keyword">let</span> humidity <span class="operator">=</span> <span class="type">Int</span>(hourWeather.humidity <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">let</span> cloudCover <span class="operator">=</span> <span class="type">Int</span>(hourWeather.cloudCover <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 输出每小时天气预报</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>时间：<span class="subst">\(formattedTime)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;小时：<span class="subst">\(hour)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;温度：<span class="subst">\(temp)</span>°C，体感温度：<span class="subst">\(feelsLike)</span>°C&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;天气状况：<span class="subst">\(conditionDesc)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;降水概率：<span class="subst">\(precipChance)</span>%&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> precipAmount <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;降水量：<span class="subst">\(precipAmount.roundTo(places: <span class="number">1</span>))</span> mm，降水类型：<span class="subst">\(precipType)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;风向：<span class="subst">\(windDirectionCompass)</span>，风速：<span class="subst">\(windSpeed)</span> km/h&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;湿度：<span class="subst">\(humidity)</span>%，云覆盖率：<span class="subst">\(cloudCover)</span>%&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-------------------&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;===================&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将 Double 四舍五入到指定小数位</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Double</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">roundTo</span>(<span class="params">places</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> divisor <span class="operator">=</span> pow(<span class="number">10.0</span>, <span class="type">Double</span>(places))</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">self</span> <span class="operator">*</span> divisor).rounded() <span class="operator">/</span> divisor</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将风向角度转换为罗盘方向</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCompassDirection</span>(<span class="params">from</span> <span class="params">degrees</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> directions <span class="operator">=</span> [<span class="string">&quot;北&quot;</span>, <span class="string">&quot;东北&quot;</span>, <span class="string">&quot;东&quot;</span>, <span class="string">&quot;东南&quot;</span>, <span class="string">&quot;南&quot;</span>, <span class="string">&quot;西南&quot;</span>, <span class="string">&quot;西&quot;</span>, <span class="string">&quot;西北&quot;</span>]</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>((degrees <span class="operator">+</span> <span class="number">22.5</span>) <span class="operator">/</span> <span class="number">45.0</span>) <span class="operator">%</span> <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> directions[index]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-3-注意事项"><a href="#5-3-3-注意事项" class="headerlink" title="5.3.3 注意事项"></a>5.3.3 注意事项</h4><ul>
<li><code>HourWeather</code> 默认返回未来12小时的天气预报</li>
<li>每小时预报的时间间隔为1小时</li>
<li>紫外线指数（<code>uvIndex</code>）在夜间可能为0或无值</li>
<li>日出和日落时间（<code>sunrise</code>、<code>sunset</code>）仅在包含日出或日落的特定小时有值</li>
<li>降水量（<code>precipitationAmount</code>）的值可能为0，表示该小时无降水</li>
</ul>
<h3 id="5-4-MinuteWeather"><a href="#5-4-MinuteWeather" class="headerlink" title="5.4 MinuteWeather"></a>5.4 MinuteWeather</h3><p><code>MinuteWeather</code> 包含未来1小时内的逐分钟降水预报数据，仅在部分地区可用。</p>
<h4 id="5-4-1-属性详细说明与使用示例"><a href="#5-4-1-属性详细说明与使用示例" class="headerlink" title="5.4.1 属性详细说明与使用示例"></a>5.4.1 属性详细说明与使用示例</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>date</strong></td>
<td>Date</td>
<td>预报时间点</td>
<td><code>let time = minuteWeather.date.formatted(date: .omitted, time: .seconded)</code></td>
</tr>
<tr>
<td><strong>precipitationIntensity</strong></td>
<td>Measurement<UnitPrecipitationRate></td>
<td>降水强度</td>
<td><code>let intensity = minuteWeather.precipitationIntensity.value</code></td>
</tr>
<tr>
<td><strong>precipitationChance</strong></td>
<td>Double</td>
<td>降水概率（0-1）</td>
<td><code>let precipChance = Int(minuteWeather.precipitationChance * 100)</code></td>
</tr>
<tr>
<td><strong>precipitationType</strong></td>
<td>PrecipitationType</td>
<td>降水类型（雨、雪、冰雹等）</td>
<td><code>let precipType = minuteWeather.precipitationType</code></td>
</tr>
</tbody></table>
<h4 id="5-4-2-完整使用示例"><a href="#5-4-2-完整使用示例" class="headerlink" title="5.4.2 完整使用示例"></a>5.4.2 完整使用示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理并显示分钟级降水预报数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">displayMinuteForecast</span>(<span class="keyword">_</span> <span class="params">minuteForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">MinuteWeather</span>&gt;) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== 分钟级降水预报 ===&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查是否有降水预报</span></span><br><span class="line">    <span class="keyword">let</span> hasPrecipitation <span class="operator">=</span> minuteForecast.forecast.contains &#123; <span class="variable">$0</span>.precipitationChance <span class="operator">&gt;</span> <span class="number">0</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="operator">!</span>hasPrecipitation &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未来1小时内无降水预报&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;未来1小时内降水预报：&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (index, minuteWeather) <span class="keyword">in</span> minuteForecast.forecast.enumerated() &#123;</span><br><span class="line">        <span class="comment">// 时间格式化</span></span><br><span class="line">        <span class="keyword">let</span> timeFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        timeFormatter.timeStyle <span class="operator">=</span> .short</span><br><span class="line">        <span class="keyword">let</span> formattedTime <span class="operator">=</span> timeFormatter.string(from: minuteWeather.date)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 降水信息</span></span><br><span class="line">        <span class="keyword">let</span> precipChance <span class="operator">=</span> <span class="type">Int</span>(minuteWeather.precipitationChance <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">let</span> intensity <span class="operator">=</span> minuteWeather.precipitationIntensity.value</span><br><span class="line">        <span class="keyword">let</span> precipType <span class="operator">=</span> minuteWeather.precipitationType</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 只显示有降水概率的时间段</span></span><br><span class="line">        <span class="keyword">if</span> precipChance <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            <span class="comment">// 降水强度描述</span></span><br><span class="line">            <span class="keyword">let</span> intensityDesc <span class="operator">=</span> getPrecipitationIntensityDescription(from: intensity)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>时间：<span class="subst">\(formattedTime)</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;分钟：<span class="subst">\(index <span class="operator">+</span> <span class="number">1</span>)</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;降水概率：<span class="subst">\(precipChance)</span>%&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;降水强度：<span class="subst">\(intensity.roundTo(places: <span class="number">2</span>))</span> mm/h，<span class="subst">\(intensityDesc)</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;降水类型：<span class="subst">\(precipType)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;===================&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：根据降水强度返回描述</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPrecipitationIntensityDescription</span>(<span class="params">from</span> <span class="params">intensity</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">0.1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;微量&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">2.5</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;小雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">7.6</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;中雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">50</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;大雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;暴雨&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将 Double 四舍五入到指定小数位</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Double</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">roundTo</span>(<span class="params">places</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> divisor <span class="operator">=</span> pow(<span class="number">10.0</span>, <span class="type">Double</span>(places))</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">self</span> <span class="operator">*</span> divisor).rounded() <span class="operator">/</span> divisor</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-4-3-注意事项"><a href="#5-4-3-注意事项" class="headerlink" title="5.4.3 注意事项"></a>5.4.3 注意事项</h4><ul>
<li><code>MinuteWeather</code> 仅在部分地区可用，在不支持的地区获取时会返回空数据或抛出错误</li>
<li>默认返回未来60分钟的逐分钟预报</li>
<li>主要用于显示近期降水趋势，帮助用户决定是否需要携带雨具</li>
<li>降水强度单位为毫米&#x2F;小时（mm&#x2F;h）或英寸&#x2F;小时（in&#x2F;h），取决于地区设置</li>
</ul>
<h3 id="5-5-WeatherAttribution"><a href="#5-5-WeatherAttribution" class="headerlink" title="5.5 WeatherAttribution"></a>5.5 WeatherAttribution</h3><p><code>WeatherAttribution</code> 包含天气数据的来源归因信息，用于显示版权信息。根据 Apple 的要求，使用 WeatherKit 数据的应用必须显示这些归因信息。</p>
<h4 id="5-5-1-属性详细说明与使用示例"><a href="#5-5-1-属性详细说明与使用示例" class="headerlink" title="5.5.1 属性详细说明与使用示例"></a>5.5.1 属性详细说明与使用示例</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>logoLightURL</strong></td>
<td>URL?</td>
<td>亮色背景下的归因Logo URL</td>
<td><code>let lightLogoURL = attribution.logoLightURL</code></td>
</tr>
<tr>
<td><strong>logoDarkURL</strong></td>
<td>URL?</td>
<td>暗色背景下的归因Logo URL</td>
<td><code>let darkLogoURL = attribution.logoDarkURL</code></td>
</tr>
<tr>
<td><strong>legalText</strong></td>
<td>String</td>
<td>法律声明文本</td>
<td><code>let legalText = attribution.legalText</code></td>
</tr>
<tr>
<td><strong>privacyPolicyURL</strong></td>
<td>URL?</td>
<td>隐私政策URL</td>
<td><code>let privacyURL = attribution.privacyPolicyURL</code></td>
</tr>
<tr>
<td><strong>termsOfServiceURL</strong></td>
<td>URL?</td>
<td>服务条款URL</td>
<td><code>let termsURL = attribution.termsOfServiceURL</code></td>
</tr>
</tbody></table>
<h4 id="5-5-2-完整使用示例"><a href="#5-5-2-完整使用示例" class="headerlink" title="5.5.2 完整使用示例"></a>5.5.2 完整使用示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 显示天气数据归因信息</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">showWeatherAttribution</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.attribution</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 显示法律声明</span></span><br><span class="line">            <span class="keyword">let</span> attributionLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">            attributionLabel.text <span class="operator">=</span> attribution.legalText</span><br><span class="line">            attributionLabel.font <span class="operator">=</span> .systemFont(ofSize: <span class="number">12</span>)</span><br><span class="line">            attributionLabel.textColor <span class="operator">=</span> .secondaryLabel</span><br><span class="line">            attributionLabel.textAlignment <span class="operator">=</span> .center</span><br><span class="line">            attributionLabel.numberOfLines <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">            view.addSubview(attributionLabel)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 约束设置</span></span><br><span class="line">            attributionLabel.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">            <span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">                attributionLabel.bottomAnchor.constraint(equalTo: view.safeAreaLayoutGuide.bottomAnchor, constant: <span class="operator">-</span><span class="number">20</span>),</span><br><span class="line">                attributionLabel.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: <span class="number">20</span>),</span><br><span class="line">                attributionLabel.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: <span class="operator">-</span><span class="number">20</span>)</span><br><span class="line">            ])</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 显示归因Logo（根据当前外观模式选择合适的Logo）</span></span><br><span class="line">            <span class="keyword">let</span> isDarkMode <span class="operator">=</span> traitCollection.userInterfaceStyle <span class="operator">==</span> .dark</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> logoURL <span class="operator">=</span> isDarkMode <span class="operator">?</span> attribution.logoDarkURL : attribution.logoLightURL &#123;</span><br><span class="line">                <span class="keyword">let</span> logoImageView <span class="operator">=</span> <span class="type">UIImageView</span>()</span><br><span class="line">                logoImageView.contentMode <span class="operator">=</span> .scaleAspectFit</span><br><span class="line">                logoImageView.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">                view.addSubview(logoImageView)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 从URL加载图片</span></span><br><span class="line">                <span class="type">URLSession</span>.shared.dataTask(with: logoURL) &#123; data, response, error <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> data <span class="operator">=</span> data, <span class="keyword">let</span> image <span class="operator">=</span> <span class="type">UIImage</span>(data: data) &#123;</span><br><span class="line">                        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                            logoImageView.image <span class="operator">=</span> image</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;.resume()</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 约束设置</span></span><br><span class="line">                <span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">                    logoImageView.topAnchor.constraint(equalTo: attributionLabel.bottomAnchor, constant: <span class="number">10</span>),</span><br><span class="line">                    logoImageView.centerXAnchor.constraint(equalTo: view.centerXAnchor),</span><br><span class="line">                    logoImageView.widthAnchor.constraint(equalToConstant: <span class="number">100</span>),</span><br><span class="line">                    logoImageView.heightAnchor.constraint(equalToConstant: <span class="number">30</span>)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加隐私政策和服务条款链接</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> privacyURL <span class="operator">=</span> attribution.privacyPolicyURL, <span class="keyword">let</span> termsURL <span class="operator">=</span> attribution.termsOfServiceURL &#123;</span><br><span class="line">                <span class="keyword">let</span> linksStackView <span class="operator">=</span> <span class="type">UIStackView</span>()</span><br><span class="line">                linksStackView.axis <span class="operator">=</span> .horizontal</span><br><span class="line">                linksStackView.spacing <span class="operator">=</span> <span class="number">20</span></span><br><span class="line">                linksStackView.alignment <span class="operator">=</span> .center</span><br><span class="line">                linksStackView.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">                view.addSubview(linksStackView)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 隐私政策按钮</span></span><br><span class="line">                <span class="keyword">let</span> privacyButton <span class="operator">=</span> <span class="type">UIButton</span>(type: .system)</span><br><span class="line">                privacyButton.setTitle(<span class="string">&quot;隐私政策&quot;</span>, for: .normal)</span><br><span class="line">                privacyButton.titleLabel<span class="operator">?</span>.font <span class="operator">=</span> .systemFont(ofSize: <span class="number">12</span>)</span><br><span class="line">                privacyButton.addTarget(<span class="keyword">self</span>, action: <span class="keyword">#selector</span>(openPrivacyPolicy), for: .touchUpInside)</span><br><span class="line">                linksStackView.addArrangedSubview(privacyButton)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 服务条款按钮</span></span><br><span class="line">                <span class="keyword">let</span> termsButton <span class="operator">=</span> <span class="type">UIButton</span>(type: .system)</span><br><span class="line">                termsButton.setTitle(<span class="string">&quot;服务条款&quot;</span>, for: .normal)</span><br><span class="line">                termsButton.titleLabel<span class="operator">?</span>.font <span class="operator">=</span> .systemFont(ofSize: <span class="number">12</span>)</span><br><span class="line">                termsButton.addTarget(<span class="keyword">self</span>, action: <span class="keyword">#selector</span>(openTermsOfService), for: .touchUpInside)</span><br><span class="line">                linksStackView.addArrangedSubview(termsButton)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 约束设置</span></span><br><span class="line">                <span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">                    linksStackView.topAnchor.constraint(equalTo: attributionLabel.topAnchor, constant: <span class="operator">-</span><span class="number">20</span>),</span><br><span class="line">                    linksStackView.centerXAnchor.constraint(equalTo: view.centerXAnchor)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取归因信息失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开隐私政策</span></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">openPrivacyPolicy</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.attribution</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> privacyURL <span class="operator">=</span> attribution.privacyPolicyURL &#123;</span><br><span class="line">                <span class="type">UIApplication</span>.shared.open(privacyURL)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;打开隐私政策失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开服务条款</span></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">openTermsOfService</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.attribution</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> termsURL <span class="operator">=</span> attribution.termsOfServiceURL &#123;</span><br><span class="line">                <span class="type">UIApplication</span>.shared.open(termsURL)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;打开服务条款失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-辅助数据类型"><a href="#6-辅助数据类型" class="headerlink" title="6. 辅助数据类型"></a>6. 辅助数据类型</h2><p>WeatherKit 中包含一些辅助数据类型，用于表示天气数据的特定方面。以下是这些辅助数据类型的详细说明和使用方法：</p>
<h3 id="6-1-Wind"><a href="#6-1-Wind" class="headerlink" title="6.1 Wind"></a>6.1 Wind</h3><p><code>Wind</code> 表示风向和风速信息。</p>
<h4 id="6-1-1-属性说明"><a href="#6-1-1-属性说明" class="headerlink" title="6.1.1 属性说明"></a>6.1.1 属性说明</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>speed</strong></td>
<td>Measurement<UnitSpeed></td>
<td>风速</td>
</tr>
<tr>
<td><strong>direction</strong></td>
<td>Double</td>
<td>风向（以度数表示，0°表示北风，顺时针递增）</td>
</tr>
</tbody></table>
<h4 id="6-1-2-使用示例"><a href="#6-1-2-使用示例" class="headerlink" title="6.1.2 使用示例"></a>6.1.2 使用示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理风向和风速数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatWindData</span>(<span class="keyword">_</span> <span class="params">wind</span>: <span class="type">Wind</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Int</span>(wind.speed.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> windDirection <span class="operator">=</span> wind.direction</span><br><span class="line">    <span class="keyword">let</span> windDirectionCompass <span class="operator">=</span> getCompassDirection(from: windDirection)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(windSpeed)</span> km/h，<span class="subst">\(windDirectionCompass)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将风向角度转换为罗盘方向</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCompassDirection</span>(<span class="params">from</span> <span class="params">degrees</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> directions <span class="operator">=</span> [<span class="string">&quot;北&quot;</span>, <span class="string">&quot;东北&quot;</span>, <span class="string">&quot;东&quot;</span>, <span class="string">&quot;东南&quot;</span>, <span class="string">&quot;南&quot;</span>, <span class="string">&quot;西南&quot;</span>, <span class="string">&quot;西&quot;</span>, <span class="string">&quot;西北&quot;</span>]</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>((degrees <span class="operator">+</span> <span class="number">22.5</span>) <span class="operator">/</span> <span class="number">45.0</span>) <span class="operator">%</span> <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> directions[index]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">15</span>, unit: <span class="type">UnitSpeed</span>.kilometersPerHour)</span><br><span class="line"><span class="keyword">let</span> windData <span class="operator">=</span> <span class="type">Wind</span>(speed: windSpeed, direction: <span class="number">90</span>) <span class="comment">// 东风，15 km/h</span></span><br><span class="line"><span class="keyword">let</span> formattedWind <span class="operator">=</span> formatWindData(windData)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;风向风速：<span class="subst">\(formattedWind)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-2-Precipitation"><a href="#6-2-Precipitation" class="headerlink" title="6.2 Precipitation"></a>6.2 Precipitation</h3><p><code>Precipitation</code> 表示降水信息。</p>
<h4 id="6-2-1-属性说明"><a href="#6-2-1-属性说明" class="headerlink" title="6.2.1 属性说明"></a>6.2.1 属性说明</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>intensity</strong></td>
<td>Measurement<UnitPrecipitationRate></td>
<td>降水强度</td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>PrecipitationType</td>
<td>降水类型</td>
</tr>
</tbody></table>
<h4 id="6-2-2-使用示例"><a href="#6-2-2-使用示例" class="headerlink" title="6.2.2 使用示例"></a>6.2.2 使用示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理降水数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatPrecipitationData</span>(<span class="keyword">_</span> <span class="params">precipitation</span>: <span class="type">Precipitation</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> intensity <span class="operator">=</span> precipitation.intensity.value</span><br><span class="line">    <span class="keyword">let</span> intensityDesc <span class="operator">=</span> getPrecipitationIntensityDescription(from: intensity)</span><br><span class="line">    <span class="keyword">let</span> type <span class="operator">=</span> precipitation.type</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(intensityDesc)</span>，<span class="subst">\(type)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据降水强度返回描述</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPrecipitationIntensityDescription</span>(<span class="params">from</span> <span class="params">intensity</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">0.1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;微量&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">2.5</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;小雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">7.6</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;中雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">50</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;大雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;暴雨&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> intensity <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">3.5</span>, unit: <span class="type">UnitPrecipitationRate</span>.millimetersPerHour)</span><br><span class="line"><span class="keyword">let</span> precipData <span class="operator">=</span> <span class="type">Precipitation</span>(intensity: intensity, type: .rain)</span><br><span class="line"><span class="keyword">let</span> formattedPrecip <span class="operator">=</span> formatPrecipitationData(precipData)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;降水情况：<span class="subst">\(formattedPrecip)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-3-PrecipitationType"><a href="#6-3-PrecipitationType" class="headerlink" title="6.3 PrecipitationType"></a>6.3 PrecipitationType</h3><p><code>PrecipitationType</code> 是一个枚举，表示降水类型。</p>
<h4 id="6-3-1-枚举值说明"><a href="#6-3-1-枚举值说明" class="headerlink" title="6.3.1 枚举值说明"></a>6.3.1 枚举值说明</h4><table>
<thead>
<tr>
<th>枚举值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>none</strong></td>
<td>无降水</td>
</tr>
<tr>
<td><strong>rain</strong></td>
<td>雨</td>
</tr>
<tr>
<td><strong>snow</strong></td>
<td>雪</td>
</tr>
<tr>
<td><strong>sleet</strong></td>
<td>雨夹雪</td>
</tr>
<tr>
<td><strong>hail</strong></td>
<td>冰雹</td>
</tr>
</tbody></table>
<h4 id="6-3-2-使用示例"><a href="#6-3-2-使用示例" class="headerlink" title="6.3.2 使用示例"></a>6.3.2 使用示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取降水类型的中文描述</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPrecipitationTypeDescription</span>(<span class="keyword">_</span> <span class="params">type</span>: <span class="type">PrecipitationType</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> type &#123;</span><br><span class="line">    <span class="keyword">case</span> .none:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;无降水&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .rain:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;雨&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .snow:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;雪&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .sleet:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;雨夹雪&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .hail:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;冰雹&quot;</span></span><br><span class="line">    <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-UVIndex"><a href="#6-4-UVIndex" class="headerlink" title="6.4 UVIndex"></a>6.4 UVIndex</h3><p><code>UVIndex</code> 表示紫外线指数。</p>
<h4 id="6-4-1-使用示例"><a href="#6-4-1-使用示例" class="headerlink" title="6.4.1 使用示例"></a>6.4.1 使用示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理紫外线指数数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatUVIndex</span>(<span class="keyword">_</span> <span class="params">uvIndex</span>: <span class="type">UVIndex</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>(uvIndex.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> description <span class="operator">=</span> getUVIndexDescription(from: index)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(index)</span> - <span class="subst">\(description)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取紫外线指数的中文描述</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getUVIndexDescription</span>(<span class="params">from</span> <span class="params">index</span>: <span class="type">Int</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> index &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span><span class="operator">...</span><span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;低&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span><span class="operator">...</span><span class="number">5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;中等&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span><span class="operator">...</span><span class="number">7</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;高&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span><span class="operator">...</span><span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;很高&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">11</span><span class="operator">...</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;极高&quot;</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> uvIndex <span class="operator">=</span> <span class="type">UVIndex</span>(value: <span class="number">6.5</span>)</span><br><span class="line"><span class="keyword">let</span> formattedUVIndex <span class="operator">=</span> formatUVIndex(uvIndex)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;紫外线指数：<span class="subst">\(formattedUVIndex)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-5-MoonPhase"><a href="#6-5-MoonPhase" class="headerlink" title="6.5 MoonPhase"></a>6.5 MoonPhase</h3><p><code>MoonPhase</code> 是一个枚举，表示月相阶段。</p>
<h4 id="6-5-1-枚举值说明"><a href="#6-5-1-枚举值说明" class="headerlink" title="6.5.1 枚举值说明"></a>6.5.1 枚举值说明</h4><table>
<thead>
<tr>
<th>枚举值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>new</strong></td>
<td>新月</td>
</tr>
<tr>
<td><strong>waxingCrescent</strong></td>
<td>娥眉月（新月到上弦月）</td>
</tr>
<tr>
<td><strong>firstQuarter</strong></td>
<td>上弦月</td>
</tr>
<tr>
<td><strong>waxingGibbous</strong></td>
<td>盈凸月（上弦月到满月）</td>
</tr>
<tr>
<td><strong>full</strong></td>
<td>满月</td>
</tr>
<tr>
<td><strong>waningGibbous</strong></td>
<td>亏凸月（满月到下弦月）</td>
</tr>
<tr>
<td><strong>thirdQuarter</strong></td>
<td>下弦月</td>
</tr>
<tr>
<td><strong>waningCrescent</strong></td>
<td>残月（下弦月到新月）</td>
</tr>
</tbody></table>
<h4 id="6-5-2-使用示例"><a href="#6-5-2-使用示例" class="headerlink" title="6.5.2 使用示例"></a>6.5.2 使用示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取月相的中文描述</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getMoonPhaseDescription</span>(<span class="keyword">_</span> <span class="params">phase</span>: <span class="type">MoonPhase</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> phase &#123;</span><br><span class="line">    <span class="keyword">case</span> .new:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;新月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .waxingCrescent:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;娥眉月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .firstQuarter:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;上弦月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .waxingGibbous:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;盈凸月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .full:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;满月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .waningGibbous:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;亏凸月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .thirdQuarter:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;下弦月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .waningCrescent:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;残月&quot;</span></span><br><span class="line">    <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> moonPhase <span class="operator">=</span> <span class="type">MoonPhase</span>.full</span><br><span class="line"><span class="keyword">let</span> phaseDesc <span class="operator">=</span> getMoonPhaseDescription(moonPhase)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;月相：<span class="subst">\(phaseDesc)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="7-错误处理"><a href="#7-错误处理" class="headerlink" title="7. 错误处理"></a>7. 错误处理</h2><p>WeatherKit 可能抛出以下类型的错误，了解这些错误类型可以帮助您更好地处理异常情况：</p>
<h3 id="7-1-完整的-WeatherError-类型"><a href="#7-1-完整的-WeatherError-类型" class="headerlink" title="7.1 完整的 WeatherError 类型"></a>7.1 完整的 WeatherError 类型</h3><table>
<thead>
<tr>
<th>错误类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>locationAccessDenied</strong></td>
<td>位置访问被拒绝，用户未授权应用访问位置</td>
</tr>
<tr>
<td><strong>locationUnknown</strong></td>
<td>无法获取设备位置，可能是因为设备处于飞行模式或信号较弱</td>
</tr>
<tr>
<td><strong>networkError</strong></td>
<td>网络错误，无法连接到天气服务</td>
</tr>
<tr>
<td><strong>serviceUnavailable</strong></td>
<td>天气服务暂时不可用</td>
</tr>
<tr>
<td><strong>invalidCoordinates</strong></td>
<td>提供的坐标无效或不在支持的区域内</td>
</tr>
<tr>
<td><strong>weatherDataUnavailable</strong></td>
<td>无法获取请求的天气数据，可能是因为该地区不支持某些数据类型</td>
</tr>
<tr>
<td><strong>historicalDataUnavailable</strong></td>
<td>无法获取请求的历史天气数据</td>
</tr>
<tr>
<td><strong>searchResultsUnavailable</strong></td>
<td>无法获取搜索结果</td>
</tr>
<tr>
<td><strong>attributionUnavailable</strong></td>
<td>无法获取天气数据归因信息</td>
</tr>
<tr>
<td><strong>unsupportedFeature</strong></td>
<td>请求的功能在当前设备或 iOS 版本上不受支持</td>
</tr>
<tr>
<td><strong>unknown</strong></td>
<td>发生了未知错误</td>
</tr>
</tbody></table>
<h3 id="6-2-详细的错误处理示例"><a href="#6-2-详细的错误处理示例" class="headerlink" title="6.2 详细的错误处理示例"></a>6.2 详细的错误处理示例</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">        for: location,</span><br><span class="line">        including: .current, .daily, .hourly</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// 使用天气数据</span></span><br><span class="line">    updateUI(current: currentWeather, daily: dailyForecast, hourly: hourlyForecast, location: location)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.locationAccessDenied &#123;</span><br><span class="line">    showError(<span class="string">&quot;位置访问被拒绝，请在设置中允许应用访问您的位置&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.locationUnknown &#123;</span><br><span class="line">    showError(<span class="string">&quot;无法获取您的位置，请检查位置服务是否开启&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.networkError &#123;</span><br><span class="line">    showError(<span class="string">&quot;网络连接失败，请检查您的网络设置&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.serviceUnavailable &#123;</span><br><span class="line">    showError(<span class="string">&quot;天气服务暂时不可用，请稍后再试&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.invalidCoordinates &#123;</span><br><span class="line">    showError(<span class="string">&quot;提供的位置无效，请尝试其他位置&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.weatherDataUnavailable &#123;</span><br><span class="line">    showError(<span class="string">&quot;无法获取该地区的天气数据&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.unsupportedFeature &#123;</span><br><span class="line">    showError(<span class="string">&quot;当前设备不支持该功能&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-处理历史天气数据错误"><a href="#6-3-处理历史天气数据错误" class="headerlink" title="6.3 处理历史天气数据错误"></a>6.3 处理历史天气数据错误</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> historicalWeather <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.historicalWeather(</span><br><span class="line">        for: location,</span><br><span class="line">        including: .daily,</span><br><span class="line">        from: startDate,</span><br><span class="line">        to: endDate</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// 使用历史天气数据</span></span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.historicalDataUnavailable &#123;</span><br><span class="line">    showError(<span class="string">&quot;无法获取该时间段的历史天气数据&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    showError(<span class="string">&quot;获取历史天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-处理搜索错误"><a href="#6-4-处理搜索错误" class="headerlink" title="6.4 处理搜索错误"></a>6.4 处理搜索错误</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> searchResults <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.search(for: <span class="string">&quot;Beijing&quot;</span>)</span><br><span class="line">    <span class="comment">// 使用搜索结果</span></span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.searchResultsUnavailable &#123;</span><br><span class="line">    showError(<span class="string">&quot;无法获取搜索结果，请检查网络连接&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    showError(<span class="string">&quot;搜索失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-数据单位转换"><a href="#7-数据单位转换" class="headerlink" title="7. 数据单位转换"></a>7. 数据单位转换</h2><p>WeatherKit 返回的天气数据使用 <code>Measurement</code> 类型，这使得单位转换变得非常简单。以下是一些常见的单位转换示例：</p>
<h3 id="7-1-温度单位转换"><a href="#7-1-温度单位转换" class="headerlink" title="7.1 温度单位转换"></a>7.1 温度单位转换</h3><p>温度单位转换是 WeatherKit 应用中最常见的单位转换需求。以下是完整的温度单位转换规则和示例：</p>
<h4 id="7-1-1-常用温度单位"><a href="#7-1-1-常用温度单位" class="headerlink" title="7.1.1 常用温度单位"></a>7.1.1 常用温度单位</h4><ul>
<li><strong>摄氏度（°C）</strong>：国际标准单位，符号为 °C</li>
<li><strong>华氏度（°F）</strong>：主要在美国使用，符号为 °F</li>
<li><strong>开尔文（K）</strong>：热力学温度单位，符号为 K</li>
</ul>
<h4 id="7-1-2-转换公式"><a href="#7-1-2-转换公式" class="headerlink" title="7.1.2 转换公式"></a>7.1.2 转换公式</h4><ul>
<li>摄氏度转华氏度：°F &#x3D; °C × 9&#x2F;5 + 32</li>
<li>华氏度转摄氏度：°C &#x3D; (°F - 32) × 5&#x2F;9</li>
<li>摄氏度转开尔文：K &#x3D; °C + 273.15</li>
<li>开尔文转摄氏度：°C &#x3D; K - 273.15</li>
</ul>
<h4 id="7-1-3-Swift-代码示例"><a href="#7-1-3-Swift-代码示例" class="headerlink" title="7.1.3 Swift 代码示例"></a>7.1.3 Swift 代码示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将摄氏度转换为华氏度</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertCelsiusToFahrenheit</span>(<span class="params">temperature</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> temperature.converted(to: .fahrenheit)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将华氏度转换为摄氏度</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertFahrenheitToCelsius</span>(<span class="params">temperature</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> temperature.converted(to: .celsius)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将摄氏度转换为开尔文</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertCelsiusToKelvin</span>(<span class="params">temperature</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> temperature.converted(to: .kelvin)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> celsiusTemp <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">25</span>, unit: <span class="type">UnitTemperature</span>.celsius)</span><br><span class="line"><span class="keyword">let</span> fahrenheitTemp <span class="operator">=</span> convertCelsiusToFahrenheit(temperature: celsiusTemp)</span><br><span class="line"><span class="keyword">let</span> kelvinTemp <span class="operator">=</span> convertCelsiusToKelvin(temperature: celsiusTemp)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(celsiusTemp)</span> = <span class="subst">\(fahrenheitTemp)</span> = <span class="subst">\(kelvinTemp)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用 Measurement API 进行转换</span></span><br><span class="line"><span class="keyword">let</span> tempInFahrenheit <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">77</span>, unit: <span class="type">UnitTemperature</span>.fahrenheit)</span><br><span class="line"><span class="keyword">let</span> tempInCelsius <span class="operator">=</span> tempInFahrenheit.converted(to: .celsius)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;77°F = <span class="subst">\(String(format: <span class="string">&quot;%.1f&quot;</span>, tempInCelsius.value))</span>°C&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-1-4-在-UI-中显示温度"><a href="#7-1-4-在-UI-中显示温度" class="headerlink" title="7.1.4 在 UI 中显示温度"></a>7.1.4 在 UI 中显示温度</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据用户偏好显示温度单位</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">displayTemperature</span>(<span class="keyword">_</span> <span class="params">temperature</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt;, <span class="params">forLocale</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temperatureFormatter <span class="operator">=</span> <span class="type">MeasurementFormatter</span>()</span><br><span class="line">    temperatureFormatter.locale <span class="operator">=</span> locale</span><br><span class="line">    temperatureFormatter.numberFormatter.maximumFractionDigits <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    temperatureFormatter.unitOptions <span class="operator">=</span> .providedUnit</span><br><span class="line">    <span class="keyword">return</span> temperatureFormatter.string(from: temperature)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> userLocale <span class="operator">=</span> <span class="type">Locale</span>.current <span class="comment">// 获取用户设备的区域设置</span></span><br><span class="line"><span class="keyword">let</span> temperature <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">25</span>, unit: <span class="type">UnitTemperature</span>.celsius)</span><br><span class="line"><span class="keyword">let</span> displayText <span class="operator">=</span> displayTemperature(temperature, forLocale: userLocale)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;根据区域设置显示温度：<span class="subst">\(displayText)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-2-速度单位转换"><a href="#7-2-速度单位转换" class="headerlink" title="7.2 速度单位转换"></a>7.2 速度单位转换</h3><p>风速单位转换在显示天气数据时非常重要，尤其是在不同地区使用不同单位系统的情况下。以下是完整的风速单位转换规则和示例：</p>
<h4 id="7-2-1-常用风速单位"><a href="#7-2-1-常用风速单位" class="headerlink" title="7.2.1 常用风速单位"></a>7.2.1 常用风速单位</h4><ul>
<li><strong>公里&#x2F;小时（km&#x2F;h）</strong>：国际标准单位，符号为 km&#x2F;h</li>
<li><strong>英里&#x2F;小时（mph）</strong>：主要在美国使用，符号为 mph</li>
<li><strong>米&#x2F;秒（m&#x2F;s）</strong>：科学计算常用单位，符号为 m&#x2F;s</li>
<li><strong>节（knot）</strong>：航海和航空常用单位，符号为 kn</li>
<li><strong>英尺&#x2F;秒（ft&#x2F;s）</strong>：英制单位，符号为 ft&#x2F;s</li>
</ul>
<h4 id="7-2-2-转换公式"><a href="#7-2-2-转换公式" class="headerlink" title="7.2.2 转换公式"></a>7.2.2 转换公式</h4><ul>
<li>公里&#x2F;小时转英里&#x2F;小时：mph &#x3D; km&#x2F;h × 0.621371</li>
<li>英里&#x2F;小时转公里&#x2F;小时：km&#x2F;h &#x3D; mph × 1.60934</li>
<li>公里&#x2F;小时转米&#x2F;秒：m&#x2F;s &#x3D; km&#x2F;h ÷ 3.6</li>
<li>米&#x2F;秒转公里&#x2F;小时：km&#x2F;h &#x3D; m&#x2F;s × 3.6</li>
<li>公里&#x2F;小时转节：kn &#x3D; km&#x2F;h × 0.539957</li>
<li>节转公里&#x2F;小时：km&#x2F;h &#x3D; kn × 1.852</li>
</ul>
<h4 id="7-2-3-Swift-代码示例"><a href="#7-2-3-Swift-代码示例" class="headerlink" title="7.2.3 Swift 代码示例"></a>7.2.3 Swift 代码示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将公里/小时转换为英里/小时</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertKilometersPerHourToMilesPerHour</span>(<span class="params">speed</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> speed.converted(to: .milesPerHour)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将公里/小时转换为米/秒</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertKilometersPerHourToMetersPerSecond</span>(<span class="params">speed</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> speed.converted(to: .metersPerSecond)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将公里/小时转换为节</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertKilometersPerHourToKnots</span>(<span class="params">speed</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> speed.converted(to: .knots)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> kmhSpeed <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">100</span>, unit: <span class="type">UnitSpeed</span>.kilometersPerHour)</span><br><span class="line"><span class="keyword">let</span> mphSpeed <span class="operator">=</span> convertKilometersPerHourToMilesPerHour(speed: kmhSpeed)</span><br><span class="line"><span class="keyword">let</span> mpsSpeed <span class="operator">=</span> convertKilometersPerHourToMetersPerSecond(speed: kmhSpeed)</span><br><span class="line"><span class="keyword">let</span> knotsSpeed <span class="operator">=</span> convertKilometersPerHourToKnots(speed: kmhSpeed)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(kmhSpeed)</span> = <span class="subst">\(mphSpeed)</span> = <span class="subst">\(mpsSpeed)</span> = <span class="subst">\(knotsSpeed)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用 Measurement API 进行转换</span></span><br><span class="line"><span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">15</span>, unit: <span class="type">UnitSpeed</span>.kilometersPerHour)</span><br><span class="line"><span class="keyword">let</span> displaySpeed <span class="operator">=</span> windSpeed.converted(to: .milesPerHour)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;风速：<span class="subst">\(String(format: <span class="string">&quot;%.1f&quot;</span>, displaySpeed.value))</span> mph&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-2-4-根据地区显示合适的风速单位"><a href="#7-2-4-根据地区显示合适的风速单位" class="headerlink" title="7.2.4 根据地区显示合适的风速单位"></a>7.2.4 根据地区显示合适的风速单位</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据地区设置自动选择风速单位</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPreferredSpeedUnit</span>(<span class="params">for</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">UnitSpeed</span> &#123;</span><br><span class="line">    <span class="comment">// 美国使用英里/小时</span></span><br><span class="line">    <span class="keyword">if</span> locale.identifier <span class="operator">==</span> <span class="string">&quot;en_US&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .milesPerHour</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他地区默认使用公里/小时</span></span><br><span class="line">    <span class="keyword">return</span> .kilometersPerHour</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> userLocale <span class="operator">=</span> <span class="type">Locale</span>.current</span><br><span class="line"><span class="keyword">let</span> preferredSpeedUnit <span class="operator">=</span> getPreferredSpeedUnit(for: userLocale)</span><br><span class="line"><span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">20</span>, unit: <span class="type">UnitSpeed</span>.kilometersPerHour)</span><br><span class="line"><span class="keyword">let</span> convertedSpeed <span class="operator">=</span> windSpeed.converted(to: preferredSpeedUnit)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;风速：<span class="subst">\(String(format: <span class="string">&quot;%.1f&quot;</span>, convertedSpeed.value))</span> <span class="subst">\(preferredSpeedUnit.symbol)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-3-降水量单位转换"><a href="#7-3-降水量单位转换" class="headerlink" title="7.3 降水量单位转换"></a>7.3 降水量单位转换</h3><p>降水量单位转换在显示天气预报时非常重要，尤其是在不同地区使用不同单位系统的情况下。以下是完整的降水量单位转换规则和示例：</p>
<h4 id="7-3-1-常用降水量单位"><a href="#7-3-1-常用降水量单位" class="headerlink" title="7.3.1 常用降水量单位"></a>7.3.1 常用降水量单位</h4><ul>
<li><strong>毫米（mm）</strong>：国际标准单位，符号为 mm</li>
<li><strong>英寸（in）</strong>：主要在美国使用，符号为 in</li>
<li><strong>厘米（cm）</strong>：常用单位，符号为 cm</li>
</ul>
<h4 id="7-3-2-转换公式"><a href="#7-3-2-转换公式" class="headerlink" title="7.3.2 转换公式"></a>7.3.2 转换公式</h4><ul>
<li>毫米转英寸：in &#x3D; mm × 0.0393701</li>
<li>英寸转毫米：mm &#x3D; in × 25.4</li>
<li>毫米转厘米：cm &#x3D; mm ÷ 10</li>
<li>厘米转毫米：mm &#x3D; cm × 10</li>
</ul>
<h4 id="7-3-3-Swift-代码示例"><a href="#7-3-3-Swift-代码示例" class="headerlink" title="7.3.3 Swift 代码示例"></a>7.3.3 Swift 代码示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将毫米转换为英寸</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertMillimetersToInches</span>(<span class="params">length</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> length.converted(to: .inches)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将英寸转换为毫米</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertInchesToMillimeters</span>(<span class="params">length</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> length.converted(to: .millimeters)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将毫米转换为厘米</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertMillimetersToCentimeters</span>(<span class="params">length</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> length.converted(to: .centimeters)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> mmRain <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">10</span>, unit: <span class="type">UnitLength</span>.millimeters)</span><br><span class="line"><span class="keyword">let</span> inchesRain <span class="operator">=</span> convertMillimetersToInches(length: mmRain)</span><br><span class="line"><span class="keyword">let</span> cmRain <span class="operator">=</span> convertMillimetersToCentimeters(length: mmRain)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;降水量：<span class="subst">\(mmRain)</span> = <span class="subst">\(inchesRain)</span> = <span class="subst">\(cmRain)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用 Measurement API 进行转换</span></span><br><span class="line"><span class="keyword">let</span> precipitation <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">25</span>, unit: <span class="type">UnitLength</span>.millimeters)</span><br><span class="line"><span class="keyword">let</span> displayPrecipitation <span class="operator">=</span> precipitation.converted(to: .inches)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;预计降水量：<span class="subst">\(String(format: <span class="string">&quot;%.2f&quot;</span>, displayPrecipitation.value))</span> in&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-3-4-根据地区显示合适的降水量单位"><a href="#7-3-4-根据地区显示合适的降水量单位" class="headerlink" title="7.3.4 根据地区显示合适的降水量单位"></a>7.3.4 根据地区显示合适的降水量单位</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据地区设置自动选择降水量单位</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPreferredPrecipitationUnit</span>(<span class="params">for</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">UnitLength</span> &#123;</span><br><span class="line">    <span class="comment">// 美国使用英寸</span></span><br><span class="line">    <span class="keyword">if</span> locale.identifier <span class="operator">==</span> <span class="string">&quot;en_US&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .inches</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他地区默认使用毫米</span></span><br><span class="line">    <span class="keyword">return</span> .millimeters</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> userLocale <span class="operator">=</span> <span class="type">Locale</span>.current</span><br><span class="line"><span class="keyword">let</span> preferredPrecipUnit <span class="operator">=</span> getPreferredPrecipitationUnit(for: userLocale)</span><br><span class="line"><span class="keyword">let</span> precipitation <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">15</span>, unit: <span class="type">UnitLength</span>.millimeters)</span><br><span class="line"><span class="keyword">let</span> convertedPrecipitation <span class="operator">=</span> precipitation.converted(to: preferredPrecipUnit)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;降水量：<span class="subst">\(String(format: <span class="string">&quot;%.2f&quot;</span>, convertedPrecipitation.value))</span> <span class="subst">\(preferredPrecipUnit.symbol)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-4-气压单位转换"><a href="#7-4-气压单位转换" class="headerlink" title="7.4 气压单位转换"></a>7.4 气压单位转换</h3><p>气压单位转换在显示天气数据时非常重要，尤其是在不同地区使用不同单位系统的情况下。以下是完整的气压单位转换规则和示例：</p>
<h4 id="7-4-1-常用气压单位"><a href="#7-4-1-常用气压单位" class="headerlink" title="7.4.1 常用气压单位"></a>7.4.1 常用气压单位</h4><ul>
<li><strong>百帕（hPa）</strong>：国际标准单位，符号为 hPa</li>
<li><strong>毫米汞柱（mmHg）</strong>：常用单位，符号为 mmHg</li>
<li><strong>英寸汞柱（inHg）</strong>：主要在美国使用，符号为 inHg</li>
<li><strong>千帕（kPa）</strong>：常用单位，符号为 kPa</li>
<li><strong>磅力&#x2F;平方英寸（psi）</strong>：英制单位，符号为 psi</li>
</ul>
<h4 id="7-4-2-转换公式"><a href="#7-4-2-转换公式" class="headerlink" title="7.4.2 转换公式"></a>7.4.2 转换公式</h4><ul>
<li>百帕转毫米汞柱：mmHg &#x3D; hPa × 0.750062</li>
<li>毫米汞柱转百帕：hPa &#x3D; mmHg × 1.33322</li>
<li>百帕转英寸汞柱：inHg &#x3D; hPa × 0.02953</li>
<li>英寸汞柱转百帕：hPa &#x3D; inHg × 33.8639</li>
<li>百帕转千帕：kPa &#x3D; hPa ÷ 10</li>
<li>千帕转百帕：hPa &#x3D; kPa × 10</li>
<li>百帕转磅力&#x2F;平方英寸：psi &#x3D; hPa × 0.0145038</li>
</ul>
<h4 id="7-4-3-Swift-代码示例"><a href="#7-4-3-Swift-代码示例" class="headerlink" title="7.4.3 Swift 代码示例"></a>7.4.3 Swift 代码示例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将百帕转换为毫米汞柱</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertHectopascalsToMillimetersOfMercury</span>(<span class="params">pressure</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> pressure.converted(to: .millimetersOfMercury)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将百帕转换为英寸汞柱</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertHectopascalsToInchesOfMercury</span>(<span class="params">pressure</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> pressure.converted(to: .inchesOfMercury)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将百帕转换为千帕</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertHectopascalsToKilopascals</span>(<span class="params">pressure</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> pressure.converted(to: .kilopascals)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> hPaPressure <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">1013.25</span>, unit: <span class="type">UnitPressure</span>.hectopascals)</span><br><span class="line"><span class="keyword">let</span> mmHgPressure <span class="operator">=</span> convertHectopascalsToMillimetersOfMercury(pressure: hPaPressure)</span><br><span class="line"><span class="keyword">let</span> inHgPressure <span class="operator">=</span> convertHectopascalsToInchesOfMercury(pressure: hPaPressure)</span><br><span class="line"><span class="keyword">let</span> kPaPressure <span class="operator">=</span> convertHectopascalsToKilopascals(pressure: hPaPressure)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;气压：<span class="subst">\(hPaPressure)</span> = <span class="subst">\(mmHgPressure)</span> = <span class="subst">\(inHgPressure)</span> = <span class="subst">\(kPaPressure)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用 Measurement API 进行转换</span></span><br><span class="line"><span class="keyword">let</span> atmosphericPressure <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">1000</span>, unit: <span class="type">UnitPressure</span>.hectopascals)</span><br><span class="line"><span class="keyword">let</span> displayPressure <span class="operator">=</span> atmosphericPressure.converted(to: .inchesOfMercury)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;气压：<span class="subst">\(String(format: <span class="string">&quot;%.2f&quot;</span>, displayPressure.value))</span> inHg&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-4-4-根据地区显示合适的气压单位"><a href="#7-4-4-根据地区显示合适的气压单位" class="headerlink" title="7.4.4 根据地区显示合适的气压单位"></a>7.4.4 根据地区显示合适的气压单位</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据地区设置自动选择气压单位</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPreferredPressureUnit</span>(<span class="params">for</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">UnitPressure</span> &#123;</span><br><span class="line">    <span class="comment">// 美国使用英寸汞柱</span></span><br><span class="line">    <span class="keyword">if</span> locale.identifier <span class="operator">==</span> <span class="string">&quot;en_US&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .inchesOfMercury</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他地区默认使用百帕</span></span><br><span class="line">    <span class="keyword">return</span> .hectopascals</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> userLocale <span class="operator">=</span> <span class="type">Locale</span>.current</span><br><span class="line"><span class="keyword">let</span> preferredPressureUnit <span class="operator">=</span> getPreferredPressureUnit(for: userLocale)</span><br><span class="line"><span class="keyword">let</span> atmosphericPressure <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">1013.25</span>, unit: <span class="type">UnitPressure</span>.hectopascals)</span><br><span class="line"><span class="keyword">let</span> convertedPressure <span class="operator">=</span> atmosphericPressure.converted(to: preferredPressureUnit)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;气压：<span class="subst">\(String(format: <span class="string">&quot;%.1f&quot;</span>, convertedPressure.value))</span> <span class="subst">\(preferredPressureUnit.symbol)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-5-其他数据类型的显示与转换"><a href="#7-5-其他数据类型的显示与转换" class="headerlink" title="7.5 其他数据类型的显示与转换"></a>7.5 其他数据类型的显示与转换</h3><p>除了上述主要单位转换外，还有一些其他天气数据类型需要适当的格式化和显示规则：</p>
<h4 id="7-5-1-湿度显示"><a href="#7-5-1-湿度显示" class="headerlink" title="7.5.1 湿度显示"></a>7.5.1 湿度显示</h4><p>湿度通常以百分比形式显示，范围为 0% 到 100%。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 格式化湿度显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatHumidity</span>(<span class="keyword">_</span> <span class="params">humidity</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// 湿度值范围为 0-1，转换为百分比</span></span><br><span class="line">    <span class="keyword">let</span> humidityPercentage <span class="operator">=</span> <span class="type">Int</span>(humidity <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(humidityPercentage)</span>%&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> humidity <span class="operator">=</span> <span class="number">0.65</span> <span class="comment">// 从 WeatherKit 获取的湿度值（0-1）</span></span><br><span class="line"><span class="keyword">let</span> formattedHumidity <span class="operator">=</span> formatHumidity(humidity)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;湿度：<span class="subst">\(formattedHumidity)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-5-2-紫外线指数显示"><a href="#7-5-2-紫外线指数显示" class="headerlink" title="7.5.2 紫外线指数显示"></a>7.5.2 紫外线指数显示</h4><p>紫外线指数范围通常为 0-11+，可以根据数值范围显示不同的描述和颜色。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 紫外线指数描述映射</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> uvIndexDescriptions <span class="operator">=</span> [</span><br><span class="line">    <span class="number">0</span>: (<span class="string">&quot;低&quot;</span>, <span class="type">UIColor</span>.green),</span><br><span class="line">    <span class="number">1</span>: (<span class="string">&quot;低&quot;</span>, <span class="type">UIColor</span>.green),</span><br><span class="line">    <span class="number">2</span>: (<span class="string">&quot;低&quot;</span>, <span class="type">UIColor</span>.green),</span><br><span class="line">    <span class="number">3</span>: (<span class="string">&quot;中等&quot;</span>, <span class="type">UIColor</span>.yellow),</span><br><span class="line">    <span class="number">4</span>: (<span class="string">&quot;中等&quot;</span>, <span class="type">UIColor</span>.yellow),</span><br><span class="line">    <span class="number">5</span>: (<span class="string">&quot;中等&quot;</span>, <span class="type">UIColor</span>.yellow),</span><br><span class="line">    <span class="number">6</span>: (<span class="string">&quot;高&quot;</span>, <span class="type">UIColor</span>.orange),</span><br><span class="line">    <span class="number">7</span>: (<span class="string">&quot;高&quot;</span>, <span class="type">UIColor</span>.orange),</span><br><span class="line">    <span class="number">8</span>: (<span class="string">&quot;很高&quot;</span>, <span class="type">UIColor</span>.red),</span><br><span class="line">    <span class="number">9</span>: (<span class="string">&quot;很高&quot;</span>, <span class="type">UIColor</span>.red),</span><br><span class="line">    <span class="number">10</span>: (<span class="string">&quot;很高&quot;</span>, <span class="type">UIColor</span>.red),</span><br><span class="line">    <span class="number">11</span>: (<span class="string">&quot;极高&quot;</span>, <span class="type">UIColor</span>.purple)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化紫外线指数显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatUVIndex</span>(<span class="keyword">_</span> <span class="params">uvIndex</span>: <span class="type">Double</span>) -&gt; (<span class="type">String</span>, <span class="type">UIColor</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>(uvIndex)</span><br><span class="line">    <span class="keyword">let</span> clampedIndex <span class="operator">=</span> <span class="built_in">min</span>(<span class="built_in">max</span>(index, <span class="number">0</span>), <span class="number">11</span>)</span><br><span class="line">    <span class="keyword">return</span> uvIndexDescriptions[clampedIndex] <span class="operator">??</span> (<span class="string">&quot;未知&quot;</span>, <span class="type">UIColor</span>.gray)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> uvIndex <span class="operator">=</span> <span class="number">7.5</span> <span class="comment">// 从 WeatherKit 获取的紫外线指数</span></span><br><span class="line"><span class="keyword">let</span> (uvDescription, uvColor) <span class="operator">=</span> formatUVIndex(uvIndex)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;紫外线指数：<span class="subst">\(Int(uvIndex))</span>，<span class="subst">\(uvDescription)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-5-3-降水概率显示"><a href="#7-5-3-降水概率显示" class="headerlink" title="7.5.3 降水概率显示"></a>7.5.3 降水概率显示</h4><p>降水概率通常以百分比形式显示，范围为 0% 到 100%。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 格式化降水概率显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatPrecipitationChance</span>(<span class="keyword">_</span> <span class="params">chance</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// 降水概率范围为 0-1，转换为百分比</span></span><br><span class="line">    <span class="keyword">let</span> chancePercentage <span class="operator">=</span> <span class="type">Int</span>(chance <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(chancePercentage)</span>%&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> precipitationChance <span class="operator">=</span> <span class="number">0.45</span> <span class="comment">// 从 WeatherKit 获取的降水概率（0-1）</span></span><br><span class="line"><span class="keyword">let</span> formattedChance <span class="operator">=</span> formatPrecipitationChance(precipitationChance)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;降水概率：<span class="subst">\(formattedChance)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-5-4-云覆盖率显示"><a href="#7-5-4-云覆盖率显示" class="headerlink" title="7.5.4 云覆盖率显示"></a>7.5.4 云覆盖率显示</h4><p>云覆盖率通常以百分比形式显示，范围为 0% 到 100%。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 格式化云覆盖率显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatCloudCover</span>(<span class="keyword">_</span> <span class="params">cloudCover</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// 云覆盖率范围为 0-1，转换为百分比</span></span><br><span class="line">    <span class="keyword">let</span> cloudCoverPercentage <span class="operator">=</span> <span class="type">Int</span>(cloudCover <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(cloudCoverPercentage)</span>%&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> cloudCover <span class="operator">=</span> <span class="number">0.3</span> <span class="comment">// 从 WeatherKit 获取的云覆盖率（0-1）</span></span><br><span class="line"><span class="keyword">let</span> formattedCloudCover <span class="operator">=</span> formatCloudCover(cloudCover)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;云覆盖率：<span class="subst">\(formattedCloudCover)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-5-5-时间格式化显示"><a href="#7-5-5-时间格式化显示" class="headerlink" title="7.5.5 时间格式化显示"></a>7.5.5 时间格式化显示</h4><p>天气数据中的时间需要根据用户时区和偏好进行格式化显示。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 格式化时间显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatTime</span>(<span class="keyword">_</span> <span class="params">date</span>: <span class="type">Date</span>, <span class="params">for</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">    formatter.locale <span class="operator">=</span> locale</span><br><span class="line">    formatter.timeStyle <span class="operator">=</span> .short <span class="comment">// 显示短时间格式，如 &quot;14:30&quot;</span></span><br><span class="line">    <span class="keyword">return</span> formatter.string(from: date)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化日期显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatDate</span>(<span class="keyword">_</span> <span class="params">date</span>: <span class="type">Date</span>, <span class="params">for</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">    formatter.locale <span class="operator">=</span> locale</span><br><span class="line">    formatter.dateStyle <span class="operator">=</span> .medium <span class="comment">// 显示中等日期格式，如 &quot;2023年12月31日&quot;</span></span><br><span class="line">    <span class="keyword">return</span> formatter.string(from: date)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> sunriseTime <span class="operator">=</span> <span class="type">Date</span>() <span class="comment">// 从 WeatherKit 获取的日出时间</span></span><br><span class="line"><span class="keyword">let</span> userLocale <span class="operator">=</span> <span class="type">Locale</span>.current</span><br><span class="line"><span class="keyword">let</span> formattedSunriseTime <span class="operator">=</span> formatTime(sunriseTime, for: userLocale)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;日出时间：<span class="subst">\(formattedSunriseTime)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> forecastDate <span class="operator">=</span> <span class="type">Date</span>() <span class="comment">// 从 WeatherKit 获取的预报日期</span></span><br><span class="line"><span class="keyword">let</span> formattedDate <span class="operator">=</span> formatDate(forecastDate, for: userLocale)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;预报日期：<span class="subst">\(formattedDate)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-5-6-在-UI-中显示不同单位"><a href="#7-5-6-在-UI-中显示不同单位" class="headerlink" title="7.5.6 在 UI 中显示不同单位"></a>7.5.6 在 UI 中显示不同单位</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新温度标签</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">updateTemperatureLabel</span>(<span class="params">with</span> <span class="params">temperature</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt;, <span class="params">unit</span>: <span class="type">UnitTemperature</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> convertedTemperature <span class="operator">=</span> temperature.converted(to: unit)</span><br><span class="line">    temperatureLabel.text <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(Int(convertedTemperature.value.rounded()))</span>°&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新风速标签</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">updateWindSpeedLabel</span>(<span class="params">with</span> <span class="params">windSpeed</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt;, <span class="params">unit</span>: <span class="type">UnitSpeed</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> convertedSpeed <span class="operator">=</span> windSpeed.converted(to: unit)</span><br><span class="line">    windSpeedLabel.text <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(Int(convertedSpeed.value.rounded()))</span> <span class="subst">\(unit.symbol)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> currentWeather: <span class="type">CurrentWeather</span> <span class="operator">=</span> <span class="comment">// 从 WeatherKit 获取的当前天气</span></span><br><span class="line"><span class="keyword">let</span> userPreferredTempUnit <span class="operator">=</span> <span class="type">UnitTemperature</span>.celsius <span class="comment">// 可以从用户设置中获取</span></span><br><span class="line"><span class="keyword">let</span> userPreferredSpeedUnit <span class="operator">=</span> <span class="type">UnitSpeed</span>.kilometersPerHour <span class="comment">// 可以从用户设置中获取</span></span><br><span class="line"></span><br><span class="line">updateTemperatureLabel(with: currentWeather.temperature, unit: userPreferredTempUnit)</span><br><span class="line">updateWindSpeedLabel(with: currentWeather.wind.speed, unit: userPreferredSpeedUnit)</span><br></pre></td></tr></table></figure>

<h2 id="8-最佳实践"><a href="#8-最佳实践" class="headerlink" title="8. 最佳实践"></a>8. 最佳实践</h2><ol>
<li><strong>权限请求时机</strong>：只在需要天气数据时请求位置权限</li>
<li><strong>缓存天气数据</strong>：使用 <code>UserDefaults</code> 或 <code>Core Data</code> 缓存天气数据，减少网络请求</li>
<li><strong>异步处理</strong>：在后台线程获取天气数据，避免阻塞主线程</li>
<li><strong>错误处理</strong>：提供友好的错误提示，帮助用户解决问题</li>
<li><strong>归因显示</strong>：根据 Apple 的要求，显示天气数据的来源归因</li>
<li><strong>单位适配</strong>：根据用户的区域设置或偏好显示适当的单位</li>
<li><strong>数据验证</strong>：对获取的天气数据进行验证，处理缺失或异常值</li>
</ol>
<h2 id="9-天气数据缓存策略"><a href="#9-天气数据缓存策略" class="headerlink" title="9. 天气数据缓存策略"></a>9. 天气数据缓存策略</h2><p>合理缓存天气数据可以减少网络请求，提高应用性能，并在网络不可用时提供离线支持。以下是一些常见的缓存策略和实现示例：</p>
<h3 id="9-1-使用-UserDefaults-缓存天气数据"><a href="#9-1-使用-UserDefaults-缓存天气数据" class="headerlink" title="9.1 使用 UserDefaults 缓存天气数据"></a>9.1 使用 UserDefaults 缓存天气数据</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义缓存键</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> weatherCacheKey <span class="operator">=</span> <span class="string">&quot;cached_weather_data&quot;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> weatherCacheTimestampKey <span class="operator">=</span> <span class="string">&quot;cached_weather_timestamp&quot;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> weatherCacheExpirationTime: <span class="type">TimeInterval</span> <span class="operator">=</span> <span class="number">3600</span> <span class="comment">// 1小时过期</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">cacheWeatherData</span>(<span class="params">currentWeather</span>: <span class="type">CurrentWeather</span>, <span class="params">dailyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;, <span class="params">hourlyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// 创建包含所有天气数据的字典</span></span><br><span class="line">        <span class="keyword">let</span> weatherData <span class="operator">=</span> [</span><br><span class="line">            <span class="string">&quot;current&quot;</span>: currentWeather,</span><br><span class="line">            <span class="string">&quot;daily&quot;</span>: dailyForecast,</span><br><span class="line">            <span class="string">&quot;hourly&quot;</span>: hourlyForecast</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 编码数据</span></span><br><span class="line">        <span class="keyword">let</span> encoder <span class="operator">=</span> <span class="type">JSONEncoder</span>()</span><br><span class="line">        <span class="keyword">let</span> encodedData <span class="operator">=</span> <span class="keyword">try</span> encoder.encode(weatherData)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 保存到 UserDefaults</span></span><br><span class="line">        <span class="type">UserDefaults</span>.standard.set(encodedData, forKey: weatherCacheKey)</span><br><span class="line">        <span class="type">UserDefaults</span>.standard.set(<span class="type">Date</span>().timeIntervalSince1970, forKey: weatherCacheTimestampKey)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;缓存天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查缓存是否有效</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">isWeatherCacheValid</span>() -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> cacheTimestamp <span class="operator">=</span> <span class="type">UserDefaults</span>.standard.object(forKey: weatherCacheTimestampKey) <span class="keyword">as?</span> <span class="type">TimeInterval</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> cacheDate <span class="operator">=</span> <span class="type">Date</span>(timeIntervalSince1970: cacheTimestamp)</span><br><span class="line">    <span class="keyword">let</span> now <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">    <span class="keyword">return</span> now.timeIntervalSince(cacheDate) <span class="operator">&lt;</span> weatherCacheExpirationTime</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从缓存获取天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCachedWeatherData</span>() -&gt; (<span class="type">CurrentWeather</span>, <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;, <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;)<span class="operator">?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> isWeatherCacheValid(),</span><br><span class="line">          <span class="keyword">let</span> cachedData <span class="operator">=</span> <span class="type">UserDefaults</span>.standard.data(forKey: weatherCacheKey) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> decoder <span class="operator">=</span> <span class="type">JSONDecoder</span>()</span><br><span class="line">        <span class="keyword">let</span> weatherData <span class="operator">=</span> <span class="keyword">try</span> decoder.decode([String: <span class="keyword">Any</span>].<span class="keyword">self</span>, from: cachedData)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解码并返回数据</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> current <span class="operator">=</span> weatherData[<span class="string">&quot;current&quot;</span>] <span class="keyword">as?</span> <span class="type">CurrentWeather</span>,</span><br><span class="line">           <span class="keyword">let</span> daily <span class="operator">=</span> weatherData[<span class="string">&quot;daily&quot;</span>] <span class="keyword">as?</span> <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;,</span><br><span class="line">           <span class="keyword">let</span> hourly <span class="operator">=</span> weatherData[<span class="string">&quot;hourly&quot;</span>] <span class="keyword">as?</span> <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> (current, daily, hourly)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;读取缓存天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用缓存的示例</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherWithCache</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="comment">// 首先检查缓存</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> cachedWeather <span class="operator">=</span> getCachedWeatherData() &#123;</span><br><span class="line">        updateUI(current: cachedWeather.<span class="number">0</span>, daily: cachedWeather.<span class="number">1</span>, hourly: cachedWeather.<span class="number">2</span>, location: location)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 然后异步获取最新数据</span></span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .current, .daily, .hourly</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 更新 UI 并缓存数据</span></span><br><span class="line">            updateUI(current: currentWeather, daily: dailyForecast, hourly: hourlyForecast, location: location)</span><br><span class="line">            cacheWeatherData(currentWeather: currentWeather, dailyForecast: dailyForecast, hourlyForecast: hourlyForecast)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="comment">// 如果没有缓存数据且获取失败，显示错误</span></span><br><span class="line">            <span class="keyword">if</span> getCachedWeatherData() <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-使用-Core-Data-缓存天气数据"><a href="#9-2-使用-Core-Data-缓存天气数据" class="headerlink" title="9.2 使用 Core Data 缓存天气数据"></a>9.2 使用 Core Data 缓存天气数据</h3><p>对于更复杂的应用，可以使用 Core Data 来缓存天气数据，这允许更灵活的查询和管理。以下是一个简单的示例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 定义 Core Data 模型</span></span><br><span class="line"><span class="comment">// - WeatherCache: 包含缓存的基本信息（位置、时间戳、过期时间）</span></span><br><span class="line"><span class="comment">// - CurrentWeatherEntity: 当前天气数据</span></span><br><span class="line"><span class="comment">// - DayWeatherEntity: 每日天气预报</span></span><br><span class="line"><span class="comment">// - HourWeatherEntity: 每小时天气预报</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 保存天气数据到 Core Data</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">saveWeatherToCoreData</span>(<span class="params">location</span>: <span class="type">CLLocation</span>, <span class="params">currentWeather</span>: <span class="type">CurrentWeather</span>, <span class="params">dailyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;, <span class="params">hourlyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">let</span> context <span class="operator">=</span> persistentContainer.viewContext</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建缓存记录</span></span><br><span class="line">    <span class="keyword">let</span> cache <span class="operator">=</span> <span class="type">WeatherCache</span>(context: context)</span><br><span class="line">    cache.locationLatitude <span class="operator">=</span> location.coordinate.latitude</span><br><span class="line">    cache.locationLongitude <span class="operator">=</span> location.coordinate.longitude</span><br><span class="line">    cache.timestamp <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">    cache.expirationDate <span class="operator">=</span> <span class="type">Date</span>().addingTimeInterval(<span class="number">3600</span>) <span class="comment">// 1小时过期</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存当前天气数据</span></span><br><span class="line">    <span class="keyword">let</span> currentEntity <span class="operator">=</span> <span class="type">CurrentWeatherEntity</span>(context: context)</span><br><span class="line">    currentEntity.temperature <span class="operator">=</span> currentWeather.temperature.value</span><br><span class="line">    currentEntity.condition <span class="operator">=</span> currentWeather.condition.rawValue</span><br><span class="line">    <span class="comment">// 保存其他属性...</span></span><br><span class="line">    cache.currentWeather <span class="operator">=</span> currentEntity</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存每日预报</span></span><br><span class="line">    <span class="keyword">for</span> dayWeather <span class="keyword">in</span> dailyForecast.forecast &#123;</span><br><span class="line">        <span class="keyword">let</span> dayEntity <span class="operator">=</span> <span class="type">DayWeatherEntity</span>(context: context)</span><br><span class="line">        dayEntity.date <span class="operator">=</span> dayWeather.date</span><br><span class="line">        dayEntity.highTemperature <span class="operator">=</span> dayWeather.highTemperature.value</span><br><span class="line">        dayEntity.lowTemperature <span class="operator">=</span> dayWeather.lowTemperature.value</span><br><span class="line">        <span class="comment">// 保存其他属性...</span></span><br><span class="line">        cache.addToDailyForecasts(dayEntity)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存每小时预报</span></span><br><span class="line">    <span class="keyword">for</span> hourWeather <span class="keyword">in</span> hourlyForecast.forecast &#123;</span><br><span class="line">        <span class="keyword">let</span> hourEntity <span class="operator">=</span> <span class="type">HourWeatherEntity</span>(context: context)</span><br><span class="line">        hourEntity.date <span class="operator">=</span> hourWeather.date</span><br><span class="line">        hourEntity.temperature <span class="operator">=</span> hourWeather.temperature.value</span><br><span class="line">        <span class="comment">// 保存其他属性...</span></span><br><span class="line">        cache.addToHourlyForecasts(hourEntity)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存上下文</span></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> context.save()</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;保存天气数据到 Core Data 失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 从 Core Data 获取天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getWeatherFromCoreData</span>(<span class="params">location</span>: <span class="type">CLLocation</span>) -&gt; (<span class="type">CurrentWeather</span>, <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;, <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;)<span class="operator">?</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> context <span class="operator">=</span> persistentContainer.viewContext</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建请求</span></span><br><span class="line">    <span class="keyword">let</span> request: <span class="type">NSFetchRequest</span>&lt;<span class="type">WeatherCache</span>&gt; <span class="operator">=</span> <span class="type">WeatherCache</span>.fetchRequest()</span><br><span class="line">    request.predicate <span class="operator">=</span> <span class="type">NSPredicate</span>(format: <span class="string">&quot;locationLatitude == %@ AND locationLongitude == %@ AND expirationDate &gt; %@&quot;</span>,</span><br><span class="line">                                    location.coordinate.latitude,</span><br><span class="line">                                    location.coordinate.longitude,</span><br><span class="line">                                    <span class="type">Date</span>())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> caches <span class="operator">=</span> <span class="keyword">try</span> context.fetch(request)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> cache <span class="operator">=</span> caches.first &#123;</span><br><span class="line">            <span class="comment">// 从 Core Data 实体转换为 WeatherKit 数据类型</span></span><br><span class="line">            <span class="comment">// 这里需要根据你的 Core Data 模型实现转换逻辑</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="keyword">return</span> (convertedCurrentWeather, convertedDailyForecast, convertedHourlyForecast)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;从 Core Data 获取天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-3-缓存失效策略"><a href="#9-3-缓存失效策略" class="headerlink" title="9.3 缓存失效策略"></a>9.3 缓存失效策略</h3><p>选择合适的缓存失效策略取决于你的应用需求：</p>
<ol>
<li><strong>时间过期策略</strong>：根据固定时间（如1小时）过期缓存</li>
<li><strong>位置距离策略</strong>：当设备移动超过一定距离（如5公里）时刷新缓存</li>
<li><strong>用户交互触发</strong>：当用户手动刷新时更新缓存</li>
<li><strong>后台定期更新</strong>：使用后台任务定期更新缓存</li>
<li><strong>网络状态变化</strong>：当网络从不可用变为可用时更新缓存</li>
</ol>
<h3 id="9-4-实现位置距离策略示例"><a href="#9-4-实现位置距离策略示例" class="headerlink" title="9.4 实现位置距离策略示例"></a>9.4 实现位置距离策略示例</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义距离阈值</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> locationDistanceThreshold: <span class="type">CLLocationDistance</span> <span class="operator">=</span> <span class="number">5000</span> <span class="comment">// 5公里</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存上次获取天气的位置</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> lastWeatherLocation: <span class="type">CLLocation</span>?</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查是否需要刷新天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">shouldRefreshWeather</span>(<span class="params">for</span> <span class="params">currentLocation</span>: <span class="type">CLLocation</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="comment">// 检查缓存是否过期</span></span><br><span class="line">    <span class="keyword">if</span> <span class="operator">!</span>isWeatherCacheValid() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查位置是否变化超过阈值</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> lastLocation <span class="operator">=</span> lastWeatherLocation &#123;</span><br><span class="line">        <span class="keyword">let</span> distance <span class="operator">=</span> currentLocation.distance(from: lastLocation)</span><br><span class="line">        <span class="keyword">return</span> distance <span class="operator">&gt;</span> locationDistanceThreshold</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-代码示例（完整的-ViewController）"><a href="#10-代码示例（完整的-ViewController）" class="headerlink" title="10. 代码示例（完整的 ViewController）"></a>10. 代码示例（完整的 ViewController）</h2><p>基于 SelfViewController.swift 的完整代码示例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> WeatherKit</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherViewController</span>: <span class="title class_ inherited__">UIViewController</span> &#123;</span><br><span class="line">    <span class="comment">// MARK: - 核心组件</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> locationManager <span class="operator">=</span> <span class="type">CLLocationManager</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> weatherService <span class="operator">=</span> <span class="type">WeatherService</span>.shared</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - UI 控件</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> stackView <span class="operator">=</span> <span class="type">UIStackView</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> cityLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> temperatureLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> conditionLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> highLowLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> activityIndicator <span class="operator">=</span> <span class="type">UIActivityIndicatorView</span>(style: .large)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        view.backgroundColor <span class="operator">=</span> .systemBackground</span><br><span class="line">        setupUI()</span><br><span class="line">        setupLocationManager()</span><br><span class="line">        requestLocation()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - UI 搭建</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">setupUI</span>() &#123;</span><br><span class="line">        <span class="comment">// UI 布局代码...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - CoreLocation 设置</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">setupLocationManager</span>() &#123;</span><br><span class="line">        locationManager.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">        locationManager.desiredAccuracy <span class="operator">=</span> kCLLocationAccuracyHundredMeters</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">requestLocation</span>() &#123;</span><br><span class="line">        <span class="comment">// 请求位置权限和位置信息...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - 获取天气数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">fetchWeather</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">        <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                    for: location,</span><br><span class="line">                    including: .current, .daily, .hourly</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                updateUI(</span><br><span class="line">                    current: currentWeather,</span><br><span class="line">                    daily: dailyForecast,</span><br><span class="line">                    hourly: hourlyForecast,</span><br><span class="line">                    location: location</span><br><span class="line">                )</span><br><span class="line">            &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - 更新 UI</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">updateUI</span>(</span><br><span class="line">        <span class="params">current</span>: <span class="type">CurrentWeather</span>,</span><br><span class="line">        <span class="params">daily</span>: <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;,</span><br><span class="line">        <span class="params">hourly</span>: <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;,</span><br><span class="line">        <span class="params">location</span>: <span class="type">CLLocation</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="comment">// 更新 UI 代码...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - 辅助方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">showError</span>(<span class="keyword">_</span> <span class="params">message</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="comment">// 显示错误提示...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - CLLocationManagerDelegate</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">WeatherViewController</span>: <span class="title class_ inherited__">CLLocationManagerDelegate</span> &#123;</span><br><span class="line">    <span class="comment">// 位置管理器代理方法...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-总结"><a href="#11-总结" class="headerlink" title="11. 总结"></a>11. 总结</h2><p>WeatherKit 是一个强大的框架，提供了丰富的天气数据和简单的 API 接口。通过正确配置权限和使用 WeatherService，开发者可以轻松地在应用中集成天气功能。</p>
<p>使用 WeatherKit 时，需要注意：</p>
<ul>
<li>确保应用有正确的权限设置</li>
<li>在异步上下文中调用天气服务</li>
<li>妥善处理可能的错误</li>
<li>遵循 Apple 的指南，显示天气数据归因</li>
<li>根据用户偏好进行单位转换</li>
<li>合理缓存天气数据，减少网络请求</li>
</ul>
<p>通过本文档和示例代码，您应该能够理解如何在自己的应用中使用 WeatherKit 获取和显示天气数据，包括：</p>
<ul>
<li>获取当前天气、每日预报、每小时预报和分钟级降水预报</li>
<li>获取历史天气数据</li>
<li>使用城市名或位置获取天气</li>
<li>批量获取多个地点的天气数据</li>
<li>显示天气数据归因信息</li>
<li>进行单位转换</li>
<li>实现合理的缓存策略</li>
</ul>
<p>WeatherKit 提供了全面的天气数据和灵活的 API，适合各种类型的天气应用开发。</p>

  </div>
  <!--文末结束语-->
  
    <div style="text-align:center;color: #ccc;font-size:24px;"> --- 本文结束 <i class="iconfont icon-heartbeat" style="font-size:24px;"></i> The End --- </div>
  
  <!--页脚广告-->
  
  <div class="mdui-divider"></div>
  
  <nav>
    
      <a rel="prev" class="post-nav-item mdui-float-left" href="/ios.github.io/2025/12/03/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/">
        <i class="iconfont icon-angle-left"></i>
        <span>swift学习日记(一)</span>
      </a>
    
    
  </nav>
</article>




  <div class="toc-button"  style="z-index: 100;">
    <button class="mdui-fab mdui-ripple mdui-color-teal" mdui-menu="{target: '#toc'}"><i class="iconfont icon-list"></i></button>
    <ul class="mdui-menu" id="toc">
      <li class="mdui-menu-item">
        <a href="/ios.github.io/2025/12/03/WeatheKit%20%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/" id="toc-header" class="mdui-ripple">文章目录</a>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#WeatherKit-%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3"><span class="toc-number">1.</span> <span class="toc-text">WeatherKit 使用文档</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1. 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE%E8%A6%81%E6%B1%82"><span class="toc-number">1.2.</span> <span class="toc-text">2. 配置要求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 项目配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%9D%83%E9%99%90%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 权限设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">3. 核心组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-WeatherService"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 WeatherService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-weather-for-including"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.1.1 weather(for:including:)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-historicalWeather-for-including-from-to"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.1.2 historicalWeather(for:including:from:to:)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-historicalWeather-for-at-including"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.1.3 historicalWeather(for:at:including:)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-4-search-for"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.1.4 search(for:)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-5-attribution"><span class="toc-number">1.3.6.</span> <span class="toc-text">3.1.5 attribution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.7.</span> <span class="toc-text">3.2 天气数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%A4%A9%E6%B0%94%E7%8A%B6%E6%80%81%E4%B8%AD%E6%96%87%E6%98%A0%E5%B0%84"><span class="toc-number">1.3.8.</span> <span class="toc-text">3.3 天气状态中文映射</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.4.</span> <span class="toc-text">4. 使用示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AF%BC%E5%85%A5%E6%A1%86%E6%9E%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 导入框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%AF%B7%E6%B1%82%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 请求天气数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E8%AF%B7%E6%B1%82%E5%8C%85%E5%90%AB%E5%88%86%E9%92%9F%E7%BA%A7%E9%99%8D%E6%B0%B4%E7%9A%84%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 请求包含分钟级降水的天气数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E8%8E%B7%E5%8F%96%E5%8E%86%E5%8F%B2%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 获取历史天气数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E8%8E%B7%E5%8F%96%E7%89%B9%E5%AE%9A%E6%97%B6%E9%97%B4%E7%82%B9%E7%9A%84%E5%8E%86%E5%8F%B2%E5%A4%A9%E6%B0%94"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 获取特定时间点的历史天气</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E5%A4%84%E7%90%86%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.6.</span> <span class="toc-text">4.6 处理天气数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-%E4%BD%8D%E7%BD%AE%E8%8E%B7%E5%8F%96%E4%B8%8E%E6%8E%88%E6%9D%83"><span class="toc-number">1.4.7.</span> <span class="toc-text">4.7 位置获取与授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-%E4%BD%BF%E7%94%A8%E5%9F%8E%E5%B8%82%E5%90%8D%E8%8E%B7%E5%8F%96%E5%A4%A9%E6%B0%94"><span class="toc-number">1.4.8.</span> <span class="toc-text">4.8 使用城市名获取天气</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E4%BD%8D%E7%BD%AE%E8%8E%B7%E5%8F%96%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.9.</span> <span class="toc-text">4.9 使用多个位置获取天气数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-%E6%98%BE%E7%A4%BA%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE%E5%BD%92%E5%9B%A0%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.10.</span> <span class="toc-text">4.10 显示天气数据归因信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E"><span class="toc-number">1.5.</span> <span class="toc-text">5. 天气数据详细说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-CurrentWeather"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 CurrentWeather</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-%E5%B1%9E%E6%80%A7%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E4%B8%8E%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">5.1.1 属性详细说明与使用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">5.1.2 完整使用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">5.1.3 注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-DayWeather"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 DayWeather</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-%E5%B1%9E%E6%80%A7%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E4%B8%8E%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">5.2.1 属性详细说明与使用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">5.2.2 完整使用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">5.2.3 注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-HourWeather"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 HourWeather</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-%E5%B1%9E%E6%80%A7%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E4%B8%8E%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">5.3.1 属性详细说明与使用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">5.3.2 完整使用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-3-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">5.3.3 注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-MinuteWeather"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.4 MinuteWeather</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-1-%E5%B1%9E%E6%80%A7%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E4%B8%8E%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">5.4.1 属性详细说明与使用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-2-%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">5.4.2 完整使用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-3-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">5.4.3 注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-WeatherAttribution"><span class="toc-number">1.5.5.</span> <span class="toc-text">5.5 WeatherAttribution</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-1-%E5%B1%9E%E6%80%A7%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E4%B8%8E%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">5.5.1 属性详细说明与使用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-2-%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">5.5.2 完整使用示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%BE%85%E5%8A%A9%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.</span> <span class="toc-text">6. 辅助数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-Wind"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 Wind</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-%E5%B1%9E%E6%80%A7%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">6.1.1 属性说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">6.1.2 使用示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Precipitation"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 Precipitation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-%E5%B1%9E%E6%80%A7%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">6.2.1 属性说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">6.2.2 使用示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-PrecipitationType"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 PrecipitationType</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-1-%E6%9E%9A%E4%B8%BE%E5%80%BC%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">6.3.1 枚举值说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">6.3.2 使用示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-UVIndex"><span class="toc-number">1.6.4.</span> <span class="toc-text">6.4 UVIndex</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-1-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">6.4.1 使用示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-MoonPhase"><span class="toc-number">1.6.5.</span> <span class="toc-text">6.5 MoonPhase</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-1-%E6%9E%9A%E4%B8%BE%E5%80%BC%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">6.5.1 枚举值说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-2-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">6.5.2 使用示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">7. 错误处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E5%AE%8C%E6%95%B4%E7%9A%84-WeatherError-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 完整的 WeatherError 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E8%AF%A6%E7%BB%86%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.7.2.</span> <span class="toc-text">6.2 详细的错误处理示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%A4%84%E7%90%86%E5%8E%86%E5%8F%B2%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE%E9%94%99%E8%AF%AF"><span class="toc-number">1.7.3.</span> <span class="toc-text">6.3 处理历史天气数据错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E5%A4%84%E7%90%86%E6%90%9C%E7%B4%A2%E9%94%99%E8%AF%AF"><span class="toc-number">1.7.4.</span> <span class="toc-text">6.4 处理搜索错误</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%95%B0%E6%8D%AE%E5%8D%95%E4%BD%8D%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.8.</span> <span class="toc-text">7. 数据单位转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E6%B8%A9%E5%BA%A6%E5%8D%95%E4%BD%8D%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.8.1.</span> <span class="toc-text">7.1 温度单位转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-1-%E5%B8%B8%E7%94%A8%E6%B8%A9%E5%BA%A6%E5%8D%95%E4%BD%8D"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">7.1.1 常用温度单位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-2-%E8%BD%AC%E6%8D%A2%E5%85%AC%E5%BC%8F"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">7.1.2 转换公式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-3-Swift-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">7.1.3 Swift 代码示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-4-%E5%9C%A8-UI-%E4%B8%AD%E6%98%BE%E7%A4%BA%E6%B8%A9%E5%BA%A6"><span class="toc-number">1.8.1.4.</span> <span class="toc-text">7.1.4 在 UI 中显示温度</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E9%80%9F%E5%BA%A6%E5%8D%95%E4%BD%8D%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.8.2.</span> <span class="toc-text">7.2 速度单位转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-%E5%B8%B8%E7%94%A8%E9%A3%8E%E9%80%9F%E5%8D%95%E4%BD%8D"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">7.2.1 常用风速单位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-%E8%BD%AC%E6%8D%A2%E5%85%AC%E5%BC%8F"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">7.2.2 转换公式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-Swift-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">7.2.3 Swift 代码示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-4-%E6%A0%B9%E6%8D%AE%E5%9C%B0%E5%8C%BA%E6%98%BE%E7%A4%BA%E5%90%88%E9%80%82%E7%9A%84%E9%A3%8E%E9%80%9F%E5%8D%95%E4%BD%8D"><span class="toc-number">1.8.2.4.</span> <span class="toc-text">7.2.4 根据地区显示合适的风速单位</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E9%99%8D%E6%B0%B4%E9%87%8F%E5%8D%95%E4%BD%8D%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.8.3.</span> <span class="toc-text">7.3 降水量单位转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-1-%E5%B8%B8%E7%94%A8%E9%99%8D%E6%B0%B4%E9%87%8F%E5%8D%95%E4%BD%8D"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">7.3.1 常用降水量单位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-2-%E8%BD%AC%E6%8D%A2%E5%85%AC%E5%BC%8F"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">7.3.2 转换公式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-Swift-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.8.3.3.</span> <span class="toc-text">7.3.3 Swift 代码示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-4-%E6%A0%B9%E6%8D%AE%E5%9C%B0%E5%8C%BA%E6%98%BE%E7%A4%BA%E5%90%88%E9%80%82%E7%9A%84%E9%99%8D%E6%B0%B4%E9%87%8F%E5%8D%95%E4%BD%8D"><span class="toc-number">1.8.3.4.</span> <span class="toc-text">7.3.4 根据地区显示合适的降水量单位</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E6%B0%94%E5%8E%8B%E5%8D%95%E4%BD%8D%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.8.4.</span> <span class="toc-text">7.4 气压单位转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-1-%E5%B8%B8%E7%94%A8%E6%B0%94%E5%8E%8B%E5%8D%95%E4%BD%8D"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">7.4.1 常用气压单位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-%E8%BD%AC%E6%8D%A2%E5%85%AC%E5%BC%8F"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">7.4.2 转换公式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-3-Swift-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.8.4.3.</span> <span class="toc-text">7.4.3 Swift 代码示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-4-%E6%A0%B9%E6%8D%AE%E5%9C%B0%E5%8C%BA%E6%98%BE%E7%A4%BA%E5%90%88%E9%80%82%E7%9A%84%E6%B0%94%E5%8E%8B%E5%8D%95%E4%BD%8D"><span class="toc-number">1.8.4.4.</span> <span class="toc-text">7.4.4 根据地区显示合适的气压单位</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%98%BE%E7%A4%BA%E4%B8%8E%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.8.5.</span> <span class="toc-text">7.5 其他数据类型的显示与转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-1-%E6%B9%BF%E5%BA%A6%E6%98%BE%E7%A4%BA"><span class="toc-number">1.8.5.1.</span> <span class="toc-text">7.5.1 湿度显示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-2-%E7%B4%AB%E5%A4%96%E7%BA%BF%E6%8C%87%E6%95%B0%E6%98%BE%E7%A4%BA"><span class="toc-number">1.8.5.2.</span> <span class="toc-text">7.5.2 紫外线指数显示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-3-%E9%99%8D%E6%B0%B4%E6%A6%82%E7%8E%87%E6%98%BE%E7%A4%BA"><span class="toc-number">1.8.5.3.</span> <span class="toc-text">7.5.3 降水概率显示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-4-%E4%BA%91%E8%A6%86%E7%9B%96%E7%8E%87%E6%98%BE%E7%A4%BA"><span class="toc-number">1.8.5.4.</span> <span class="toc-text">7.5.4 云覆盖率显示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-5-%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%98%BE%E7%A4%BA"><span class="toc-number">1.8.5.5.</span> <span class="toc-text">7.5.5 时间格式化显示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-6-%E5%9C%A8-UI-%E4%B8%AD%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%90%8C%E5%8D%95%E4%BD%8D"><span class="toc-number">1.8.5.6.</span> <span class="toc-text">7.5.6 在 UI 中显示不同单位</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.9.</span> <span class="toc-text">8. 最佳实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="toc-number">1.10.</span> <span class="toc-text">9. 天气数据缓存策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E4%BD%BF%E7%94%A8-UserDefaults-%E7%BC%93%E5%AD%98%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE"><span class="toc-number">1.10.1.</span> <span class="toc-text">9.1 使用 UserDefaults 缓存天气数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E4%BD%BF%E7%94%A8-Core-Data-%E7%BC%93%E5%AD%98%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE"><span class="toc-number">1.10.2.</span> <span class="toc-text">9.2 使用 Core Data 缓存天气数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E7%AD%96%E7%95%A5"><span class="toc-number">1.10.3.</span> <span class="toc-text">9.3 缓存失效策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-%E5%AE%9E%E7%8E%B0%E4%BD%8D%E7%BD%AE%E8%B7%9D%E7%A6%BB%E7%AD%96%E7%95%A5%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.10.4.</span> <span class="toc-text">9.4 实现位置距离策略示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%EF%BC%88%E5%AE%8C%E6%95%B4%E7%9A%84-ViewController%EF%BC%89"><span class="toc-number">1.11.</span> <span class="toc-text">10. 代码示例（完整的 ViewController）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E6%80%BB%E7%BB%93"><span class="toc-number">1.12.</span> <span class="toc-text">11. 总结</span></a></li></ol></li></ol>
      </li>
    </ul>
  </div>



    <div id="comment" class="mdui-card mdui-p-a-2 mdui-m-b-5">
      <div class="mdui-tab" mdui-tab>
        
          <a href="#comment-tab0" class="mdui-ripple">gitalk</a>
        
          <a href="#comment-tab1" class="mdui-ripple">livere</a>
        
      </div>
      
        <div id="comment-tab0" class="mdui-p-a-2">
          <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>
<script>
  var gitalk = new Gitalk({
    clientID: '',
    clientSecret: '',
    repo: '',
    owner: '',
    admin: [''],
    id:  md5(location.pathname) ,
    distractionFreeMode: 'true',
  });
  gitalk.render('gitalk-container');
</script>
        </div>
      
        <div id="comment-tab1" class="mdui-p-a-2">
          <div id="lv-container" data-id="city" data-uid="">
  <script type="text/javascript">
    (function (d, s) {
      var j, e = d.getElementsByTagName(s)[0];
      if (typeof LivereTower === 'function') { return; }
      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;
      e.parentNode.insertBefore(j, e);
    })(document, 'script');
  </script>
  <noscript>Please enable JavaScript to view the comments powered by LiveRe.</noscript>
</div>
        </div>
      
    </div>

  </main>
  <footer id="footer" class="mdui-text-center mdui-m-t-5 mdui-p-b-2 mdui-p-t-4 mdui-color-theme">
  <div class="mdui-container">
    <div class="mdui-row">
      
      <span>
        &copy; 2025 - 2025 
        
        猪会飞
      </span>
    </div>
    <div class="mdui-row">
      
        <span>Theme: <a href="https://github.com/kb1000fx/hexo-theme-meadow" rel="noopener" target="_blank">Meadow</a></span>
      
    </div>
    <div class="mdui-row">
      
    </div>
 </div>
</footer>
  
  <button id="gotop" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-ripple mdui-color-teal" style="z-index:100;"><i class="iconfont icon-arrowup"></i></button>
  
  




    <script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({
        startOnLoad: true,
        theme: "default"
    });</script>




    
<script src="/ios.github.io/js/mdui.min.v1.0.0.js"></script>




<script src="/ios.github.io/js/meadow.js"></script>

</body>
</html >