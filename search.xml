<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>swift学习日记(一)</title>
    <url>/ios.github.io/2025/12/03/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Swift学习日记（一）：Swift语言概述与基础语法"><a href="#Swift学习日记（一）：Swift语言概述与基础语法" class="headerlink" title="Swift学习日记（一）：Swift语言概述与基础语法"></a>Swift学习日记（一）：Swift语言概述与基础语法</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>Swift是苹果公司于2014年WWDC上发布的现代编程语言，用于开发iOS、macOS、watchOS和tvOS应用程序。它结合了C和Objective-C的优点，同时克服了它们的缺点，是一种安全、高效、易读的编程语言。</p>
<h2 id="二、Swift语言简介"><a href="#二、Swift语言简介" class="headerlink" title="二、Swift语言简介"></a>二、Swift语言简介</h2><h3 id="1-Swift的主要特点"><a href="#1-Swift的主要特点" class="headerlink" title="1. Swift的主要特点"></a>1. Swift的主要特点</h3><ol>
<li><strong>安全</strong>：通过类型安全和内存安全设计，减少常见编程错误</li>
<li><strong>现代</strong>：采用现代编程语言最佳实践，语法简洁明了</li>
<li><strong>高性能</strong>：性能接近C语言，适合开发高性能应用</li>
<li><strong>互操作性</strong>：与Objective-C完全兼容，可在同一项目中混合使用</li>
<li><strong>开源</strong>：自2015年起开源，拥有活跃的社区支持</li>
</ol>
<h3 id="2-Swift的应用场景"><a href="#2-Swift的应用场景" class="headerlink" title="2. Swift的应用场景"></a>2. Swift的应用场景</h3><ul>
<li>移动应用开发（iOS、iPadOS）</li>
<li>桌面应用开发（macOS）</li>
<li>穿戴设备开发（watchOS、tvOS）</li>
<li>服务器端开发</li>
<li>跨平台应用开发</li>
</ul>
<h2 id="三、Swift基础语法"><a href="#三、Swift基础语法" class="headerlink" title="三、Swift基础语法"></a>三、Swift基础语法</h2><!-- CATEGORY: 基础语法与数据类型 -->
<!-- INTERVIEW_TOPIC: 变量与常量 -->
<!-- HIGH_FREQUENCY_INTERVIEW: let与var的区别 -->

<h3 id="1-变量与常量"><a href="#1-变量与常量" class="headerlink" title="1. 变量与常量"></a>1. 变量与常量</h3><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><p>在Swift中，使用<code>var</code>声明变量，使用<code>let</code>声明常量：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 声明变量</span></span><br><span class="line"><span class="keyword">var</span> age: <span class="type">Int</span> <span class="operator">=</span> <span class="number">25</span></span><br><span class="line">age <span class="operator">=</span> <span class="number">26</span> <span class="comment">// 变量可以修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明常量</span></span><br><span class="line"><span class="keyword">let</span> name: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;张三&quot;</span></span><br><span class="line"><span class="comment">// name = &quot;李四&quot; // 常量不可以修改，这行代码会报错</span></span><br></pre></td></tr></table></figure>

<!-- INTERVIEW_TOPIC: 类型推断 -->

<h4 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h4><p>Swift具有强大的类型推断能力，通常可以省略类型声明：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> score <span class="operator">=</span> <span class="number">95</span> <span class="comment">// 自动推断为Int类型</span></span><br><span class="line"><span class="keyword">let</span> message <span class="operator">=</span> <span class="string">&quot;Hello Swift&quot;</span> <span class="comment">// 自动推断为String类型</span></span><br></pre></td></tr></table></figure>

<!-- INTERVIEW_TOPIC: 数据类型 -->

<h3 id="2-数据类型"><a href="#2-数据类型" class="headerlink" title="2. 数据类型"></a>2. 数据类型</h3><h4 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>Int</td>
<td>整数类型，自动适配平台（32&#x2F;64位）</td>
<td><code>var count: Int = 10</code></td>
</tr>
<tr>
<td>Double</td>
<td>双精度浮点数（64位）</td>
<td><code>var pi: Double = 3.14159</code></td>
</tr>
<tr>
<td>Float</td>
<td>单精度浮点数（32位）</td>
<td><code>var price: Float = 9.99</code></td>
</tr>
<tr>
<td>Bool</td>
<td>布尔类型，只能是true或false</td>
<td><code>var isActive: Bool = true</code></td>
</tr>
<tr>
<td>String</td>
<td>字符串类型，Unicode编码</td>
<td><code>var text: String = &quot;Hello&quot;</code></td>
</tr>
</tbody></table>
<!-- INTERVIEW_TOPIC: 集合类型 -->

<h4 id="集合类型"><a href="#集合类型" class="headerlink" title="集合类型"></a>集合类型</h4><ul>
<li><p><strong>数组(Array)</strong>：有序的相同类型元素集合</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers: [<span class="type">Int</span>] <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> fruits <span class="operator">=</span> [<span class="string">&quot;苹果&quot;</span>, <span class="string">&quot;香蕉&quot;</span>, <span class="string">&quot;橙子&quot;</span>] <span class="comment">// 自动推断为[String]类型</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>集合(Set)</strong>：无序的唯一类型元素集合</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> uniqueNumbers: <span class="type">Set</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> colors: <span class="type">Set</span>&lt;<span class="type">String</span>&gt; <span class="operator">=</span> [<span class="string">&quot;红&quot;</span>, <span class="string">&quot;绿&quot;</span>, <span class="string">&quot;蓝&quot;</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>字典(Dictionary)</strong>：键值对集合，键必须唯一</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> person: [<span class="type">String</span>: <span class="keyword">Any</span>] <span class="operator">=</span> [<span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>, <span class="string">&quot;isStudent&quot;</span>: <span class="literal">true</span>]</span><br><span class="line"><span class="keyword">var</span> scores: [<span class="type">String</span>: <span class="type">Int</span>] <span class="operator">=</span> [<span class="string">&quot;语文&quot;</span>: <span class="number">90</span>, <span class="string">&quot;数学&quot;</span>: <span class="number">95</span>, <span class="string">&quot;英语&quot;</span>: <span class="number">88</span>]</span><br></pre></td></tr></table></figure></li>
</ul>
<!-- INTERVIEW_TOPIC: 字符串操作 -->

<h3 id="3-字符串操作"><a href="#3-字符串操作" class="headerlink" title="3. 字符串操作"></a>3. 字符串操作</h3><p>Swift的String类型提供了丰富的字符串操作方法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字符串拼接</span></span><br><span class="line"><span class="keyword">let</span> firstName <span class="operator">=</span> <span class="string">&quot;张&quot;</span></span><br><span class="line"><span class="keyword">let</span> lastName <span class="operator">=</span> <span class="string">&quot;三&quot;</span></span><br><span class="line"><span class="keyword">let</span> fullName <span class="operator">=</span> firstName <span class="operator">+</span> lastName <span class="comment">// 结果为&quot;张三&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串插值</span></span><br><span class="line"><span class="keyword">let</span> age <span class="operator">=</span> <span class="number">25</span></span><br><span class="line"><span class="keyword">let</span> introduction <span class="operator">=</span> <span class="string">&quot;我叫<span class="subst">\(fullName)</span>，今年<span class="subst">\(age)</span>岁&quot;</span> <span class="comment">// 结果为&quot;我叫张三，今年25岁&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串长度</span></span><br><span class="line"><span class="keyword">let</span> text <span class="operator">=</span> <span class="string">&quot;Hello Swift&quot;</span></span><br><span class="line"><span class="keyword">let</span> length <span class="operator">=</span> text.count <span class="comment">// 结果为11</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串截取</span></span><br><span class="line"><span class="keyword">let</span> greeting <span class="operator">=</span> <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line"><span class="keyword">let</span> hello <span class="operator">=</span> greeting.prefix(<span class="number">5</span>) <span class="comment">// 结果为&quot;Hello&quot;</span></span><br><span class="line"><span class="keyword">let</span> world <span class="operator">=</span> greeting.suffix(<span class="number">6</span>) <span class="comment">// 结果为&quot;World!&quot;</span></span><br></pre></td></tr></table></figure>

<!-- CATEGORY: 控制流与函数 -->
<!-- INTERVIEW_TOPIC: 控制流 -->

<h3 id="4-控制流"><a href="#4-控制流" class="headerlink" title="4. 控制流"></a>4. 控制流</h3><h4 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// if-else语句</span></span><br><span class="line"><span class="keyword">let</span> score <span class="operator">=</span> <span class="number">85</span></span><br><span class="line"><span class="keyword">if</span> score <span class="operator">&gt;=</span> <span class="number">90</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;优秀&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> score <span class="operator">&gt;=</span> <span class="number">80</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;良好&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> score <span class="operator">&gt;=</span> <span class="number">60</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;及格&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;不及格&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// switch语句</span></span><br><span class="line"><span class="keyword">let</span> day <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">switch</span> day &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;星期一&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;星期二&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;星期三&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;星期四&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;星期五&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>, <span class="number">7</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;周末&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;无效的星期&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// for-in循环遍历数组</span></span><br><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">    <span class="built_in">print</span>(number)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for-in循环遍历字典</span></span><br><span class="line"><span class="keyword">let</span> scores <span class="operator">=</span> [<span class="string">&quot;语文&quot;</span>: <span class="number">90</span>, <span class="string">&quot;数学&quot;</span>: <span class="number">95</span>, <span class="string">&quot;英语&quot;</span>: <span class="number">88</span>]</span><br><span class="line"><span class="keyword">for</span> (subject, score) <span class="keyword">in</span> scores &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(subject)</span>：<span class="subst">\(score)</span>分&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// while循环</span></span><br><span class="line"><span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count <span class="operator">&lt;</span> <span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">    count <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// repeat-while循环（相当于do-while）</span></span><br><span class="line"><span class="keyword">var</span> index <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(index)</span><br><span class="line">    index <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">while</span> index <span class="operator">&lt;</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>

<!-- INTERVIEW_TOPIC: 函数 -->

<h3 id="5-函数"><a href="#5-函数" class="headerlink" title="5. 函数"></a>5. 函数</h3><h4 id="基本概念-1"><a href="#基本概念-1" class="headerlink" title="基本概念"></a>基本概念</h4><p>函数是执行特定任务的代码块，Swift的函数定义格式如下：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 函数定义</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">greet</span>(<span class="params">name</span>: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, <span class="subst">\(name)</span>!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数调用</span></span><br><span class="line"><span class="keyword">let</span> message <span class="operator">=</span> greet(name: <span class="string">&quot;张三&quot;</span>) <span class="comment">// 结果为&quot;Hello, 张三!&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="参数默认值"><a href="#参数默认值" class="headerlink" title="参数默认值"></a>参数默认值</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">greet</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">greeting</span>: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(greeting)</span>, <span class="subst">\(name)</span>!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用默认值调用</span></span><br><span class="line"><span class="keyword">let</span> message1 <span class="operator">=</span> greet(name: <span class="string">&quot;张三&quot;</span>) <span class="comment">// 结果为&quot;Hello, 张三!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义参数调用</span></span><br><span class="line"><span class="keyword">let</span> message2 <span class="operator">=</span> greet(name: <span class="string">&quot;张三&quot;</span>, greeting: <span class="string">&quot;你好&quot;</span>) <span class="comment">// 结果为&quot;你好, 张三!&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="params">numbers</span>: <span class="type">Int</span>...) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> total <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        total <span class="operator">+=</span> number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> sum(numbers: <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) <span class="comment">// 结果为15</span></span><br></pre></td></tr></table></figure>

<h2 id="四、内容机制与知识点总结"><a href="#四、内容机制与知识点总结" class="headerlink" title="四、内容机制与知识点总结"></a>四、内容机制与知识点总结</h2><h3 id="1-内容机制"><a href="#1-内容机制" class="headerlink" title="1. 内容机制"></a>1. 内容机制</h3><p>Swift的基础语法设计遵循以下原则：</p>
<ul>
<li><strong>简洁性</strong>：尽可能减少冗余代码，提高可读性</li>
<li><strong>安全性</strong>：通过类型安全和内存安全防止常见错误</li>
<li><strong>一致性</strong>：语法规则在整个语言中保持一致</li>
<li><strong>表达性</strong>：允许开发者用更自然的方式表达思想</li>
</ul>
<h3 id="2-知识点总结"><a href="#2-知识点总结" class="headerlink" title="2. 知识点总结"></a>2. 知识点总结</h3><table>
<thead>
<tr>
<th>主题</th>
<th>核心知识点</th>
</tr>
</thead>
<tbody><tr>
<td>变量与常量</td>
<td><code>var</code>&#x2F;<code>let</code>声明、类型推断</td>
</tr>
<tr>
<td>基本数据类型</td>
<td>Int、Double、Float、Bool、String</td>
</tr>
<tr>
<td>集合类型</td>
<td>Array、Set、Dictionary</td>
</tr>
<tr>
<td>字符串操作</td>
<td>拼接、插值、长度、截取</td>
</tr>
<tr>
<td>控制流</td>
<td>if-else、switch、for-in、while、repeat-while</td>
</tr>
<tr>
<td>函数</td>
<td>定义、调用、参数默认值、可变参数</td>
</tr>
</tbody></table>
<h2 id="五、遇到的问题及解决方案"><a href="#五、遇到的问题及解决方案" class="headerlink" title="五、遇到的问题及解决方案"></a>五、遇到的问题及解决方案</h2><h3 id="1-类型不匹配错误"><a href="#1-类型不匹配错误" class="headerlink" title="1. 类型不匹配错误"></a>1. 类型不匹配错误</h3><p><strong>问题</strong>：尝试将不同类型的值赋给变量时出现错误</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> age: <span class="type">Int</span> <span class="operator">=</span> <span class="string">&quot;25&quot;</span> <span class="comment">// 错误：Cannot assign value of type &#x27;String&#x27; to type &#x27;Int&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用类型转换</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> age: <span class="type">Int</span> <span class="operator">=</span> <span class="type">Int</span>(<span class="string">&quot;25&quot;</span>) <span class="operator">??</span> <span class="number">0</span> <span class="comment">// 使用可选绑定进行安全转换</span></span><br></pre></td></tr></table></figure>

<h3 id="2-常量修改错误"><a href="#2-常量修改错误" class="headerlink" title="2. 常量修改错误"></a>2. 常量修改错误</h3><p><strong>问题</strong>：尝试修改已声明的常量</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> name <span class="operator">=</span> <span class="string">&quot;张三&quot;</span></span><br><span class="line">name <span class="operator">=</span> <span class="string">&quot;李四&quot;</span> <span class="comment">// 错误：Cannot assign to value: &#x27;name&#x27; is a &#x27;let&#x27; constant</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：将<code>let</code>改为<code>var</code>声明为变量，或重新考虑设计，确定是否真的需要修改</p>
<h3 id="3-可选类型处理错误"><a href="#3-可选类型处理错误" class="headerlink" title="3. 可选类型处理错误"></a>3. 可选类型处理错误</h3><p><strong>问题</strong>：直接使用可能为nil的值</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> optionalString: <span class="type">String</span>? <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> count <span class="operator">=</span> optionalString.count <span class="comment">// 错误：Value of optional type &#x27;String?&#x27; must be unwrapped</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用可选绑定或强制解包（谨慎使用）</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 可选绑定</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> unwrappedString <span class="operator">=</span> optionalString &#123;</span><br><span class="line">    <span class="keyword">let</span> count <span class="operator">=</span> unwrappedString.count</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 强制解包（仅当确定值不为nil时使用）</span></span><br><span class="line"><span class="keyword">let</span> count <span class="operator">=</span> optionalString<span class="operator">!</span>.count</span><br></pre></td></tr></table></figure>

<h2 id="六、高阶用法"><a href="#六、高阶用法" class="headerlink" title="六、高阶用法"></a>六、高阶用法</h2><h3 id="1-高级类型技巧"><a href="#1-高级类型技巧" class="headerlink" title="1. 高级类型技巧"></a>1. 高级类型技巧</h3><h4 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h4><p>使用<code>typealias</code>为现有类型创建别名，提高代码可读性：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">UserID</span> <span class="operator">=</span> <span class="type">String</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Coordinate</span> <span class="operator">=</span> (latitude: <span class="type">Double</span>, longitude: <span class="type">Double</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">CompletionHandler</span> <span class="operator">=</span> (<span class="type">Result</span>&lt;<span class="type">Data</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用类型别名</span></span><br><span class="line"><span class="keyword">let</span> userID: <span class="type">UserID</span> <span class="operator">=</span> <span class="string">&quot;user_123&quot;</span></span><br><span class="line"><span class="keyword">let</span> location: <span class="type">Coordinate</span> <span class="operator">=</span> (<span class="number">39.9042</span>, <span class="number">116.4074</span>)</span><br><span class="line"><span class="keyword">let</span> handler: <span class="type">CompletionHandler</span> <span class="operator">=</span> &#123; result <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// 处理结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="元组的高级用法"><a href="#元组的高级用法" class="headerlink" title="元组的高级用法"></a>元组的高级用法</h4><p>元组可以用于返回多个值，且支持命名元素：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 返回多个值的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">calculateStatistics</span>(<span class="params">scores</span>: [<span class="type">Int</span>]) -&gt; (count: <span class="type">Int</span>, sum: <span class="type">Int</span>, average: <span class="type">Double</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> count <span class="operator">=</span> scores.count</span><br><span class="line">    <span class="keyword">let</span> sum <span class="operator">=</span> scores.reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line">    <span class="keyword">let</span> average <span class="operator">=</span> count <span class="operator">&gt;</span> <span class="number">0</span> <span class="operator">?</span> <span class="type">Double</span>(sum) <span class="operator">/</span> <span class="type">Double</span>(count) : <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">return</span> (count, sum, average)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> statistics <span class="operator">=</span> calculateStatistics(scores: [<span class="number">90</span>, <span class="number">85</span>, <span class="number">95</span>, <span class="number">88</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;数量：<span class="subst">\(statistics.count)</span>&quot;</span>) <span class="comment">// 输出：数量：4</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;总和：<span class="subst">\(statistics.sum)</span>&quot;</span>) <span class="comment">// 输出：总和：358</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;平均值：<span class="subst">\(statistics.average)</span>&quot;</span>) <span class="comment">// 输出：平均值：89.5</span></span><br></pre></td></tr></table></figure>

<h3 id="2-高级字符串操作"><a href="#2-高级字符串操作" class="headerlink" title="2. 高级字符串操作"></a>2. 高级字符串操作</h3><h4 id="多行字符串"><a href="#多行字符串" class="headerlink" title="多行字符串"></a>多行字符串</h4><p>使用三个双引号创建多行字符串：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> multiLineString <span class="operator">=</span> <span class="string">&quot;&quot;&quot;<span class="subst">\n</span>这是一个多行字符串，</span></span><br><span class="line"><span class="string">可以包含换行符和特殊字符，</span></span><br><span class="line"><span class="string">不需要使用转义序列。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h4><p>Swift提供了多种字符串比较方法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> string1 <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span></span><br><span class="line"><span class="keyword">let</span> string2 <span class="operator">=</span> <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 区分大小写比较</span></span><br><span class="line"><span class="keyword">if</span> string1 <span class="operator">==</span> string2 &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;字符串相等&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;字符串不相等&quot;</span>) <span class="comment">// 输出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不区分大小写比较</span></span><br><span class="line"><span class="keyword">if</span> string1.lowercased() <span class="operator">==</span> string2.lowercased() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;字符串相等&quot;</span>) <span class="comment">// 输出</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;字符串不相等&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前缀/后缀比较</span></span><br><span class="line"><span class="keyword">let</span> filePath <span class="operator">=</span> <span class="string">&quot;document.pdf&quot;</span></span><br><span class="line"><span class="keyword">if</span> filePath.hasSuffix(<span class="string">&quot;.pdf&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;这是一个PDF文件&quot;</span>) <span class="comment">// 输出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-高级函数技巧"><a href="#3-高级函数技巧" class="headerlink" title="3. 高级函数技巧"></a>3. 高级函数技巧</h3><h4 id="函数类型作为参数"><a href="#函数类型作为参数" class="headerlink" title="函数类型作为参数"></a>函数类型作为参数</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">applyOperation</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>, <span class="params">operation</span>: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> operation(a, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用函数类型参数</span></span><br><span class="line"><span class="keyword">let</span> result1 <span class="operator">=</span> applyOperation(<span class="number">5</span>, <span class="number">3</span>, operation: <span class="operator">+</span>)</span><br><span class="line"><span class="built_in">print</span>(result1) <span class="comment">// 输出：8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result2 <span class="operator">=</span> applyOperation(<span class="number">5</span>, <span class="number">3</span>, operation: <span class="operator">*</span>)</span><br><span class="line"><span class="built_in">print</span>(result2) <span class="comment">// 输出：15</span></span><br></pre></td></tr></table></figure>

<h4 id="函数作为返回值"><a href="#函数作为返回值" class="headerlink" title="函数作为返回值"></a>函数作为返回值</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">makeMultiplier</span>(<span class="params">factor</span>: <span class="type">Int</span>) -&gt; (<span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; number <span class="keyword">in</span> number <span class="operator">*</span> factor &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用返回的函数</span></span><br><span class="line"><span class="keyword">let</span> double <span class="operator">=</span> makeMultiplier(factor: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> triple <span class="operator">=</span> makeMultiplier(factor: <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(double(<span class="number">5</span>)) <span class="comment">// 输出：10</span></span><br><span class="line"><span class="built_in">print</span>(triple(<span class="number">5</span>)) <span class="comment">// 输出：15</span></span><br></pre></td></tr></table></figure>

<h3 id="4-性能优化策略"><a href="#4-性能优化策略" class="headerlink" title="4. 性能优化策略"></a>4. 性能优化策略</h3><h4 id="常量优先"><a href="#常量优先" class="headerlink" title="常量优先"></a>常量优先</h4><p>优先使用<code>let</code>声明常量，只有在需要修改时才使用<code>var</code>。这样可以：</p>
<ul>
<li>提高代码可读性（明确表示值不会改变）</li>
<li>帮助编译器进行优化</li>
<li>防止意外修改</li>
</ul>
<h4 id="适当使用集合类型"><a href="#适当使用集合类型" class="headerlink" title="适当使用集合类型"></a>适当使用集合类型</h4><p>根据使用场景选择合适的集合类型：</p>
<ul>
<li>需要有序集合时使用<code>Array</code></li>
<li>需要唯一元素且不关心顺序时使用<code>Set</code></li>
<li>需要键值对映射时使用<code>Dictionary</code></li>
</ul>
<h4 id="字符串性能"><a href="#字符串性能" class="headerlink" title="字符串性能"></a>字符串性能</h4><ul>
<li>大量字符串拼接时，使用<code>String</code>的<code>append</code>方法比<code>+</code>运算符更高效</li>
<li>复杂字符串处理时，考虑使用<code>NSAttributedString</code></li>
</ul>
<h3 id="5-最佳实践"><a href="#5-最佳实践" class="headerlink" title="5. 最佳实践"></a>5. 最佳实践</h3><h4 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h4><ul>
<li>使用驼峰命名法（camelCase）命名变量和函数</li>
<li>使用首字母大写的驼峰命名法（PascalCase）命名类型</li>
<li>命名要清晰、简洁，避免使用缩写</li>
</ul>
<h4 id="代码组织"><a href="#代码组织" class="headerlink" title="代码组织"></a>代码组织</h4><ul>
<li>函数职责要单一，避免过长的函数</li>
<li>使用注释解释复杂的逻辑，但不要过度注释</li>
<li>保持代码缩进一致，提高可读性</li>
</ul>
<h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><ul>
<li>尽早发现并处理错误</li>
<li>使用可选类型处理可能为nil的值</li>
<li>避免过多的强制解包</li>
</ul>
<h2 id="七、学习计划"><a href="#七、学习计划" class="headerlink" title="七、学习计划"></a>七、学习计划</h2><p>为了系统地学习Swift编程语言，我制定了以下学习计划：</p>
<ol>
<li><strong>Swift语言概述与基础语法</strong>（已完成）</li>
<li>数据类型与运算符</li>
<li>控制流（条件语句与循环）</li>
<li>函数与闭包</li>
<li>面向对象编程（类与结构体）</li>
<li>枚举与协议</li>
<li>扩展与泛型</li>
<li>错误处理</li>
<li>内存管理</li>
<li>Swift高级特性</li>
</ol>
<p>后续我将按照这个计划，逐步深入学习Swift编程语言的各个核心概念，并在学习日记中记录学习心得和示例代码。</p>
]]></content>
      <tags>
        <tag>swift</tag>
      </tags>
  </entry>
  <entry>
    <title>WeatherKit 使用文档</title>
    <url>/ios.github.io/2025/12/04/WeatheKit%20%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<h1 id="WeatherKit-使用文档"><a href="#WeatherKit-使用文档" class="headerlink" title="WeatherKit 使用文档"></a>WeatherKit 使用文档</h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h2><p>WeatherKit 是 Apple 提供的官方天气服务框架，允许开发者轻松获取实时天气数据、天气预报和历史天气信息。该框架支持 iOS 16+、iPadOS 16+、macOS 13+ 和 watchOS 9+，为跨平台天气应用开发提供了统一的解决方案。</p>
<p>WeatherKit 提供了丰富的天气数据类型和简单易用的 API 接口，包括：</p>
<ul>
<li>实时天气状况</li>
<li>每日天气预报</li>
<li>每小时天气预报</li>
<li>分钟级降水预报（部分地区支持）</li>
<li>历史天气数据</li>
<li>天气数据归因信息</li>
</ul>
<p>通过集成 WeatherKit，开发者可以快速构建功能丰富、数据准确的天气应用。</p>
<h2 id="2-配置要求"><a href="#2-配置要求" class="headerlink" title="2. 配置要求"></a>2. 配置要求</h2><p>要使用 WeatherKit 框架，需要进行以下配置：</p>
<h3 id="2-1-项目配置"><a href="#2-1-项目配置" class="headerlink" title="2.1 项目配置"></a>2.1 项目配置</h3><ol>
<li><strong>最低系统版本</strong>：在 Xcode 项目中，确保目标平台版本为 iOS 16.0+、iPadOS 16.0+、macOS 13.0+ 或 watchOS 9.0+</li>
<li><strong>添加 WeatherKit 能力</strong>：在项目的 <code>Signing &amp; Capabilities</code> 面板中添加 <code>WeatherKit</code> capability</li>
<li><strong>添加位置权限描述</strong>：在 <code>Info.plist</code> 文件中添加以下键值对：<ul>
<li><code>NSLocationWhenInUseUsageDescription</code>：当应用在前台使用时访问位置的描述</li>
<li><code>NSLocationAlwaysAndWhenInUseUsageDescription</code>（可选）：用于后台获取天气数据时的位置权限描述</li>
</ul>
</li>
</ol>
<h3 id="2-2-权限设置"><a href="#2-2-权限设置" class="headerlink" title="2.2 权限设置"></a>2.2 权限设置</h3><p>WeatherKit 需要位置权限才能提供基于位置的天气数据。应用需要请求用户授权访问位置信息。建议只请求必要的权限：</p>
<ul>
<li>对于仅在前台使用的天气应用，请求 <code>When In Use</code> 权限即可</li>
<li>对于需要后台更新天气数据的应用，可以请求 <code>Always</code> 权限</li>
</ul>
<p>通过合理的权限请求策略，可以提高用户授权率，同时保护用户隐私。</p>
<h2 id="3-核心组件"><a href="#3-核心组件" class="headerlink" title="3. 核心组件"></a>3. 核心组件</h2><h3 id="3-1-WeatherService"><a href="#3-1-WeatherService" class="headerlink" title="3.1 WeatherService"></a>3.1 WeatherService</h3><p><code>WeatherService</code> 是 WeatherKit 的核心类，用于获取所有天气数据。它采用单例设计模式，通过 <code>shared</code> 属性访问：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取 WeatherService 单例</span></span><br><span class="line"><span class="keyword">let</span> weatherService <span class="operator">=</span> <span class="type">WeatherService</span>.shared</span><br></pre></td></tr></table></figure>

<p><code>WeatherService</code> 提供了以下主要方法：</p>
<h3 id="3-1-1-weather-for-including"><a href="#3-1-1-weather-for-including" class="headerlink" title="3.1.1 weather(for:including:)"></a>3.1.1 weather(for:including:)</h3><p><strong>功能</strong>：获取指定位置的实时天气数据和预报数据。</p>
<p><strong>方法签名</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">weather</span>(</span><br><span class="line">    <span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>,</span><br><span class="line">    <span class="params">including</span> <span class="params">dataTypes</span>: <span class="type">WeatherData</span>.<span class="keyword">Type</span><span class="operator">...</span></span><br><span class="line">) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">WeatherKit</span>.<span class="type">Weather</span>&lt;<span class="type">WeatherKit</span>.<span class="type">WeatherData</span>.<span class="keyword">Type</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>location</code>：要获取天气数据的位置，类型为 <code>CLLocation</code></li>
<li><code>dataTypes</code>：要获取的数据类型，可变参数，可选值包括 <code>.current</code>、<code>.daily</code>、<code>.hourly</code>、<code>.minute</code></li>
</ul>
<p><strong>返回值</strong>：包含请求的所有天气数据的元组，元组中的每个元素对应请求的数据类型。</p>
<p><strong>使用示例</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前天气、每日预报和每小时预报</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherData</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> (current, daily, hourly) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .current, .daily, .hourly</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用当前天气数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;当前温度：<span class="subst">\(Int(current.temperature.value.rounded()))</span>°C&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;天气状况：<span class="subst">\(current.condition.description)</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用每日预报数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;未来7天预报：&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> day <span class="keyword">in</span> daily.forecast &#123;</span><br><span class="line">                <span class="keyword">let</span> date <span class="operator">=</span> day.date.formatted(date: .abbreviated, time: .omitted)</span><br><span class="line">                <span class="keyword">let</span> high <span class="operator">=</span> <span class="type">Int</span>(day.highTemperature.value.rounded())</span><br><span class="line">                <span class="keyword">let</span> low <span class="operator">=</span> <span class="type">Int</span>(day.lowTemperature.value.rounded())</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(date)</span>: 最高<span class="subst">\(high)</span>°C，最低<span class="subst">\(low)</span>°C&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用每小时预报数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;未来24小时预报：&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> hour <span class="keyword">in</span> hourly.forecast.prefix(<span class="number">24</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> time <span class="operator">=</span> hour.date.formatted(date: .omitted, time: .shortened)</span><br><span class="line">                <span class="keyword">let</span> temp <span class="operator">=</span> <span class="type">Int</span>(hour.temperature.value.rounded())</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(time)</span>: <span class="subst">\(temp)</span>°C&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong>：</p>
<ul>
<li>分钟级降水预报（<code>.minute</code>）仅在部分地区可用</li>
<li>每日预报默认返回未来7天的数据</li>
<li>每小时预报默认返回未来12小时的数据</li>
</ul>
<h3 id="3-1-2-historicalWeather-for-including-from-to"><a href="#3-1-2-historicalWeather-for-including-from-to" class="headerlink" title="3.1.2 historicalWeather(for:including:from:to:)"></a>3.1.2 historicalWeather(for:including:from:to:)</h3><p><strong>功能</strong>：获取指定时间范围的历史天气数据。</p>
<p><strong>方法签名</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">historicalWeather</span>(</span><br><span class="line">    <span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>,</span><br><span class="line">    <span class="params">including</span> <span class="params">dataTypes</span>: <span class="type">WeatherData</span>.<span class="keyword">Type</span><span class="operator">...</span>,</span><br><span class="line">    <span class="params">from</span> <span class="params">startDate</span>: <span class="type">Date</span>,</span><br><span class="line">    <span class="params">to</span> <span class="params">endDate</span>: <span class="type">Date</span></span><br><span class="line">) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">WeatherKit</span>.<span class="type">HistoricalWeather</span>&lt;<span class="type">WeatherKit</span>.<span class="type">WeatherData</span>.<span class="keyword">Type</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>location</code>：要获取历史天气数据的位置，类型为 <code>CLLocation</code></li>
<li><code>dataTypes</code>：要获取的历史数据类型，可变参数，可选值包括 <code>.current</code>、<code>.daily</code>、<code>.hourly</code></li>
<li><code>startDate</code>：历史数据的起始日期</li>
<li><code>endDate</code>：历史数据的结束日期</li>
</ul>
<p><strong>返回值</strong>：包含指定时间范围内历史天气数据的元组。</p>
<p><strong>使用示例</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取过去7天的历史天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchHistoricalWeatherData</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 设置时间范围（过去7天）</span></span><br><span class="line">            <span class="keyword">let</span> endDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">            <span class="keyword">let</span> startDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .day, value: <span class="operator">-</span><span class="number">7</span>, to: endDate)<span class="operator">!</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> historicalWeather <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.historicalWeather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .daily,</span><br><span class="line">                from: startDate,</span><br><span class="line">                to: endDate</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用历史每日数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;过去7天历史天气：&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> day <span class="keyword">in</span> historicalWeather.daily.forecast &#123;</span><br><span class="line">                <span class="keyword">let</span> date <span class="operator">=</span> day.date.formatted(date: .abbreviated, time: .omitted)</span><br><span class="line">                <span class="keyword">let</span> high <span class="operator">=</span> <span class="type">Int</span>(day.highTemperature.value.rounded())</span><br><span class="line">                <span class="keyword">let</span> low <span class="operator">=</span> <span class="type">Int</span>(day.lowTemperature.value.rounded())</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(date)</span>: 最高<span class="subst">\(high)</span>°C，最低<span class="subst">\(low)</span>°C&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取历史天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong>：</p>
<ul>
<li>历史数据的时间范围有限制，具体取决于 WeatherKit 服务的支持</li>
<li>无法获取分钟级的历史降水数据</li>
</ul>
<h3 id="3-1-3-historicalWeather-for-at-including"><a href="#3-1-3-historicalWeather-for-at-including" class="headerlink" title="3.1.3 historicalWeather(for:at:including:)"></a>3.1.3 historicalWeather(for:at:including:)</h3><p><strong>功能</strong>：获取指定位置在特定时间点的历史天气数据。</p>
<p><strong>方法签名</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">historicalWeather</span>(</span><br><span class="line">    <span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>,</span><br><span class="line">    <span class="params">at</span> <span class="params">timestamp</span>: <span class="type">Date</span>,</span><br><span class="line">    <span class="params">including</span> <span class="params">dataTypes</span>: <span class="type">WeatherData</span>.<span class="keyword">Type</span><span class="operator">...</span></span><br><span class="line">) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">WeatherKit</span>.<span class="type">HistoricalWeather</span>&lt;<span class="type">WeatherKit</span>.<span class="type">WeatherData</span>.<span class="keyword">Type</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>location</code>：要获取历史天气数据的位置，类型为 <code>CLLocation</code></li>
<li><code>timestamp</code>：要获取历史天气数据的特定时间点</li>
<li><code>dataTypes</code>：要获取的历史数据类型，可变参数，可选值包括 <code>.current</code></li>
</ul>
<p><strong>返回值</strong>：包含指定时间点历史天气数据的元组。</p>
<p><strong>使用示例</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取昨天此时的历史天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchYesterdayWeather</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 设置时间点（昨天的这个时间）</span></span><br><span class="line">            <span class="keyword">let</span> yesterday <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .day, value: <span class="operator">-</span><span class="number">1</span>, to: <span class="type">Date</span>())<span class="operator">!</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> historicalWeather <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.historicalWeather(</span><br><span class="line">                for: location,</span><br><span class="line">                at: yesterday,</span><br><span class="line">                including: .current</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用历史数据</span></span><br><span class="line">            <span class="keyword">let</span> date <span class="operator">=</span> yesterday.formatted(date: .abbreviated, time: .shortened)</span><br><span class="line">            <span class="keyword">let</span> temp <span class="operator">=</span> <span class="type">Int</span>(historicalWeather.current.temperature.value.rounded())</span><br><span class="line">            <span class="keyword">let</span> condition <span class="operator">=</span> historicalWeather.current.condition.description</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(date)</span> 的天气：<span class="subst">\(temp)</span>°C，<span class="subst">\(condition)</span>&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取历史天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-4-search-for"><a href="#3-1-4-search-for" class="headerlink" title="3.1.4 search(for:)"></a>3.1.4 search(for:)</h3><p><strong>功能</strong>：根据关键词搜索位置，返回匹配的位置列表。</p>
<p><strong>方法签名</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">search</span>(</span><br><span class="line">    <span class="params">for</span> <span class="params">searchTerm</span>: <span class="type">String</span></span><br><span class="line">) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; [<span class="type">WeatherKit</span>.<span class="type">WeatherLocation</span>]</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>searchTerm</code>：搜索关键词，可以是城市名、地区名、邮政编码等</li>
</ul>
<p><strong>返回值</strong>：匹配的位置列表，每个位置包含名称、坐标等信息。</p>
<p><strong>使用示例</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据城市名搜索位置</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">searchLocation</span>(<span class="params">for</span> <span class="params">cityName</span>: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> searchResults <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.search(for: cityName)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 显示搜索结果</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;搜索结果：&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> result <span class="keyword">in</span> searchResults &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;名称：<span class="subst">\(result.name)</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;坐标：<span class="subst">\(result.location.coordinate.latitude)</span>, <span class="subst">\(result.location.coordinate.longitude)</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;国家：<span class="subst">\(result.country <span class="operator">??</span> <span class="string">&quot;未知&quot;</span>)</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;行政区划：<span class="subst">\(result.administrativeArea <span class="operator">??</span> <span class="string">&quot;未知&quot;</span>)</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;---&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用第一个搜索结果获取天气数据</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> firstResult <span class="operator">=</span> searchResults.first &#123;</span><br><span class="line">                <span class="keyword">let</span> (current, <span class="keyword">_</span>, <span class="keyword">_</span>) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                    for: firstResult.location,</span><br><span class="line">                    including: .current</span><br><span class="line">                )</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(firstResult.name)</span> 当前温度：<span class="subst">\(Int(current.temperature.value.rounded()))</span>°C&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;搜索位置失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-5-attribution"><a href="#3-1-5-attribution" class="headerlink" title="3.1.5 attribution"></a>3.1.5 attribution</h3><p><strong>功能</strong>：获取天气数据的归因信息，用于显示版权声明。</p>
<p><strong>方法签名</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> attribution: <span class="type">WeatherKit</span>.<span class="type">WeatherAttribution</span> &#123; <span class="keyword">get</span> <span class="keyword">async</span> <span class="keyword">throws</span> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回值</strong>：包含天气数据归因信息的 <code>WeatherAttribution</code> 对象。</p>
<p><strong>使用示例</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取并显示天气数据归因信息</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherAttribution</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.attribution</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用归因信息</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;法律声明：<span class="subst">\(attribution.legalText)</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> logoURL <span class="operator">=</span> attribution.logoLightURL &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;亮色背景 Logo URL：<span class="subst">\(logoURL)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> logoURL <span class="operator">=</span> attribution.logoDarkURL &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;暗色背景 Logo URL：<span class="subst">\(logoURL)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> privacyURL <span class="operator">=</span> attribution.privacyPolicyURL &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;隐私政策 URL：<span class="subst">\(privacyURL)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> termsURL <span class="operator">=</span> attribution.termsOfServiceURL &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;服务条款 URL：<span class="subst">\(termsURL)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取归因信息失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong>：</p>
<ul>
<li>根据 Apple 的要求，使用 WeatherKit 数据的应用必须显示归因信息</li>
<li>归因信息包括法律声明、Logo 和相关链接</li>
</ul>
<p>所有天气数据获取方法都是异步的，需要在异步上下文中调用，如 Swift 的 <code>Task</code> 中。</p>
<h3 id="3-2-天气数据类型"><a href="#3-2-天气数据类型" class="headerlink" title="3.2 天气数据类型"></a>3.2 天气数据类型</h3><ul>
<li><strong>CurrentWeather</strong>: 当前天气状况，包括温度、湿度、风向、气压等实时数据</li>
<li><strong>DayWeather</strong>: 每日天气预报，包括最高&#x2F;最低温度、降水概率、日出&#x2F;日落时间等</li>
<li><strong>HourWeather</strong>: 每小时天气预报，包括温度变化、降水概率、风速等</li>
<li><strong>MinuteWeather</strong>: 分钟级降水预报（某些地区支持），提供未来1小时内的逐分钟降水预测</li>
<li><strong>WeatherAttribution</strong>: 天气数据来源归因，用于显示天气数据的版权信息</li>
<li><strong>Forecast<T></strong>: 天气预报容器，用于包含多个时间点的天气数据</li>
</ul>
<h3 id="3-3-天气状态中文映射"><a href="#3-3-天气状态中文映射" class="headerlink" title="3.3 天气状态中文映射"></a>3.3 天气状态中文映射</h3><p>WeatherKit 使用 <code>WeatherCondition</code> 枚举表示天气状态，以下是完整的中文映射表：</p>
<table>
<thead>
<tr>
<th>WeatherCondition</th>
<th>中文描述</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>clear</strong></td>
<td>晴天</td>
<td>天空晴朗，无云或极少云</td>
</tr>
<tr>
<td><strong>partlyCloudy</strong></td>
<td>多云</td>
<td>天空部分多云</td>
</tr>
<tr>
<td><strong>cloudy</strong></td>
<td>阴</td>
<td>天空多云</td>
</tr>
<tr>
<td><strong>overcast</strong></td>
<td>阴云密布</td>
<td>天空完全被云覆盖</td>
</tr>
<tr>
<td><strong>foggy</strong></td>
<td>雾</td>
<td>能见度降低的雾天</td>
</tr>
<tr>
<td><strong>windy</strong></td>
<td>大风</td>
<td>风力较强</td>
</tr>
<tr>
<td><strong>breezy</strong></td>
<td>微风</td>
<td>风力适中</td>
</tr>
<tr>
<td><strong>rainy</strong></td>
<td>雨天</td>
<td>有降雨</td>
</tr>
<tr>
<td><strong>snowy</strong></td>
<td>雪天</td>
<td>有降雪</td>
</tr>
<tr>
<td><strong>sleety</strong></td>
<td>雨夹雪</td>
<td>雨和雪混合</td>
</tr>
<tr>
<td><strong>haily</strong></td>
<td>冰雹</td>
<td>有冰雹</td>
</tr>
<tr>
<td><strong>blizzard</strong></td>
<td>暴风雪</td>
<td>强烈的降雪天气</td>
</tr>
<tr>
<td><strong>tropicalStorm</strong></td>
<td>热带风暴</td>
<td>热带地区的风暴天气</td>
</tr>
<tr>
<td><strong>hurricane</strong></td>
<td>飓风</td>
<td>强烈的热带气旋</td>
</tr>
<tr>
<td><strong>thundery</strong></td>
<td>雷暴</td>
<td>伴有雷电的天气</td>
</tr>
<tr>
<td><strong>tornado</strong></td>
<td>龙卷风</td>
<td>强烈的旋转气流天气</td>
</tr>
</tbody></table>
<h2 id="4-使用示例"><a href="#4-使用示例" class="headerlink" title="4. 使用示例"></a>4. 使用示例</h2><h3 id="4-1-导入框架"><a href="#4-1-导入框架" class="headerlink" title="4.1 导入框架"></a>4.1 导入框架</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> WeatherKit</span><br><span class="line"><span class="keyword">import</span> CoreLocation <span class="comment">// 用于位置获取</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-请求天气数据"><a href="#4-2-请求天气数据" class="headerlink" title="4.2 请求天气数据"></a>4.2 请求天气数据</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在异步上下文中调用</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeather</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 获取当前天气、每日预报和每小时预报</span></span><br><span class="line">            <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .current, .daily, .hourly</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用获取到的天气数据</span></span><br><span class="line">            updateUI(</span><br><span class="line">                current: currentWeather,</span><br><span class="line">                daily: dailyForecast,</span><br><span class="line">                hourly: hourlyForecast,</span><br><span class="line">                location: location</span><br><span class="line">            )</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="comment">// 处理错误</span></span><br><span class="line">            showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-请求包含分钟级降水的天气数据"><a href="#4-3-请求包含分钟级降水的天气数据" class="headerlink" title="4.3 请求包含分钟级降水的天气数据"></a>4.3 请求包含分钟级降水的天气数据</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherWithMinuteForecast</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 获取当前天气、每日预报、每小时预报和分钟级降水预报</span></span><br><span class="line">            <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast, minuteForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .current, .daily, .hourly, .minute</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用分钟级降水预报</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> firstMinute <span class="operator">=</span> minuteForecast.forecast.first &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;未来1分钟降水概率：<span class="subst">\(Int(firstMinute.precipitationChance <span class="operator">*</span> <span class="number">100</span>))</span>%&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-获取历史天气数据"><a href="#4-4-获取历史天气数据" class="headerlink" title="4.4 获取历史天气数据"></a>4.4 获取历史天气数据</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchHistoricalWeather</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 定义历史时间范围（过去7天）</span></span><br><span class="line">            <span class="keyword">let</span> endDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">            <span class="keyword">let</span> startDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .day, value: <span class="operator">-</span><span class="number">7</span>, to: endDate)<span class="operator">!</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取历史天气数据</span></span><br><span class="line">            <span class="keyword">let</span> historicalWeather <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.historicalWeather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .daily,</span><br><span class="line">                from: startDate,</span><br><span class="line">                to: endDate</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用历史天气数据</span></span><br><span class="line">            <span class="keyword">for</span> dayWeather <span class="keyword">in</span> historicalWeather.daily.forecast &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(dayWeather.date)</span>: 最高温 <span class="subst">\(Int(dayWeather.highTemperature.value.rounded()))</span>°，最低温 <span class="subst">\(Int(dayWeather.lowTemperature.value.rounded()))</span>°&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            showError(<span class="string">&quot;获取历史天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-获取特定时间点的历史天气"><a href="#4-5-获取特定时间点的历史天气" class="headerlink" title="4.5 获取特定时间点的历史天气"></a>4.5 获取特定时间点的历史天气</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchHistoricalWeatherForSpecificTime</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 定义特定的历史时间点（昨天的这个时间）</span></span><br><span class="line">            <span class="keyword">let</span> historicalDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .day, value: <span class="operator">-</span><span class="number">1</span>, to: <span class="type">Date</span>())<span class="operator">!</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取特定时间点的历史天气</span></span><br><span class="line">            <span class="keyword">let</span> historicalWeather <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.historicalWeather(</span><br><span class="line">                for: location,</span><br><span class="line">                at: historicalDate,</span><br><span class="line">                including: .current</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用历史天气数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;昨天此时的温度：<span class="subst">\(Int(historicalWeather.current.temperature.value.rounded()))</span>°&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            showError(<span class="string">&quot;获取历史天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-处理天气数据"><a href="#4-6-处理天气数据" class="headerlink" title="4.6 处理天气数据"></a>4.6 处理天气数据</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">updateUI</span>(</span><br><span class="line">    <span class="params">current</span>: <span class="type">CurrentWeather</span>,</span><br><span class="line">    <span class="params">daily</span>: <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;,</span><br><span class="line">    <span class="params">hourly</span>: <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;,</span><br><span class="line">    <span class="params">location</span>: <span class="type">CLLocation</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// 更新当前温度</span></span><br><span class="line">    temperatureLabel.text <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(Int(current.temperature.value.rounded()))</span>°&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新天气状况描述</span></span><br><span class="line">    conditionLabel.text <span class="operator">=</span> current.condition.description</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新今日最高/最低温度</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> today <span class="operator">=</span> daily.forecast.first &#123;</span><br><span class="line">        <span class="keyword">let</span> high <span class="operator">=</span> <span class="type">Int</span>(today.highTemperature.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> low <span class="operator">=</span> <span class="type">Int</span>(today.lowTemperature.value.rounded())</span><br><span class="line">        highLowLabel.text <span class="operator">=</span> <span class="string">&quot;H:<span class="subst">\(high)</span>°  L:<span class="subst">\(low)</span>°&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-7-位置获取与授权"><a href="#4-7-位置获取与授权" class="headerlink" title="4.7 位置获取与授权"></a>4.7 位置获取与授权</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置位置管理器</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">setupLocationManager</span>() &#123;</span><br><span class="line">    locationManager.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    locationManager.desiredAccuracy <span class="operator">=</span> kCLLocationAccuracyHundredMeters</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求位置权限和位置信息</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">requestLocation</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> status <span class="operator">=</span> locationManager.authorizationStatus</span><br><span class="line">    <span class="keyword">switch</span> status &#123;</span><br><span class="line">    <span class="keyword">case</span> .notDetermined:</span><br><span class="line">        locationManager.requestWhenInUseAuthorization()</span><br><span class="line">    <span class="keyword">case</span> .authorizedWhenInUse, .authorizedAlways:</span><br><span class="line">        locationManager.requestLocation()</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        showError(<span class="string">&quot;定位权限被拒绝，无法获取天气&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 位置更新回调</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">locationManager</span>(<span class="keyword">_</span> <span class="params">manager</span>: <span class="type">CLLocationManager</span>, <span class="params">didUpdateLocations</span> <span class="params">locations</span>: [<span class="type">CLLocation</span>]) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> location <span class="operator">=</span> locations.first <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    fetchWeather(for: location)</span><br><span class="line">    reverseGeocode(location: location) <span class="comment">// 获取城市名</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-8-使用城市名获取天气"><a href="#4-8-使用城市名获取天气" class="headerlink" title="4.8 使用城市名获取天气"></a>4.8 使用城市名获取天气</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherByCityName</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 创建城市名查询</span></span><br><span class="line">            <span class="keyword">let</span> searchQuery <span class="operator">=</span> <span class="string">&quot;Beijing&quot;</span></span><br><span class="line">            <span class="keyword">let</span> searchResults <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.search(for: searchQuery)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取第一个搜索结果的位置</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> firstResult <span class="operator">=</span> searchResults.first <span class="keyword">else</span> &#123;</span><br><span class="line">                showError(<span class="string">&quot;未找到该城市&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用搜索结果的位置获取天气</span></span><br><span class="line">            <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.weather(</span><br><span class="line">                for: firstResult.location,</span><br><span class="line">                including: .current, .daily, .hourly</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用天气数据</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(firstResult.name)</span> 当前温度：<span class="subst">\(Int(currentWeather.temperature.value.rounded()))</span>°&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-9-使用多个位置获取天气数据"><a href="#4-9-使用多个位置获取天气数据" class="headerlink" title="4.9 使用多个位置获取天气数据"></a>4.9 使用多个位置获取天气数据</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherForMultipleLocations</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 定义多个位置</span></span><br><span class="line">            <span class="keyword">let</span> beijingLocation <span class="operator">=</span> <span class="type">CLLocation</span>(latitude: <span class="number">39.9042</span>, longitude: <span class="number">116.4074</span>)</span><br><span class="line">            <span class="keyword">let</span> shanghaiLocation <span class="operator">=</span> <span class="type">CLLocation</span>(latitude: <span class="number">31.2304</span>, longitude: <span class="number">121.4737</span>)</span><br><span class="line">            <span class="keyword">let</span> locations <span class="operator">=</span> [beijingLocation, shanghaiLocation]</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 批量获取天气数据</span></span><br><span class="line">            <span class="keyword">for</span> location <span class="keyword">in</span> locations &#123;</span><br><span class="line">                <span class="keyword">let</span> (currentWeather, <span class="keyword">_</span>, <span class="keyword">_</span>) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.weather(</span><br><span class="line">                    for: location,</span><br><span class="line">                    including: .current</span><br><span class="line">                )</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;位置 <span class="subst">\(location.coordinate.latitude)</span>, <span class="subst">\(location.coordinate.longitude)</span> 当前温度：<span class="subst">\(Int(currentWeather.temperature.value.rounded()))</span>°&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-10-显示天气数据归因信息"><a href="#4-10-显示天气数据归因信息" class="headerlink" title="4.10 显示天气数据归因信息"></a>4.10 显示天气数据归因信息</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">showWeatherAttribution</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.attribution</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 在 UI 中显示归因信息</span></span><br><span class="line">            <span class="keyword">let</span> attributionLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">            attributionLabel.text <span class="operator">=</span> attribution.legalText</span><br><span class="line">            attributionLabel.font <span class="operator">=</span> .systemFont(ofSize: <span class="number">12</span>)</span><br><span class="line">            attributionLabel.textColor <span class="operator">=</span> .secondaryLabel</span><br><span class="line">            attributionLabel.textAlignment <span class="operator">=</span> .center</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加到视图中</span></span><br><span class="line">            view.addSubview(attributionLabel)</span><br><span class="line">            <span class="comment">// 设置约束...</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 或者使用归因链接</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> attributionURL <span class="operator">=</span> attribution.privacyPolicyURL &#123;</span><br><span class="line">                <span class="keyword">let</span> attributionButton <span class="operator">=</span> <span class="type">UIButton</span>(type: .system)</span><br><span class="line">                attributionButton.setTitle(<span class="string">&quot;天气数据来源&quot;</span>, for: .normal)</span><br><span class="line">                attributionButton.addTarget(<span class="keyword">self</span>, action: <span class="keyword">#selector</span>(openAttributionLink), for: .touchUpInside)</span><br><span class="line">                <span class="comment">// 设置约束...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取归因信息失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">openAttributionLink</span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try?</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.attribution,</span><br><span class="line">       <span class="keyword">let</span> attributionURL <span class="operator">=</span> attribution.privacyPolicyURL &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.shared.open(attributionURL)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-天气数据详细说明"><a href="#5-天气数据详细说明" class="headerlink" title="5. 天气数据详细说明"></a>5. 天气数据详细说明</h2><h3 id="5-1-CurrentWeather"><a href="#5-1-CurrentWeather" class="headerlink" title="5.1 CurrentWeather"></a>5.1 CurrentWeather</h3><p><code>CurrentWeather</code> 包含当前天气的详细信息，是 WeatherKit 中最常用的天气数据类型之一。</p>
<h4 id="5-1-1-属性详细说明与使用示例"><a href="#5-1-1-属性详细说明与使用示例" class="headerlink" title="5.1.1 属性详细说明与使用示例"></a>5.1.1 属性详细说明与使用示例</h4><table>
<thead>
<tr>
<th align="left">属性</th>
<th>类型</th>
<th>描述</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>date</strong></td>
<td>Date</td>
<td>当前天气的时间戳</td>
<td><code>let time = currentWeather.date.formatted(date: .omitted, time: .shortened)</code></td>
</tr>
<tr>
<td align="left"><strong>temperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>当前温度</td>
<td><code>let temp = Int(currentWeather.temperature.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>feelsLikeTemperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>体感温度</td>
<td><code>let feelsLike = Int(currentWeather.feelsLikeTemperature.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>condition</strong></td>
<td>WeatherCondition</td>
<td>天气状况</td>
<td><code>let condition = currentWeather.condition</code></td>
</tr>
<tr>
<td align="left"><strong>description</strong></td>
<td>String</td>
<td>天气状况的文本描述</td>
<td><code>let desc = currentWeather.description</code></td>
</tr>
<tr>
<td align="left"><strong>humidity</strong></td>
<td>Double</td>
<td>相对湿度（0-1）</td>
<td><code>let humidity = Int(currentWeather.humidity * 100)</code></td>
</tr>
<tr>
<td align="left"><strong>dewPoint</strong></td>
<td>Measurement<UnitTemperature></td>
<td>露点温度</td>
<td><code>let dewPoint = Int(currentWeather.dewPoint.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>wind</strong></td>
<td>Wind</td>
<td>风向和风速</td>
<td>见下方详细说明</td>
</tr>
<tr>
<td align="left"><strong>gust</strong></td>
<td>Measurement<UnitSpeed></td>
<td>阵风风速</td>
<td><code>let gustSpeed = Int(currentWeather.gust.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>pressure</strong></td>
<td>Measurement<UnitPressure></td>
<td>气压</td>
<td><code>let pressure = Int(currentWeather.pressure.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>visibility</strong></td>
<td>Measurement<UnitLength></td>
<td>能见度</td>
<td><code>let visibility = Int(currentWeather.visibility.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>uvIndex</strong></td>
<td>UVIndex</td>
<td>紫外线指数</td>
<td><code>let uvIndex = Int(currentWeather.uvIndex.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>uvIndexDescription</strong></td>
<td>String</td>
<td>紫外线指数描述</td>
<td><code>let uvDesc = currentWeather.uvIndexDescription</code></td>
</tr>
<tr>
<td align="left"><strong>cloudCover</strong></td>
<td>Double</td>
<td>云覆盖率（0-1）</td>
<td><code>let cloudCover = Int(currentWeather.cloudCover * 100)</code></td>
</tr>
<tr>
<td align="left"><strong>ceiling</strong></td>
<td>Measurement<UnitLength></td>
<td>云底高度</td>
<td><code>let ceiling = Int(currentWeather.ceiling.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>precipitation</strong></td>
<td>Precipitation</td>
<td>当前降水情况</td>
<td>见下方详细说明</td>
</tr>
<tr>
<td align="left"><strong>precipitationChance</strong></td>
<td>Double</td>
<td>降水概率（0-1）</td>
<td><code>let precipChance = Int(currentWeather.precipitationChance * 100)</code></td>
</tr>
<tr>
<td align="left"><strong>precipitationType</strong></td>
<td>PrecipitationType</td>
<td>降水类型</td>
<td><code>let precipType = currentWeather.precipitationType</code></td>
</tr>
<tr>
<td align="left"><strong>sunrise</strong></td>
<td>Date?</td>
<td>今日日出时间</td>
<td><code>let sunrise = currentWeather.sunrise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td align="left"><strong>sunset</strong></td>
<td>Date?</td>
<td>今日日落时间</td>
<td><code>let sunset = currentWeather.sunset?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td align="left"><strong>moonPhase</strong></td>
<td>MoonPhase</td>
<td>月相</td>
<td><code>let moonPhase = currentWeather.moonPhase</code></td>
</tr>
<tr>
<td align="left"><strong>moonRise</strong></td>
<td>Date?</td>
<td>今日月出时间</td>
<td><code>let moonRise = currentWeather.moonRise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td align="left"><strong>moonSet</strong></td>
<td>Date?</td>
<td>今日月落时间</td>
<td><code>let moonSet = currentWeather.moonSet?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td align="left"><strong>solarZenith</strong></td>
<td>Double</td>
<td>太阳天顶角</td>
<td><code>let solarZenith = currentWeather.solarZenith</code></td>
</tr>
<tr>
<td align="left"><strong>solarElevation</strong></td>
<td>Double</td>
<td>太阳高度角</td>
<td><code>let solarElevation = currentWeather.solarElevation</code></td>
</tr>
<tr>
<td align="left"><strong>apparentTemperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>表观温度</td>
<td><code>let apparentTemp = Int(currentWeather.apparentTemperature.value.rounded())</code></td>
</tr>
<tr>
<td align="left"><strong>airQuality</strong></td>
<td>AirQuality?</td>
<td>空气质量指数</td>
<td>见下方详细说明</td>
</tr>
<tr>
<td align="left"><strong>pollen</strong></td>
<td>Pollen?</td>
<td>花粉指数</td>
<td>见下方详细说明</td>
</tr>
</tbody></table>
<h4 id="5-1-2-完整使用示例"><a href="#5-1-2-完整使用示例" class="headerlink" title="5.1.2 完整使用示例"></a>5.1.2 完整使用示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理并显示当前天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">displayCurrentWeather</span>(<span class="keyword">_</span> <span class="params">currentWeather</span>: <span class="type">CurrentWeather</span>) &#123;</span><br><span class="line">    <span class="comment">// 格式化日期和时间</span></span><br><span class="line">    <span class="keyword">let</span> dateFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">    dateFormatter.dateStyle <span class="operator">=</span> .medium</span><br><span class="line">    dateFormatter.timeStyle <span class="operator">=</span> .short</span><br><span class="line">    <span class="keyword">let</span> formattedDate <span class="operator">=</span> dateFormatter.string(from: currentWeather.date)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 温度相关数据</span></span><br><span class="line">    <span class="keyword">let</span> currentTemp <span class="operator">=</span> <span class="type">Int</span>(currentWeather.temperature.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> feelsLikeTemp <span class="operator">=</span> <span class="type">Int</span>(currentWeather.feelsLikeTemperature.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> dewPointTemp <span class="operator">=</span> <span class="type">Int</span>(currentWeather.dewPoint.value.rounded())</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 天气状况</span></span><br><span class="line">    <span class="keyword">let</span> condition <span class="operator">=</span> currentWeather.condition</span><br><span class="line">    <span class="keyword">let</span> conditionDesc <span class="operator">=</span> currentWeather.description</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 湿度和云覆盖率</span></span><br><span class="line">    <span class="keyword">let</span> humidityPercentage <span class="operator">=</span> <span class="type">Int</span>(currentWeather.humidity <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">let</span> cloudCoverPercentage <span class="operator">=</span> <span class="type">Int</span>(currentWeather.cloudCover <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 风向和风速</span></span><br><span class="line">    <span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Int</span>(currentWeather.wind.speed.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> windDirection <span class="operator">=</span> currentWeather.wind.direction</span><br><span class="line">    <span class="keyword">let</span> windDirectionCompass <span class="operator">=</span> getCompassDirection(from: windDirection)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 紫外线指数</span></span><br><span class="line">    <span class="keyword">let</span> uvIndex <span class="operator">=</span> <span class="type">Int</span>(currentWeather.uvIndex.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> uvIndexDesc <span class="operator">=</span> currentWeather.uvIndexDescription</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 降水信息</span></span><br><span class="line">    <span class="keyword">let</span> precipChance <span class="operator">=</span> <span class="type">Int</span>(currentWeather.precipitationChance <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">let</span> precipType <span class="operator">=</span> currentWeather.precipitationType</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 日出日落时间</span></span><br><span class="line">    <span class="keyword">let</span> sunriseTime <span class="operator">=</span> currentWeather.sunrise<span class="operator">?</span>.formatted(time: .shortened) <span class="operator">??</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    <span class="keyword">let</span> sunsetTime <span class="operator">=</span> currentWeather.sunset<span class="operator">?</span>.formatted(time: .shortened) <span class="operator">??</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 输出所有数据</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== 当前天气 ===&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;时间：<span class="subst">\(formattedDate)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;温度：<span class="subst">\(currentTemp)</span>°C，体感温度：<span class="subst">\(feelsLikeTemp)</span>°C&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;天气状况：<span class="subst">\(conditionDesc)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;湿度：<span class="subst">\(humidityPercentage)</span>%，露点温度：<span class="subst">\(dewPointTemp)</span>°C&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;风向：<span class="subst">\(windDirectionCompass)</span>，风速：<span class="subst">\(windSpeed)</span> km/h&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;云覆盖率：<span class="subst">\(cloudCoverPercentage)</span>%&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;紫外线指数：<span class="subst">\(uvIndex)</span> - <span class="subst">\(uvIndexDesc)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;降水概率：<span class="subst">\(precipChance)</span>%，降水类型：<span class="subst">\(precipType)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;日出：<span class="subst">\(sunriseTime)</span>，日落：<span class="subst">\(sunsetTime)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;================&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将风向角度转换为罗盘方向</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCompassDirection</span>(<span class="params">from</span> <span class="params">degrees</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> directions <span class="operator">=</span> [<span class="string">&quot;北&quot;</span>, <span class="string">&quot;东北&quot;</span>, <span class="string">&quot;东&quot;</span>, <span class="string">&quot;东南&quot;</span>, <span class="string">&quot;南&quot;</span>, <span class="string">&quot;西南&quot;</span>, <span class="string">&quot;西&quot;</span>, <span class="string">&quot;西北&quot;</span>]</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>((degrees <span class="operator">+</span> <span class="number">22.5</span>) <span class="operator">/</span> <span class="number">45.0</span>) <span class="operator">%</span> <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> directions[index]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-3-注意事项"><a href="#5-1-3-注意事项" class="headerlink" title="5.1.3 注意事项"></a>5.1.3 注意事项</h4><ul>
<li>体感温度（<code>feelsLikeTemperature</code>）考虑了温度、湿度、风速等因素，更能反映人体实际感受</li>
<li>紫外线指数（<code>uvIndex</code>）范围为 0-11+，数值越高紫外线越强，建议根据指数采取相应的防护措施</li>
<li>降水类型（<code>precipitationType</code>）可能为 <code>.none</code>（无降水）、<code>.rain</code>（雨）、<code>.snow</code>（雪）、<code>.sleet</code>（雨夹雪）或 <code>.hail</code>（冰雹）</li>
<li>空气质量（<code>airQuality</code>）和花粉指数（<code>pollen</code>）仅在部分地区可用</li>
<li>月相（<code>moonPhase</code>）是一个枚举值，表示当前月相阶段</li>
</ul>
<h3 id="5-2-DayWeather"><a href="#5-2-DayWeather" class="headerlink" title="5.2 DayWeather"></a>5.2 DayWeather</h3><p><code>DayWeather</code> 包含每日天气预报数据，用于显示未来几天的天气趋势。</p>
<h4 id="5-2-1-属性详细说明与使用示例"><a href="#5-2-1-属性详细说明与使用示例" class="headerlink" title="5.2.1 属性详细说明与使用示例"></a>5.2.1 属性详细说明与使用示例</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>date</strong></td>
<td>Date</td>
<td>预报日期</td>
<td><code>let date = dayWeather.date.formatted(date: .abbreviated, time: .omitted)</code></td>
</tr>
<tr>
<td><strong>temperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>当日平均温度</td>
<td><code>let avgTemp = Int(dayWeather.temperature.value.rounded())</code></td>
</tr>
<tr>
<td><strong>highTemperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>最高温度</td>
<td><code>let highTemp = Int(dayWeather.highTemperature.value.rounded())</code></td>
</tr>
<tr>
<td><strong>lowTemperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>最低温度</td>
<td><code>let lowTemp = Int(dayWeather.lowTemperature.value.rounded())</code></td>
</tr>
<tr>
<td><strong>feelsLikeTemperatureHigh</strong></td>
<td>Measurement<UnitTemperature></td>
<td>最高体感温度</td>
<td><code>let feelsLikeHigh = Int(dayWeather.feelsLikeTemperatureHigh.value.rounded())</code></td>
</tr>
<tr>
<td><strong>feelsLikeTemperatureLow</strong></td>
<td>Measurement<UnitTemperature></td>
<td>最低体感温度</td>
<td><code>let feelsLikeLow = Int(dayWeather.feelsLikeTemperatureLow.value.rounded())</code></td>
</tr>
<tr>
<td><strong>condition</strong></td>
<td>WeatherCondition</td>
<td>主要天气状况</td>
<td><code>let condition = dayWeather.condition</code></td>
</tr>
<tr>
<td><strong>description</strong></td>
<td>String</td>
<td>天气状况的文本描述</td>
<td><code>let desc = dayWeather.description</code></td>
</tr>
<tr>
<td><strong>precipitationChance</strong></td>
<td>Double</td>
<td>降水概率（0-1）</td>
<td><code>let precipChance = Int(dayWeather.precipitationChance * 100)</code></td>
</tr>
<tr>
<td><strong>precipitationAmount</strong></td>
<td>Measurement<UnitLength></td>
<td>预计降水量</td>
<td><code>let precipAmount = dayWeather.precipitationAmount.value</code></td>
</tr>
<tr>
<td><strong>precipitationType</strong></td>
<td>PrecipitationType</td>
<td>主要降水类型</td>
<td><code>let precipType = dayWeather.precipitationType</code></td>
</tr>
<tr>
<td><strong>precipitationHours</strong></td>
<td>Int</td>
<td>预计降水小时数</td>
<td><code>let precipHours = dayWeather.precipitationHours</code></td>
</tr>
<tr>
<td><strong>rainAmount</strong></td>
<td>Measurement<UnitLength></td>
<td>预计降雨量</td>
<td><code>let rainAmount = dayWeather.rainAmount.value</code></td>
</tr>
<tr>
<td><strong>snowAmount</strong></td>
<td>Measurement<UnitLength></td>
<td>预计降雪量</td>
<td><code>let snowAmount = dayWeather.snowAmount.value</code></td>
</tr>
<tr>
<td><strong>wind</strong></td>
<td>Wind</td>
<td>主要风向和风速</td>
<td><code>let windSpeed = Int(dayWeather.wind.speed.value.rounded())</code></td>
</tr>
<tr>
<td><strong>windGust</strong></td>
<td>Measurement<UnitSpeed></td>
<td>最大阵风风速</td>
<td><code>let gustSpeed = Int(dayWeather.windGust.value.rounded())</code></td>
</tr>
<tr>
<td><strong>humidity</strong></td>
<td>Double</td>
<td>平均相对湿度（0-1）</td>
<td><code>let humidity = Int(dayWeather.humidity * 100)</code></td>
</tr>
<tr>
<td><strong>pressure</strong></td>
<td>Measurement<UnitPressure></td>
<td>平均气压</td>
<td><code>let pressure = Int(dayWeather.pressure.value.rounded())</code></td>
</tr>
<tr>
<td><strong>visibility</strong></td>
<td>Measurement<UnitLength></td>
<td>平均能见度</td>
<td><code>let visibility = Int(dayWeather.visibility.value.rounded())</code></td>
</tr>
<tr>
<td><strong>uvIndex</strong></td>
<td>UVIndex</td>
<td>最高紫外线指数</td>
<td><code>let uvIndex = Int(dayWeather.uvIndex.value.rounded())</code></td>
</tr>
<tr>
<td><strong>uvIndexDescription</strong></td>
<td>String</td>
<td>紫外线指数的文本描述</td>
<td><code>let uvDesc = dayWeather.uvIndexDescription</code></td>
</tr>
<tr>
<td><strong>cloudCover</strong></td>
<td>Double</td>
<td>平均云覆盖率（0-1）</td>
<td><code>let cloudCover = Int(dayWeather.cloudCover * 100)</code></td>
</tr>
<tr>
<td><strong>sunrise</strong></td>
<td>Date?</td>
<td>日出时间</td>
<td><code>let sunrise = dayWeather.sunrise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>sunset</strong></td>
<td>Date?</td>
<td>日落时间</td>
<td><code>let sunset = dayWeather.sunset?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>moonRise</strong></td>
<td>Date?</td>
<td>月出时间</td>
<td><code>let moonRise = dayWeather.moonRise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>moonSet</strong></td>
<td>Date?</td>
<td>月落时间</td>
<td><code>let moonSet = dayWeather.moonSet?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>moonPhase</strong></td>
<td>MoonPhase</td>
<td>月相</td>
<td><code>let moonPhase = dayWeather.moonPhase</code></td>
</tr>
<tr>
<td><strong>astroSunrise</strong></td>
<td>Date?</td>
<td>天文日出时间</td>
<td><code>let astroSunrise = dayWeather.astroSunrise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>astroSunset</strong></td>
<td>Date?</td>
<td>天文日落时间</td>
<td><code>let astroSunset = dayWeather.astroSunset?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>astroMoonRise</strong></td>
<td>Date?</td>
<td>天文月出时间</td>
<td><code>let astroMoonRise = dayWeather.astroMoonRise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>astroMoonSet</strong></td>
<td>Date?</td>
<td>天文月落时间</td>
<td><code>let astroMoonSet = dayWeather.astroMoonSet?.formatted(time: .shortened)</code></td>
</tr>
</tbody></table>
<h4 id="5-2-2-完整使用示例"><a href="#5-2-2-完整使用示例" class="headerlink" title="5.2.2 完整使用示例"></a>5.2.2 完整使用示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理并显示每日天气预报数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">displayDailyForecast</span>(<span class="keyword">_</span> <span class="params">dailyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== 每日天气预报 ===&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> dayWeather <span class="keyword">in</span> dailyForecast.forecast &#123;</span><br><span class="line">        <span class="comment">// 日期格式化</span></span><br><span class="line">        <span class="keyword">let</span> dateFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        dateFormatter.dateStyle <span class="operator">=</span> .full</span><br><span class="line">        <span class="keyword">let</span> formattedDate <span class="operator">=</span> dateFormatter.string(from: dayWeather.date)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 星期几</span></span><br><span class="line">        <span class="keyword">let</span> weekdayFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        weekdayFormatter.dateFormat <span class="operator">=</span> <span class="string">&quot;EEEE&quot;</span></span><br><span class="line">        <span class="keyword">let</span> weekday <span class="operator">=</span> weekdayFormatter.string(from: dayWeather.date)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 温度数据</span></span><br><span class="line">        <span class="keyword">let</span> highTemp <span class="operator">=</span> <span class="type">Int</span>(dayWeather.highTemperature.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> lowTemp <span class="operator">=</span> <span class="type">Int</span>(dayWeather.lowTemperature.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> feelsLikeHigh <span class="operator">=</span> <span class="type">Int</span>(dayWeather.feelsLikeTemperatureHigh.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> feelsLikeLow <span class="operator">=</span> <span class="type">Int</span>(dayWeather.feelsLikeTemperatureLow.value.rounded())</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 天气状况</span></span><br><span class="line">        <span class="keyword">let</span> condition <span class="operator">=</span> dayWeather.condition</span><br><span class="line">        <span class="keyword">let</span> conditionDesc <span class="operator">=</span> dayWeather.description</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 降水信息</span></span><br><span class="line">        <span class="keyword">let</span> precipChance <span class="operator">=</span> <span class="type">Int</span>(dayWeather.precipitationChance <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">let</span> precipAmount <span class="operator">=</span> dayWeather.precipitationAmount.value</span><br><span class="line">        <span class="keyword">let</span> precipType <span class="operator">=</span> dayWeather.precipitationType</span><br><span class="line">        <span class="keyword">let</span> precipHours <span class="operator">=</span> dayWeather.precipitationHours</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 风向和风速</span></span><br><span class="line">        <span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Int</span>(dayWeather.wind.speed.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> windDirection <span class="operator">=</span> dayWeather.wind.direction</span><br><span class="line">        <span class="keyword">let</span> windDirectionCompass <span class="operator">=</span> getCompassDirection(from: windDirection)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 紫外线指数</span></span><br><span class="line">        <span class="keyword">let</span> uvIndex <span class="operator">=</span> <span class="type">Int</span>(dayWeather.uvIndex.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> uvIndexDesc <span class="operator">=</span> dayWeather.uvIndexDescription</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 日出日落时间</span></span><br><span class="line">        <span class="keyword">let</span> sunriseTime <span class="operator">=</span> dayWeather.sunrise<span class="operator">?</span>.formatted(time: .shortened) <span class="operator">??</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">        <span class="keyword">let</span> sunsetTime <span class="operator">=</span> dayWeather.sunset<span class="operator">?</span>.formatted(time: .shortened) <span class="operator">??</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 输出每日天气预报</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>日期：<span class="subst">\(formattedDate)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;星期：<span class="subst">\(weekday)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;温度：<span class="subst">\(highTemp)</span>°C / <span class="subst">\(lowTemp)</span>°C&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;体感温度：<span class="subst">\(feelsLikeHigh)</span>°C / <span class="subst">\(feelsLikeLow)</span>°C&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;天气状况：<span class="subst">\(conditionDesc)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;降水概率：<span class="subst">\(precipChance)</span>%&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> precipAmount <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;降水量：<span class="subst">\(precipAmount.roundTo(places: <span class="number">1</span>))</span> mm，降水类型：<span class="subst">\(precipType)</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;预计降水小时数：<span class="subst">\(precipHours)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;风向：<span class="subst">\(windDirectionCompass)</span>，风速：<span class="subst">\(windSpeed)</span> km/h&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;紫外线指数：<span class="subst">\(uvIndex)</span> - <span class="subst">\(uvIndexDesc)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;日出：<span class="subst">\(sunriseTime)</span>，日落：<span class="subst">\(sunsetTime)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-------------------&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;===================&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将 Double 四舍五入到指定小数位</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Double</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">roundTo</span>(<span class="params">places</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> divisor <span class="operator">=</span> pow(<span class="number">10.0</span>, <span class="type">Double</span>(places))</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">self</span> <span class="operator">*</span> divisor).rounded() <span class="operator">/</span> divisor</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将风向角度转换为罗盘方向</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCompassDirection</span>(<span class="params">from</span> <span class="params">degrees</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> directions <span class="operator">=</span> [<span class="string">&quot;北&quot;</span>, <span class="string">&quot;东北&quot;</span>, <span class="string">&quot;东&quot;</span>, <span class="string">&quot;东南&quot;</span>, <span class="string">&quot;南&quot;</span>, <span class="string">&quot;西南&quot;</span>, <span class="string">&quot;西&quot;</span>, <span class="string">&quot;西北&quot;</span>]</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>((degrees <span class="operator">+</span> <span class="number">22.5</span>) <span class="operator">/</span> <span class="number">45.0</span>) <span class="operator">%</span> <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> directions[index]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-注意事项"><a href="#5-2-3-注意事项" class="headerlink" title="5.2.3 注意事项"></a>5.2.3 注意事项</h4><ul>
<li><code>DayWeather</code> 默认返回未来7天的天气预报</li>
<li>降水量相关属性（<code>precipitationAmount</code>、<code>rainAmount</code>、<code>snowAmount</code>）的值可能为0，表示无降水</li>
<li><code>precipitationType</code> 可能为 <code>.none</code>，表示当日无降水</li>
<li>天文日出日落时间（<code>astroSunrise</code>、<code>astroSunset</code>）与实际日出日落时间（<code>sunrise</code>、<code>sunset</code>）可能略有不同，前者不考虑大气折射</li>
<li>月相（<code>moonPhase</code>）是一个枚举值，表示当前月相阶段，如新月、上弦月、满月、下弦月等</li>
</ul>
<h3 id="5-3-HourWeather"><a href="#5-3-HourWeather" class="headerlink" title="5.3 HourWeather"></a>5.3 HourWeather</h3><p><code>HourWeather</code> 包含每小时天气预报数据，用于显示未来数小时的天气变化趋势。</p>
<h4 id="5-3-1-属性详细说明与使用示例"><a href="#5-3-1-属性详细说明与使用示例" class="headerlink" title="5.3.1 属性详细说明与使用示例"></a>5.3.1 属性详细说明与使用示例</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>date</strong></td>
<td>Date</td>
<td>预报时间</td>
<td><code>let time = hourWeather.date.formatted(date: .omitted, time: .shortened)</code></td>
</tr>
<tr>
<td><strong>temperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>温度</td>
<td><code>let temp = Int(hourWeather.temperature.value.rounded())</code></td>
</tr>
<tr>
<td><strong>feelsLikeTemperature</strong></td>
<td>Measurement<UnitTemperature></td>
<td>体感温度</td>
<td><code>let feelsLike = Int(hourWeather.feelsLikeTemperature.value.rounded())</code></td>
</tr>
<tr>
<td><strong>condition</strong></td>
<td>WeatherCondition</td>
<td>天气状况</td>
<td><code>let condition = hourWeather.condition</code></td>
</tr>
<tr>
<td><strong>precipitationChance</strong></td>
<td>Double</td>
<td>降水概率（0-1）</td>
<td><code>let precipChance = Int(hourWeather.precipitationChance * 100)</code></td>
</tr>
<tr>
<td><strong>precipitationAmount</strong></td>
<td>Measurement<UnitLength></td>
<td>降水量</td>
<td><code>let precipAmount = hourWeather.precipitationAmount.value</code></td>
</tr>
<tr>
<td><strong>precipitationType</strong></td>
<td>PrecipitationType</td>
<td>降水类型（雨、雪、冰雹等）</td>
<td><code>let precipType = hourWeather.precipitationType</code></td>
</tr>
<tr>
<td><strong>wind</strong></td>
<td>Wind</td>
<td>风向和风速</td>
<td><code>let windSpeed = Int(hourWeather.wind.speed.value.rounded())</code></td>
</tr>
<tr>
<td><strong>humidity</strong></td>
<td>Double</td>
<td>相对湿度（0-1）</td>
<td><code>let humidity = Int(hourWeather.humidity * 100)</code></td>
</tr>
<tr>
<td><strong>pressure</strong></td>
<td>Measurement<UnitPressure></td>
<td>气压</td>
<td><code>let pressure = Int(hourWeather.pressure.value.rounded())</code></td>
</tr>
<tr>
<td><strong>visibility</strong></td>
<td>Measurement<UnitLength></td>
<td>能见度</td>
<td><code>let visibility = Int(hourWeather.visibility.value.rounded())</code></td>
</tr>
<tr>
<td><strong>uvIndex</strong></td>
<td>UVIndex</td>
<td>紫外线指数</td>
<td><code>let uvIndex = Int(hourWeather.uvIndex.value.rounded())</code></td>
</tr>
<tr>
<td><strong>cloudCover</strong></td>
<td>Double</td>
<td>云覆盖率（0-1）</td>
<td><code>let cloudCover = Int(hourWeather.cloudCover * 100)</code></td>
</tr>
<tr>
<td><strong>sunrise</strong></td>
<td>Date?</td>
<td>日出时间（仅当日小时）</td>
<td><code>let sunrise = hourWeather.sunrise?.formatted(time: .shortened)</code></td>
</tr>
<tr>
<td><strong>sunset</strong></td>
<td>Date?</td>
<td>日落时间（仅当日小时）</td>
<td><code>let sunset = hourWeather.sunset?.formatted(time: .shortened)</code></td>
</tr>
</tbody></table>
<h4 id="5-3-2-完整使用示例"><a href="#5-3-2-完整使用示例" class="headerlink" title="5.3.2 完整使用示例"></a>5.3.2 完整使用示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理并显示每小时天气预报数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">displayHourlyForecast</span>(<span class="keyword">_</span> <span class="params">hourlyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== 每小时天气预报 ===&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只显示未来24小时的预报</span></span><br><span class="line">    <span class="keyword">let</span> next24Hours <span class="operator">=</span> hourlyForecast.forecast.prefix(<span class="number">24</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> hourWeather <span class="keyword">in</span> next24Hours &#123;</span><br><span class="line">        <span class="comment">// 时间格式化</span></span><br><span class="line">        <span class="keyword">let</span> timeFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        timeFormatter.dateStyle <span class="operator">=</span> .abbreviated</span><br><span class="line">        timeFormatter.timeStyle <span class="operator">=</span> .short</span><br><span class="line">        <span class="keyword">let</span> formattedTime <span class="operator">=</span> timeFormatter.string(from: hourWeather.date)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 小时</span></span><br><span class="line">        <span class="keyword">let</span> hourFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        hourFormatter.dateFormat <span class="operator">=</span> <span class="string">&quot;HH:mm&quot;</span></span><br><span class="line">        <span class="keyword">let</span> hour <span class="operator">=</span> hourFormatter.string(from: hourWeather.date)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 温度数据</span></span><br><span class="line">        <span class="keyword">let</span> temp <span class="operator">=</span> <span class="type">Int</span>(hourWeather.temperature.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> feelsLike <span class="operator">=</span> <span class="type">Int</span>(hourWeather.feelsLikeTemperature.value.rounded())</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 天气状况</span></span><br><span class="line">        <span class="keyword">let</span> condition <span class="operator">=</span> hourWeather.condition</span><br><span class="line">        <span class="keyword">let</span> conditionDesc <span class="operator">=</span> hourWeather.description</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 降水信息</span></span><br><span class="line">        <span class="keyword">let</span> precipChance <span class="operator">=</span> <span class="type">Int</span>(hourWeather.precipitationChance <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">let</span> precipAmount <span class="operator">=</span> hourWeather.precipitationAmount.value</span><br><span class="line">        <span class="keyword">let</span> precipType <span class="operator">=</span> hourWeather.precipitationType</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 风向和风速</span></span><br><span class="line">        <span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Int</span>(hourWeather.wind.speed.value.rounded())</span><br><span class="line">        <span class="keyword">let</span> windDirection <span class="operator">=</span> hourWeather.wind.direction</span><br><span class="line">        <span class="keyword">let</span> windDirectionCompass <span class="operator">=</span> getCompassDirection(from: windDirection)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 湿度和云覆盖率</span></span><br><span class="line">        <span class="keyword">let</span> humidity <span class="operator">=</span> <span class="type">Int</span>(hourWeather.humidity <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">let</span> cloudCover <span class="operator">=</span> <span class="type">Int</span>(hourWeather.cloudCover <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 输出每小时天气预报</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>时间：<span class="subst">\(formattedTime)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;小时：<span class="subst">\(hour)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;温度：<span class="subst">\(temp)</span>°C，体感温度：<span class="subst">\(feelsLike)</span>°C&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;天气状况：<span class="subst">\(conditionDesc)</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;降水概率：<span class="subst">\(precipChance)</span>%&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> precipAmount <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;降水量：<span class="subst">\(precipAmount.roundTo(places: <span class="number">1</span>))</span> mm，降水类型：<span class="subst">\(precipType)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;风向：<span class="subst">\(windDirectionCompass)</span>，风速：<span class="subst">\(windSpeed)</span> km/h&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;湿度：<span class="subst">\(humidity)</span>%，云覆盖率：<span class="subst">\(cloudCover)</span>%&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-------------------&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;===================&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将 Double 四舍五入到指定小数位</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Double</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">roundTo</span>(<span class="params">places</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> divisor <span class="operator">=</span> pow(<span class="number">10.0</span>, <span class="type">Double</span>(places))</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">self</span> <span class="operator">*</span> divisor).rounded() <span class="operator">/</span> divisor</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将风向角度转换为罗盘方向</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCompassDirection</span>(<span class="params">from</span> <span class="params">degrees</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> directions <span class="operator">=</span> [<span class="string">&quot;北&quot;</span>, <span class="string">&quot;东北&quot;</span>, <span class="string">&quot;东&quot;</span>, <span class="string">&quot;东南&quot;</span>, <span class="string">&quot;南&quot;</span>, <span class="string">&quot;西南&quot;</span>, <span class="string">&quot;西&quot;</span>, <span class="string">&quot;西北&quot;</span>]</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>((degrees <span class="operator">+</span> <span class="number">22.5</span>) <span class="operator">/</span> <span class="number">45.0</span>) <span class="operator">%</span> <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> directions[index]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-3-注意事项"><a href="#5-3-3-注意事项" class="headerlink" title="5.3.3 注意事项"></a>5.3.3 注意事项</h4><ul>
<li><code>HourWeather</code> 默认返回未来12小时的天气预报</li>
<li>每小时预报的时间间隔为1小时</li>
<li>紫外线指数（<code>uvIndex</code>）在夜间可能为0或无值</li>
<li>日出和日落时间（<code>sunrise</code>、<code>sunset</code>）仅在包含日出或日落的特定小时有值</li>
<li>降水量（<code>precipitationAmount</code>）的值可能为0，表示该小时无降水</li>
</ul>
<h3 id="5-4-MinuteWeather"><a href="#5-4-MinuteWeather" class="headerlink" title="5.4 MinuteWeather"></a>5.4 MinuteWeather</h3><p><code>MinuteWeather</code> 包含未来1小时内的逐分钟降水预报数据，仅在部分地区可用。</p>
<h4 id="5-4-1-属性详细说明与使用示例"><a href="#5-4-1-属性详细说明与使用示例" class="headerlink" title="5.4.1 属性详细说明与使用示例"></a>5.4.1 属性详细说明与使用示例</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>date</strong></td>
<td>Date</td>
<td>预报时间点</td>
<td><code>let time = minuteWeather.date.formatted(date: .omitted, time: .seconded)</code></td>
</tr>
<tr>
<td><strong>precipitationIntensity</strong></td>
<td>Measurement<UnitPrecipitationRate></td>
<td>降水强度</td>
<td><code>let intensity = minuteWeather.precipitationIntensity.value</code></td>
</tr>
<tr>
<td><strong>precipitationChance</strong></td>
<td>Double</td>
<td>降水概率（0-1）</td>
<td><code>let precipChance = Int(minuteWeather.precipitationChance * 100)</code></td>
</tr>
<tr>
<td><strong>precipitationType</strong></td>
<td>PrecipitationType</td>
<td>降水类型（雨、雪、冰雹等）</td>
<td><code>let precipType = minuteWeather.precipitationType</code></td>
</tr>
</tbody></table>
<h4 id="5-4-2-完整使用示例"><a href="#5-4-2-完整使用示例" class="headerlink" title="5.4.2 完整使用示例"></a>5.4.2 完整使用示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理并显示分钟级降水预报数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">displayMinuteForecast</span>(<span class="keyword">_</span> <span class="params">minuteForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">MinuteWeather</span>&gt;) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== 分钟级降水预报 ===&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查是否有降水预报</span></span><br><span class="line">    <span class="keyword">let</span> hasPrecipitation <span class="operator">=</span> minuteForecast.forecast.contains &#123; <span class="variable">$0</span>.precipitationChance <span class="operator">&gt;</span> <span class="number">0</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="operator">!</span>hasPrecipitation &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未来1小时内无降水预报&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;未来1小时内降水预报：&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (index, minuteWeather) <span class="keyword">in</span> minuteForecast.forecast.enumerated() &#123;</span><br><span class="line">        <span class="comment">// 时间格式化</span></span><br><span class="line">        <span class="keyword">let</span> timeFormatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        timeFormatter.timeStyle <span class="operator">=</span> .short</span><br><span class="line">        <span class="keyword">let</span> formattedTime <span class="operator">=</span> timeFormatter.string(from: minuteWeather.date)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 降水信息</span></span><br><span class="line">        <span class="keyword">let</span> precipChance <span class="operator">=</span> <span class="type">Int</span>(minuteWeather.precipitationChance <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">let</span> intensity <span class="operator">=</span> minuteWeather.precipitationIntensity.value</span><br><span class="line">        <span class="keyword">let</span> precipType <span class="operator">=</span> minuteWeather.precipitationType</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 只显示有降水概率的时间段</span></span><br><span class="line">        <span class="keyword">if</span> precipChance <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            <span class="comment">// 降水强度描述</span></span><br><span class="line">            <span class="keyword">let</span> intensityDesc <span class="operator">=</span> getPrecipitationIntensityDescription(from: intensity)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>时间：<span class="subst">\(formattedTime)</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;分钟：<span class="subst">\(index <span class="operator">+</span> <span class="number">1</span>)</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;降水概率：<span class="subst">\(precipChance)</span>%&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;降水强度：<span class="subst">\(intensity.roundTo(places: <span class="number">2</span>))</span> mm/h，<span class="subst">\(intensityDesc)</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;降水类型：<span class="subst">\(precipType)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;===================&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：根据降水强度返回描述</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPrecipitationIntensityDescription</span>(<span class="params">from</span> <span class="params">intensity</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">0.1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;微量&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">2.5</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;小雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">7.6</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;中雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">50</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;大雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;暴雨&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数：将 Double 四舍五入到指定小数位</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Double</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">roundTo</span>(<span class="params">places</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> divisor <span class="operator">=</span> pow(<span class="number">10.0</span>, <span class="type">Double</span>(places))</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">self</span> <span class="operator">*</span> divisor).rounded() <span class="operator">/</span> divisor</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-4-3-注意事项"><a href="#5-4-3-注意事项" class="headerlink" title="5.4.3 注意事项"></a>5.4.3 注意事项</h4><ul>
<li><code>MinuteWeather</code> 仅在部分地区可用，在不支持的地区获取时会返回空数据或抛出错误</li>
<li>默认返回未来60分钟的逐分钟预报</li>
<li>主要用于显示近期降水趋势，帮助用户决定是否需要携带雨具</li>
<li>降水强度单位为毫米&#x2F;小时（mm&#x2F;h）或英寸&#x2F;小时（in&#x2F;h），取决于地区设置</li>
</ul>
<h3 id="5-5-WeatherAttribution"><a href="#5-5-WeatherAttribution" class="headerlink" title="5.5 WeatherAttribution"></a>5.5 WeatherAttribution</h3><p><code>WeatherAttribution</code> 包含天气数据的来源归因信息，用于显示版权信息。根据 Apple 的要求，使用 WeatherKit 数据的应用必须显示这些归因信息。</p>
<h4 id="5-5-1-属性详细说明与使用示例"><a href="#5-5-1-属性详细说明与使用示例" class="headerlink" title="5.5.1 属性详细说明与使用示例"></a>5.5.1 属性详细说明与使用示例</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
<th>使用示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>logoLightURL</strong></td>
<td>URL?</td>
<td>亮色背景下的归因Logo URL</td>
<td><code>let lightLogoURL = attribution.logoLightURL</code></td>
</tr>
<tr>
<td><strong>logoDarkURL</strong></td>
<td>URL?</td>
<td>暗色背景下的归因Logo URL</td>
<td><code>let darkLogoURL = attribution.logoDarkURL</code></td>
</tr>
<tr>
<td><strong>legalText</strong></td>
<td>String</td>
<td>法律声明文本</td>
<td><code>let legalText = attribution.legalText</code></td>
</tr>
<tr>
<td><strong>privacyPolicyURL</strong></td>
<td>URL?</td>
<td>隐私政策URL</td>
<td><code>let privacyURL = attribution.privacyPolicyURL</code></td>
</tr>
<tr>
<td><strong>termsOfServiceURL</strong></td>
<td>URL?</td>
<td>服务条款URL</td>
<td><code>let termsURL = attribution.termsOfServiceURL</code></td>
</tr>
</tbody></table>
<h4 id="5-5-2-完整使用示例"><a href="#5-5-2-完整使用示例" class="headerlink" title="5.5.2 完整使用示例"></a>5.5.2 完整使用示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 显示天气数据归因信息</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">showWeatherAttribution</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.attribution</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 显示法律声明</span></span><br><span class="line">            <span class="keyword">let</span> attributionLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">            attributionLabel.text <span class="operator">=</span> attribution.legalText</span><br><span class="line">            attributionLabel.font <span class="operator">=</span> .systemFont(ofSize: <span class="number">12</span>)</span><br><span class="line">            attributionLabel.textColor <span class="operator">=</span> .secondaryLabel</span><br><span class="line">            attributionLabel.textAlignment <span class="operator">=</span> .center</span><br><span class="line">            attributionLabel.numberOfLines <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">            view.addSubview(attributionLabel)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 约束设置</span></span><br><span class="line">            attributionLabel.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">            <span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">                attributionLabel.bottomAnchor.constraint(equalTo: view.safeAreaLayoutGuide.bottomAnchor, constant: <span class="operator">-</span><span class="number">20</span>),</span><br><span class="line">                attributionLabel.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: <span class="number">20</span>),</span><br><span class="line">                attributionLabel.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: <span class="operator">-</span><span class="number">20</span>)</span><br><span class="line">            ])</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 显示归因Logo（根据当前外观模式选择合适的Logo）</span></span><br><span class="line">            <span class="keyword">let</span> isDarkMode <span class="operator">=</span> traitCollection.userInterfaceStyle <span class="operator">==</span> .dark</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> logoURL <span class="operator">=</span> isDarkMode <span class="operator">?</span> attribution.logoDarkURL : attribution.logoLightURL &#123;</span><br><span class="line">                <span class="keyword">let</span> logoImageView <span class="operator">=</span> <span class="type">UIImageView</span>()</span><br><span class="line">                logoImageView.contentMode <span class="operator">=</span> .scaleAspectFit</span><br><span class="line">                logoImageView.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">                view.addSubview(logoImageView)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 从URL加载图片</span></span><br><span class="line">                <span class="type">URLSession</span>.shared.dataTask(with: logoURL) &#123; data, response, error <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> data <span class="operator">=</span> data, <span class="keyword">let</span> image <span class="operator">=</span> <span class="type">UIImage</span>(data: data) &#123;</span><br><span class="line">                        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                            logoImageView.image <span class="operator">=</span> image</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;.resume()</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 约束设置</span></span><br><span class="line">                <span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">                    logoImageView.topAnchor.constraint(equalTo: attributionLabel.bottomAnchor, constant: <span class="number">10</span>),</span><br><span class="line">                    logoImageView.centerXAnchor.constraint(equalTo: view.centerXAnchor),</span><br><span class="line">                    logoImageView.widthAnchor.constraint(equalToConstant: <span class="number">100</span>),</span><br><span class="line">                    logoImageView.heightAnchor.constraint(equalToConstant: <span class="number">30</span>)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加隐私政策和服务条款链接</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> privacyURL <span class="operator">=</span> attribution.privacyPolicyURL, <span class="keyword">let</span> termsURL <span class="operator">=</span> attribution.termsOfServiceURL &#123;</span><br><span class="line">                <span class="keyword">let</span> linksStackView <span class="operator">=</span> <span class="type">UIStackView</span>()</span><br><span class="line">                linksStackView.axis <span class="operator">=</span> .horizontal</span><br><span class="line">                linksStackView.spacing <span class="operator">=</span> <span class="number">20</span></span><br><span class="line">                linksStackView.alignment <span class="operator">=</span> .center</span><br><span class="line">                linksStackView.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">                view.addSubview(linksStackView)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 隐私政策按钮</span></span><br><span class="line">                <span class="keyword">let</span> privacyButton <span class="operator">=</span> <span class="type">UIButton</span>(type: .system)</span><br><span class="line">                privacyButton.setTitle(<span class="string">&quot;隐私政策&quot;</span>, for: .normal)</span><br><span class="line">                privacyButton.titleLabel<span class="operator">?</span>.font <span class="operator">=</span> .systemFont(ofSize: <span class="number">12</span>)</span><br><span class="line">                privacyButton.addTarget(<span class="keyword">self</span>, action: <span class="keyword">#selector</span>(openPrivacyPolicy), for: .touchUpInside)</span><br><span class="line">                linksStackView.addArrangedSubview(privacyButton)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 服务条款按钮</span></span><br><span class="line">                <span class="keyword">let</span> termsButton <span class="operator">=</span> <span class="type">UIButton</span>(type: .system)</span><br><span class="line">                termsButton.setTitle(<span class="string">&quot;服务条款&quot;</span>, for: .normal)</span><br><span class="line">                termsButton.titleLabel<span class="operator">?</span>.font <span class="operator">=</span> .systemFont(ofSize: <span class="number">12</span>)</span><br><span class="line">                termsButton.addTarget(<span class="keyword">self</span>, action: <span class="keyword">#selector</span>(openTermsOfService), for: .touchUpInside)</span><br><span class="line">                linksStackView.addArrangedSubview(termsButton)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 约束设置</span></span><br><span class="line">                <span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">                    linksStackView.topAnchor.constraint(equalTo: attributionLabel.topAnchor, constant: <span class="operator">-</span><span class="number">20</span>),</span><br><span class="line">                    linksStackView.centerXAnchor.constraint(equalTo: view.centerXAnchor)</span><br><span class="line">                ])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取归因信息失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开隐私政策</span></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">openPrivacyPolicy</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.attribution</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> privacyURL <span class="operator">=</span> attribution.privacyPolicyURL &#123;</span><br><span class="line">                <span class="type">UIApplication</span>.shared.open(privacyURL)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;打开隐私政策失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开服务条款</span></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">openTermsOfService</span>() &#123;</span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> attribution <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">WeatherService</span>.shared.attribution</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> termsURL <span class="operator">=</span> attribution.termsOfServiceURL &#123;</span><br><span class="line">                <span class="type">UIApplication</span>.shared.open(termsURL)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;打开服务条款失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-辅助数据类型"><a href="#6-辅助数据类型" class="headerlink" title="6. 辅助数据类型"></a>6. 辅助数据类型</h2><p>WeatherKit 中包含一些辅助数据类型，用于表示天气数据的特定方面。以下是这些辅助数据类型的详细说明和使用方法：</p>
<h3 id="6-1-Wind"><a href="#6-1-Wind" class="headerlink" title="6.1 Wind"></a>6.1 Wind</h3><p><code>Wind</code> 表示风向和风速信息。</p>
<h4 id="6-1-1-属性说明"><a href="#6-1-1-属性说明" class="headerlink" title="6.1.1 属性说明"></a>6.1.1 属性说明</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>speed</strong></td>
<td>Measurement<UnitSpeed></td>
<td>风速</td>
</tr>
<tr>
<td><strong>direction</strong></td>
<td>Double</td>
<td>风向（以度数表示，0°表示北风，顺时针递增）</td>
</tr>
</tbody></table>
<h4 id="6-1-2-使用示例"><a href="#6-1-2-使用示例" class="headerlink" title="6.1.2 使用示例"></a>6.1.2 使用示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理风向和风速数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatWindData</span>(<span class="keyword">_</span> <span class="params">wind</span>: <span class="type">Wind</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Int</span>(wind.speed.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> windDirection <span class="operator">=</span> wind.direction</span><br><span class="line">    <span class="keyword">let</span> windDirectionCompass <span class="operator">=</span> getCompassDirection(from: windDirection)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(windSpeed)</span> km/h，<span class="subst">\(windDirectionCompass)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将风向角度转换为罗盘方向</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCompassDirection</span>(<span class="params">from</span> <span class="params">degrees</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> directions <span class="operator">=</span> [<span class="string">&quot;北&quot;</span>, <span class="string">&quot;东北&quot;</span>, <span class="string">&quot;东&quot;</span>, <span class="string">&quot;东南&quot;</span>, <span class="string">&quot;南&quot;</span>, <span class="string">&quot;西南&quot;</span>, <span class="string">&quot;西&quot;</span>, <span class="string">&quot;西北&quot;</span>]</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>((degrees <span class="operator">+</span> <span class="number">22.5</span>) <span class="operator">/</span> <span class="number">45.0</span>) <span class="operator">%</span> <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> directions[index]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">15</span>, unit: <span class="type">UnitSpeed</span>.kilometersPerHour)</span><br><span class="line"><span class="keyword">let</span> windData <span class="operator">=</span> <span class="type">Wind</span>(speed: windSpeed, direction: <span class="number">90</span>) <span class="comment">// 东风，15 km/h</span></span><br><span class="line"><span class="keyword">let</span> formattedWind <span class="operator">=</span> formatWindData(windData)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;风向风速：<span class="subst">\(formattedWind)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-2-Precipitation"><a href="#6-2-Precipitation" class="headerlink" title="6.2 Precipitation"></a>6.2 Precipitation</h3><p><code>Precipitation</code> 表示降水信息。</p>
<h4 id="6-2-1-属性说明"><a href="#6-2-1-属性说明" class="headerlink" title="6.2.1 属性说明"></a>6.2.1 属性说明</h4><table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>intensity</strong></td>
<td>Measurement<UnitPrecipitationRate></td>
<td>降水强度</td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>PrecipitationType</td>
<td>降水类型</td>
</tr>
</tbody></table>
<h4 id="6-2-2-使用示例"><a href="#6-2-2-使用示例" class="headerlink" title="6.2.2 使用示例"></a>6.2.2 使用示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理降水数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatPrecipitationData</span>(<span class="keyword">_</span> <span class="params">precipitation</span>: <span class="type">Precipitation</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> intensity <span class="operator">=</span> precipitation.intensity.value</span><br><span class="line">    <span class="keyword">let</span> intensityDesc <span class="operator">=</span> getPrecipitationIntensityDescription(from: intensity)</span><br><span class="line">    <span class="keyword">let</span> type <span class="operator">=</span> precipitation.type</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(intensityDesc)</span>，<span class="subst">\(type)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据降水强度返回描述</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPrecipitationIntensityDescription</span>(<span class="params">from</span> <span class="params">intensity</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">0.1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;微量&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">2.5</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;小雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">7.6</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;中雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> intensity <span class="operator">&lt;</span> <span class="number">50</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;大雨&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;暴雨&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> intensity <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">3.5</span>, unit: <span class="type">UnitPrecipitationRate</span>.millimetersPerHour)</span><br><span class="line"><span class="keyword">let</span> precipData <span class="operator">=</span> <span class="type">Precipitation</span>(intensity: intensity, type: .rain)</span><br><span class="line"><span class="keyword">let</span> formattedPrecip <span class="operator">=</span> formatPrecipitationData(precipData)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;降水情况：<span class="subst">\(formattedPrecip)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-3-PrecipitationType"><a href="#6-3-PrecipitationType" class="headerlink" title="6.3 PrecipitationType"></a>6.3 PrecipitationType</h3><p><code>PrecipitationType</code> 是一个枚举，表示降水类型。</p>
<h4 id="6-3-1-枚举值说明"><a href="#6-3-1-枚举值说明" class="headerlink" title="6.3.1 枚举值说明"></a>6.3.1 枚举值说明</h4><table>
<thead>
<tr>
<th>枚举值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>none</strong></td>
<td>无降水</td>
</tr>
<tr>
<td><strong>rain</strong></td>
<td>雨</td>
</tr>
<tr>
<td><strong>snow</strong></td>
<td>雪</td>
</tr>
<tr>
<td><strong>sleet</strong></td>
<td>雨夹雪</td>
</tr>
<tr>
<td><strong>hail</strong></td>
<td>冰雹</td>
</tr>
</tbody></table>
<h4 id="6-3-2-使用示例"><a href="#6-3-2-使用示例" class="headerlink" title="6.3.2 使用示例"></a>6.3.2 使用示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取降水类型的中文描述</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPrecipitationTypeDescription</span>(<span class="keyword">_</span> <span class="params">type</span>: <span class="type">PrecipitationType</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> type &#123;</span><br><span class="line">    <span class="keyword">case</span> .none:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;无降水&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .rain:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;雨&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .snow:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;雪&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .sleet:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;雨夹雪&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .hail:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;冰雹&quot;</span></span><br><span class="line">    <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-UVIndex"><a href="#6-4-UVIndex" class="headerlink" title="6.4 UVIndex"></a>6.4 UVIndex</h3><p><code>UVIndex</code> 表示紫外线指数。</p>
<h4 id="6-4-1-使用示例"><a href="#6-4-1-使用示例" class="headerlink" title="6.4.1 使用示例"></a>6.4.1 使用示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理紫外线指数数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatUVIndex</span>(<span class="keyword">_</span> <span class="params">uvIndex</span>: <span class="type">UVIndex</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>(uvIndex.value.rounded())</span><br><span class="line">    <span class="keyword">let</span> description <span class="operator">=</span> getUVIndexDescription(from: index)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(index)</span> - <span class="subst">\(description)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取紫外线指数的中文描述</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getUVIndexDescription</span>(<span class="params">from</span> <span class="params">index</span>: <span class="type">Int</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> index &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span><span class="operator">...</span><span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;低&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span><span class="operator">...</span><span class="number">5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;中等&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span><span class="operator">...</span><span class="number">7</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;高&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span><span class="operator">...</span><span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;很高&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">11</span><span class="operator">...</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;极高&quot;</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> uvIndex <span class="operator">=</span> <span class="type">UVIndex</span>(value: <span class="number">6.5</span>)</span><br><span class="line"><span class="keyword">let</span> formattedUVIndex <span class="operator">=</span> formatUVIndex(uvIndex)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;紫外线指数：<span class="subst">\(formattedUVIndex)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-5-MoonPhase"><a href="#6-5-MoonPhase" class="headerlink" title="6.5 MoonPhase"></a>6.5 MoonPhase</h3><p><code>MoonPhase</code> 是一个枚举，表示月相阶段。</p>
<h4 id="6-5-1-枚举值说明"><a href="#6-5-1-枚举值说明" class="headerlink" title="6.5.1 枚举值说明"></a>6.5.1 枚举值说明</h4><table>
<thead>
<tr>
<th>枚举值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>new</strong></td>
<td>新月</td>
</tr>
<tr>
<td><strong>waxingCrescent</strong></td>
<td>娥眉月（新月到上弦月）</td>
</tr>
<tr>
<td><strong>firstQuarter</strong></td>
<td>上弦月</td>
</tr>
<tr>
<td><strong>waxingGibbous</strong></td>
<td>盈凸月（上弦月到满月）</td>
</tr>
<tr>
<td><strong>full</strong></td>
<td>满月</td>
</tr>
<tr>
<td><strong>waningGibbous</strong></td>
<td>亏凸月（满月到下弦月）</td>
</tr>
<tr>
<td><strong>thirdQuarter</strong></td>
<td>下弦月</td>
</tr>
<tr>
<td><strong>waningCrescent</strong></td>
<td>残月（下弦月到新月）</td>
</tr>
</tbody></table>
<h4 id="6-5-2-使用示例"><a href="#6-5-2-使用示例" class="headerlink" title="6.5.2 使用示例"></a>6.5.2 使用示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取月相的中文描述</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getMoonPhaseDescription</span>(<span class="keyword">_</span> <span class="params">phase</span>: <span class="type">MoonPhase</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> phase &#123;</span><br><span class="line">    <span class="keyword">case</span> .new:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;新月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .waxingCrescent:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;娥眉月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .firstQuarter:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;上弦月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .waxingGibbous:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;盈凸月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .full:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;满月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .waningGibbous:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;亏凸月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .thirdQuarter:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;下弦月&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .waningCrescent:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;残月&quot;</span></span><br><span class="line">    <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> moonPhase <span class="operator">=</span> <span class="type">MoonPhase</span>.full</span><br><span class="line"><span class="keyword">let</span> phaseDesc <span class="operator">=</span> getMoonPhaseDescription(moonPhase)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;月相：<span class="subst">\(phaseDesc)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="7-错误处理"><a href="#7-错误处理" class="headerlink" title="7. 错误处理"></a>7. 错误处理</h2><p>WeatherKit 可能抛出以下类型的错误，了解这些错误类型可以帮助您更好地处理异常情况：</p>
<h3 id="7-1-完整的-WeatherError-类型"><a href="#7-1-完整的-WeatherError-类型" class="headerlink" title="7.1 完整的 WeatherError 类型"></a>7.1 完整的 WeatherError 类型</h3><table>
<thead>
<tr>
<th>错误类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>locationAccessDenied</strong></td>
<td>位置访问被拒绝，用户未授权应用访问位置</td>
</tr>
<tr>
<td><strong>locationUnknown</strong></td>
<td>无法获取设备位置，可能是因为设备处于飞行模式或信号较弱</td>
</tr>
<tr>
<td><strong>networkError</strong></td>
<td>网络错误，无法连接到天气服务</td>
</tr>
<tr>
<td><strong>serviceUnavailable</strong></td>
<td>天气服务暂时不可用</td>
</tr>
<tr>
<td><strong>invalidCoordinates</strong></td>
<td>提供的坐标无效或不在支持的区域内</td>
</tr>
<tr>
<td><strong>weatherDataUnavailable</strong></td>
<td>无法获取请求的天气数据，可能是因为该地区不支持某些数据类型</td>
</tr>
<tr>
<td><strong>historicalDataUnavailable</strong></td>
<td>无法获取请求的历史天气数据</td>
</tr>
<tr>
<td><strong>searchResultsUnavailable</strong></td>
<td>无法获取搜索结果</td>
</tr>
<tr>
<td><strong>attributionUnavailable</strong></td>
<td>无法获取天气数据归因信息</td>
</tr>
<tr>
<td><strong>unsupportedFeature</strong></td>
<td>请求的功能在当前设备或 iOS 版本上不受支持</td>
</tr>
<tr>
<td><strong>unknown</strong></td>
<td>发生了未知错误</td>
</tr>
</tbody></table>
<h3 id="6-2-详细的错误处理示例"><a href="#6-2-详细的错误处理示例" class="headerlink" title="6.2 详细的错误处理示例"></a>6.2 详细的错误处理示例</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">        for: location,</span><br><span class="line">        including: .current, .daily, .hourly</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// 使用天气数据</span></span><br><span class="line">    updateUI(current: currentWeather, daily: dailyForecast, hourly: hourlyForecast, location: location)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.locationAccessDenied &#123;</span><br><span class="line">    showError(<span class="string">&quot;位置访问被拒绝，请在设置中允许应用访问您的位置&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.locationUnknown &#123;</span><br><span class="line">    showError(<span class="string">&quot;无法获取您的位置，请检查位置服务是否开启&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.networkError &#123;</span><br><span class="line">    showError(<span class="string">&quot;网络连接失败，请检查您的网络设置&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.serviceUnavailable &#123;</span><br><span class="line">    showError(<span class="string">&quot;天气服务暂时不可用，请稍后再试&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.invalidCoordinates &#123;</span><br><span class="line">    showError(<span class="string">&quot;提供的位置无效，请尝试其他位置&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.weatherDataUnavailable &#123;</span><br><span class="line">    showError(<span class="string">&quot;无法获取该地区的天气数据&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.unsupportedFeature &#123;</span><br><span class="line">    showError(<span class="string">&quot;当前设备不支持该功能&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-处理历史天气数据错误"><a href="#6-3-处理历史天气数据错误" class="headerlink" title="6.3 处理历史天气数据错误"></a>6.3 处理历史天气数据错误</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> historicalWeather <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.historicalWeather(</span><br><span class="line">        for: location,</span><br><span class="line">        including: .daily,</span><br><span class="line">        from: startDate,</span><br><span class="line">        to: endDate</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// 使用历史天气数据</span></span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.historicalDataUnavailable &#123;</span><br><span class="line">    showError(<span class="string">&quot;无法获取该时间段的历史天气数据&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    showError(<span class="string">&quot;获取历史天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-处理搜索错误"><a href="#6-4-处理搜索错误" class="headerlink" title="6.4 处理搜索错误"></a>6.4 处理搜索错误</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> searchResults <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.search(for: <span class="string">&quot;Beijing&quot;</span>)</span><br><span class="line">    <span class="comment">// 使用搜索结果</span></span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">WeatherError</span>.searchResultsUnavailable &#123;</span><br><span class="line">    showError(<span class="string">&quot;无法获取搜索结果，请检查网络连接&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    showError(<span class="string">&quot;搜索失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-数据单位转换"><a href="#7-数据单位转换" class="headerlink" title="7. 数据单位转换"></a>7. 数据单位转换</h2><p>WeatherKit 返回的天气数据使用 <code>Measurement</code> 类型，这使得单位转换变得非常简单。以下是一些常见的单位转换示例：</p>
<h3 id="7-1-温度单位转换"><a href="#7-1-温度单位转换" class="headerlink" title="7.1 温度单位转换"></a>7.1 温度单位转换</h3><p>温度单位转换是 WeatherKit 应用中最常见的单位转换需求。以下是完整的温度单位转换规则和示例：</p>
<h4 id="7-1-1-常用温度单位"><a href="#7-1-1-常用温度单位" class="headerlink" title="7.1.1 常用温度单位"></a>7.1.1 常用温度单位</h4><ul>
<li><strong>摄氏度（°C）</strong>：国际标准单位，符号为 °C</li>
<li><strong>华氏度（°F）</strong>：主要在美国使用，符号为 °F</li>
<li><strong>开尔文（K）</strong>：热力学温度单位，符号为 K</li>
</ul>
<h4 id="7-1-2-转换公式"><a href="#7-1-2-转换公式" class="headerlink" title="7.1.2 转换公式"></a>7.1.2 转换公式</h4><ul>
<li>摄氏度转华氏度：°F &#x3D; °C × 9&#x2F;5 + 32</li>
<li>华氏度转摄氏度：°C &#x3D; (°F - 32) × 5&#x2F;9</li>
<li>摄氏度转开尔文：K &#x3D; °C + 273.15</li>
<li>开尔文转摄氏度：°C &#x3D; K - 273.15</li>
</ul>
<h4 id="7-1-3-Swift-代码示例"><a href="#7-1-3-Swift-代码示例" class="headerlink" title="7.1.3 Swift 代码示例"></a>7.1.3 Swift 代码示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将摄氏度转换为华氏度</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertCelsiusToFahrenheit</span>(<span class="params">temperature</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> temperature.converted(to: .fahrenheit)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将华氏度转换为摄氏度</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertFahrenheitToCelsius</span>(<span class="params">temperature</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> temperature.converted(to: .celsius)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将摄氏度转换为开尔文</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertCelsiusToKelvin</span>(<span class="params">temperature</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> temperature.converted(to: .kelvin)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> celsiusTemp <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">25</span>, unit: <span class="type">UnitTemperature</span>.celsius)</span><br><span class="line"><span class="keyword">let</span> fahrenheitTemp <span class="operator">=</span> convertCelsiusToFahrenheit(temperature: celsiusTemp)</span><br><span class="line"><span class="keyword">let</span> kelvinTemp <span class="operator">=</span> convertCelsiusToKelvin(temperature: celsiusTemp)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(celsiusTemp)</span> = <span class="subst">\(fahrenheitTemp)</span> = <span class="subst">\(kelvinTemp)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用 Measurement API 进行转换</span></span><br><span class="line"><span class="keyword">let</span> tempInFahrenheit <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">77</span>, unit: <span class="type">UnitTemperature</span>.fahrenheit)</span><br><span class="line"><span class="keyword">let</span> tempInCelsius <span class="operator">=</span> tempInFahrenheit.converted(to: .celsius)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;77°F = <span class="subst">\(String(format: <span class="string">&quot;%.1f&quot;</span>, tempInCelsius.value))</span>°C&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-1-4-在-UI-中显示温度"><a href="#7-1-4-在-UI-中显示温度" class="headerlink" title="7.1.4 在 UI 中显示温度"></a>7.1.4 在 UI 中显示温度</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据用户偏好显示温度单位</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">displayTemperature</span>(<span class="keyword">_</span> <span class="params">temperature</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt;, <span class="params">forLocale</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temperatureFormatter <span class="operator">=</span> <span class="type">MeasurementFormatter</span>()</span><br><span class="line">    temperatureFormatter.locale <span class="operator">=</span> locale</span><br><span class="line">    temperatureFormatter.numberFormatter.maximumFractionDigits <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    temperatureFormatter.unitOptions <span class="operator">=</span> .providedUnit</span><br><span class="line">    <span class="keyword">return</span> temperatureFormatter.string(from: temperature)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> userLocale <span class="operator">=</span> <span class="type">Locale</span>.current <span class="comment">// 获取用户设备的区域设置</span></span><br><span class="line"><span class="keyword">let</span> temperature <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">25</span>, unit: <span class="type">UnitTemperature</span>.celsius)</span><br><span class="line"><span class="keyword">let</span> displayText <span class="operator">=</span> displayTemperature(temperature, forLocale: userLocale)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;根据区域设置显示温度：<span class="subst">\(displayText)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-2-速度单位转换"><a href="#7-2-速度单位转换" class="headerlink" title="7.2 速度单位转换"></a>7.2 速度单位转换</h3><p>风速单位转换在显示天气数据时非常重要，尤其是在不同地区使用不同单位系统的情况下。以下是完整的风速单位转换规则和示例：</p>
<h4 id="7-2-1-常用风速单位"><a href="#7-2-1-常用风速单位" class="headerlink" title="7.2.1 常用风速单位"></a>7.2.1 常用风速单位</h4><ul>
<li><strong>公里&#x2F;小时（km&#x2F;h）</strong>：国际标准单位，符号为 km&#x2F;h</li>
<li><strong>英里&#x2F;小时（mph）</strong>：主要在美国使用，符号为 mph</li>
<li><strong>米&#x2F;秒（m&#x2F;s）</strong>：科学计算常用单位，符号为 m&#x2F;s</li>
<li><strong>节（knot）</strong>：航海和航空常用单位，符号为 kn</li>
<li><strong>英尺&#x2F;秒（ft&#x2F;s）</strong>：英制单位，符号为 ft&#x2F;s</li>
</ul>
<h4 id="7-2-2-转换公式"><a href="#7-2-2-转换公式" class="headerlink" title="7.2.2 转换公式"></a>7.2.2 转换公式</h4><ul>
<li>公里&#x2F;小时转英里&#x2F;小时：mph &#x3D; km&#x2F;h × 0.621371</li>
<li>英里&#x2F;小时转公里&#x2F;小时：km&#x2F;h &#x3D; mph × 1.60934</li>
<li>公里&#x2F;小时转米&#x2F;秒：m&#x2F;s &#x3D; km&#x2F;h ÷ 3.6</li>
<li>米&#x2F;秒转公里&#x2F;小时：km&#x2F;h &#x3D; m&#x2F;s × 3.6</li>
<li>公里&#x2F;小时转节：kn &#x3D; km&#x2F;h × 0.539957</li>
<li>节转公里&#x2F;小时：km&#x2F;h &#x3D; kn × 1.852</li>
</ul>
<h4 id="7-2-3-Swift-代码示例"><a href="#7-2-3-Swift-代码示例" class="headerlink" title="7.2.3 Swift 代码示例"></a>7.2.3 Swift 代码示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将公里/小时转换为英里/小时</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertKilometersPerHourToMilesPerHour</span>(<span class="params">speed</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> speed.converted(to: .milesPerHour)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将公里/小时转换为米/秒</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertKilometersPerHourToMetersPerSecond</span>(<span class="params">speed</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> speed.converted(to: .metersPerSecond)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将公里/小时转换为节</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertKilometersPerHourToKnots</span>(<span class="params">speed</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> speed.converted(to: .knots)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> kmhSpeed <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">100</span>, unit: <span class="type">UnitSpeed</span>.kilometersPerHour)</span><br><span class="line"><span class="keyword">let</span> mphSpeed <span class="operator">=</span> convertKilometersPerHourToMilesPerHour(speed: kmhSpeed)</span><br><span class="line"><span class="keyword">let</span> mpsSpeed <span class="operator">=</span> convertKilometersPerHourToMetersPerSecond(speed: kmhSpeed)</span><br><span class="line"><span class="keyword">let</span> knotsSpeed <span class="operator">=</span> convertKilometersPerHourToKnots(speed: kmhSpeed)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(kmhSpeed)</span> = <span class="subst">\(mphSpeed)</span> = <span class="subst">\(mpsSpeed)</span> = <span class="subst">\(knotsSpeed)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用 Measurement API 进行转换</span></span><br><span class="line"><span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">15</span>, unit: <span class="type">UnitSpeed</span>.kilometersPerHour)</span><br><span class="line"><span class="keyword">let</span> displaySpeed <span class="operator">=</span> windSpeed.converted(to: .milesPerHour)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;风速：<span class="subst">\(String(format: <span class="string">&quot;%.1f&quot;</span>, displaySpeed.value))</span> mph&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-2-4-根据地区显示合适的风速单位"><a href="#7-2-4-根据地区显示合适的风速单位" class="headerlink" title="7.2.4 根据地区显示合适的风速单位"></a>7.2.4 根据地区显示合适的风速单位</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据地区设置自动选择风速单位</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPreferredSpeedUnit</span>(<span class="params">for</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">UnitSpeed</span> &#123;</span><br><span class="line">    <span class="comment">// 美国使用英里/小时</span></span><br><span class="line">    <span class="keyword">if</span> locale.identifier <span class="operator">==</span> <span class="string">&quot;en_US&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .milesPerHour</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他地区默认使用公里/小时</span></span><br><span class="line">    <span class="keyword">return</span> .kilometersPerHour</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> userLocale <span class="operator">=</span> <span class="type">Locale</span>.current</span><br><span class="line"><span class="keyword">let</span> preferredSpeedUnit <span class="operator">=</span> getPreferredSpeedUnit(for: userLocale)</span><br><span class="line"><span class="keyword">let</span> windSpeed <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">20</span>, unit: <span class="type">UnitSpeed</span>.kilometersPerHour)</span><br><span class="line"><span class="keyword">let</span> convertedSpeed <span class="operator">=</span> windSpeed.converted(to: preferredSpeedUnit)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;风速：<span class="subst">\(String(format: <span class="string">&quot;%.1f&quot;</span>, convertedSpeed.value))</span> <span class="subst">\(preferredSpeedUnit.symbol)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-3-降水量单位转换"><a href="#7-3-降水量单位转换" class="headerlink" title="7.3 降水量单位转换"></a>7.3 降水量单位转换</h3><p>降水量单位转换在显示天气预报时非常重要，尤其是在不同地区使用不同单位系统的情况下。以下是完整的降水量单位转换规则和示例：</p>
<h4 id="7-3-1-常用降水量单位"><a href="#7-3-1-常用降水量单位" class="headerlink" title="7.3.1 常用降水量单位"></a>7.3.1 常用降水量单位</h4><ul>
<li><strong>毫米（mm）</strong>：国际标准单位，符号为 mm</li>
<li><strong>英寸（in）</strong>：主要在美国使用，符号为 in</li>
<li><strong>厘米（cm）</strong>：常用单位，符号为 cm</li>
</ul>
<h4 id="7-3-2-转换公式"><a href="#7-3-2-转换公式" class="headerlink" title="7.3.2 转换公式"></a>7.3.2 转换公式</h4><ul>
<li>毫米转英寸：in &#x3D; mm × 0.0393701</li>
<li>英寸转毫米：mm &#x3D; in × 25.4</li>
<li>毫米转厘米：cm &#x3D; mm ÷ 10</li>
<li>厘米转毫米：mm &#x3D; cm × 10</li>
</ul>
<h4 id="7-3-3-Swift-代码示例"><a href="#7-3-3-Swift-代码示例" class="headerlink" title="7.3.3 Swift 代码示例"></a>7.3.3 Swift 代码示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将毫米转换为英寸</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertMillimetersToInches</span>(<span class="params">length</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> length.converted(to: .inches)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将英寸转换为毫米</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertInchesToMillimeters</span>(<span class="params">length</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> length.converted(to: .millimeters)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将毫米转换为厘米</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertMillimetersToCentimeters</span>(<span class="params">length</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitLength</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> length.converted(to: .centimeters)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> mmRain <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">10</span>, unit: <span class="type">UnitLength</span>.millimeters)</span><br><span class="line"><span class="keyword">let</span> inchesRain <span class="operator">=</span> convertMillimetersToInches(length: mmRain)</span><br><span class="line"><span class="keyword">let</span> cmRain <span class="operator">=</span> convertMillimetersToCentimeters(length: mmRain)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;降水量：<span class="subst">\(mmRain)</span> = <span class="subst">\(inchesRain)</span> = <span class="subst">\(cmRain)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用 Measurement API 进行转换</span></span><br><span class="line"><span class="keyword">let</span> precipitation <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">25</span>, unit: <span class="type">UnitLength</span>.millimeters)</span><br><span class="line"><span class="keyword">let</span> displayPrecipitation <span class="operator">=</span> precipitation.converted(to: .inches)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;预计降水量：<span class="subst">\(String(format: <span class="string">&quot;%.2f&quot;</span>, displayPrecipitation.value))</span> in&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-3-4-根据地区显示合适的降水量单位"><a href="#7-3-4-根据地区显示合适的降水量单位" class="headerlink" title="7.3.4 根据地区显示合适的降水量单位"></a>7.3.4 根据地区显示合适的降水量单位</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据地区设置自动选择降水量单位</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPreferredPrecipitationUnit</span>(<span class="params">for</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">UnitLength</span> &#123;</span><br><span class="line">    <span class="comment">// 美国使用英寸</span></span><br><span class="line">    <span class="keyword">if</span> locale.identifier <span class="operator">==</span> <span class="string">&quot;en_US&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .inches</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他地区默认使用毫米</span></span><br><span class="line">    <span class="keyword">return</span> .millimeters</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> userLocale <span class="operator">=</span> <span class="type">Locale</span>.current</span><br><span class="line"><span class="keyword">let</span> preferredPrecipUnit <span class="operator">=</span> getPreferredPrecipitationUnit(for: userLocale)</span><br><span class="line"><span class="keyword">let</span> precipitation <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">15</span>, unit: <span class="type">UnitLength</span>.millimeters)</span><br><span class="line"><span class="keyword">let</span> convertedPrecipitation <span class="operator">=</span> precipitation.converted(to: preferredPrecipUnit)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;降水量：<span class="subst">\(String(format: <span class="string">&quot;%.2f&quot;</span>, convertedPrecipitation.value))</span> <span class="subst">\(preferredPrecipUnit.symbol)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-4-气压单位转换"><a href="#7-4-气压单位转换" class="headerlink" title="7.4 气压单位转换"></a>7.4 气压单位转换</h3><p>气压单位转换在显示天气数据时非常重要，尤其是在不同地区使用不同单位系统的情况下。以下是完整的气压单位转换规则和示例：</p>
<h4 id="7-4-1-常用气压单位"><a href="#7-4-1-常用气压单位" class="headerlink" title="7.4.1 常用气压单位"></a>7.4.1 常用气压单位</h4><ul>
<li><strong>百帕（hPa）</strong>：国际标准单位，符号为 hPa</li>
<li><strong>毫米汞柱（mmHg）</strong>：常用单位，符号为 mmHg</li>
<li><strong>英寸汞柱（inHg）</strong>：主要在美国使用，符号为 inHg</li>
<li><strong>千帕（kPa）</strong>：常用单位，符号为 kPa</li>
<li><strong>磅力&#x2F;平方英寸（psi）</strong>：英制单位，符号为 psi</li>
</ul>
<h4 id="7-4-2-转换公式"><a href="#7-4-2-转换公式" class="headerlink" title="7.4.2 转换公式"></a>7.4.2 转换公式</h4><ul>
<li>百帕转毫米汞柱：mmHg &#x3D; hPa × 0.750062</li>
<li>毫米汞柱转百帕：hPa &#x3D; mmHg × 1.33322</li>
<li>百帕转英寸汞柱：inHg &#x3D; hPa × 0.02953</li>
<li>英寸汞柱转百帕：hPa &#x3D; inHg × 33.8639</li>
<li>百帕转千帕：kPa &#x3D; hPa ÷ 10</li>
<li>千帕转百帕：hPa &#x3D; kPa × 10</li>
<li>百帕转磅力&#x2F;平方英寸：psi &#x3D; hPa × 0.0145038</li>
</ul>
<h4 id="7-4-3-Swift-代码示例"><a href="#7-4-3-Swift-代码示例" class="headerlink" title="7.4.3 Swift 代码示例"></a>7.4.3 Swift 代码示例</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将百帕转换为毫米汞柱</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertHectopascalsToMillimetersOfMercury</span>(<span class="params">pressure</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> pressure.converted(to: .millimetersOfMercury)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将百帕转换为英寸汞柱</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertHectopascalsToInchesOfMercury</span>(<span class="params">pressure</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> pressure.converted(to: .inchesOfMercury)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将百帕转换为千帕</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">convertHectopascalsToKilopascals</span>(<span class="params">pressure</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt;) -&gt; <span class="type">Measurement</span>&lt;<span class="type">UnitPressure</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> pressure.converted(to: .kilopascals)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> hPaPressure <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">1013.25</span>, unit: <span class="type">UnitPressure</span>.hectopascals)</span><br><span class="line"><span class="keyword">let</span> mmHgPressure <span class="operator">=</span> convertHectopascalsToMillimetersOfMercury(pressure: hPaPressure)</span><br><span class="line"><span class="keyword">let</span> inHgPressure <span class="operator">=</span> convertHectopascalsToInchesOfMercury(pressure: hPaPressure)</span><br><span class="line"><span class="keyword">let</span> kPaPressure <span class="operator">=</span> convertHectopascalsToKilopascals(pressure: hPaPressure)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;气压：<span class="subst">\(hPaPressure)</span> = <span class="subst">\(mmHgPressure)</span> = <span class="subst">\(inHgPressure)</span> = <span class="subst">\(kPaPressure)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用 Measurement API 进行转换</span></span><br><span class="line"><span class="keyword">let</span> atmosphericPressure <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">1000</span>, unit: <span class="type">UnitPressure</span>.hectopascals)</span><br><span class="line"><span class="keyword">let</span> displayPressure <span class="operator">=</span> atmosphericPressure.converted(to: .inchesOfMercury)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;气压：<span class="subst">\(String(format: <span class="string">&quot;%.2f&quot;</span>, displayPressure.value))</span> inHg&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-4-4-根据地区显示合适的气压单位"><a href="#7-4-4-根据地区显示合适的气压单位" class="headerlink" title="7.4.4 根据地区显示合适的气压单位"></a>7.4.4 根据地区显示合适的气压单位</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据地区设置自动选择气压单位</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getPreferredPressureUnit</span>(<span class="params">for</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">UnitPressure</span> &#123;</span><br><span class="line">    <span class="comment">// 美国使用英寸汞柱</span></span><br><span class="line">    <span class="keyword">if</span> locale.identifier <span class="operator">==</span> <span class="string">&quot;en_US&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .inchesOfMercury</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他地区默认使用百帕</span></span><br><span class="line">    <span class="keyword">return</span> .hectopascals</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> userLocale <span class="operator">=</span> <span class="type">Locale</span>.current</span><br><span class="line"><span class="keyword">let</span> preferredPressureUnit <span class="operator">=</span> getPreferredPressureUnit(for: userLocale)</span><br><span class="line"><span class="keyword">let</span> atmosphericPressure <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">1013.25</span>, unit: <span class="type">UnitPressure</span>.hectopascals)</span><br><span class="line"><span class="keyword">let</span> convertedPressure <span class="operator">=</span> atmosphericPressure.converted(to: preferredPressureUnit)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;气压：<span class="subst">\(String(format: <span class="string">&quot;%.1f&quot;</span>, convertedPressure.value))</span> <span class="subst">\(preferredPressureUnit.symbol)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-5-其他数据类型的显示与转换"><a href="#7-5-其他数据类型的显示与转换" class="headerlink" title="7.5 其他数据类型的显示与转换"></a>7.5 其他数据类型的显示与转换</h3><p>除了上述主要单位转换外，还有一些其他天气数据类型需要适当的格式化和显示规则：</p>
<h4 id="7-5-1-湿度显示"><a href="#7-5-1-湿度显示" class="headerlink" title="7.5.1 湿度显示"></a>7.5.1 湿度显示</h4><p>湿度通常以百分比形式显示，范围为 0% 到 100%。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 格式化湿度显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatHumidity</span>(<span class="keyword">_</span> <span class="params">humidity</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// 湿度值范围为 0-1，转换为百分比</span></span><br><span class="line">    <span class="keyword">let</span> humidityPercentage <span class="operator">=</span> <span class="type">Int</span>(humidity <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(humidityPercentage)</span>%&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> humidity <span class="operator">=</span> <span class="number">0.65</span> <span class="comment">// 从 WeatherKit 获取的湿度值（0-1）</span></span><br><span class="line"><span class="keyword">let</span> formattedHumidity <span class="operator">=</span> formatHumidity(humidity)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;湿度：<span class="subst">\(formattedHumidity)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-5-2-紫外线指数显示"><a href="#7-5-2-紫外线指数显示" class="headerlink" title="7.5.2 紫外线指数显示"></a>7.5.2 紫外线指数显示</h4><p>紫外线指数范围通常为 0-11+，可以根据数值范围显示不同的描述和颜色。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 紫外线指数描述映射</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> uvIndexDescriptions <span class="operator">=</span> [</span><br><span class="line">    <span class="number">0</span>: (<span class="string">&quot;低&quot;</span>, <span class="type">UIColor</span>.green),</span><br><span class="line">    <span class="number">1</span>: (<span class="string">&quot;低&quot;</span>, <span class="type">UIColor</span>.green),</span><br><span class="line">    <span class="number">2</span>: (<span class="string">&quot;低&quot;</span>, <span class="type">UIColor</span>.green),</span><br><span class="line">    <span class="number">3</span>: (<span class="string">&quot;中等&quot;</span>, <span class="type">UIColor</span>.yellow),</span><br><span class="line">    <span class="number">4</span>: (<span class="string">&quot;中等&quot;</span>, <span class="type">UIColor</span>.yellow),</span><br><span class="line">    <span class="number">5</span>: (<span class="string">&quot;中等&quot;</span>, <span class="type">UIColor</span>.yellow),</span><br><span class="line">    <span class="number">6</span>: (<span class="string">&quot;高&quot;</span>, <span class="type">UIColor</span>.orange),</span><br><span class="line">    <span class="number">7</span>: (<span class="string">&quot;高&quot;</span>, <span class="type">UIColor</span>.orange),</span><br><span class="line">    <span class="number">8</span>: (<span class="string">&quot;很高&quot;</span>, <span class="type">UIColor</span>.red),</span><br><span class="line">    <span class="number">9</span>: (<span class="string">&quot;很高&quot;</span>, <span class="type">UIColor</span>.red),</span><br><span class="line">    <span class="number">10</span>: (<span class="string">&quot;很高&quot;</span>, <span class="type">UIColor</span>.red),</span><br><span class="line">    <span class="number">11</span>: (<span class="string">&quot;极高&quot;</span>, <span class="type">UIColor</span>.purple)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化紫外线指数显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatUVIndex</span>(<span class="keyword">_</span> <span class="params">uvIndex</span>: <span class="type">Double</span>) -&gt; (<span class="type">String</span>, <span class="type">UIColor</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> index <span class="operator">=</span> <span class="type">Int</span>(uvIndex)</span><br><span class="line">    <span class="keyword">let</span> clampedIndex <span class="operator">=</span> <span class="built_in">min</span>(<span class="built_in">max</span>(index, <span class="number">0</span>), <span class="number">11</span>)</span><br><span class="line">    <span class="keyword">return</span> uvIndexDescriptions[clampedIndex] <span class="operator">??</span> (<span class="string">&quot;未知&quot;</span>, <span class="type">UIColor</span>.gray)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> uvIndex <span class="operator">=</span> <span class="number">7.5</span> <span class="comment">// 从 WeatherKit 获取的紫外线指数</span></span><br><span class="line"><span class="keyword">let</span> (uvDescription, uvColor) <span class="operator">=</span> formatUVIndex(uvIndex)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;紫外线指数：<span class="subst">\(Int(uvIndex))</span>，<span class="subst">\(uvDescription)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-5-3-降水概率显示"><a href="#7-5-3-降水概率显示" class="headerlink" title="7.5.3 降水概率显示"></a>7.5.3 降水概率显示</h4><p>降水概率通常以百分比形式显示，范围为 0% 到 100%。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 格式化降水概率显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatPrecipitationChance</span>(<span class="keyword">_</span> <span class="params">chance</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// 降水概率范围为 0-1，转换为百分比</span></span><br><span class="line">    <span class="keyword">let</span> chancePercentage <span class="operator">=</span> <span class="type">Int</span>(chance <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(chancePercentage)</span>%&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> precipitationChance <span class="operator">=</span> <span class="number">0.45</span> <span class="comment">// 从 WeatherKit 获取的降水概率（0-1）</span></span><br><span class="line"><span class="keyword">let</span> formattedChance <span class="operator">=</span> formatPrecipitationChance(precipitationChance)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;降水概率：<span class="subst">\(formattedChance)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-5-4-云覆盖率显示"><a href="#7-5-4-云覆盖率显示" class="headerlink" title="7.5.4 云覆盖率显示"></a>7.5.4 云覆盖率显示</h4><p>云覆盖率通常以百分比形式显示，范围为 0% 到 100%。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 格式化云覆盖率显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatCloudCover</span>(<span class="keyword">_</span> <span class="params">cloudCover</span>: <span class="type">Double</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// 云覆盖率范围为 0-1，转换为百分比</span></span><br><span class="line">    <span class="keyword">let</span> cloudCoverPercentage <span class="operator">=</span> <span class="type">Int</span>(cloudCover <span class="operator">*</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(cloudCoverPercentage)</span>%&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> cloudCover <span class="operator">=</span> <span class="number">0.3</span> <span class="comment">// 从 WeatherKit 获取的云覆盖率（0-1）</span></span><br><span class="line"><span class="keyword">let</span> formattedCloudCover <span class="operator">=</span> formatCloudCover(cloudCover)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;云覆盖率：<span class="subst">\(formattedCloudCover)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-5-5-时间格式化显示"><a href="#7-5-5-时间格式化显示" class="headerlink" title="7.5.5 时间格式化显示"></a>7.5.5 时间格式化显示</h4><p>天气数据中的时间需要根据用户时区和偏好进行格式化显示。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 格式化时间显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatTime</span>(<span class="keyword">_</span> <span class="params">date</span>: <span class="type">Date</span>, <span class="params">for</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">    formatter.locale <span class="operator">=</span> locale</span><br><span class="line">    formatter.timeStyle <span class="operator">=</span> .short <span class="comment">// 显示短时间格式，如 &quot;14:30&quot;</span></span><br><span class="line">    <span class="keyword">return</span> formatter.string(from: date)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化日期显示</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">formatDate</span>(<span class="keyword">_</span> <span class="params">date</span>: <span class="type">Date</span>, <span class="params">for</span> <span class="params">locale</span>: <span class="type">Locale</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> formatter <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">    formatter.locale <span class="operator">=</span> locale</span><br><span class="line">    formatter.dateStyle <span class="operator">=</span> .medium <span class="comment">// 显示中等日期格式，如 &quot;2023年12月31日&quot;</span></span><br><span class="line">    <span class="keyword">return</span> formatter.string(from: date)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> sunriseTime <span class="operator">=</span> <span class="type">Date</span>() <span class="comment">// 从 WeatherKit 获取的日出时间</span></span><br><span class="line"><span class="keyword">let</span> userLocale <span class="operator">=</span> <span class="type">Locale</span>.current</span><br><span class="line"><span class="keyword">let</span> formattedSunriseTime <span class="operator">=</span> formatTime(sunriseTime, for: userLocale)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;日出时间：<span class="subst">\(formattedSunriseTime)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> forecastDate <span class="operator">=</span> <span class="type">Date</span>() <span class="comment">// 从 WeatherKit 获取的预报日期</span></span><br><span class="line"><span class="keyword">let</span> formattedDate <span class="operator">=</span> formatDate(forecastDate, for: userLocale)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;预报日期：<span class="subst">\(formattedDate)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-5-6-在-UI-中显示不同单位"><a href="#7-5-6-在-UI-中显示不同单位" class="headerlink" title="7.5.6 在 UI 中显示不同单位"></a>7.5.6 在 UI 中显示不同单位</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 更新温度标签</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">updateTemperatureLabel</span>(<span class="params">with</span> <span class="params">temperature</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitTemperature</span>&gt;, <span class="params">unit</span>: <span class="type">UnitTemperature</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> convertedTemperature <span class="operator">=</span> temperature.converted(to: unit)</span><br><span class="line">    temperatureLabel.text <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(Int(convertedTemperature.value.rounded()))</span>°&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新风速标签</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">updateWindSpeedLabel</span>(<span class="params">with</span> <span class="params">windSpeed</span>: <span class="type">Measurement</span>&lt;<span class="type">UnitSpeed</span>&gt;, <span class="params">unit</span>: <span class="type">UnitSpeed</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> convertedSpeed <span class="operator">=</span> windSpeed.converted(to: unit)</span><br><span class="line">    windSpeedLabel.text <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(Int(convertedSpeed.value.rounded()))</span> <span class="subst">\(unit.symbol)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> currentWeather: <span class="type">CurrentWeather</span> <span class="operator">=</span> <span class="comment">// 从 WeatherKit 获取的当前天气</span></span><br><span class="line"><span class="keyword">let</span> userPreferredTempUnit <span class="operator">=</span> <span class="type">UnitTemperature</span>.celsius <span class="comment">// 可以从用户设置中获取</span></span><br><span class="line"><span class="keyword">let</span> userPreferredSpeedUnit <span class="operator">=</span> <span class="type">UnitSpeed</span>.kilometersPerHour <span class="comment">// 可以从用户设置中获取</span></span><br><span class="line"></span><br><span class="line">updateTemperatureLabel(with: currentWeather.temperature, unit: userPreferredTempUnit)</span><br><span class="line">updateWindSpeedLabel(with: currentWeather.wind.speed, unit: userPreferredSpeedUnit)</span><br></pre></td></tr></table></figure>

<h2 id="8-最佳实践"><a href="#8-最佳实践" class="headerlink" title="8. 最佳实践"></a>8. 最佳实践</h2><ol>
<li><strong>权限请求时机</strong>：只在需要天气数据时请求位置权限</li>
<li><strong>缓存天气数据</strong>：使用 <code>UserDefaults</code> 或 <code>Core Data</code> 缓存天气数据，减少网络请求</li>
<li><strong>异步处理</strong>：在后台线程获取天气数据，避免阻塞主线程</li>
<li><strong>错误处理</strong>：提供友好的错误提示，帮助用户解决问题</li>
<li><strong>归因显示</strong>：根据 Apple 的要求，显示天气数据的来源归因</li>
<li><strong>单位适配</strong>：根据用户的区域设置或偏好显示适当的单位</li>
<li><strong>数据验证</strong>：对获取的天气数据进行验证，处理缺失或异常值</li>
</ol>
<h2 id="9-天气数据缓存策略"><a href="#9-天气数据缓存策略" class="headerlink" title="9. 天气数据缓存策略"></a>9. 天气数据缓存策略</h2><p>合理缓存天气数据可以减少网络请求，提高应用性能，并在网络不可用时提供离线支持。以下是一些常见的缓存策略和实现示例：</p>
<h3 id="9-1-使用-UserDefaults-缓存天气数据"><a href="#9-1-使用-UserDefaults-缓存天气数据" class="headerlink" title="9.1 使用 UserDefaults 缓存天气数据"></a>9.1 使用 UserDefaults 缓存天气数据</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义缓存键</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> weatherCacheKey <span class="operator">=</span> <span class="string">&quot;cached_weather_data&quot;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> weatherCacheTimestampKey <span class="operator">=</span> <span class="string">&quot;cached_weather_timestamp&quot;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> weatherCacheExpirationTime: <span class="type">TimeInterval</span> <span class="operator">=</span> <span class="number">3600</span> <span class="comment">// 1小时过期</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">cacheWeatherData</span>(<span class="params">currentWeather</span>: <span class="type">CurrentWeather</span>, <span class="params">dailyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;, <span class="params">hourlyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// 创建包含所有天气数据的字典</span></span><br><span class="line">        <span class="keyword">let</span> weatherData <span class="operator">=</span> [</span><br><span class="line">            <span class="string">&quot;current&quot;</span>: currentWeather,</span><br><span class="line">            <span class="string">&quot;daily&quot;</span>: dailyForecast,</span><br><span class="line">            <span class="string">&quot;hourly&quot;</span>: hourlyForecast</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 编码数据</span></span><br><span class="line">        <span class="keyword">let</span> encoder <span class="operator">=</span> <span class="type">JSONEncoder</span>()</span><br><span class="line">        <span class="keyword">let</span> encodedData <span class="operator">=</span> <span class="keyword">try</span> encoder.encode(weatherData)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 保存到 UserDefaults</span></span><br><span class="line">        <span class="type">UserDefaults</span>.standard.set(encodedData, forKey: weatherCacheKey)</span><br><span class="line">        <span class="type">UserDefaults</span>.standard.set(<span class="type">Date</span>().timeIntervalSince1970, forKey: weatherCacheTimestampKey)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;缓存天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查缓存是否有效</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">isWeatherCacheValid</span>() -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> cacheTimestamp <span class="operator">=</span> <span class="type">UserDefaults</span>.standard.object(forKey: weatherCacheTimestampKey) <span class="keyword">as?</span> <span class="type">TimeInterval</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> cacheDate <span class="operator">=</span> <span class="type">Date</span>(timeIntervalSince1970: cacheTimestamp)</span><br><span class="line">    <span class="keyword">let</span> now <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">    <span class="keyword">return</span> now.timeIntervalSince(cacheDate) <span class="operator">&lt;</span> weatherCacheExpirationTime</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从缓存获取天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCachedWeatherData</span>() -&gt; (<span class="type">CurrentWeather</span>, <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;, <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;)<span class="operator">?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> isWeatherCacheValid(),</span><br><span class="line">          <span class="keyword">let</span> cachedData <span class="operator">=</span> <span class="type">UserDefaults</span>.standard.data(forKey: weatherCacheKey) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> decoder <span class="operator">=</span> <span class="type">JSONDecoder</span>()</span><br><span class="line">        <span class="keyword">let</span> weatherData <span class="operator">=</span> <span class="keyword">try</span> decoder.decode([String: <span class="keyword">Any</span>].<span class="keyword">self</span>, from: cachedData)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解码并返回数据</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> current <span class="operator">=</span> weatherData[<span class="string">&quot;current&quot;</span>] <span class="keyword">as?</span> <span class="type">CurrentWeather</span>,</span><br><span class="line">           <span class="keyword">let</span> daily <span class="operator">=</span> weatherData[<span class="string">&quot;daily&quot;</span>] <span class="keyword">as?</span> <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;,</span><br><span class="line">           <span class="keyword">let</span> hourly <span class="operator">=</span> weatherData[<span class="string">&quot;hourly&quot;</span>] <span class="keyword">as?</span> <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> (current, daily, hourly)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;读取缓存天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用缓存的示例</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWeatherWithCache</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">    <span class="comment">// 首先检查缓存</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> cachedWeather <span class="operator">=</span> getCachedWeatherData() &#123;</span><br><span class="line">        updateUI(current: cachedWeather.<span class="number">0</span>, daily: cachedWeather.<span class="number">1</span>, hourly: cachedWeather.<span class="number">2</span>, location: location)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 然后异步获取最新数据</span></span><br><span class="line">    <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                for: location,</span><br><span class="line">                including: .current, .daily, .hourly</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 更新 UI 并缓存数据</span></span><br><span class="line">            updateUI(current: currentWeather, daily: dailyForecast, hourly: hourlyForecast, location: location)</span><br><span class="line">            cacheWeatherData(currentWeather: currentWeather, dailyForecast: dailyForecast, hourlyForecast: hourlyForecast)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="comment">// 如果没有缓存数据且获取失败，显示错误</span></span><br><span class="line">            <span class="keyword">if</span> getCachedWeatherData() <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-使用-Core-Data-缓存天气数据"><a href="#9-2-使用-Core-Data-缓存天气数据" class="headerlink" title="9.2 使用 Core Data 缓存天气数据"></a>9.2 使用 Core Data 缓存天气数据</h3><p>对于更复杂的应用，可以使用 Core Data 来缓存天气数据，这允许更灵活的查询和管理。以下是一个简单的示例：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 定义 Core Data 模型</span></span><br><span class="line"><span class="comment">// - WeatherCache: 包含缓存的基本信息（位置、时间戳、过期时间）</span></span><br><span class="line"><span class="comment">// - CurrentWeatherEntity: 当前天气数据</span></span><br><span class="line"><span class="comment">// - DayWeatherEntity: 每日天气预报</span></span><br><span class="line"><span class="comment">// - HourWeatherEntity: 每小时天气预报</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 保存天气数据到 Core Data</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">saveWeatherToCoreData</span>(<span class="params">location</span>: <span class="type">CLLocation</span>, <span class="params">currentWeather</span>: <span class="type">CurrentWeather</span>, <span class="params">dailyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;, <span class="params">hourlyForecast</span>: <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">let</span> context <span class="operator">=</span> persistentContainer.viewContext</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建缓存记录</span></span><br><span class="line">    <span class="keyword">let</span> cache <span class="operator">=</span> <span class="type">WeatherCache</span>(context: context)</span><br><span class="line">    cache.locationLatitude <span class="operator">=</span> location.coordinate.latitude</span><br><span class="line">    cache.locationLongitude <span class="operator">=</span> location.coordinate.longitude</span><br><span class="line">    cache.timestamp <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">    cache.expirationDate <span class="operator">=</span> <span class="type">Date</span>().addingTimeInterval(<span class="number">3600</span>) <span class="comment">// 1小时过期</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存当前天气数据</span></span><br><span class="line">    <span class="keyword">let</span> currentEntity <span class="operator">=</span> <span class="type">CurrentWeatherEntity</span>(context: context)</span><br><span class="line">    currentEntity.temperature <span class="operator">=</span> currentWeather.temperature.value</span><br><span class="line">    currentEntity.condition <span class="operator">=</span> currentWeather.condition.rawValue</span><br><span class="line">    <span class="comment">// 保存其他属性...</span></span><br><span class="line">    cache.currentWeather <span class="operator">=</span> currentEntity</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存每日预报</span></span><br><span class="line">    <span class="keyword">for</span> dayWeather <span class="keyword">in</span> dailyForecast.forecast &#123;</span><br><span class="line">        <span class="keyword">let</span> dayEntity <span class="operator">=</span> <span class="type">DayWeatherEntity</span>(context: context)</span><br><span class="line">        dayEntity.date <span class="operator">=</span> dayWeather.date</span><br><span class="line">        dayEntity.highTemperature <span class="operator">=</span> dayWeather.highTemperature.value</span><br><span class="line">        dayEntity.lowTemperature <span class="operator">=</span> dayWeather.lowTemperature.value</span><br><span class="line">        <span class="comment">// 保存其他属性...</span></span><br><span class="line">        cache.addToDailyForecasts(dayEntity)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存每小时预报</span></span><br><span class="line">    <span class="keyword">for</span> hourWeather <span class="keyword">in</span> hourlyForecast.forecast &#123;</span><br><span class="line">        <span class="keyword">let</span> hourEntity <span class="operator">=</span> <span class="type">HourWeatherEntity</span>(context: context)</span><br><span class="line">        hourEntity.date <span class="operator">=</span> hourWeather.date</span><br><span class="line">        hourEntity.temperature <span class="operator">=</span> hourWeather.temperature.value</span><br><span class="line">        <span class="comment">// 保存其他属性...</span></span><br><span class="line">        cache.addToHourlyForecasts(hourEntity)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存上下文</span></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> context.save()</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;保存天气数据到 Core Data 失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 从 Core Data 获取天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getWeatherFromCoreData</span>(<span class="params">location</span>: <span class="type">CLLocation</span>) -&gt; (<span class="type">CurrentWeather</span>, <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;, <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;)<span class="operator">?</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> context <span class="operator">=</span> persistentContainer.viewContext</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建请求</span></span><br><span class="line">    <span class="keyword">let</span> request: <span class="type">NSFetchRequest</span>&lt;<span class="type">WeatherCache</span>&gt; <span class="operator">=</span> <span class="type">WeatherCache</span>.fetchRequest()</span><br><span class="line">    request.predicate <span class="operator">=</span> <span class="type">NSPredicate</span>(format: <span class="string">&quot;locationLatitude == %@ AND locationLongitude == %@ AND expirationDate &gt; %@&quot;</span>,</span><br><span class="line">                                    location.coordinate.latitude,</span><br><span class="line">                                    location.coordinate.longitude,</span><br><span class="line">                                    <span class="type">Date</span>())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> caches <span class="operator">=</span> <span class="keyword">try</span> context.fetch(request)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> cache <span class="operator">=</span> caches.first &#123;</span><br><span class="line">            <span class="comment">// 从 Core Data 实体转换为 WeatherKit 数据类型</span></span><br><span class="line">            <span class="comment">// 这里需要根据你的 Core Data 模型实现转换逻辑</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="keyword">return</span> (convertedCurrentWeather, convertedDailyForecast, convertedHourlyForecast)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;从 Core Data 获取天气数据失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-3-缓存失效策略"><a href="#9-3-缓存失效策略" class="headerlink" title="9.3 缓存失效策略"></a>9.3 缓存失效策略</h3><p>选择合适的缓存失效策略取决于你的应用需求：</p>
<ol>
<li><strong>时间过期策略</strong>：根据固定时间（如1小时）过期缓存</li>
<li><strong>位置距离策略</strong>：当设备移动超过一定距离（如5公里）时刷新缓存</li>
<li><strong>用户交互触发</strong>：当用户手动刷新时更新缓存</li>
<li><strong>后台定期更新</strong>：使用后台任务定期更新缓存</li>
<li><strong>网络状态变化</strong>：当网络从不可用变为可用时更新缓存</li>
</ol>
<h3 id="9-4-实现位置距离策略示例"><a href="#9-4-实现位置距离策略示例" class="headerlink" title="9.4 实现位置距离策略示例"></a>9.4 实现位置距离策略示例</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义距离阈值</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> locationDistanceThreshold: <span class="type">CLLocationDistance</span> <span class="operator">=</span> <span class="number">5000</span> <span class="comment">// 5公里</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存上次获取天气的位置</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> lastWeatherLocation: <span class="type">CLLocation</span>?</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查是否需要刷新天气数据</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">shouldRefreshWeather</span>(<span class="params">for</span> <span class="params">currentLocation</span>: <span class="type">CLLocation</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="comment">// 检查缓存是否过期</span></span><br><span class="line">    <span class="keyword">if</span> <span class="operator">!</span>isWeatherCacheValid() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查位置是否变化超过阈值</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> lastLocation <span class="operator">=</span> lastWeatherLocation &#123;</span><br><span class="line">        <span class="keyword">let</span> distance <span class="operator">=</span> currentLocation.distance(from: lastLocation)</span><br><span class="line">        <span class="keyword">return</span> distance <span class="operator">&gt;</span> locationDistanceThreshold</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-代码示例（完整的-ViewController）"><a href="#10-代码示例（完整的-ViewController）" class="headerlink" title="10. 代码示例（完整的 ViewController）"></a>10. 代码示例（完整的 ViewController）</h2><p>基于 SelfViewController.swift 的完整代码示例：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> WeatherKit</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherViewController</span>: <span class="title class_ inherited__">UIViewController</span> &#123;</span><br><span class="line">    <span class="comment">// MARK: - 核心组件</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> locationManager <span class="operator">=</span> <span class="type">CLLocationManager</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> weatherService <span class="operator">=</span> <span class="type">WeatherService</span>.shared</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - UI 控件</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> stackView <span class="operator">=</span> <span class="type">UIStackView</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> cityLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> temperatureLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> conditionLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> highLowLabel <span class="operator">=</span> <span class="type">UILabel</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> activityIndicator <span class="operator">=</span> <span class="type">UIActivityIndicatorView</span>(style: .large)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">viewDidLoad</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        view.backgroundColor <span class="operator">=</span> .systemBackground</span><br><span class="line">        setupUI()</span><br><span class="line">        setupLocationManager()</span><br><span class="line">        requestLocation()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - UI 搭建</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">setupUI</span>() &#123;</span><br><span class="line">        <span class="comment">// UI 布局代码...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - CoreLocation 设置</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">setupLocationManager</span>() &#123;</span><br><span class="line">        locationManager.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">        locationManager.desiredAccuracy <span class="operator">=</span> kCLLocationAccuracyHundredMeters</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">requestLocation</span>() &#123;</span><br><span class="line">        <span class="comment">// 请求位置权限和位置信息...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - 获取天气数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">fetchWeather</span>(<span class="params">for</span> <span class="params">location</span>: <span class="type">CLLocation</span>) &#123;</span><br><span class="line">        <span class="type">Task</span> &#123; <span class="meta">@MainActor</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> (currentWeather, dailyForecast, hourlyForecast) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> weatherService.weather(</span><br><span class="line">                    for: location,</span><br><span class="line">                    including: .current, .daily, .hourly</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                updateUI(</span><br><span class="line">                    current: currentWeather,</span><br><span class="line">                    daily: dailyForecast,</span><br><span class="line">                    hourly: hourlyForecast,</span><br><span class="line">                    location: location</span><br><span class="line">                )</span><br><span class="line">            &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                showError(<span class="string">&quot;获取天气失败：<span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - 更新 UI</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">updateUI</span>(</span><br><span class="line">        <span class="params">current</span>: <span class="type">CurrentWeather</span>,</span><br><span class="line">        <span class="params">daily</span>: <span class="type">Forecast</span>&lt;<span class="type">DayWeather</span>&gt;,</span><br><span class="line">        <span class="params">hourly</span>: <span class="type">Forecast</span>&lt;<span class="type">HourWeather</span>&gt;,</span><br><span class="line">        <span class="params">location</span>: <span class="type">CLLocation</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="comment">// 更新 UI 代码...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - 辅助方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">showError</span>(<span class="keyword">_</span> <span class="params">message</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="comment">// 显示错误提示...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - CLLocationManagerDelegate</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">WeatherViewController</span>: <span class="title class_ inherited__">CLLocationManagerDelegate</span> &#123;</span><br><span class="line">    <span class="comment">// 位置管理器代理方法...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-总结"><a href="#11-总结" class="headerlink" title="11. 总结"></a>11. 总结</h2><p>WeatherKit 是一个强大的框架，提供了丰富的天气数据和简单的 API 接口。通过正确配置权限和使用 WeatherService，开发者可以轻松地在应用中集成天气功能。</p>
<p>使用 WeatherKit 时，需要注意：</p>
<ul>
<li>确保应用有正确的权限设置</li>
<li>在异步上下文中调用天气服务</li>
<li>妥善处理可能的错误</li>
<li>遵循 Apple 的指南，显示天气数据归因</li>
<li>根据用户偏好进行单位转换</li>
<li>合理缓存天气数据，减少网络请求</li>
</ul>
<p>通过本文档和示例代码，您应该能够理解如何在自己的应用中使用 WeatherKit 获取和显示天气数据，包括：</p>
<ul>
<li>获取当前天气、每日预报、每小时预报和分钟级降水预报</li>
<li>获取历史天气数据</li>
<li>使用城市名或位置获取天气</li>
<li>批量获取多个地点的天气数据</li>
<li>显示天气数据归因信息</li>
<li>进行单位转换</li>
<li>实现合理的缓存策略</li>
</ul>
<p>WeatherKit 提供了全面的天气数据和灵活的 API，适合各种类型的天气应用开发。</p>
]]></content>
      <tags>
        <tag>官方API</tag>
      </tags>
  </entry>
  <entry>
    <title>swift学习日记(七)</title>
    <url>/ios.github.io/2025/12/10/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Swift学习日记（七）：扩展与泛型"><a href="#Swift学习日记（七）：扩展与泛型" class="headerlink" title="Swift学习日记（七）：扩展与泛型"></a>Swift学习日记（七）：扩展与泛型</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>在上一篇学习日记中，我们学习了Swift的枚举和协议，它们是面向对象编程的重要组成部分。在这篇日记中，我们将探讨Swift的两个高级特性：扩展（Extension）和泛型（Generic）。扩展允许我们为已有类型添加新功能，泛型允许我们编写灵活、可重用的代码，它们都是Swift代码复用和类型安全的重要工具。</p>
<h2 id="二、扩展（Extension）"><a href="#二、扩展（Extension）" class="headerlink" title="二、扩展（Extension）"></a>二、扩展（Extension）</h2><p>扩展是Swift的一个强大特性，它允许我们为已有的类、结构体、枚举或协议添加新功能，而不需要修改原始类型的定义。扩展可以添加计算属性、方法、初始化器、下标、嵌套类型等。</p>
<h3 id="1-扩展的基本语法"><a href="#1-扩展的基本语法" class="headerlink" title="1. 扩展的基本语法"></a>1. 扩展的基本语法</h3><p>扩展的定义使用<code>extension</code>关键字：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为已有的类型添加扩展</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">TypeName</span> &#123;</span><br><span class="line">    <span class="comment">// 新功能的实现</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-添加计算属性"><a href="#2-添加计算属性" class="headerlink" title="2. 添加计算属性"></a>2. 添加计算属性</h3><p>扩展可以为类型添加计算属性（包括实例属性和类型属性），但不能添加存储属性：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为Int类型添加扩展</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Int</span> &#123;</span><br><span class="line">    <span class="comment">// 实例计算属性</span></span><br><span class="line">    <span class="keyword">var</span> isEven: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> isOdd: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">!=</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型计算属性</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> zero: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> number <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"><span class="built_in">print</span>(number.isEven) <span class="comment">// 输出：false</span></span><br><span class="line"><span class="built_in">print</span>(number.isOdd) <span class="comment">// 输出：true</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>.zero) <span class="comment">// 输出：0</span></span><br></pre></td></tr></table></figure>

<h3 id="3-添加方法"><a href="#3-添加方法" class="headerlink" title="3. 添加方法"></a>3. 添加方法</h3><p>扩展可以为类型添加实例方法和类型方法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为Double类型添加扩展</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Double</span> &#123;</span><br><span class="line">    <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">rounded</span>(<span class="params">toPlaces</span> <span class="params">places</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> multiplier <span class="operator">=</span> pow(<span class="number">10.0</span>, <span class="type">Double</span>(places))</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">self</span> <span class="operator">*</span> multiplier).rounded() <span class="operator">/</span> multiplier</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">random</span>(<span class="params">in</span> <span class="params">range</span>: <span class="type">ClosedRange</span>&lt;<span class="type">Double</span>&gt;) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> range <span class="operator">=</span> range.upperBound <span class="operator">-</span> range.lowerBound</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">Double</span>.random(in: <span class="number">0</span><span class="operator">...</span><span class="number">1</span>) <span class="operator">*</span> range) <span class="operator">+</span> range.lowerBound</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> value <span class="operator">=</span> <span class="number">3.1415926</span></span><br><span class="line"><span class="built_in">print</span>(value.rounded(toPlaces: <span class="number">2</span>)) <span class="comment">// 输出：3.14</span></span><br><span class="line"><span class="built_in">print</span>(value.rounded(toPlaces: <span class="number">4</span>)) <span class="comment">// 输出：3.1416</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> randomValue <span class="operator">=</span> <span class="type">Double</span>.random(in: <span class="number">1.0</span><span class="operator">...</span><span class="number">10.0</span>)</span><br><span class="line"><span class="built_in">print</span>(randomValue) <span class="comment">// 输出：一个1.0到10.0之间的随机数</span></span><br></pre></td></tr></table></figure>

<h3 id="4-添加初始化器"><a href="#4-添加初始化器" class="headerlink" title="4. 添加初始化器"></a>4. 添加初始化器</h3><p>扩展可以为类型添加新的初始化器：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个结构体</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> email: <span class="type">String</span>?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为Person结构体添加扩展，添加一个新的初始化器</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="comment">// 便捷初始化器</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(name: name, age: age, email: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 另一个便捷初始化器</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">firstName</span>: <span class="type">String</span>, <span class="params">lastName</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>, <span class="params">email</span>: <span class="type">String</span>?) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(name: <span class="string">&quot;<span class="subst">\(firstName)</span> <span class="subst">\(lastName)</span>&quot;</span>, age: age, email: email)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用扩展添加的初始化器</span></span><br><span class="line"><span class="keyword">let</span> person1 <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">30</span>)</span><br><span class="line"><span class="keyword">let</span> person2 <span class="operator">=</span> <span class="type">Person</span>(firstName: <span class="string">&quot;李&quot;</span>, lastName: <span class="string">&quot;四&quot;</span>, age: <span class="number">25</span>, email: <span class="string">&quot;lisi@example.com&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：扩展不能添加指定初始化器（designated initializer），只能添加便捷初始化器（convenience initializer）。</p>
<h3 id="5-添加下标"><a href="#5-添加下标" class="headerlink" title="5. 添加下标"></a>5. 添加下标</h3><p>扩展可以为类型添加下标：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为String类型添加扩展</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="comment">// 下标：通过索引获取字符</span></span><br><span class="line">    <span class="keyword">subscript</span>(<span class="params">index</span>: <span class="type">Int</span>) -&gt; <span class="type">Character</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> stringIndex <span class="operator">=</span> <span class="keyword">self</span>.index(startIndex, offsetBy: index)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>[stringIndex]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下标：通过范围获取子字符串</span></span><br><span class="line">    <span class="keyword">subscript</span>(<span class="params">range</span>: <span class="type">Range</span>&lt;<span class="type">Int</span>&gt;) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> startIndex <span class="operator">=</span> <span class="keyword">self</span>.index(<span class="keyword">self</span>.startIndex, offsetBy: range.lowerBound)</span><br><span class="line">        <span class="keyword">let</span> endIndex <span class="operator">=</span> <span class="keyword">self</span>.index(<span class="keyword">self</span>.startIndex, offsetBy: range.upperBound)</span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(<span class="keyword">self</span>[startIndex<span class="operator">..&lt;</span>endIndex])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> str <span class="operator">=</span> <span class="string">&quot;Hello, Swift!&quot;</span></span><br><span class="line"><span class="built_in">print</span>(str[<span class="number">7</span>]) <span class="comment">// 输出：S</span></span><br><span class="line"><span class="built_in">print</span>(str[<span class="number">0</span><span class="operator">..&lt;</span><span class="number">5</span>]) <span class="comment">// 输出：Hello</span></span><br></pre></td></tr></table></figure>

<h3 id="6-添加嵌套类型"><a href="#6-添加嵌套类型" class="headerlink" title="6. 添加嵌套类型"></a>6. 添加嵌套类型</h3><p>扩展可以为类型添加嵌套类型：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为Int类型添加扩展</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Int</span> &#123;</span><br><span class="line">    <span class="comment">// 嵌套枚举</span></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Kind</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> positive, zero, negative</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算属性，返回数字的类型</span></span><br><span class="line">    <span class="keyword">var</span> kind: <span class="type">Kind</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> x <span class="keyword">where</span> x <span class="operator">&gt;</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> .positive</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> .zero</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> .negative</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> number <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"><span class="built_in">print</span>(number.kind) <span class="comment">// 输出：positive</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> zero <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="built_in">print</span>(zero.kind) <span class="comment">// 输出：zero</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> negativeNumber <span class="operator">=</span> <span class="operator">-</span><span class="number">5</span></span><br><span class="line"><span class="built_in">print</span>(negativeNumber.kind) <span class="comment">// 输出：negative</span></span><br></pre></td></tr></table></figure>

<h3 id="7-扩展协议"><a href="#7-扩展协议" class="headerlink" title="7. 扩展协议"></a>7. 扩展协议</h3><p>扩展可以为协议添加默认实现，这在我们之前学习协议时已经介绍过：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展协议，添加默认实现</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(name)</span>。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span>: <span class="title class_ inherited__">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="comment">// 使用默认实现的greet方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(person.greet()) <span class="comment">// 输出：你好，我是张三。</span></span><br></pre></td></tr></table></figure>

<h3 id="8-扩展泛型类型"><a href="#8-扩展泛型类型" class="headerlink" title="8. 扩展泛型类型"></a>8. 扩展泛型类型</h3><p>扩展可以为泛型类型添加新功能，我们将在泛型部分详细介绍。</p>
<h2 id="三、泛型（Generic）"><a href="#三、泛型（Generic）" class="headerlink" title="三、泛型（Generic）"></a>三、泛型（Generic）</h2><p>泛型是Swift的一个强大特性，它允许我们编写灵活、可重用的代码，而不需要指定具体的类型。泛型可以应用于函数、类型（类、结构体、枚举）、协议等。</p>
<h3 id="1-泛型函数"><a href="#1-泛型函数" class="headerlink" title="1. 泛型函数"></a>1. 泛型函数</h3><p>泛型函数允许我们编写一个函数，它可以处理不同类型的参数：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个泛型函数，交换两个值</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">swapValues</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">_</span> <span class="params">a</span>: <span class="keyword">inout</span> <span class="type">T</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="keyword">inout</span> <span class="type">T</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> temp <span class="operator">=</span> a</span><br><span class="line">    a <span class="operator">=</span> b</span><br><span class="line">    b <span class="operator">=</span> temp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用泛型函数交换两个整数</span></span><br><span class="line"><span class="keyword">var</span> x <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> y <span class="operator">=</span> <span class="number">20</span></span><br><span class="line">swapValues(<span class="operator">&amp;</span>x, <span class="operator">&amp;</span>y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;x: <span class="subst">\(x)</span>, y: <span class="subst">\(y)</span>&quot;</span>) <span class="comment">// 输出：x: 20, y: 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用泛型函数交换两个字符串</span></span><br><span class="line"><span class="keyword">var</span> str1 <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span></span><br><span class="line"><span class="keyword">var</span> str2 <span class="operator">=</span> <span class="string">&quot;Swift&quot;</span></span><br><span class="line">swapValues(<span class="operator">&amp;</span>str1, <span class="operator">&amp;</span>str2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;str1: <span class="subst">\(str1)</span>, str2: <span class="subst">\(str2)</span>&quot;</span>) <span class="comment">// 输出：str1: Swift, str2: Hello</span></span><br></pre></td></tr></table></figure>

<p>在上面的例子中，<code>&lt;T&gt;</code>是类型参数，它表示一个占位符类型，实际类型会在函数调用时被推断出来。</p>
<h3 id="2-泛型类型"><a href="#2-泛型类型" class="headerlink" title="2. 泛型类型"></a>2. 泛型类型</h3><p>泛型类型允许我们定义一个类型，它可以处理不同类型的数据：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个泛型结构体：栈</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Stack</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> items <span class="operator">=</span> [<span class="type">T</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 压栈操作</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">push</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">T</span>) &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 出栈操作</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">pop</span>() -&gt; <span class="type">T</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> items.popLast()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取栈顶元素</span></span><br><span class="line">    <span class="keyword">var</span> top: <span class="type">T</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> items.last</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查栈是否为空</span></span><br><span class="line">    <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.isEmpty</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取栈的大小</span></span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.count</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个整数栈</span></span><br><span class="line"><span class="keyword">var</span> intStack <span class="operator">=</span> <span class="type">Stack</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">intStack.push(<span class="number">1</span>)</span><br><span class="line">intStack.push(<span class="number">2</span>)</span><br><span class="line">intStack.push(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(intStack.top) <span class="comment">// 输出：Optional(3)</span></span><br><span class="line"><span class="built_in">print</span>(intStack.pop()) <span class="comment">// 输出：Optional(3)</span></span><br><span class="line"><span class="built_in">print</span>(intStack.count) <span class="comment">// 输出：2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个字符串栈</span></span><br><span class="line"><span class="keyword">var</span> stringStack <span class="operator">=</span> <span class="type">Stack</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line">stringStack.push(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">stringStack.push(<span class="string">&quot;Swift&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(stringStack.top) <span class="comment">// 输出：Optional(&quot;Swift&quot;)</span></span><br><span class="line"><span class="built_in">print</span>(stringStack.pop()) <span class="comment">// 输出：Optional(&quot;Swift&quot;)</span></span><br><span class="line"><span class="built_in">print</span>(stringStack.count) <span class="comment">// 输出：1</span></span><br></pre></td></tr></table></figure>

<h3 id="3-泛型枚举"><a href="#3-泛型枚举" class="headerlink" title="3. 泛型枚举"></a>3. 泛型枚举</h3><p>泛型枚举允许我们定义一个枚举，它可以处理不同类型的关联值：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个泛型枚举：结果</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">case</span> success(<span class="type">T</span>)</span><br><span class="line">    <span class="keyword">case</span> failure(<span class="type">E</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用泛型枚举表示成功结果</span></span><br><span class="line"><span class="keyword">let</span> successResult: <span class="type">Result</span>&lt;<span class="type">Int</span>, <span class="type">String</span>&gt; <span class="operator">=</span> .success(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用泛型枚举表示失败结果</span></span><br><span class="line"><span class="keyword">let</span> failureResult: <span class="type">Result</span>&lt;<span class="type">Int</span>, <span class="type">String</span>&gt; <span class="operator">=</span> .failure(<span class="string">&quot;请求失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配泛型枚举</span></span><br><span class="line"><span class="keyword">switch</span> successResult &#123;</span><br><span class="line"><span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;成功：<span class="subst">\(value)</span>&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：成功：100</span></span><br></pre></td></tr></table></figure>

<h3 id="4-泛型类"><a href="#4-泛型类" class="headerlink" title="4. 泛型类"></a>4. 泛型类</h3><p>泛型类允许我们定义一个类，它可以处理不同类型的数据：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个泛型类：链表节点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">T</span></span><br><span class="line">    <span class="keyword">var</span> next: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">value</span>: <span class="type">T</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.value <span class="operator">=</span> value</span><br><span class="line">        <span class="keyword">self</span>.next <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个泛型类：链表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LinkedList</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> head: <span class="type">Node</span>&lt;<span class="type">T</span>&gt;?</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加元素到链表头部</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">addToHead</span>(<span class="keyword">_</span> <span class="params">value</span>: <span class="type">T</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> newNode <span class="operator">=</span> <span class="type">Node</span>(value: value)</span><br><span class="line">        newNode.next <span class="operator">=</span> head</span><br><span class="line">        head <span class="operator">=</span> newNode</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取链表中的所有元素</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getAllValues</span>() -&gt; [<span class="type">T</span>] &#123;</span><br><span class="line">        <span class="keyword">var</span> values <span class="operator">=</span> [<span class="type">T</span>]()</span><br><span class="line">        <span class="keyword">var</span> current <span class="operator">=</span> head</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> node <span class="operator">=</span> current &#123;</span><br><span class="line">            values.append(node.value)</span><br><span class="line">            current <span class="operator">=</span> node.next</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> values</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个字符串链表</span></span><br><span class="line"><span class="keyword">let</span> linkedList <span class="operator">=</span> <span class="type">LinkedList</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line">linkedList.addToHead(<span class="string">&quot;Swift&quot;</span>)</span><br><span class="line">linkedList.addToHead(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(linkedList.getAllValues()) <span class="comment">// 输出：[&quot;Hello&quot;, &quot;Swift&quot;]</span></span><br></pre></td></tr></table></figure>

<h3 id="5-类型约束"><a href="#5-类型约束" class="headerlink" title="5. 类型约束"></a>5. 类型约束</h3><p>类型约束允许我们限制泛型类型可以接受的类型：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个泛型函数，要求类型必须遵循Equatable协议</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">findIndex</span>&lt;<span class="type">T</span>: <span class="type">Equatable</span>&gt;(<span class="params">of</span> <span class="params">valueToFind</span>: <span class="type">T</span>, <span class="params">in</span> <span class="params">array</span>: [<span class="type">T</span>]) -&gt; <span class="type">Int</span>? &#123;</span><br><span class="line">    <span class="keyword">for</span> (index, value) <span class="keyword">in</span> array.enumerated() &#123;</span><br><span class="line">        <span class="keyword">if</span> value <span class="operator">==</span> valueToFind &#123;</span><br><span class="line">            <span class="keyword">return</span> index</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> index <span class="operator">=</span> findIndex(of: <span class="number">3</span>, in: numbers) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字3在索引<span class="subst">\(index)</span>处&quot;</span>) <span class="comment">// 输出：数字3在索引2处</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> strings <span class="operator">=</span> [<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;Swift&quot;</span>, <span class="string">&quot;World&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> index <span class="operator">=</span> findIndex(of: <span class="string">&quot;Swift&quot;</span>, in: strings) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;字符串<span class="subst">\&quot;</span>Swift<span class="subst">\&quot;</span>在索引<span class="subst">\(index)</span>处&quot;</span>) <span class="comment">// 输出：字符串&quot;Swift&quot;在索引1处</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的例子中，<code>&lt;T: Equatable&gt;</code>表示类型参数T必须遵循Equatable协议，这样我们才能使用<code>==</code>运算符比较两个值。</p>
<h3 id="6-关联类型"><a href="#6-关联类型" class="headerlink" title="6. 关联类型"></a>6. 关联类型</h3><p>关联类型允许我们在协议中定义占位符类型，具体类型会在协议被遵循时确定：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个协议，包含关联类型</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Container</span> &#123;</span><br><span class="line">    <span class="comment">// 关联类型</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">ItemType</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 要求实现的方法和属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">append</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">ItemType</span>)</span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">subscript</span>(<span class="params">i</span>: <span class="type">Int</span>) -&gt; <span class="type">ItemType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体遵循协议，使用Int作为关联类型</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">IntStack</span>: <span class="title class_ inherited__">Container</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> items <span class="operator">=</span> [<span class="type">Int</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">append</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.count</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">subscript</span>(<span class="params">i</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体遵循协议，使用泛型作为关联类型</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GenericStack</span>&lt;<span class="type">T</span>&gt;: <span class="title class_ inherited__">Container</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> items <span class="operator">=</span> [<span class="type">T</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">append</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">T</span>) &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.count</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">subscript</span>(<span class="params">i</span>: <span class="type">Int</span>) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-泛型扩展"><a href="#7-泛型扩展" class="headerlink" title="7. 泛型扩展"></a>7. 泛型扩展</h3><p>扩展可以为泛型类型添加新功能：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为泛型Stack结构体添加扩展</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line">    <span class="comment">// 添加一个方法，将栈中的元素反转</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">reverse</span>() &#123;</span><br><span class="line">        <span class="keyword">var</span> reversedItems <span class="operator">=</span> [<span class="type">T</span>]()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> item <span class="operator">=</span> pop() &#123;</span><br><span class="line">            reversedItems.append(item)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> reversedItems &#123;</span><br><span class="line">            push(item)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stack <span class="operator">=</span> <span class="type">Stack</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">stack.push(<span class="number">1</span>)</span><br><span class="line">stack.push(<span class="number">2</span>)</span><br><span class="line">stack.push(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(stack.top) <span class="comment">// 输出：Optional(3)</span></span><br><span class="line"></span><br><span class="line">stack.reverse()</span><br><span class="line"><span class="built_in">print</span>(stack.top) <span class="comment">// 输出：Optional(1)</span></span><br></pre></td></tr></table></figure>

<h3 id="8-泛型约束的高级用法"><a href="#8-泛型约束的高级用法" class="headerlink" title="8. 泛型约束的高级用法"></a>8. 泛型约束的高级用法</h3><p>我们可以使用<code>where</code>子句对泛型类型添加更复杂的约束：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个泛型函数，要求两个容器的元素类型必须相同，并且必须遵循Equatable协议</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">allItemsMatch</span>&lt;<span class="type">C1</span>: <span class="type">Container</span>, <span class="type">C2</span>: <span class="type">Container</span>&gt;(<span class="keyword">_</span> <span class="params">container1</span>: <span class="type">C1</span>, <span class="keyword">_</span> <span class="params">container2</span>: <span class="type">C2</span>) -&gt; <span class="type">Bool</span> <span class="keyword">where</span> <span class="type">C1</span>.<span class="type">ItemType</span> <span class="operator">==</span> <span class="type">C2</span>.<span class="type">ItemType</span>, <span class="type">C1</span>.<span class="type">ItemType</span>: <span class="type">Equatable</span> &#123;</span><br><span class="line">    <span class="comment">// 检查两个容器的大小是否相同</span></span><br><span class="line">    <span class="keyword">if</span> container1.count <span class="operator">!=</span> container2.count &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查每个位置的元素是否相同</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>container1.count &#123;</span><br><span class="line">        <span class="keyword">if</span> container1[i] <span class="operator">!=</span> container2[i] &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> intStack1 <span class="operator">=</span> <span class="type">IntStack</span>()</span><br><span class="line">intStack1.append(<span class="number">1</span>)</span><br><span class="line">intStack1.append(<span class="number">2</span>)</span><br><span class="line">intStack1.append(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> intStack2 <span class="operator">=</span> <span class="type">GenericStack</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">intStack2.append(<span class="number">1</span>)</span><br><span class="line">intStack2.append(<span class="number">2</span>)</span><br><span class="line">intStack2.append(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(allItemsMatch(intStack1, intStack2)) <span class="comment">// 输出：true</span></span><br></pre></td></tr></table></figure>

<h2 id="三、扩展与泛型的应用场景"><a href="#三、扩展与泛型的应用场景" class="headerlink" title="三、扩展与泛型的应用场景"></a>三、扩展与泛型的应用场景</h2><h3 id="1-扩展的应用场景"><a href="#1-扩展的应用场景" class="headerlink" title="1. 扩展的应用场景"></a>1. 扩展的应用场景</h3><p>扩展在Swift开发中有广泛的应用场景：</p>
<ul>
<li><strong>为系统类型添加新功能</strong>：例如为<code>String</code>、<code>Int</code>、<code>Array</code>等系统类型添加实用方法</li>
<li><strong>为自定义类型添加额外功能</strong>：例如为自定义的类、结构体、枚举添加新方法和属性</li>
<li><strong>为协议添加默认实现</strong>：提高代码复用性，减少重复代码</li>
<li><strong>组织代码</strong>：将相关功能的代码组织在一起，提高代码的可读性和可维护性</li>
</ul>
<h3 id="2-泛型的应用场景"><a href="#2-泛型的应用场景" class="headerlink" title="2. 泛型的应用场景"></a>2. 泛型的应用场景</h3><p>泛型在Swift开发中也有广泛的应用场景：</p>
<ul>
<li><strong>集合类型</strong>：例如<code>Array</code>、<code>Dictionary</code>、<code>Set</code>等都是泛型类型</li>
<li><strong>数据结构</strong>：例如栈、队列、链表、树等数据结构通常使用泛型实现</li>
<li><strong>函数式编程</strong>：例如<code>map</code>、<code>filter</code>、<code>reduce</code>等高阶函数都是泛型函数</li>
<li><strong>API设计</strong>：编写灵活、可重用的API时，泛型是必不可少的工具</li>
<li><strong>类型安全</strong>：泛型可以在编译时检查类型，避免运行时错误</li>
</ul>
<h2 id="四、内容机制与知识点总结"><a href="#四、内容机制与知识点总结" class="headerlink" title="四、内容机制与知识点总结"></a>四、内容机制与知识点总结</h2><h3 id="1-Swift扩展与泛型的设计原则"><a href="#1-Swift扩展与泛型的设计原则" class="headerlink" title="1. Swift扩展与泛型的设计原则"></a>1. Swift扩展与泛型的设计原则</h3><p>Swift的扩展与泛型体现了几个核心设计原则：</p>
<ul>
<li><strong>代码复用</strong>：扩展允许为已有类型添加新功能，泛型允许编写可重用的代码</li>
<li><strong>类型安全</strong>：泛型在编译时检查类型，避免运行时错误</li>
<li><strong>开闭原则</strong>：对扩展开放，对修改关闭，通过扩展为类型添加功能而不修改其源代码</li>
<li><strong>抽象与封装</strong>：泛型提供了抽象机制，允许编写与具体类型无关的代码</li>
<li><strong>灵活性</strong>：扩展和泛型结合使用，可以创建高度灵活和可扩展的代码结构</li>
</ul>
<h3 id="2-核心知识点总结"><a href="#2-核心知识点总结" class="headerlink" title="2. 核心知识点总结"></a>2. 核心知识点总结</h3><table>
<thead>
<tr>
<th>概念</th>
<th>描述</th>
<th>主要特性</th>
</tr>
</thead>
<tbody><tr>
<td>扩展基本语法</td>
<td>使用<code>extension</code>关键字为已有类型添加功能</td>
<td>可以扩展类、结构体、枚举和协议</td>
</tr>
<tr>
<td>计算属性扩展</td>
<td>为类型添加计算属性（实例和类型）</td>
<td>不能添加存储属性</td>
</tr>
<tr>
<td>方法扩展</td>
<td>为类型添加实例方法和类型方法</td>
<td>可以访问类型的所有成员</td>
</tr>
<tr>
<td>初始化器扩展</td>
<td>为类型添加便捷初始化器</td>
<td>不能添加指定初始化器</td>
</tr>
<tr>
<td>下标扩展</td>
<td>为类型添加自定义下标</td>
<td>增强类型的访问能力</td>
</tr>
<tr>
<td>嵌套类型扩展</td>
<td>为类型添加嵌套的枚举、结构体或类</td>
<td>提高代码组织性</td>
</tr>
<tr>
<td>协议扩展</td>
<td>为协议添加默认实现和新方法</td>
<td>提高代码复用性</td>
</tr>
<tr>
<td>泛型函数</td>
<td>使用类型参数<code>&lt;T&gt;</code>的函数</td>
<td>可以处理不同类型的参数</td>
</tr>
<tr>
<td>泛型类型</td>
<td>使用类型参数的类、结构体或枚举</td>
<td>可以处理不同类型的数据</td>
</tr>
<tr>
<td>类型约束</td>
<td>限制泛型可以接受的类型</td>
<td>使用<code>:</code>指定协议约束</td>
</tr>
<tr>
<td>关联类型</td>
<td>协议中的占位符类型</td>
<td>使用<code>associatedtype</code>关键字</td>
</tr>
<tr>
<td>泛型扩展</td>
<td>为泛型类型添加新功能</td>
<td>可以保留或添加类型约束</td>
</tr>
<tr>
<td>高级约束</td>
<td>使用<code>where</code>子句添加复杂约束</td>
<td>支持多重条件约束</td>
</tr>
</tbody></table>
<h2 id="五、遇到的问题及解决方案"><a href="#五、遇到的问题及解决方案" class="headerlink" title="五、遇到的问题及解决方案"></a>五、遇到的问题及解决方案</h2><h3 id="1-扩展中添加存储属性的错误"><a href="#1-扩展中添加存储属性的错误" class="headerlink" title="1. 扩展中添加存储属性的错误"></a>1. 扩展中添加存储属性的错误</h3><p><strong>问题</strong>：尝试在扩展中添加存储属性</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> customPrefix: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;PRE_&quot;</span> <span class="comment">// 错误：Extensions may not contain stored properties</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用计算属性替代存储属性，或使用关联对象（不推荐）</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="comment">// 使用计算属性</span></span><br><span class="line">    <span class="keyword">var</span> customPrefix: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;PRE_&quot;</span> <span class="operator">+</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或使用关联对象（需要导入Foundation）</span></span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">var</span> customPrefixKey <span class="operator">=</span> <span class="string">&quot;customPrefix&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> customPrefix: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, <span class="operator">&amp;</span><span class="keyword">Self</span>.customPrefixKey) <span class="keyword">as?</span> <span class="type">String</span> <span class="operator">??</span> <span class="string">&quot;PRE_&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            objc_setAssociatedObject(<span class="keyword">self</span>, <span class="operator">&amp;</span><span class="keyword">Self</span>.customPrefixKey, newValue, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-泛型类型约束错误"><a href="#2-泛型类型约束错误" class="headerlink" title="2. 泛型类型约束错误"></a>2. 泛型类型约束错误</h3><p><strong>问题</strong>：尝试在泛型函数中使用未约束的类型操作</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">compare</span>&lt;<span class="type">T</span>&gt;(<span class="params">a</span>: <span class="type">T</span>, <span class="params">b</span>: <span class="type">T</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a <span class="operator">&lt;</span> b <span class="comment">// 错误：Cannot invoke &#x27;&lt;&#x27; with arguments of type &#x27;T&#x27; and &#x27;T&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：添加适当的类型约束</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">compare</span>&lt;<span class="type">T</span>: <span class="type">Comparable</span>&gt;(<span class="params">a</span>: <span class="type">T</span>, <span class="params">b</span>: <span class="type">T</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a <span class="operator">&lt;</span> b <span class="comment">// 正确：T遵循Comparable协议</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-扩展协议时的冲突"><a href="#3-扩展协议时的冲突" class="headerlink" title="3. 扩展协议时的冲突"></a>3. 扩展协议时的冲突</h3><p><strong>问题</strong>：协议扩展中的默认实现与遵循者的实现冲突</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanFly</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fly</span>() -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">CanFly</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fly</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;飞行&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span>: <span class="title class_ inherited__">CanFly</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fly</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;鸟儿飞行&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用时使用哪个实现？</span></span><br><span class="line"><span class="keyword">let</span> bird <span class="operator">=</span> <span class="type">Bird</span>()</span><br><span class="line"><span class="built_in">print</span>(bird.fly()) <span class="comment">// 输出：鸟儿飞行（遵循者的实现优先）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果通过协议类型调用</span></span><br><span class="line"><span class="keyword">let</span> flyingCreature: <span class="type">CanFly</span> <span class="operator">=</span> <span class="type">Bird</span>()</span><br><span class="line"><span class="built_in">print</span>(flyingCreature.fly()) <span class="comment">// 输出：鸟儿飞行（同样遵循者的实现优先）</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：明确了解实现优先级，必要时在遵循者中显式调用协议扩展的实现</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span>: <span class="title class_ inherited__">CanFly</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fly</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="comment">// 调用协议扩展的实现</span></span><br><span class="line">        <span class="keyword">let</span> defaultFly <span class="operator">=</span> (<span class="keyword">self</span> <span class="keyword">as</span> <span class="type">CanFly</span>).fly()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;鸟儿&quot;</span> <span class="operator">+</span> defaultFly</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-泛型类的继承问题"><a href="#4-泛型类的继承问题" class="headerlink" title="4. 泛型类的继承问题"></a>4. 泛型类的继承问题</h3><p><strong>问题</strong>：泛型类继承时的类型约束处理</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BaseStack</span>&lt;<span class="type">T</span>: <span class="type">Equatable</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// 实现</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 尝试继承</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DerivedStack</span>&lt;<span class="type">T</span>&gt;: <span class="title class_ inherited__">BaseStack</span>&lt;<span class="title class_ inherited__">T</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// 错误：Type &#x27;T&#x27; does not conform to protocol &#x27;Equatable&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：在子类中也添加相应的类型约束</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DerivedStack</span>&lt;<span class="type">T</span>: <span class="type">Equatable</span>&gt;: <span class="title class_ inherited__">BaseStack</span>&lt;<span class="title class_ inherited__">T</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// 正确</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-关联类型的约束问题"><a href="#5-关联类型的约束问题" class="headerlink" title="5. 关联类型的约束问题"></a>5. 关联类型的约束问题</h3><p><strong>问题</strong>：在协议扩展中使用关联类型时的约束</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">Container</span> &#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Item</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">append</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">Item</span>)</span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">subscript</span>(<span class="params">i</span>: <span class="type">Int</span>) -&gt; <span class="type">Item</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 尝试为Container添加扩展</span></span><br><span class="line"><span class="comment">// 错误：Protocol &#x27;Container&#x27; can only be used as a generic constraint because it has Self or associated type requirements</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Array</span> <span class="keyword">where</span> <span class="type">Element</span>: <span class="type">Container</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">allItems</span>() -&gt; [<span class="type">Item</span>] &#123;</span><br><span class="line">        <span class="comment">// 实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：正确使用关联类型约束</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Array</span> <span class="keyword">where</span> <span class="type">Element</span>: <span class="type">Container</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">allItems</span>() -&gt; [<span class="type">Element</span>.<span class="type">Item</span>] &#123;</span><br><span class="line">        <span class="keyword">var</span> result <span class="operator">=</span> [<span class="type">Element</span>.<span class="type">Item</span>]()</span><br><span class="line">        <span class="keyword">for</span> container <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>container.count &#123;</span><br><span class="line">                result.append(container[i])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、高阶用法"><a href="#六、高阶用法" class="headerlink" title="六、高阶用法"></a>六、高阶用法</h2><h3 id="1-高级扩展技巧"><a href="#1-高级扩展技巧" class="headerlink" title="1. 高级扩展技巧"></a>1. 高级扩展技巧</h3><h4 id="1-1-协议扩展与默认实现"><a href="#1-1-协议扩展与默认实现" class="headerlink" title="1.1 协议扩展与默认实现"></a>1.1 协议扩展与默认实现</h4><p>利用协议扩展提供默认实现，可以减少重复代码：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">JSONConvertible</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">toJSON</span>() -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为String提供默认实现</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">String</span>: <span class="title class_ inherited__">JSONConvertible</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">toJSON</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="comment">// 简单的JSON转义</span></span><br><span class="line">        <span class="keyword">let</span> escaped <span class="operator">=</span> replacingOccurrences(of: <span class="string">&quot;<span class="subst">\&quot;</span>&quot;</span>, with: <span class="string">&quot;<span class="subst">\\</span><span class="subst">\&quot;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\&quot;</span><span class="subst">\(escaped)</span><span class="subst">\&quot;</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为Int提供默认实现</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Int</span>: <span class="title class_ inherited__">JSONConvertible</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">toJSON</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为Array提供默认实现</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Array</span>: <span class="title class_ inherited__">JSONConvertible</span> <span class="keyword">where</span> <span class="title class_ inherited__">Element</span>: <span class="title class_ inherited__">JSONConvertible</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">toJSON</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> jsonStrings <span class="operator">=</span> map &#123; <span class="variable">$0</span>.toJSON() &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[<span class="subst">\(jsonStrings.joined(separator: <span class="string">&quot;, &quot;</span>))</span>]&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">let</span> array: [<span class="type">JSONConvertible</span>] <span class="operator">=</span> [<span class="string">&quot;Hello&quot;</span>, <span class="number">123</span>]</span><br><span class="line"><span class="built_in">print</span>(array.toJSON()) <span class="comment">// 输出：[&quot;Hello&quot;, 123]</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-条件扩展"><a href="#1-2-条件扩展" class="headerlink" title="1.2 条件扩展"></a>1.2 条件扩展</h4><p>为满足特定条件的类型提供扩展：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Collection</span> <span class="keyword">where</span> <span class="type">Element</span>: <span class="type">Numeric</span> &#123;</span><br><span class="line">    <span class="comment">// 计算所有元素的和</span></span><br><span class="line">    <span class="keyword">var</span> sum: <span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Collection</span> <span class="keyword">where</span> <span class="type">Element</span>: <span class="type">StringProtocol</span> &#123;</span><br><span class="line">    <span class="comment">// 计算所有字符串的总长度</span></span><br><span class="line">    <span class="keyword">var</span> totalLength: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reduce(<span class="number">0</span>) &#123; <span class="variable">$0</span> <span class="operator">+</span> <span class="variable">$1</span>.count &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="built_in">print</span>(numbers.sum) <span class="comment">// 输出：15</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> strings <span class="operator">=</span> [<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;Swift&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(strings.totalLength) <span class="comment">// 输出：10</span></span><br></pre></td></tr></table></figure>

<h4 id="1-3-嵌套类型的高级应用"><a href="#1-3-嵌套类型的高级应用" class="headerlink" title="1.3 嵌套类型的高级应用"></a>1.3 嵌套类型的高级应用</h4><p>在扩展中使用嵌套类型实现复杂逻辑：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Date</span> &#123;</span><br><span class="line">    <span class="comment">// 嵌套枚举</span></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> year, month, day, hour, minute, second</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用嵌套枚举的方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">component</span>(<span class="keyword">_</span> <span class="params">component</span>: <span class="type">Component</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> calendar <span class="operator">=</span> <span class="type">Calendar</span>.current</span><br><span class="line">        <span class="keyword">switch</span> component &#123;</span><br><span class="line">        <span class="keyword">case</span> .year:</span><br><span class="line">            <span class="keyword">return</span> calendar.component(.year, from: <span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">case</span> .month:</span><br><span class="line">            <span class="keyword">return</span> calendar.component(.month, from: <span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">case</span> .day:</span><br><span class="line">            <span class="keyword">return</span> calendar.component(.day, from: <span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">case</span> .hour:</span><br><span class="line">            <span class="keyword">return</span> calendar.component(.hour, from: <span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">case</span> .minute:</span><br><span class="line">            <span class="keyword">return</span> calendar.component(.minute, from: <span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">case</span> .second:</span><br><span class="line">            <span class="keyword">return</span> calendar.component(.second, from: <span class="keyword">self</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">let</span> now <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"><span class="built_in">print</span>(now.component(.year)) <span class="comment">// 输出当前年份</span></span><br><span class="line"><span class="built_in">print</span>(now.component(.month)) <span class="comment">// 输出当前月份</span></span><br></pre></td></tr></table></figure>

<h3 id="2-高级泛型技巧"><a href="#2-高级泛型技巧" class="headerlink" title="2. 高级泛型技巧"></a>2. 高级泛型技巧</h3><h4 id="2-1-泛型与协议组合"><a href="#2-1-泛型与协议组合" class="headerlink" title="2.1 泛型与协议组合"></a>2.1 泛型与协议组合</h4><p>结合泛型和协议组合创建灵活的类型系统：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">Drawable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">draw</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">Animatable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">animate</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型函数，接受同时遵循两个协议的参数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">render</span>&lt;<span class="type">T</span>: <span class="type">Drawable</span> &amp; <span class="type">Animatable</span>&gt;(<span class="params">object</span>: <span class="type">T</span>) &#123;</span><br><span class="line">    object.draw()</span><br><span class="line">    object.animate()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>: <span class="title class_ inherited__">Drawable</span>, <span class="title class_ inherited__">Animatable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">draw</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;绘制形状&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">animate</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;形状动画&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">let</span> shape <span class="operator">=</span> <span class="type">Shape</span>()</span><br><span class="line">render(object: shape)</span><br></pre></td></tr></table></figure>

<h4 id="2-2-泛型与类型擦除"><a href="#2-2-泛型与类型擦除" class="headerlink" title="2.2 泛型与类型擦除"></a>2.2 泛型与类型擦除</h4><p>使用类型擦除解决泛型协议的限制：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义泛型协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Input</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Output</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">process</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">Input</span>) -&gt; <span class="type">Output</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类型擦除包装器</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AnyDataProcessor</span>&lt;<span class="type">Input</span>, <span class="type">Output</span>&gt;: <span class="title class_ inherited__">DataProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> _process: (<span class="type">Input</span>) -&gt; <span class="type">Output</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>&lt;<span class="type">Processor</span>: <span class="type">DataProcessor</span>&gt;(<span class="keyword">_</span> <span class="params">processor</span>: <span class="type">Processor</span>) <span class="keyword">where</span> <span class="type">Processor</span>.<span class="type">Input</span> <span class="operator">==</span> <span class="type">Input</span>, <span class="type">Processor</span>.<span class="type">Output</span> <span class="operator">==</span> <span class="type">Output</span> &#123;</span><br><span class="line">        _process <span class="operator">=</span> processor.process</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">process</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">Input</span>) -&gt; <span class="type">Output</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> _process(input)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">StringToIntProcessor</span>: <span class="title class_ inherited__">DataProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">process</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">String</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Int</span>(input) <span class="operator">??</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">IntToDoubleProcessor</span>: <span class="title class_ inherited__">DataProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">process</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Double</span>(input)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用类型擦除</span></span><br><span class="line"><span class="keyword">let</span> processors: [<span class="type">AnyDataProcessor</span>&lt;<span class="type">String</span>, <span class="keyword">Any</span>&gt;] <span class="operator">=</span> [</span><br><span class="line">    <span class="type">AnyDataProcessor</span>(<span class="type">StringToIntProcessor</span>()),</span><br><span class="line">    <span class="type">AnyDataProcessor</span>(<span class="type">IntToDoubleProcessor</span>()) <span class="keyword">as</span> <span class="type">AnyDataProcessor</span>&lt;<span class="type">String</span>, <span class="keyword">Any</span>&gt;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="2-3-递归泛型"><a href="#2-3-递归泛型" class="headerlink" title="2.3 递归泛型"></a>2.3 递归泛型</h4><p>使用递归泛型创建复杂的数据结构：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">LinkedList</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">case</span> empty</span><br><span class="line">    <span class="keyword">indirect</span> <span class="keyword">case</span> node(<span class="type">T</span>, next: <span class="type">LinkedList</span>&lt;<span class="type">T</span>&gt;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加元素到链表头部</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">prepend</span>(<span class="keyword">_</span> <span class="params">value</span>: <span class="type">T</span>) -&gt; <span class="type">LinkedList</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> .node(value, next: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取链表长度</span></span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .empty:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .node(<span class="keyword">_</span>, next):</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> <span class="operator">+</span> next.count</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">var</span> list <span class="operator">=</span> <span class="type">LinkedList</span>&lt;<span class="type">Int</span>&gt;.empty</span><br><span class="line">list <span class="operator">=</span> list.prepend(<span class="number">3</span>)</span><br><span class="line">list <span class="operator">=</span> list.prepend(<span class="number">2</span>)</span><br><span class="line">list <span class="operator">=</span> list.prepend(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(list.count) <span class="comment">// 输出：3</span></span><br></pre></td></tr></table></figure>

<h3 id="3-性能优化策略"><a href="#3-性能优化策略" class="headerlink" title="3. 性能优化策略"></a>3. 性能优化策略</h3><h4 id="3-1-扩展方法的性能考量"><a href="#3-1-扩展方法的性能考量" class="headerlink" title="3.1 扩展方法的性能考量"></a>3.1 扩展方法的性能考量</h4><p>扩展方法与类型原生方法具有相同的性能，但需要注意：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 高效的扩展方法</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Array</span> <span class="keyword">where</span> <span class="type">Element</span>: <span class="type">Equatable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">containsDuplicates</span>() -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> seen <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">Element</span>&gt;()</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> seen.contains(element) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">            seen.insert(element)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 避免低效的实现</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Array</span> <span class="keyword">where</span> <span class="type">Element</span>: <span class="type">Equatable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">containsDuplicatesSlow</span>() -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="comment">// O(n²)的时间复杂度</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>count &#123;</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> (i <span class="operator">+</span> <span class="number">1</span>)<span class="operator">..&lt;</span>count &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">self</span>[i] <span class="operator">==</span> <span class="keyword">self</span>[j] &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-泛型的性能优化"><a href="#3-2-泛型的性能优化" class="headerlink" title="3.2 泛型的性能优化"></a>3.2 泛型的性能优化</h4><p>泛型代码在编译时会进行特化，性能通常与非泛型代码相当，但需要注意：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 高效的泛型实现</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>&lt;<span class="type">T</span>: <span class="type">Numeric</span>&gt;(<span class="keyword">_</span> <span class="params">numbers</span>: [<span class="type">T</span>]) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> total: <span class="type">T</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        total <span class="operator">+=</span> number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 避免在泛型代码中使用过多的类型检查</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">process</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">_</span> <span class="params">value</span>: <span class="type">T</span>) &#123;</span><br><span class="line">    <span class="comment">// 避免这种写法</span></span><br><span class="line">    <span class="keyword">if</span> <span class="type">T</span>.<span class="keyword">self</span> <span class="operator">==</span> <span class="type">Int</span>.<span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="comment">// 处理Int</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="type">T</span>.<span class="keyword">self</span> <span class="operator">==</span> <span class="type">String</span>.<span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="comment">// 处理String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-协议扩展的性能"><a href="#3-3-协议扩展的性能" class="headerlink" title="3.3 协议扩展的性能"></a>3.3 协议扩展的性能</h4><p>协议扩展的默认实现性能良好，但通过协议类型调用时会有轻微的性能开销：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">Calculable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">calculate</span>() -&gt; <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Calculable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">calculate</span>() -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">42</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCalculator</span>: <span class="title class_ inherited__">Calculable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">calculate</span>() -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接调用（高性能）</span></span><br><span class="line"><span class="keyword">let</span> calculator <span class="operator">=</span> <span class="type">MyCalculator</span>()</span><br><span class="line">calculator.calculate()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过协议类型调用（性能稍低）</span></span><br><span class="line"><span class="keyword">let</span> calculable: <span class="type">Calculable</span> <span class="operator">=</span> <span class="type">MyCalculator</span>()</span><br><span class="line">calculable.calculate()</span><br></pre></td></tr></table></figure>

<h3 id="4-最佳实践指南"><a href="#4-最佳实践指南" class="headerlink" title="4. 最佳实践指南"></a>4. 最佳实践指南</h3><ol>
<li><p><strong>扩展的使用原则</strong>：</p>
<ul>
<li>只为合理的功能扩展类型，避免过度扩展</li>
<li>将相关功能组织在同一个扩展中</li>
<li>使用扩展分离不同职责的代码</li>
</ul>
</li>
<li><p><strong>泛型的使用原则</strong>：</p>
<ul>
<li>只有当代码需要处理多种类型时才使用泛型</li>
<li>保持泛型约束尽可能简单</li>
<li>为泛型代码提供清晰的文档</li>
</ul>
</li>
<li><p><strong>协议与扩展结合</strong>：</p>
<ul>
<li>使用协议定义接口，使用扩展提供默认实现</li>
<li>优先使用协议扩展而非继承</li>
<li>避免在协议扩展中修改类型的核心行为</li>
</ul>
</li>
<li><p><strong>性能优化建议</strong>：</p>
<ul>
<li>避免在扩展中添加过多的计算属性</li>
<li>为频繁调用的泛型函数提供具体类型的特化实现</li>
<li>注意协议类型调用的性能开销</li>
</ul>
</li>
</ol>
<h2 id="七、实践练习"><a href="#七、实践练习" class="headerlink" title="七、实践练习"></a>七、实践练习</h2><h3 id="1-扩展基础练习"><a href="#1-扩展基础练习" class="headerlink" title="1. 扩展基础练习"></a>1. 扩展基础练习</h3><ol>
<li><p><strong>为String类型添加扩展</strong>：</p>
<ul>
<li>实现一个计算属性<code>isPalindrome</code>，判断字符串是否为回文（忽略大小写和空格）</li>
<li>实现一个方法<code>truncate(toLength:)</code>，将字符串截断到指定长度，并添加省略号</li>
<li>实现一个下标，接受<code>Character</code>类型，返回该字符在字符串中出现的次数</li>
</ul>
</li>
<li><p><strong>为Array类型添加扩展</strong>：</p>
<ul>
<li>实现一个方法<code>removeDuplicates()</code>，移除数组中的重复元素（保持原顺序）</li>
<li>实现一个计算属性<code>average</code>，计算数组中所有元素的平均值（只适用于数值类型）</li>
<li>实现一个方法<code>randomElement()</code>，返回数组中的随机元素</li>
</ul>
</li>
</ol>
<h3 id="2-泛型基础练习"><a href="#2-泛型基础练习" class="headerlink" title="2. 泛型基础练习"></a>2. 泛型基础练习</h3><ol>
<li><p><strong>实现泛型栈</strong>：</p>
<ul>
<li>创建一个泛型的<code>Stack</code>结构体，包含<code>push</code>、<code>pop</code>、<code>peek</code>等方法</li>
<li>为<code>Stack</code>实现<code>Sequence</code>协议，支持<code>for-in</code>循环遍历</li>
<li>添加一个类型方法<code>fromArray(_:)</code>，从普通数组创建栈</li>
</ul>
</li>
<li><p><strong>实现泛型队列</strong>：</p>
<ul>
<li>创建一个泛型的<code>Queue</code>结构体，包含<code>enqueue</code>、<code>dequeue</code>、<code>front</code>等方法</li>
<li>为<code>Queue</code>添加扩展，实现<code>map</code>和<code>filter</code>方法</li>
<li>实现一个泛型函数，比较两个队列是否包含相同的元素序列</li>
</ul>
</li>
</ol>
<h3 id="3-高级应用练习"><a href="#3-高级应用练习" class="headerlink" title="3. 高级应用练习"></a>3. 高级应用练习</h3><ol>
<li><p><strong>实现类型擦除</strong>：</p>
<ul>
<li>定义一个<code>GeneratorProtocol</code>泛型协议，包含<code>next()</code>方法</li>
<li>实现几个遵循该协议的具体类型（如<code>IntGenerator</code>、<code>StringGenerator</code>）</li>
<li>创建一个<code>AnyGenerator</code>类型擦除结构体，允许将不同类型的生成器放入同一个数组</li>
</ul>
</li>
<li><p><strong>实现条件协议扩展</strong>：</p>
<ul>
<li>定义一个<code>Persistable</code>协议，包含<code>save()</code>和<code>load()</code>方法</li>
<li>实现一个泛型的<code>FileStorage</code>结构体，遵循该协议</li>
<li>为协议添加条件扩展，只有当存储的类型是<code>Codable</code>时，添加<code>jsonEncode()</code>方法</li>
<li>为协议添加条件扩展，只有当存储的类型是<code>Equatable</code>时，添加<code>contains()</code>方法</li>
</ul>
</li>
</ol>
<h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><p>在这篇学习日记中，我们深入探讨了Swift的扩展和泛型：</p>
<ol>
<li><p><strong>扩展</strong>：</p>
<ul>
<li>基本语法，使用<code>extension</code>关键字</li>
<li>添加计算属性（包括实例属性和类型属性）</li>
<li>添加方法（包括实例方法和类型方法）</li>
<li>添加初始化器（只能添加便捷初始化器）</li>
<li>添加下标</li>
<li>添加嵌套类型</li>
<li>扩展协议，添加默认实现</li>
</ul>
</li>
<li><p><strong>泛型</strong>：</p>
<ul>
<li>泛型函数，使用类型参数<code>&lt;T&gt;</code></li>
<li>泛型类型（类、结构体、枚举）</li>
<li>类型约束，限制泛型类型可以接受的类型</li>
<li>关联类型，在协议中定义占位符类型</li>
<li>泛型扩展，为泛型类型添加新功能</li>
<li>高级类型约束，使用<code>where</code>子句</li>
</ul>
</li>
<li><p><strong>应用场景</strong>：</p>
<ul>
<li>扩展用于为已有类型添加新功能，提高代码复用性</li>
<li>泛型用于编写灵活、可重用的代码，提高类型安全</li>
</ul>
</li>
</ol>
<p>通过补充的内容机制与知识点总结、遇到的问题及解决方案和高阶用法章节，我们更加全面地理解了Swift扩展和泛型的核心概念和高级应用。扩展和泛型是Swift的两个核心特性，它们使得Swift代码更加灵活、可重用和类型安全。掌握扩展和泛型对于开发高质量的Swift应用程序至关重要。在下一篇学习日记中，我们将继续学习Swift的高级特性，包括错误处理。</p>
]]></content>
      <tags>
        <tag>swift</tag>
      </tags>
  </entry>
  <entry>
    <title>swift学习日记(五)</title>
    <url>/ios.github.io/2025/12/07/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Swift学习日记（五）：面向对象编程（类与结构体）"><a href="#Swift学习日记（五）：面向对象编程（类与结构体）" class="headerlink" title="Swift学习日记（五）：面向对象编程（类与结构体）"></a>Swift学习日记（五）：面向对象编程（类与结构体）</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>面向对象编程（OOP）是一种编程范式，它将数据和操作数据的方法组织在一起，形成对象。Swift支持多种面向对象编程特性，包括类、结构体、属性、方法、继承、构造函数等。在上一篇学习日记中，我们已经了解了Swift的函数和闭包。在这篇日记中，我们将深入探讨Swift的类和结构体，这是面向对象编程的基础。</p>
<h2 id="二、类与结构体的定义"><a href="#二、类与结构体的定义" class="headerlink" title="二、类与结构体的定义"></a>二、类与结构体的定义</h2><p>类和结构体是Swift中用于创建自定义数据类型的两种主要方式，它们有很多相似之处，但也有一些重要的区别。</p>
<h3 id="1-结构体的定义"><a href="#1-结构体的定义" class="headerlink" title="1. 结构体的定义"></a>1. 结构体的定义</h3><p>结构体的定义使用<code>struct</code>关键字：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个结构体</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="comment">// 存储属性</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算属性</span></span><br><span class="line">    <span class="keyword">var</span> isAdult: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age <span class="operator">&gt;=</span> <span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(name)</span>，今年<span class="subst">\(age)</span>岁。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建结构体实例</span></span><br><span class="line"><span class="keyword">var</span> person <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问属性</span></span><br><span class="line"><span class="built_in">print</span>(person.name) <span class="comment">// 输出：张三</span></span><br><span class="line"><span class="built_in">print</span>(person.age) <span class="comment">// 输出：20</span></span><br><span class="line"><span class="built_in">print</span>(person.isAdult) <span class="comment">// 输出：true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用方法</span></span><br><span class="line"><span class="built_in">print</span>(person.greet()) <span class="comment">// 输出：你好，我是张三，今年20岁。</span></span><br></pre></td></tr></table></figure>

<h3 id="2-类的定义"><a href="#2-类的定义" class="headerlink" title="2. 类的定义"></a>2. 类的定义</h3><p>类的定义使用<code>class</code>关键字：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="comment">// 存储属性</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> studentID: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算属性</span></span><br><span class="line">    <span class="keyword">var</span> isAdult: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age <span class="operator">&gt;=</span> <span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(name)</span>，今年<span class="subst">\(age)</span>岁，学号是<span class="subst">\(studentID)</span>。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>, <span class="params">studentID</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">        <span class="keyword">self</span>.studentID <span class="operator">=</span> studentID</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建类实例</span></span><br><span class="line"><span class="keyword">let</span> student <span class="operator">=</span> <span class="type">Student</span>(name: <span class="string">&quot;李四&quot;</span>, age: <span class="number">22</span>, studentID: <span class="string">&quot;20210001&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问属性</span></span><br><span class="line"><span class="built_in">print</span>(student.name) <span class="comment">// 输出：李四</span></span><br><span class="line"><span class="built_in">print</span>(student.age) <span class="comment">// 输出：22</span></span><br><span class="line"><span class="built_in">print</span>(student.studentID) <span class="comment">// 输出：20210001</span></span><br><span class="line"><span class="built_in">print</span>(student.isAdult) <span class="comment">// 输出：true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用方法</span></span><br><span class="line"><span class="built_in">print</span>(student.greet()) <span class="comment">// 输出：你好，我是李四，今年22岁，学号是20210001。</span></span><br></pre></td></tr></table></figure>

<!-- CATEGORY: 面向对象编程 -->
<!-- INTERVIEW_TOPIC: 类与结构体的区别 -->
<!-- HIGH_FREQUENCY_INTERVIEW: 值类型与引用类型 -->

<h2 id="三、类与结构体的区别"><a href="#三、类与结构体的区别" class="headerlink" title="三、类与结构体的区别"></a>三、类与结构体的区别</h2><p>虽然类和结构体有很多相似之处，但它们有以下几个重要的区别：</p>
<h3 id="1-值类型-vs-引用类型"><a href="#1-值类型-vs-引用类型" class="headerlink" title="1. 值类型 vs 引用类型"></a>1. 值类型 vs 引用类型</h3><ul>
<li><strong>结构体</strong>是值类型，当它被赋值给一个变量或常量，或者被传递给一个函数时，会被复制一份</li>
<li><strong>类</strong>是引用类型，当它被赋值给一个变量或常量，或者被传递给一个函数时，只会传递引用，不会复制</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 结构体示例（值类型）</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> y: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> point1 <span class="operator">=</span> <span class="type">Point</span>(x: <span class="number">10</span>, y: <span class="number">20</span>)</span><br><span class="line"><span class="keyword">var</span> point2 <span class="operator">=</span> point1 <span class="comment">// 复制一份</span></span><br><span class="line">point2.x <span class="operator">=</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(point1.x) <span class="comment">// 输出：10</span></span><br><span class="line"><span class="built_in">print</span>(point2.x) <span class="comment">// 输出：30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类示例（引用类型）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> person2 <span class="operator">=</span> person1 <span class="comment">// 传递引用</span></span><br><span class="line">person2.name <span class="operator">=</span> <span class="string">&quot;李四&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(person1.name) <span class="comment">// 输出：李四</span></span><br><span class="line"><span class="built_in">print</span>(person2.name) <span class="comment">// 输出：李四</span></span><br></pre></td></tr></table></figure>

<h3 id="2-继承"><a href="#2-继承" class="headerlink" title="2. 继承"></a>2. 继承</h3><ul>
<li><strong>类</strong>支持继承，可以从一个基类继承属性和方法</li>
<li><strong>结构体</strong>不支持继承</li>
</ul>
<h3 id="3-类型转换"><a href="#3-类型转换" class="headerlink" title="3. 类型转换"></a>3. 类型转换</h3><ul>
<li><strong>类</strong>支持类型转换，可以在运行时检查和转换类实例的类型</li>
<li><strong>结构体</strong>不支持类型转换</li>
</ul>
<h3 id="4-析构函数"><a href="#4-析构函数" class="headerlink" title="4. 析构函数"></a>4. 析构函数</h3><ul>
<li><strong>类</strong>可以定义析构函数，在实例被销毁前执行清理工作</li>
<li><strong>结构体</strong>不可以定义析构函数</li>
</ul>
<h3 id="5-引用计数"><a href="#5-引用计数" class="headerlink" title="5. 引用计数"></a>5. 引用计数</h3><ul>
<li><strong>类</strong>实例的内存管理通过引用计数实现</li>
<li><strong>结构体</strong>实例没有引用计数，因为它们是值类型</li>
</ul>
<!-- INTERVIEW_TOPIC: 属性 -->
<!-- HIGH_FREQUENCY_INTERVIEW: 存储属性与计算属性 -->

<h2 id="四、属性"><a href="#四、属性" class="headerlink" title="四、属性"></a>四、属性</h2><p>属性是与类、结构体或枚举关联的值。Swift提供了两种类型的属性：存储属性和计算属性。</p>
<h3 id="1-存储属性"><a href="#1-存储属性" class="headerlink" title="1. 存储属性"></a>1. 存储属性</h3><p>存储属性是实际存储在类或结构体实例中的值：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="comment">// 可变存储属性</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 不可变存储属性</span></span><br><span class="line">    <span class="keyword">let</span> gender: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">20</span>, gender: <span class="string">&quot;男&quot;</span>)</span><br><span class="line">person.name <span class="operator">=</span> <span class="string">&quot;李四&quot;</span> <span class="comment">// 可以修改</span></span><br><span class="line">person.age <span class="operator">=</span> <span class="number">21</span> <span class="comment">// 可以修改</span></span><br><span class="line"><span class="comment">// person.gender = &quot;女&quot; // 错误，不可变存储属性不能修改</span></span><br></pre></td></tr></table></figure>

<h3 id="2-计算属性"><a href="#2-计算属性" class="headerlink" title="2. 计算属性"></a>2. 计算属性</h3><p>计算属性不存储值，而是提供一个getter和可选的setter，用于计算值：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只读计算属性</span></span><br><span class="line">    <span class="keyword">var</span> area: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Double</span>.pi <span class="operator">*</span> radius <span class="operator">*</span> radius</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读写计算属性</span></span><br><span class="line">    <span class="keyword">var</span> diameter: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> radius <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>(newDiameter) &#123;</span><br><span class="line">            radius <span class="operator">=</span> newDiameter <span class="operator">/</span> <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> circle <span class="operator">=</span> <span class="type">Circle</span>(radius: <span class="number">5.0</span>)</span><br><span class="line"><span class="built_in">print</span>(circle.area) <span class="comment">// 输出：78.53981633974483</span></span><br><span class="line"><span class="built_in">print</span>(circle.diameter) <span class="comment">// 输出：10.0</span></span><br><span class="line"></span><br><span class="line">circle.diameter <span class="operator">=</span> <span class="number">12.0</span></span><br><span class="line"><span class="built_in">print</span>(circle.radius) <span class="comment">// 输出：6.0</span></span><br><span class="line"><span class="built_in">print</span>(circle.area) <span class="comment">// 输出：113.09733552923255</span></span><br></pre></td></tr></table></figure>

<h3 id="3-属性观察器"><a href="#3-属性观察器" class="headerlink" title="3. 属性观察器"></a>3. 属性观察器</h3><p>属性观察器用于监测属性值的变化，可以在属性值即将改变或已经改变时执行代码：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span>(newName) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;姓名即将从<span class="subst">\(name)</span>变为<span class="subst">\(newName)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span>(oldName) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;姓名已经从<span class="subst">\(oldName)</span>变为<span class="subst">\(name)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span>(newAge) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;年龄即将从<span class="subst">\(age)</span>变为<span class="subst">\(newAge)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span>(oldAge) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;年龄已经从<span class="subst">\(oldAge)</span>变为<span class="subst">\(age)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">20</span>)</span><br><span class="line">person.name <span class="operator">=</span> <span class="string">&quot;李四&quot;</span></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// 姓名即将从张三变为李四</span></span><br><span class="line"><span class="comment">// 姓名已经从张三变为李四</span></span><br><span class="line"></span><br><span class="line">person.age <span class="operator">=</span> <span class="number">21</span></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// 年龄即将从20变为21</span></span><br><span class="line"><span class="comment">// 年龄已经从20变为21</span></span><br></pre></td></tr></table></figure>

<h3 id="4-类型属性"><a href="#4-类型属性" class="headerlink" title="4. 类型属性"></a>4. 类型属性</h3><p>类型属性是与类型本身关联的属性，而不是与类型的实例关联。使用<code>static</code>关键字定义：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Math</span> &#123;</span><br><span class="line">    <span class="comment">// 类型常量</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> pi <span class="operator">=</span> <span class="number">3.141592653589793</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> e <span class="operator">=</span> <span class="number">2.718281828459045</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型变量</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> calculationCount <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">incrementCalculationCount</span>() &#123;</span><br><span class="line">        calculationCount <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Math</span>.pi) <span class="comment">// 输出：3.141592653589793</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Math</span>.e) <span class="comment">// 输出：2.718281828459045</span></span><br><span class="line"></span><br><span class="line"><span class="type">Math</span>.incrementCalculationCount()</span><br><span class="line"><span class="built_in">print</span>(<span class="type">Math</span>.calculationCount) <span class="comment">// 输出：1</span></span><br></pre></td></tr></table></figure>

<p>对于类，还可以使用<code>class</code>关键字定义可被子类重写的类型属性：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BaseClass</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BaseClass&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubClass</span>: <span class="title class_ inherited__">BaseClass</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">class</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SubClass&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="type">BaseClass</span>.description) <span class="comment">// 输出：BaseClass</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">SubClass</span>.description) <span class="comment">// 输出：SubClass</span></span><br></pre></td></tr></table></figure>

<h2 id="五、方法"><a href="#五、方法" class="headerlink" title="五、方法"></a>五、方法</h2><p>方法是与类、结构体或枚举关联的函数。</p>
<h3 id="1-实例方法"><a href="#1-实例方法" class="headerlink" title="1. 实例方法"></a>1. 实例方法</h3><p>实例方法是属于类或结构体实例的方法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(name)</span>，今年<span class="subst">\(age)</span>岁。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 修改实例属性的实例方法，需要使用mutating关键字</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">celebrateBirthday</span>() &#123;</span><br><span class="line">        age <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;生日快乐！现在<span class="subst">\(name)</span><span class="subst">\(age)</span>岁了。&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(person.greet()) <span class="comment">// 输出：你好，我是张三，今年20岁。</span></span><br><span class="line">person.celebrateBirthday() <span class="comment">// 输出：生日快乐！现在张三21岁了。</span></span><br><span class="line"><span class="built_in">print</span>(person.age) <span class="comment">// 输出：21</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：在结构体的实例方法中修改实例属性，需要使用<code>mutating</code>关键字，而类的实例方法不需要。</p>
<h3 id="2-类型方法"><a href="#2-类型方法" class="headerlink" title="2. 类型方法"></a>2. 类型方法</h3><p>类型方法是属于类或结构体类型本身的方法，使用<code>static</code>关键字定义：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Math</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> pi <span class="operator">=</span> <span class="number">3.141592653589793</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">circleArea</span>(<span class="params">radius</span>: <span class="type">Double</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pi <span class="operator">*</span> radius <span class="operator">*</span> radius</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">circleCircumference</span>(<span class="params">radius</span>: <span class="type">Double</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> <span class="operator">*</span> pi <span class="operator">*</span> radius</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Math</span>.circleArea(radius: <span class="number">5.0</span>)) <span class="comment">// 输出：78.53981633974483</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Math</span>.circleCircumference(radius: <span class="number">5.0</span>)) <span class="comment">// 输出：31.41592653589793</span></span><br></pre></td></tr></table></figure>

<p>对于类，还可以使用<code>class</code>关键字定义可被子类重写的类型方法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BaseClass</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="keyword">func</span> <span class="title function_">hello</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hello from BaseClass&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubClass</span>: <span class="title class_ inherited__">BaseClass</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">class</span> <span class="keyword">func</span> <span class="title function_">hello</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hello from SubClass&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">BaseClass</span>.hello() <span class="comment">// 输出：Hello from BaseClass</span></span><br><span class="line"><span class="type">SubClass</span>.hello() <span class="comment">// 输出：Hello from SubClass</span></span><br></pre></td></tr></table></figure>

<h2 id="六、构造函数"><a href="#六、构造函数" class="headerlink" title="六、构造函数"></a>六、构造函数</h2><p>构造函数是用于创建类或结构体实例的特殊方法。</p>
<h3 id="1-结构体的构造函数"><a href="#1-结构体的构造函数" class="headerlink" title="1. 结构体的构造函数"></a>1. 结构体的构造函数</h3><p>结构体默认提供了逐一成员构造函数：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用逐一成员构造函数创建实例</span></span><br><span class="line"><span class="keyword">var</span> person <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>也可以自定义构造函数：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自定义构造函数</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 另一个自定义构造函数</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用自定义构造函数创建实例</span></span><br><span class="line"><span class="keyword">var</span> baby <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;宝宝&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(baby.age) <span class="comment">// 输出：0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> adult <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(adult.age) <span class="comment">// 输出：20</span></span><br></pre></td></tr></table></figure>

<h3 id="2-类的构造函数"><a href="#2-类的构造函数" class="headerlink" title="2. 类的构造函数"></a>2. 类的构造函数</h3><p>类的构造函数需要初始化所有存储属性：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自定义构造函数</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>类还支持指定构造函数和便利构造函数：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 指定构造函数</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 便利构造函数，调用指定构造函数</span></span><br><span class="line">    <span class="keyword">convenience</span> <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(name: name, age: <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> baby <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;宝宝&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(baby.age) <span class="comment">// 输出：0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> adult <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(adult.age) <span class="comment">// 输出：20</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：便利构造函数需要使用<code>convenience</code>关键字，并且必须调用同一个类中的指定构造函数。</p>
<h2 id="七、继承"><a href="#七、继承" class="headerlink" title="七、继承"></a>七、继承</h2><p>继承是面向对象编程的一个重要特性，它允许一个类（子类）继承另一个类（父类）的属性和方法。</p>
<h3 id="1-基本继承"><a href="#1-基本继承" class="headerlink" title="1. 基本继承"></a>1. 基本继承</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(name)</span>，今年<span class="subst">\(age)</span>岁。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类，继承自Person</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>: <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> studentID: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 子类的构造函数，需要调用父类的构造函数</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>, <span class="params">studentID</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.studentID <span class="operator">=</span> studentID</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name, age: age) <span class="comment">// 调用父类的构造函数</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重写父类的方法</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是学生<span class="subst">\(name)</span>，今年<span class="subst">\(age)</span>岁，学号是<span class="subst">\(studentID)</span>。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> student <span class="operator">=</span> <span class="type">Student</span>(name: <span class="string">&quot;李四&quot;</span>, age: <span class="number">22</span>, studentID: <span class="string">&quot;20210001&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(student.greet()) <span class="comment">// 输出：你好，我是学生李四，今年22岁，学号是20210001。</span></span><br></pre></td></tr></table></figure>

<h3 id="2-重写属性"><a href="#2-重写属性" class="headerlink" title="2. 重写属性"></a>2. 重写属性</h3><p>子类可以重写父类的计算属性：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">age</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> isAdult: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age <span class="operator">&gt;=</span> <span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>: <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">    <span class="comment">// 重写计算属性</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> isAdult: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age <span class="operator">&gt;=</span> <span class="number">20</span> <span class="comment">// 学生的成年标准提高到20岁</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person <span class="operator">=</span> <span class="type">Person</span>(age: <span class="number">19</span>)</span><br><span class="line"><span class="keyword">let</span> student <span class="operator">=</span> <span class="type">Student</span>(age: <span class="number">19</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(person.isAdult) <span class="comment">// 输出：true</span></span><br><span class="line"><span class="built_in">print</span>(student.isAdult) <span class="comment">// 输出：false</span></span><br></pre></td></tr></table></figure>

<h3 id="3-防止重写"><a href="#3-防止重写" class="headerlink" title="3. 防止重写"></a>3. 防止重写</h3><p>可以使用<code>final</code>关键字防止类、属性或方法被重写：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// final类，不能被继承</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">FinalClass</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误，不能继承final类</span></span><br><span class="line"><span class="comment">// class SubClass: FinalClass &#123;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// final方法，不能被重写</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">func</span> <span class="title function_">introduce</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我是<span class="subst">\(name)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// final属性，不能被重写</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">var</span> fullName: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、析构函数"><a href="#八、析构函数" class="headerlink" title="八、析构函数"></a>八、析构函数</h2><p>析构函数是在类实例被销毁前执行的方法，用于执行清理工作。只有类可以定义析构函数。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FileHandler</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> fileName: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">fileName</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.fileName <span class="operator">=</span> fileName</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;打开文件：<span class="subst">\(fileName)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">readFile</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;读取文件内容&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 析构函数</span></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;关闭文件：<span class="subst">\(fileName)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">processFile</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> fileHandler <span class="operator">=</span> <span class="type">FileHandler</span>(fileName: <span class="string">&quot;test.txt&quot;</span>)</span><br><span class="line">    fileHandler.readFile()</span><br><span class="line">    <span class="comment">// fileHandler在这里超出作用域，会被销毁</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">processFile()</span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// 打开文件：test.txt</span></span><br><span class="line"><span class="comment">// 读取文件内容</span></span><br><span class="line"><span class="comment">// 关闭文件：test.txt</span></span><br></pre></td></tr></table></figure>

<h2 id="九、内容机制与知识点总结"><a href="#九、内容机制与知识点总结" class="headerlink" title="九、内容机制与知识点总结"></a>九、内容机制与知识点总结</h2><h3 id="1-Swift面向对象编程的设计原则"><a href="#1-Swift面向对象编程的设计原则" class="headerlink" title="1. Swift面向对象编程的设计原则"></a>1. Swift面向对象编程的设计原则</h3><p>Swift的面向对象编程支持体现了几个核心设计原则：</p>
<ul>
<li><strong>类型安全</strong>：通过严格的类型检查确保代码的可靠性和安全性</li>
<li><strong>值类型优先</strong>：鼓励使用结构体等值类型，减少引用类型带来的复杂性</li>
<li><strong>灵活性</strong>：同时支持类和结构体，开发者可以根据需要选择合适的类型</li>
<li><strong>继承与多态</strong>：通过类的继承和方法重写实现多态行为</li>
<li><strong>内存安全</strong>：通过引用计数和自动内存管理确保内存使用的安全性</li>
</ul>
<h3 id="2-核心知识点总结"><a href="#2-核心知识点总结" class="headerlink" title="2. 核心知识点总结"></a>2. 核心知识点总结</h3><table>
<thead>
<tr>
<th>概念</th>
<th>描述</th>
<th>适用类型</th>
</tr>
</thead>
<tbody><tr>
<td>存储属性</td>
<td>实际存储在实例中的值</td>
<td>类、结构体</td>
</tr>
<tr>
<td>计算属性</td>
<td>不存储值，而是通过getter&#x2F;setter计算值</td>
<td>类、结构体、枚举</td>
</tr>
<tr>
<td>属性观察器</td>
<td>监测属性值变化并执行代码</td>
<td>类、结构体</td>
</tr>
<tr>
<td>类型属性</td>
<td>与类型本身关联的属性，而非实例</td>
<td>类、结构体、枚举</td>
</tr>
<tr>
<td>实例方法</td>
<td>属于类或结构体实例的方法</td>
<td>类、结构体</td>
</tr>
<tr>
<td>类型方法</td>
<td>属于类或结构体类型本身的方法</td>
<td>类、结构体</td>
</tr>
<tr>
<td>构造函数</td>
<td>创建类或结构体实例的特殊方法</td>
<td>类、结构体</td>
</tr>
<tr>
<td>指定构造函数</td>
<td>负责初始化所有属性的构造函数</td>
<td>类</td>
</tr>
<tr>
<td>便利构造函数</td>
<td>调用其他构造函数的辅助构造函数</td>
<td>类</td>
</tr>
<tr>
<td>继承</td>
<td>子类继承父类的属性和方法</td>
<td>类</td>
</tr>
<tr>
<td>方法重写</td>
<td>子类重新实现父类的方法</td>
<td>类</td>
</tr>
<tr>
<td>析构函数</td>
<td>实例销毁前执行的清理方法</td>
<td>类</td>
</tr>
</tbody></table>
<h2 id="十、遇到的问题及解决方案"><a href="#十、遇到的问题及解决方案" class="headerlink" title="十、遇到的问题及解决方案"></a>十、遇到的问题及解决方案</h2><h3 id="1-结构体实例方法无法修改属性"><a href="#1-结构体实例方法无法修改属性" class="headerlink" title="1. 结构体实例方法无法修改属性"></a>1. 结构体实例方法无法修改属性</h3><p><strong>问题</strong>：在结构体的实例方法中尝试修改属性时，出现编译错误。</p>
<p><strong>解决方案</strong>：在结构体的实例方法前添加<code>mutating</code>关键字。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加mutating关键字</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">celebrateBirthday</span>() &#123;</span><br><span class="line">        age <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-子类构造函数未初始化所有属性"><a href="#2-子类构造函数未初始化所有属性" class="headerlink" title="2. 子类构造函数未初始化所有属性"></a>2. 子类构造函数未初始化所有属性</h3><p><strong>问题</strong>：在子类的构造函数中，编译错误提示未初始化所有属性。</p>
<p><strong>解决方案</strong>：确保先初始化子类特有的属性，然后调用父类的构造函数。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>: <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> studentID: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>, <span class="params">studentID</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.studentID <span class="operator">=</span> studentID  <span class="comment">// 先初始化子类属性</span></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name, age: age)  <span class="comment">// 再调用父类构造函数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-引用类型的意外修改"><a href="#3-引用类型的意外修改" class="headerlink" title="3. 引用类型的意外修改"></a>3. 引用类型的意外修改</h3><p><strong>问题</strong>：修改一个类实例会影响到所有引用该实例的变量。</p>
<p><strong>解决方案</strong>：如果需要独立的副本，可以实现<code>NSCopying</code>协议或手动创建副本方法。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>: <span class="title class_ inherited__">NSCopying</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">copy</span>(<span class="params">with</span> <span class="params">zone</span>: <span class="type">NSZone</span>? <span class="operator">=</span> <span class="literal">nil</span>) -&gt; <span class="keyword">Any</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Person</span>(name: <span class="keyword">self</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用副本</span></span><br><span class="line"><span class="keyword">let</span> person1 <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> person2 <span class="operator">=</span> person1.copy() <span class="keyword">as!</span> <span class="type">Person</span></span><br><span class="line">person2.name <span class="operator">=</span> <span class="string">&quot;李四&quot;</span> <span class="comment">// 不会影响person1</span></span><br></pre></td></tr></table></figure>

<h3 id="4-属性观察器不触发"><a href="#4-属性观察器不触发" class="headerlink" title="4. 属性观察器不触发"></a>4. 属性观察器不触发</h3><p><strong>问题</strong>：计算属性的setter被调用，但属性观察器没有触发。</p>
<p><strong>解决方案</strong>：属性观察器只对存储属性有效，计算属性可以在setter中直接添加观察逻辑。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;半径即将从<span class="subst">\(radius)</span>变为<span class="subst">\(newValue)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> diameter: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> radius <span class="operator">*</span> <span class="number">2</span> &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="comment">// 手动添加观察逻辑</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;直径即将从<span class="subst">\(diameter)</span>变为<span class="subst">\(newValue)</span>&quot;</span>)</span><br><span class="line">            radius <span class="operator">=</span> newValue <span class="operator">/</span> <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-内存泄漏"><a href="#5-内存泄漏" class="headerlink" title="5. 内存泄漏"></a>5. 内存泄漏</h3><p><strong>问题</strong>：类实例之间的循环引用导致内存泄漏。</p>
<p><strong>解决方案</strong>：使用<code>weak</code>或<code>unowned</code>关键字打破循环引用。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> apartment: <span class="type">Apartment</span>?  <span class="comment">// 使用weak</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Apartment</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> number: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> tenant: <span class="type">Person</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">number</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.number <span class="operator">=</span> number</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十一、高阶用法"><a href="#十一、高阶用法" class="headerlink" title="十一、高阶用法"></a>十一、高阶用法</h2><h3 id="1-高级属性技巧"><a href="#1-高级属性技巧" class="headerlink" title="1. 高级属性技巧"></a>1. 高级属性技巧</h3><h4 id="1-1-延迟存储属性"><a href="#1-1-延迟存储属性" class="headerlink" title="1.1 延迟存储属性"></a>1.1 延迟存储属性</h4><p>延迟存储属性在第一次访问时才会计算其初始值，适用于需要大量计算或依赖外部条件的属性。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataManager</span> &#123;</span><br><span class="line">    <span class="comment">// 延迟加载，第一次访问时才会创建</span></span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">var</span> largeDataSet: [<span class="type">Int</span>] <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟耗时操作</span></span><br><span class="line">        <span class="keyword">var</span> data <span class="operator">=</span> [<span class="type">Int</span>]()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">10000</span> &#123;</span><br><span class="line">            data.append(i)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> manager <span class="operator">=</span> <span class="type">DataManager</span>()</span><br><span class="line"><span class="comment">// largeDataSet尚未创建</span></span><br><span class="line"><span class="built_in">print</span>(manager.largeDataSet.count) <span class="comment">// 此时才创建并初始化</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-类型属性的高级应用"><a href="#1-2-类型属性的高级应用" class="headerlink" title="1.2 类型属性的高级应用"></a>1.2 类型属性的高级应用</h4><p>类型属性可以用于实现单例模式或共享状态。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">AppConfig</span>()  <span class="comment">// 单例</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;&#125;  <span class="comment">// 防止外部创建实例</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> apiKey: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> baseURL: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;https://api.example.com&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型计算属性</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> isDebug: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">#if</span> <span class="type">DEBUG</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">#else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">#endif</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用单例</span></span><br><span class="line"><span class="type">AppConfig</span>.shared.apiKey <span class="operator">=</span> <span class="string">&quot;your-api-key&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">AppConfig</span>.shared.baseURL)</span><br><span class="line"><span class="built_in">print</span>(<span class="type">AppConfig</span>.isDebug)  <span class="comment">// 直接访问类型属性</span></span><br></pre></td></tr></table></figure>

<h3 id="2-高级方法技巧"><a href="#2-高级方法技巧" class="headerlink" title="2. 高级方法技巧"></a>2. 高级方法技巧</h3><h4 id="2-1-方法的多重参数标签"><a href="#2-1-方法的多重参数标签" class="headerlink" title="2.1 方法的多重参数标签"></a>2.1 方法的多重参数标签</h4><p>Swift支持为方法参数提供外部标签和内部标签，提高代码的可读性。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">add</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="params">to</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a <span class="operator">+</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">multiply</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="params">by</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a <span class="operator">*</span> b</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> calc <span class="operator">=</span> <span class="type">Calculator</span>()</span><br><span class="line">calc.add(<span class="number">5</span>, to: <span class="number">3</span>)  <span class="comment">// 更具可读性</span></span><br><span class="line">calc.multiply(<span class="number">5</span>, by: <span class="number">3</span>)  <span class="comment">// 更具可读性</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-下标方法"><a href="#2-2-下标方法" class="headerlink" title="2.2 下标方法"></a>2.2 下标方法</h4><p>下标方法允许通过<code>instance[key]</code>语法访问实例的元素，类似于数组和字典。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Matrix</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> rows: <span class="type">Int</span>, columns: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> grid: [<span class="type">Double</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">rows</span>: <span class="type">Int</span>, <span class="params">columns</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.rows <span class="operator">=</span> rows</span><br><span class="line">        <span class="keyword">self</span>.columns <span class="operator">=</span> columns</span><br><span class="line">        <span class="keyword">self</span>.grid <span class="operator">=</span> <span class="type">Array</span>(repeating: <span class="number">0.0</span>, count: rows <span class="operator">*</span> columns)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下标方法</span></span><br><span class="line">    <span class="keyword">subscript</span>(<span class="params">row</span>: <span class="type">Int</span>, <span class="params">column</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="built_in">assert</span>(row <span class="operator">&gt;=</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> row <span class="operator">&lt;</span> rows <span class="operator">&amp;&amp;</span> column <span class="operator">&gt;=</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> column <span class="operator">&lt;</span> columns, <span class="string">&quot;索引超出范围&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> grid[row <span class="operator">*</span> columns <span class="operator">+</span> column]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="built_in">assert</span>(row <span class="operator">&gt;=</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> row <span class="operator">&lt;</span> rows <span class="operator">&amp;&amp;</span> column <span class="operator">&gt;=</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> column <span class="operator">&lt;</span> columns, <span class="string">&quot;索引超出范围&quot;</span>)</span><br><span class="line">            grid[row <span class="operator">*</span> columns <span class="operator">+</span> column] <span class="operator">=</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用下标访问</span></span><br><span class="line"><span class="keyword">var</span> matrix <span class="operator">=</span> <span class="type">Matrix</span>(rows: <span class="number">2</span>, columns: <span class="number">2</span>)</span><br><span class="line">matrix[<span class="number">0</span>, <span class="number">0</span>] <span class="operator">=</span> <span class="number">1.0</span></span><br><span class="line">matrix[<span class="number">0</span>, <span class="number">1</span>] <span class="operator">=</span> <span class="number">2.0</span></span><br><span class="line">matrix[<span class="number">1</span>, <span class="number">0</span>] <span class="operator">=</span> <span class="number">3.0</span></span><br><span class="line">matrix[<span class="number">1</span>, <span class="number">1</span>] <span class="operator">=</span> <span class="number">4.0</span></span><br><span class="line"><span class="built_in">print</span>(matrix[<span class="number">0</span>, <span class="number">1</span>])  <span class="comment">// 输出：2.0</span></span><br></pre></td></tr></table></figure>

<h3 id="3-高级构造函数技巧"><a href="#3-高级构造函数技巧" class="headerlink" title="3. 高级构造函数技巧"></a>3. 高级构造函数技巧</h3><h4 id="3-1-可失败构造函数"><a href="#3-1-可失败构造函数" class="headerlink" title="3.1 可失败构造函数"></a>3.1 可失败构造函数</h4><p>可失败构造函数允许在条件不满足时返回<code>nil</code>，用于处理初始化可能失败的情况。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Temperature</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> celsius: <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可失败构造函数</span></span><br><span class="line">    <span class="keyword">init?</span>(<span class="params">celsius</span>: <span class="type">Double</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> celsius <span class="operator">&lt;</span> <span class="operator">-</span><span class="number">273.15</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>  <span class="comment">// 绝对零度以下无效</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.celsius <span class="operator">=</span> celsius</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 从华氏温度转换的可失败构造函数</span></span><br><span class="line">    <span class="keyword">init?</span>(<span class="params">fahrenheit</span>: <span class="type">Double</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> celsius <span class="operator">=</span> (fahrenheit <span class="operator">-</span> <span class="number">32</span>) <span class="operator">*</span> <span class="number">5</span><span class="operator">/</span><span class="number">9</span></span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(celsius: celsius)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用可失败构造函数</span></span><br><span class="line"><span class="keyword">let</span> roomTemp <span class="operator">=</span> <span class="type">Temperature</span>(celsius: <span class="number">25</span>)  <span class="comment">// Optional(Temperature)</span></span><br><span class="line"><span class="keyword">let</span> invalidTemp <span class="operator">=</span> <span class="type">Temperature</span>(celsius: <span class="operator">-</span><span class="number">300</span>)  <span class="comment">// nil</span></span><br><span class="line"><span class="keyword">let</span> hotTemp <span class="operator">=</span> <span class="type">Temperature</span>(fahrenheit: <span class="number">212</span>)  <span class="comment">// Optional(Temperature)</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-必要构造函数"><a href="#3-2-必要构造函数" class="headerlink" title="3.2 必要构造函数"></a>3.2 必要构造函数</h4><p>必要构造函数要求子类必须实现该构造函数，使用<code>required</code>关键字标记。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> wheels: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 必要构造函数</span></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(<span class="params">wheels</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.wheels <span class="operator">=</span> wheels</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>: <span class="title class_ inherited__">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> brand: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">wheels</span>: <span class="type">Int</span>, <span class="params">brand</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.brand <span class="operator">=</span> brand</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(wheels: wheels)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 子类必须实现必要构造函数</span></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(<span class="params">wheels</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.brand <span class="operator">=</span> <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(wheels: wheels)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-高级继承技巧"><a href="#4-高级继承技巧" class="headerlink" title="4. 高级继承技巧"></a>4. 高级继承技巧</h3><h4 id="4-1-类型检查与转换"><a href="#4-1-类型检查与转换" class="headerlink" title="4.1 类型检查与转换"></a>4.1 类型检查与转换</h4><p>使用<code>is</code>和<code>as</code>操作符进行类型检查和转换，实现多态行为。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeSound</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;动物发出声音&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>: <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">makeSound</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;汪汪汪&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">wagTail</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;摇尾巴&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>: <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">makeSound</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;喵喵喵&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型检查与转换</span></span><br><span class="line"><span class="keyword">let</span> animals: [<span class="type">Animal</span>] <span class="operator">=</span> [<span class="type">Dog</span>(), <span class="type">Cat</span>(), <span class="type">Dog</span>()]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> animal <span class="keyword">in</span> animals &#123;</span><br><span class="line">    animal.makeSound()  <span class="comment">// 多态行为</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> animal <span class="keyword">is</span> <span class="type">Dog</span> &#123;</span><br><span class="line">        <span class="comment">// 向下转换</span></span><br><span class="line">        <span class="keyword">let</span> dog <span class="operator">=</span> animal <span class="keyword">as!</span> <span class="type">Dog</span></span><br><span class="line">        dog.wagTail()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可选绑定转换</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> dog <span class="operator">=</span> animal <span class="keyword">as?</span> <span class="type">Dog</span> &#123;</span><br><span class="line">        dog.wagTail()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-协议与类的结合"><a href="#4-2-协议与类的结合" class="headerlink" title="4.2 协议与类的结合"></a>4.2 协议与类的结合</h4><p>结合协议和类实现更灵活的设计，使用<code>class</code>关键字限制协议只能被类实现。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只能被类实现的协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">Vehicle</span>: <span class="title class_ inherited__">AnyObject</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">start</span>()</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">stop</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>: <span class="title class_ inherited__">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">start</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;汽车启动&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">stop</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;汽车停止&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bike</span>: <span class="title class_ inherited__">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">start</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;自行车开始骑行&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">stop</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;自行车停止&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用协议类型</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">operateVehicle</span>(<span class="keyword">_</span> <span class="params">vehicle</span>: <span class="type">Vehicle</span>) &#123;</span><br><span class="line">    vehicle.start()</span><br><span class="line">    <span class="comment">// 执行操作</span></span><br><span class="line">    vehicle.stop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> car <span class="operator">=</span> <span class="type">Car</span>()</span><br><span class="line"><span class="keyword">let</span> bike <span class="operator">=</span> <span class="type">Bike</span>()</span><br><span class="line">operateVehicle(car)</span><br><span class="line">operateVehicle(bike)</span><br></pre></td></tr></table></figure>

<h3 id="5-性能优化策略"><a href="#5-性能优化策略" class="headerlink" title="5. 性能优化策略"></a>5. 性能优化策略</h3><h4 id="5-1-值类型与引用类型的选择"><a href="#5-1-值类型与引用类型的选择" class="headerlink" title="5.1 值类型与引用类型的选择"></a>5.1 值类型与引用类型的选择</h4><ul>
<li><strong>优先使用值类型</strong>（结构体、枚举）：当需要独立副本、数据简单时</li>
<li><strong>使用引用类型</strong>（类）：当需要继承、共享状态、复杂生命周期管理时</li>
</ul>
<h4 id="5-2-避免不必要的属性计算"><a href="#5-2-避免不必要的属性计算" class="headerlink" title="5.2 避免不必要的属性计算"></a>5.2 避免不必要的属性计算</h4><ul>
<li>使用延迟存储属性避免初始化时的昂贵计算</li>
<li>对频繁访问的计算属性考虑缓存结果</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ComplexObject</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> rawData: [<span class="type">Int</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 缓存计算结果</span></span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">var</span> processedData: [<span class="type">Int</span>] <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="comment">// 耗时的处理操作</span></span><br><span class="line">        <span class="keyword">return</span> rawData.map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="number">2</span> &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-内存管理优化"><a href="#5-3-内存管理优化" class="headerlink" title="5.3 内存管理优化"></a>5.3 内存管理优化</h4><ul>
<li>使用<code>weak</code>或<code>unowned</code>引用避免循环引用</li>
<li>及时清理不再需要的强引用</li>
<li>对于大对象，考虑使用<code>autoreleasepool</code>控制内存峰值</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">processLargeData</span>() &#123;</span><br><span class="line">    autoreleasepool &#123;</span><br><span class="line">        <span class="comment">// 创建和使用大对象</span></span><br><span class="line">        <span class="keyword">let</span> largeArray <span class="operator">=</span> <span class="type">Array</span>(repeating: <span class="string">&quot;data&quot;</span>, count: <span class="number">1000000</span>)</span><br><span class="line">        <span class="comment">// 处理largeArray</span></span><br><span class="line">    &#125; <span class="comment">// largeArray在此处被释放</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-最佳实践指南"><a href="#6-最佳实践指南" class="headerlink" title="6. 最佳实践指南"></a>6. 最佳实践指南</h3><ol>
<li><strong>遵循Swift API设计指南</strong>：使用清晰的命名和参数标签</li>
<li><strong>优先使用结构体</strong>：减少引用类型带来的复杂性</li>
<li><strong>合理使用访问控制</strong>：使用<code>private</code>、<code>internal</code>、<code>public</code>等关键字限制访问权限</li>
<li><strong>避免过度使用继承</strong>：考虑使用协议和组合代替继承</li>
<li><strong>实现<code>Equatable</code>和<code>Hashable</code>协议</strong>：为自定义类型提供比较和哈希功能</li>
<li><strong>使用<code>defer</code>语句</strong>：确保资源在合适的时机被清理</li>
<li><strong>编写文档注释</strong>：使用<code>///</code>为类、属性和方法添加文档</li>
</ol>
<h2 id="十二、实践练习"><a href="#十二、实践练习" class="headerlink" title="十二、实践练习"></a>十二、实践练习</h2><h3 id="1-类与结构体基础练习"><a href="#1-类与结构体基础练习" class="headerlink" title="1. 类与结构体基础练习"></a>1. 类与结构体基础练习</h3><h4 id="练习1：创建结构体"><a href="#练习1：创建结构体" class="headerlink" title="练习1：创建结构体"></a>练习1：创建结构体</h4><p>创建一个<code>Rectangle</code>结构体，包含<code>width</code>和<code>height</code>属性，以及计算面积的<code>area</code>方法。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> width: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> area: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width <span class="operator">*</span> height</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> rect <span class="operator">=</span> <span class="type">Rectangle</span>(width: <span class="number">5</span>, height: <span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;矩形面积：<span class="subst">\(rect.area)</span>&quot;</span>) <span class="comment">// 50.0</span></span><br></pre></td></tr></table></figure>

<h4 id="练习2：创建类"><a href="#练习2：创建类" class="headerlink" title="练习2：创建类"></a>练习2：创建类</h4><p>创建一个<code>Car</code>类，包含<code>brand</code>、<code>model</code>和<code>year</code>属性，以及<code>displayInfo</code>方法。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> brand: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> model: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> year: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">brand</span>: <span class="type">String</span>, <span class="params">model</span>: <span class="type">String</span>, <span class="params">year</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.brand <span class="operator">=</span> brand</span><br><span class="line">        <span class="keyword">self</span>.model <span class="operator">=</span> model</span><br><span class="line">        <span class="keyword">self</span>.year <span class="operator">=</span> year</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">displayInfo</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(year)</span> <span class="subst">\(brand)</span> <span class="subst">\(model)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> myCar <span class="operator">=</span> <span class="type">Car</span>(brand: <span class="string">&quot;Toyota&quot;</span>, model: <span class="string">&quot;Corolla&quot;</span>, year: <span class="number">2023</span>)</span><br><span class="line"><span class="built_in">print</span>(myCar.displayInfo()) <span class="comment">// 2023 Toyota Corolla</span></span><br></pre></td></tr></table></figure>

<h3 id="2-属性与方法练习"><a href="#2-属性与方法练习" class="headerlink" title="2. 属性与方法练习"></a>2. 属性与方法练习</h3><h4 id="练习3：属性观察器"><a href="#练习3：属性观察器" class="headerlink" title="练习3：属性观察器"></a>练习3：属性观察器</h4><p>创建一个<code>BankAccount</code>结构体，包含<code>balance</code>属性，使用属性观察器在余额变化时打印信息。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">BankAccount</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> balance: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;余额即将从<span class="subst">\(balance)</span>变为<span class="subst">\(newValue)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;余额已更新为<span class="subst">\(balance)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">deposit</span>(<span class="params">amount</span>: <span class="type">Double</span>) &#123;</span><br><span class="line">        balance <span class="operator">+=</span> amount</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">withdraw</span>(<span class="params">amount</span>: <span class="type">Double</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> amount <span class="operator">&lt;=</span> balance &#123;</span><br><span class="line">            balance <span class="operator">-=</span> amount</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;余额不足&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> account <span class="operator">=</span> <span class="type">BankAccount</span>(balance: <span class="number">1000</span>)</span><br><span class="line">account.deposit(amount: <span class="number">500</span>)   <span class="comment">// 余额即将从1000.0变为1500.0，余额已更新为1500.0</span></span><br><span class="line">account.withdraw(amount: <span class="number">200</span>)  <span class="comment">// 余额即将从1500.0变为1300.0，余额已更新为1300.0</span></span><br></pre></td></tr></table></figure>

<h4 id="练习4：类型方法"><a href="#练习4：类型方法" class="headerlink" title="练习4：类型方法"></a>练习4：类型方法</h4><p>创建一个<code>Math</code>类，包含静态方法<code>add</code>、<code>subtract</code>、<code>multiply</code>和<code>divide</code>。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Math</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">add</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Double</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Double</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a <span class="operator">+</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">subtract</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Double</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Double</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a <span class="operator">-</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">multiply</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Double</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Double</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a <span class="operator">*</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">divide</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Double</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Double</span>) -&gt; <span class="type">Double</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> b <span class="operator">!=</span> <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a <span class="operator">/</span> b</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Math</span>.add(<span class="number">5</span>, <span class="number">3</span>))           <span class="comment">// 8.0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Math</span>.subtract(<span class="number">10</span>, <span class="number">4</span>))     <span class="comment">// 6.0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Math</span>.multiply(<span class="number">6</span>, <span class="number">7</span>))      <span class="comment">// 42.0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Math</span>.divide(<span class="number">10</span>, <span class="number">2</span>) <span class="operator">??</span> <span class="number">0</span>)  <span class="comment">// 5.0</span></span><br></pre></td></tr></table></figure>

<h3 id="3-继承与多态练习"><a href="#3-继承与多态练习" class="headerlink" title="3. 继承与多态练习"></a>3. 继承与多态练习</h3><h4 id="练习5：继承"><a href="#练习5：继承" class="headerlink" title="练习5：继承"></a>练习5：继承</h4><p>创建一个<code>Animal</code>基类和<code>Dog</code>、<code>Cat</code>子类，实现方法重写。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeSound</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;动物发出声音&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>: <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">makeSound</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;汪汪汪&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">wagTail</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;摇尾巴&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>: <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">makeSound</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;喵喵喵&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">purr</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;咕噜咕噜&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> dog <span class="operator">=</span> <span class="type">Dog</span>(name: <span class="string">&quot;旺财&quot;</span>)</span><br><span class="line">dog.makeSound()  <span class="comment">// 汪汪汪</span></span><br><span class="line">dog.wagTail()    <span class="comment">// 摇尾巴</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat <span class="operator">=</span> <span class="type">Cat</span>(name: <span class="string">&quot;咪咪&quot;</span>)</span><br><span class="line">cat.makeSound()  <span class="comment">// 喵喵喵</span></span><br><span class="line">cat.purr()       <span class="comment">// 咕噜咕噜</span></span><br></pre></td></tr></table></figure>

<h4 id="练习6：多态"><a href="#练习6：多态" class="headerlink" title="练习6：多态"></a>练习6：多态</h4><p>创建一个<code>Shape</code>基类和<code>Circle</code>、<code>Square</code>子类，使用多态计算不同形状的面积。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">calculateArea</span>() -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>: <span class="title class_ inherited__">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">radius</span>: <span class="type">Double</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.radius <span class="operator">=</span> radius</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">calculateArea</span>() -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Double</span>.pi <span class="operator">*</span> radius <span class="operator">*</span> radius</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span>: <span class="title class_ inherited__">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> side: <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">side</span>: <span class="type">Double</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.side <span class="operator">=</span> side</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">calculateArea</span>() -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> side <span class="operator">*</span> side</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> shapes: [<span class="type">Shape</span>] <span class="operator">=</span> [<span class="type">Circle</span>(radius: <span class="number">5</span>), <span class="type">Square</span>(side: <span class="number">10</span>)]</span><br><span class="line"><span class="keyword">for</span> shape <span class="keyword">in</span> shapes &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;面积：<span class="subst">\(shape.calculateArea())</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// 面积：78.53981633974483</span></span><br><span class="line"><span class="comment">// 面积：100.0</span></span><br></pre></td></tr></table></figure>

<h2 id="十三、总结"><a href="#十三、总结" class="headerlink" title="十三、总结"></a>十三、总结</h2><p>在这篇学习日记中，我们深入探讨了Swift的面向对象编程特性，特别是类和结构体：</p>
<ol>
<li><p><strong>类与结构体的定义</strong>：使用<code>class</code>和<code>struct</code>关键字定义类和结构体，它们都可以包含属性和方法</p>
</li>
<li><p><strong>类与结构体的区别</strong>：结构体是值类型，类是引用类型；类支持继承，结构体不支持；类支持类型转换和析构函数，结构体不支持</p>
</li>
<li><p><strong>属性</strong>：包括存储属性、计算属性和属性观察器，用于访问和修改类或结构体的数据</p>
</li>
<li><p><strong>方法</strong>：包括实例方法和类型方法，用于定义类或结构体的行为</p>
</li>
<li><p><strong>构造函数</strong>：用于创建类或结构体实例，类支持指定构造函数和便利构造函数</p>
</li>
<li><p><strong>继承</strong>：子类可以继承父类的属性和方法，并可以重写它们</p>
</li>
<li><p><strong>析构函数</strong>：用于在类实例被销毁前执行清理工作</p>
</li>
</ol>
<p>通过补充的内容机制与知识点总结、遇到的问题及解决方案和高阶用法章节，我们更加全面地理解了Swift面向对象编程的核心概念和高级应用。类和结构体是Swift面向对象编程的基础，掌握它们对于开发高质量的Swift应用程序至关重要。在下一篇学习日记中，我们将继续学习Swift的面向对象编程特性，包括枚举和协议。</p>
]]></content>
      <tags>
        <tag>swift</tag>
      </tags>
  </entry>
  <entry>
    <title>swift学习日记(九)</title>
    <url>/ios.github.io/2025/12/14/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E4%B9%9D%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Swift学习日记（九）：内存管理"><a href="#Swift学习日记（九）：内存管理" class="headerlink" title="Swift学习日记（九）：内存管理"></a>Swift学习日记（九）：内存管理</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>在上一篇学习日记中，我们学习了Swift的错误处理机制，它允许我们在程序运行时处理可能出现的错误情况，使代码更加健壮和可靠。在这篇日记中，我们将探讨Swift的内存管理机制。内存管理是编程中至关重要的一部分，它直接影响应用的性能和稳定性。Swift采用自动引用计数（ARC）机制来管理内存，这使得我们可以专注于代码逻辑，而不需要手动管理内存。</p>
<h2 id="二、内存管理的基本概念"><a href="#二、内存管理的基本概念" class="headerlink" title="二、内存管理的基本概念"></a>二、内存管理的基本概念</h2><p>内存管理是指在程序运行时，对内存的分配、使用和释放进行管理。在Swift中，内存管理主要涉及以下几个概念：</p>
<ol>
<li><p><strong>堆内存与栈内存</strong>：</p>
<ul>
<li><strong>栈内存</strong>：用于存储临时变量和函数调用信息，由系统自动管理，分配和释放速度快。</li>
<li><strong>堆内存</strong>：用于存储对象实例和较大的数据结构，由开发者或自动内存管理系统管理，分配和释放速度相对较慢。</li>
</ul>
</li>
<li><p><strong>值类型与引用类型</strong>：</p>
<ul>
<li><strong>值类型</strong>：包括结构体、枚举和基本数据类型（如Int、Double、String等），它们存储在栈内存中，赋值时会进行值拷贝。</li>
<li><strong>引用类型</strong>：包括类和闭包，它们存储在堆内存中，赋值时会进行引用拷贝。</li>
</ul>
</li>
<li><p><strong>生命周期</strong>：对象的生命周期是指从对象创建到对象被销毁的过程。在Swift中，对象的生命周期由自动引用计数（ARC）管理。</p>
</li>
</ol>
<!-- CATEGORY: 内存管理 -->
<!-- INTERVIEW_TOPIC: 自动引用计数 -->
<!-- HIGH_FREQUENCY_INTERVIEW: ARC工作原理 -->

<h2 id="三、自动引用计数（ARC）"><a href="#三、自动引用计数（ARC）" class="headerlink" title="三、自动引用计数（ARC）"></a>三、自动引用计数（ARC）</h2><p>Swift使用自动引用计数（Automatic Reference Counting，简称ARC）机制来管理类实例的内存。ARC会自动跟踪和管理对象的引用计数，当对象的引用计数为0时，ARC会自动释放对象的内存。</p>
<h3 id="1-ARC的工作原理"><a href="#1-ARC的工作原理" class="headerlink" title="1. ARC的工作原理"></a>1. ARC的工作原理</h3><ul>
<li>当创建一个类实例时，ARC会为该实例分配一块内存，并将引用计数设置为1。</li>
<li>当一个新的引用指向该实例时，ARC会将引用计数加1。</li>
<li>当一个引用不再指向该实例时，ARC会将引用计数减1。</li>
<li>当引用计数变为0时，ARC会释放该实例的内存。</li>
</ul>
<h3 id="2-ARC的基本示例"><a href="#2-ARC的基本示例" class="headerlink" title="2. ARC的基本示例"></a>2. ARC的基本示例</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被初始化&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个Person实例，引用计数为1</span></span><br><span class="line"><span class="keyword">var</span> person1: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>)</span><br><span class="line"><span class="comment">// 输出：张三 被初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个新的引用，引用计数为2</span></span><br><span class="line"><span class="keyword">var</span> person2: <span class="type">Person</span>? <span class="operator">=</span> person1</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放person1引用，引用计数为1</span></span><br><span class="line">person1 <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放person2引用，引用计数为0，实例被销毁</span></span><br><span class="line">person2 <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：张三 被销毁</span></span><br></pre></td></tr></table></figure>

<!-- INTERVIEW_TOPIC: 引用类型 -->
<!-- HIGH_FREQUENCY_INTERVIEW: 强引用、弱引用、无主引用 -->

<h2 id="四、引用类型的引用类型"><a href="#四、引用类型的引用类型" class="headerlink" title="四、引用类型的引用类型"></a>四、引用类型的引用类型</h2><p>在Swift中，引用类型有三种引用类型：强引用（Strong Reference）、弱引用（Weak Reference）和无主引用（Unowned Reference）。</p>
<h3 id="1-强引用"><a href="#1-强引用" class="headerlink" title="1. 强引用"></a>1. 强引用</h3><p>强引用是默认的引用类型，它会增加对象的引用计数。当一个对象的强引用计数为0时，对象会被销毁。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个Person实例，强引用计数为1</span></span><br><span class="line"><span class="keyword">var</span> strongReference: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;李四&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，引用计数为0，实例被销毁</span></span><br><span class="line">strongReference <span class="operator">=</span> <span class="literal">nil</span></span><br></pre></td></tr></table></figure>

<h3 id="2-弱引用"><a href="#2-弱引用" class="headerlink" title="2. 弱引用"></a>2. 弱引用</h3><p>弱引用不会增加对象的引用计数，它用于解决循环引用问题。弱引用必须是可选类型，因为当对象被销毁时，弱引用会自动变为nil。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> apartment: <span class="type">Apartment</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Apartment</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> unit: <span class="type">String</span></span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> tenant: <span class="type">Person</span>? <span class="comment">// 弱引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">unit</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.unit <span class="operator">=</span> unit</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;公寓 <span class="subst">\(unit)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> john: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;John&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> unit4A: <span class="type">Apartment</span>? <span class="operator">=</span> <span class="type">Apartment</span>(unit: <span class="string">&quot;4A&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立引用关系</span></span><br><span class="line">john<span class="operator">?</span>.apartment <span class="operator">=</span> unit4A</span><br><span class="line">unit4A<span class="operator">?</span>.tenant <span class="operator">=</span> john</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用</span></span><br><span class="line">john <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：John 被销毁</span></span><br><span class="line"></span><br><span class="line">unit4A <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：公寓 4A 被销毁</span></span><br></pre></td></tr></table></figure>

<h3 id="3-无主引用"><a href="#3-无主引用" class="headerlink" title="3. 无主引用"></a>3. 无主引用</h3><p>无主引用不会增加对象的引用计数，它也用于解决循环引用问题。与弱引用不同的是，无主引用是非可选类型，它假设引用的对象始终存在。当对象被销毁时，无主引用不会自动变为nil，而是成为一个悬垂引用（Dangling Reference）。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> creditCard: <span class="type">CreditCard</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCard</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> number: <span class="type">UInt64</span></span><br><span class="line">    <span class="keyword">unowned</span> <span class="keyword">let</span> owner: <span class="type">Person</span> <span class="comment">// 无主引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">number</span>: <span class="type">UInt64</span>, <span class="params">owner</span>: <span class="type">Person</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.number <span class="operator">=</span> number</span><br><span class="line">        <span class="keyword">self</span>.owner <span class="operator">=</span> owner</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;信用卡 <span class="subst">\(number)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> jack: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Jack&quot;</span>)</span><br><span class="line">jack<span class="operator">?</span>.creditCard <span class="operator">=</span> <span class="type">CreditCard</span>(number: <span class="number">1234_5678_9012_3456</span>, owner: jack<span class="operator">!</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用</span></span><br><span class="line">jack <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：Jack 被销毁</span></span><br><span class="line"><span class="comment">// 输出：信用卡 1234567890123456 被销毁</span></span><br></pre></td></tr></table></figure>

<!-- INTERVIEW_TOPIC: 循环引用 -->
<!-- HIGH_FREQUENCY_INTERVIEW: 循环引用的解决方法 -->

<h2 id="五、循环引用"><a href="#五、循环引用" class="headerlink" title="五、循环引用"></a>五、循环引用</h2><p>循环引用是指两个或多个对象之间相互引用，导致它们的引用计数永远不会变为0，从而造成内存泄漏。在Swift中，循环引用主要发生在以下两种情况：</p>
<h3 id="1-类实例之间的循环引用"><a href="#1-类实例之间的循环引用" class="headerlink" title="1. 类实例之间的循环引用"></a>1. 类实例之间的循环引用</h3><p>当两个类实例相互持有对方的强引用时，会发生循环引用：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> apartment: <span class="type">Apartment</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Apartment</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> unit: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> tenant: <span class="type">Person</span>? <span class="comment">// 强引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">unit</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.unit <span class="operator">=</span> unit</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;公寓 <span class="subst">\(unit)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例，建立循环引用</span></span><br><span class="line"><span class="keyword">var</span> john: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;John&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> unit4A: <span class="type">Apartment</span>? <span class="operator">=</span> <span class="type">Apartment</span>(unit: <span class="string">&quot;4A&quot;</span>)</span><br><span class="line">john<span class="operator">?</span>.apartment <span class="operator">=</span> unit4A</span><br><span class="line">unit4A<span class="operator">?</span>.tenant <span class="operator">=</span> john</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，但由于循环引用，实例不会被销毁</span></span><br><span class="line">john <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">unit4A <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 没有输出，说明实例没有被销毁，发生了内存泄漏</span></span><br></pre></td></tr></table></figure>

<p>解决类实例之间的循环引用的方法是使用弱引用或无主引用：</p>
<ul>
<li>当引用的对象可能为nil时，使用弱引用</li>
<li>当引用的对象永远不会为nil时，使用无主引用</li>
</ul>
<h3 id="2-闭包与类实例之间的循环引用"><a href="#2-闭包与类实例之间的循环引用" class="headerlink" title="2. 闭包与类实例之间的循环引用"></a>2. 闭包与类实例之间的循环引用</h3><p>当一个类实例持有一个闭包，而该闭包又捕获了该类实例的引用时，会发生循环引用：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> closure: (() -&gt; <span class="type">Void</span>)<span class="operator">?</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例，建立循环引用</span></span><br><span class="line"><span class="keyword">var</span> tom: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Tom&quot;</span>)</span><br><span class="line">tom<span class="operator">?</span>.closure <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello, <span class="subst">\(tom<span class="operator">?</span>.name)</span>!&quot;</span>) <span class="comment">// 闭包捕获了tom的强引用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，但由于循环引用，实例不会被销毁</span></span><br><span class="line">tom <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 没有输出，说明实例没有被销毁，发生了内存泄漏</span></span><br></pre></td></tr></table></figure>

<p>解决闭包与类实例之间的循环引用的方法是使用捕获列表（Capture List）：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> closure: (() -&gt; <span class="type">Void</span>)<span class="operator">?</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例，使用捕获列表避免循环引用</span></span><br><span class="line"><span class="keyword">var</span> tom: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Tom&quot;</span>)</span><br><span class="line">tom<span class="operator">?</span>.closure <span class="operator">=</span> &#123;</span><br><span class="line">    [<span class="keyword">weak</span> tom] <span class="keyword">in</span> <span class="comment">// 使用捕获列表，将tom声明为弱引用</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello, <span class="subst">\(tom<span class="operator">?</span>.name)</span>!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，实例会被销毁</span></span><br><span class="line">tom <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：Tom 被销毁</span></span><br></pre></td></tr></table></figure>

<h3 id="3-捕获列表的语法"><a href="#3-捕获列表的语法" class="headerlink" title="3. 捕获列表的语法"></a>3. 捕获列表的语法</h3><p>捕获列表用于在闭包中指定捕获变量的引用类型，语法如下：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">[<span class="keyword">weak</span> <span class="keyword">self</span>, <span class="keyword">unowned</span> delegate <span class="operator">=</span> <span class="keyword">self</span>.delegate]</span><br></pre></td></tr></table></figure>

<p>捕获列表中的每个元素可以是：</p>
<ul>
<li><code>weak varName</code>：将变量声明为弱引用</li>
<li><code>unowned varName</code>：将变量声明为无主引用</li>
<li><code>varName = expression</code>：将表达式的值绑定到变量</li>
</ul>
<h3 id="4-闭包中的self"><a href="#4-闭包中的self" class="headerlink" title="4. 闭包中的self"></a>4. 闭包中的self</h3><p>在闭包中，如果需要访问self的属性或方法，通常需要显式地使用self关键字。如果闭包捕获了self的强引用，会导致循环引用。解决方法是在捕获列表中使用weak或unowned关键字声明self：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">var</span> description: () -&gt; <span class="type">String</span> <span class="operator">=</span> &#123;</span><br><span class="line">        [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span> <span class="comment">// 使用捕获列表，将self声明为无主引用</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(<span class="keyword">self</span>.name)</span> 今年 <span class="subst">\(<span class="keyword">self</span>.age)</span> 岁&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> alice: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Alice&quot;</span>, age: <span class="number">25</span>)</span><br><span class="line"><span class="built_in">print</span>(alice<span class="operator">?</span>.description() <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// 输出：Alice 今年 25 岁</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，实例会被销毁</span></span><br><span class="line">alice <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：Alice 被销毁</span></span><br></pre></td></tr></table></figure>

<h2 id="六、内存管理的最佳实践"><a href="#六、内存管理的最佳实践" class="headerlink" title="六、内存管理的最佳实践"></a>六、内存管理的最佳实践</h2><h3 id="1-优先使用值类型"><a href="#1-优先使用值类型" class="headerlink" title="1. 优先使用值类型"></a>1. 优先使用值类型</h3><p>值类型存储在栈内存中，由系统自动管理，不会造成内存泄漏。因此，在可能的情况下，应该优先使用值类型（如结构体和枚举）而不是引用类型（如类）。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用结构体（值类型）</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> y: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用枚举（值类型）</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> north, south, east, west</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只有在需要继承或引用语义时，才使用类（引用类型）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> speed: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">speed</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.speed <span class="operator">=</span> speed</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accelerate</span>() &#123;</span><br><span class="line">        speed <span class="operator">+=</span> <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-避免不必要的强引用"><a href="#2-避免不必要的强引用" class="headerlink" title="2. 避免不必要的强引用"></a>2. 避免不必要的强引用</h3><p>在使用引用类型时，应该避免不必要的强引用，特别是在闭包和委托模式中。</p>
<h4 id="委托模式中的弱引用"><a href="#委托模式中的弱引用" class="headerlink" title="委托模式中的弱引用"></a>委托模式中的弱引用</h4><p>在委托模式中，通常应该将委托声明为弱引用：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义委托协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">UserInputDelegate</span>: <span class="title class_ inherited__">AnyObject</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidInputText</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个类，使用委托</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInputView</span> &#123;</span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">UserInputDelegate</span>? <span class="comment">// 弱引用委托</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">textFieldDidChange</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        delegate<span class="operator">?</span>.userDidInputText(text)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遵循委托协议</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ViewController</span>: <span class="title class_ inherited__">UserInputDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> inputView <span class="operator">=</span> <span class="type">UserInputView</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        inputView.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidInputText</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用户输入了：<span class="subst">\(text)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ViewController 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：在协议中使用<code>AnyObject</code>关键字可以确保协议只能被类遵循，这是使用弱引用委托的前提条件。</p>
<h3 id="3-及时清理资源"><a href="#3-及时清理资源" class="headerlink" title="3. 及时清理资源"></a>3. 及时清理资源</h3><p>在对象被销毁前，应该及时清理资源，例如：</p>
<ul>
<li>取消网络请求</li>
<li>停止定时器</li>
<li>移除通知观察者</li>
<li>释放其他系统资源</li>
</ul>
<p>这些清理工作通常在<code>deinit</code>方法中完成：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NetworkManager</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> session: <span class="type">URLSession</span>?</span><br><span class="line">    <span class="keyword">var</span> task: <span class="type">URLSessionDataTask</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        session <span class="operator">=</span> <span class="type">URLSession</span>(configuration: .default)</span><br><span class="line">        <span class="comment">// 注册通知观察者</span></span><br><span class="line">        <span class="type">NotificationCenter</span>.default.addObserver(</span><br><span class="line">            <span class="keyword">self</span>,</span><br><span class="line">            selector: <span class="keyword">#selector</span>(handleNotification),</span><br><span class="line">            name: <span class="type">NSNotification</span>.<span class="type">Name</span>(<span class="string">&quot;SomeNotification&quot;</span>),</span><br><span class="line">            object: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fetchData</span>(<span class="params">from</span> <span class="params">url</span>: <span class="type">URL</span>) &#123;</span><br><span class="line">        task <span class="operator">=</span> session<span class="operator">?</span>.dataTask(with: url) &#123; data, response, error <span class="keyword">in</span></span><br><span class="line">            <span class="comment">// 处理响应</span></span><br><span class="line">        &#125;</span><br><span class="line">        task<span class="operator">?</span>.resume()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">handleNotification</span>() &#123;</span><br><span class="line">        <span class="comment">// 处理通知</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="comment">// 取消网络请求</span></span><br><span class="line">        task<span class="operator">?</span>.cancel()</span><br><span class="line">        session<span class="operator">?</span>.invalidateAndCancel()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 移除通知观察者</span></span><br><span class="line">        <span class="type">NotificationCenter</span>.default.removeObserver(<span class="keyword">self</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;NetworkManager 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-使用内存分析工具"><a href="#4-使用内存分析工具" class="headerlink" title="4. 使用内存分析工具"></a>4. 使用内存分析工具</h3><p>在开发过程中，可以使用Xcode的内存分析工具（如Leaks、Allocations等）来检测内存泄漏：</p>
<ul>
<li><strong>Leaks</strong>：用于检测内存泄漏</li>
<li><strong>Allocations</strong>：用于分析内存分配情况</li>
<li><strong>Instruments</strong>：提供更全面的性能分析工具</li>
</ul>
<h3 id="5-避免保留周期"><a href="#5-避免保留周期" class="headerlink" title="5. 避免保留周期"></a>5. 避免保留周期</h3><p>保留周期（Retain Cycle）是指两个或多个对象之间的循环引用，导致它们的引用计数永远不会变为0。在Swift中，保留周期主要发生在类实例之间的循环引用和闭包与类实例之间的循环引用。解决保留周期的方法是使用弱引用或无主引用。</p>
<h2 id="七、内存管理的高级话题"><a href="#七、内存管理的高级话题" class="headerlink" title="七、内存管理的高级话题"></a>七、内存管理的高级话题</h2><h3 id="1-自动释放池"><a href="#1-自动释放池" class="headerlink" title="1. 自动释放池"></a>1. 自动释放池</h3><p>自动释放池（Autorelease Pool）是Cocoa Touch框架中的一个概念，它用于管理临时对象的内存。在Swift中，我们可以使用<code>autoreleasepool</code>函数来创建自动释放池：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">autoreleasepool &#123;</span><br><span class="line">    <span class="comment">// 在自动释放池中创建临时对象</span></span><br><span class="line">    <span class="keyword">let</span> image <span class="operator">=</span> <span class="type">UIImage</span>(named: <span class="string">&quot;large-image.jpg&quot;</span>)</span><br><span class="line">    <span class="keyword">let</span> view <span class="operator">=</span> <span class="type">UIImageView</span>(image: image)</span><br><span class="line">    <span class="comment">// 使用临时对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 自动释放池结束后，临时对象会被释放</span></span><br></pre></td></tr></table></figure>

<p>自动释放池适用于创建大量临时对象的场景，可以减少内存峰值。</p>
<h3 id="2-弱引用数组"><a href="#2-弱引用数组" class="headerlink" title="2. 弱引用数组"></a>2. 弱引用数组</h3><p>在某些情况下，我们需要维护一个对象的弱引用数组，以便在对象被销毁时自动从数组中移除。我们可以使用<code>NSPointerArray</code>或自定义的弱引用包装器来实现：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个弱引用包装器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Weak</span>&lt;<span class="type">T</span>: <span class="type">AnyObject</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> value: <span class="type">T</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">value</span>: <span class="type">T</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.value <span class="operator">=</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个弱引用数组</span></span><br><span class="line"><span class="keyword">var</span> observers: [<span class="type">Weak</span>&lt;<span class="type">NSObject</span>&gt;] <span class="operator">=</span> []</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加观察者</span></span><br><span class="line"><span class="keyword">let</span> observer <span class="operator">=</span> <span class="type">NSObject</span>()</span><br><span class="line">observers.append(<span class="type">Weak</span>(value: observer))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除已销毁的观察者</span></span><br><span class="line">observers <span class="operator">=</span> observers.filter &#123; <span class="variable">$0</span>.value <span class="operator">!=</span> <span class="literal">nil</span> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-延迟初始化"><a href="#3-延迟初始化" class="headerlink" title="3. 延迟初始化"></a>3. 延迟初始化</h3><p>延迟初始化是指在首次访问属性时才初始化属性值，这可以减少对象的初始化时间和内存占用。在Swift中，我们可以使用<code>lazy</code>关键字来实现延迟初始化：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataManager</span> &#123;</span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">var</span> database: <span class="type">Database</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">Database</span>()</span><br><span class="line">        db.connect()</span><br><span class="line">        <span class="keyword">return</span> db</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        database.disconnect()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：延迟初始化的属性必须是变量（var），不能是常量（let）。</p>
<h2 id="八、内容机制与知识点总结"><a href="#八、内容机制与知识点总结" class="headerlink" title="八、内容机制与知识点总结"></a>八、内容机制与知识点总结</h2><h3 id="1-Swift内存管理的设计原则"><a href="#1-Swift内存管理的设计原则" class="headerlink" title="1. Swift内存管理的设计原则"></a>1. Swift内存管理的设计原则</h3><p>Swift的内存管理机制体现了几个核心设计原则：</p>
<ul>
<li><strong>自动管理优先</strong>：默认使用自动引用计数（ARC），减少手动内存管理的负担</li>
<li><strong>安全第一</strong>：通过引用类型（强、弱、无主）的明确区分，减少内存泄漏</li>
<li><strong>性能优化</strong>：值类型存储在栈上，引用类型存储在堆上，平衡性能和灵活性</li>
<li><strong>类型安全</strong>：通过类型系统确保内存操作的安全性</li>
<li><strong>透明度</strong>：内存管理机制清晰可预测，便于开发者理解和调试</li>
</ul>
<h3 id="2-核心知识点总结"><a href="#2-核心知识点总结" class="headerlink" title="2. 核心知识点总结"></a>2. 核心知识点总结</h3><table>
<thead>
<tr>
<th>概念</th>
<th>描述</th>
<th>主要特性</th>
</tr>
</thead>
<tbody><tr>
<td>堆内存</td>
<td>用于存储对象实例和较大数据结构</td>
<td>动态分配，由ARC管理</td>
</tr>
<tr>
<td>栈内存</td>
<td>用于存储临时变量和函数调用信息</td>
<td>自动分配释放，速度快</td>
</tr>
<tr>
<td>值类型</td>
<td>包括结构体、枚举和基本数据类型</td>
<td>赋值时值拷贝，无引用计数</td>
</tr>
<tr>
<td>引用类型</td>
<td>包括类和闭包</td>
<td>赋值时引用拷贝，有引用计数</td>
</tr>
<tr>
<td>自动引用计数（ARC）</td>
<td>自动跟踪和管理对象引用计数</td>
<td>引用计数为0时释放内存</td>
</tr>
<tr>
<td>强引用</td>
<td>默认引用类型，增加引用计数</td>
<td>可能导致循环引用</td>
</tr>
<tr>
<td>弱引用</td>
<td>不增加引用计数，对象销毁时变为nil</td>
<td>解决循环引用，可选类型</td>
</tr>
<tr>
<td>无主引用</td>
<td>不增加引用计数，对象销毁时不变为nil</td>
<td>解决循环引用，非可选类型</td>
</tr>
<tr>
<td>循环引用</td>
<td>两个或多个对象相互引用，导致内存泄漏</td>
<td>需使用弱引用或无主引用解决</td>
</tr>
<tr>
<td>闭包捕获列表</td>
<td>指定闭包中变量的引用类型</td>
<td>避免闭包与实例的循环引用</td>
</tr>
<tr>
<td><code>deinit</code>方法</td>
<td>对象被销毁前调用的方法</td>
<td>用于资源清理</td>
</tr>
</tbody></table>
<h2 id="九、遇到的问题及解决方案"><a href="#九、遇到的问题及解决方案" class="headerlink" title="九、遇到的问题及解决方案"></a>九、遇到的问题及解决方案</h2><h3 id="1-循环引用导致内存泄漏"><a href="#1-循环引用导致内存泄漏" class="headerlink" title="1. 循环引用导致内存泄漏"></a>1. 循环引用导致内存泄漏</h3><p><strong>问题</strong>：两个类实例相互持有强引用，导致引用计数永远不为0，内存无法释放</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> apartment: <span class="type">Apartment</span>? <span class="comment">// 强引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Apartment</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> unit: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> tenant: <span class="type">Person</span>? <span class="comment">// 强引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">unit</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.unit <span class="operator">=</span> unit</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;公寓 <span class="subst">\(unit)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例，建立循环引用</span></span><br><span class="line"><span class="keyword">var</span> john: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;John&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> unit4A: <span class="type">Apartment</span>? <span class="operator">=</span> <span class="type">Apartment</span>(unit: <span class="string">&quot;4A&quot;</span>)</span><br><span class="line">john<span class="operator">?</span>.apartment <span class="operator">=</span> unit4A</span><br><span class="line">unit4A<span class="operator">?</span>.tenant <span class="operator">=</span> john</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，但由于循环引用，实例不会被销毁</span></span><br><span class="line">john <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">unit4A <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 没有输出，发生内存泄漏</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用弱引用或无主引用打破循环引用</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> apartment: <span class="type">Apartment</span>? <span class="comment">// 强引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Apartment</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> unit: <span class="type">String</span></span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> tenant: <span class="type">Person</span>? <span class="comment">// 弱引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">unit</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.unit <span class="operator">=</span> unit</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;公寓 <span class="subst">\(unit)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例，建立引用关系</span></span><br><span class="line"><span class="keyword">var</span> john: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;John&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> unit4A: <span class="type">Apartment</span>? <span class="operator">=</span> <span class="type">Apartment</span>(unit: <span class="string">&quot;4A&quot;</span>)</span><br><span class="line">john<span class="operator">?</span>.apartment <span class="operator">=</span> unit4A</span><br><span class="line">unit4A<span class="operator">?</span>.tenant <span class="operator">=</span> john</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，实例会被销毁</span></span><br><span class="line">john <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：John 被销毁</span></span><br><span class="line"></span><br><span class="line">unit4A <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：公寓 4A 被销毁</span></span><br></pre></td></tr></table></figure>

<h3 id="2-闭包与实例的循环引用"><a href="#2-闭包与实例的循环引用" class="headerlink" title="2. 闭包与实例的循环引用"></a>2. 闭包与实例的循环引用</h3><p><strong>问题</strong>：闭包捕获了实例的强引用，导致循环引用</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> closure: (() -&gt; <span class="type">Void</span>)<span class="operator">?</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例，建立循环引用</span></span><br><span class="line"><span class="keyword">var</span> tom: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Tom&quot;</span>)</span><br><span class="line">tom<span class="operator">?</span>.closure <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello, <span class="subst">\(tom<span class="operator">?</span>.name)</span>!&quot;</span>) <span class="comment">// 闭包捕获了tom的强引用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，但由于循环引用，实例不会被销毁</span></span><br><span class="line">tom <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 没有输出，发生内存泄漏</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用捕获列表避免循环引用</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> closure: (() -&gt; <span class="type">Void</span>)<span class="operator">?</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例，使用捕获列表避免循环引用</span></span><br><span class="line"><span class="keyword">var</span> tom: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Tom&quot;</span>)</span><br><span class="line">tom<span class="operator">?</span>.closure <span class="operator">=</span> &#123;</span><br><span class="line">    [<span class="keyword">weak</span> tom] <span class="keyword">in</span> <span class="comment">// 使用捕获列表，将tom声明为弱引用</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello, <span class="subst">\(tom<span class="operator">?</span>.name)</span>!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，实例会被销毁</span></span><br><span class="line">tom <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：Tom 被销毁</span></span><br></pre></td></tr></table></figure>

<h3 id="3-委托模式中的循环引用"><a href="#3-委托模式中的循环引用" class="headerlink" title="3. 委托模式中的循环引用"></a>3. 委托模式中的循环引用</h3><p><strong>问题</strong>：委托对象和被委托对象之间的循环引用</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">UserInputDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidInputText</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInputView</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> delegate: <span class="type">UserInputDelegate</span>? <span class="comment">// 强引用委托</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">textFieldDidChange</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        delegate<span class="operator">?</span>.userDidInputText(text)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;UserInputView 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ViewController</span>: <span class="title class_ inherited__">UserInputDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> inputView <span class="operator">=</span> <span class="type">UserInputView</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        inputView.delegate <span class="operator">=</span> <span class="keyword">self</span> <span class="comment">// 强引用循环</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidInputText</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用户输入了：<span class="subst">\(text)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ViewController 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例，建立循环引用</span></span><br><span class="line"><span class="keyword">var</span> vc: <span class="type">ViewController</span>? <span class="operator">=</span> <span class="type">ViewController</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，但由于循环引用，实例不会被销毁</span></span><br><span class="line">vc <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 没有输出，发生内存泄漏</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：将委托声明为弱引用</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">UserInputDelegate</span>: <span class="title class_ inherited__">AnyObject</span> &#123; <span class="comment">// 确保协议只能被类遵循</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidInputText</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInputView</span> &#123;</span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">UserInputDelegate</span>? <span class="comment">// 弱引用委托</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">textFieldDidChange</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        delegate<span class="operator">?</span>.userDidInputText(text)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;UserInputView 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ViewController</span>: <span class="title class_ inherited__">UserInputDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> inputView <span class="operator">=</span> <span class="type">UserInputView</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        inputView.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidInputText</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用户输入了：<span class="subst">\(text)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ViewController 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> vc: <span class="type">ViewController</span>? <span class="operator">=</span> <span class="type">ViewController</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，实例会被销毁</span></span><br><span class="line">vc <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：ViewController 被销毁</span></span><br><span class="line"><span class="comment">// 输出：UserInputView 被销毁</span></span><br></pre></td></tr></table></figure>

<h3 id="4-强引用循环在延迟属性中"><a href="#4-强引用循环在延迟属性中" class="headerlink" title="4. 强引用循环在延迟属性中"></a>4. 强引用循环在延迟属性中</h3><p><strong>问题</strong>：延迟属性中的闭包与实例形成循环引用</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">var</span> description: () -&gt; <span class="type">String</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(<span class="keyword">self</span>.name)</span> 今年 <span class="subst">\(<span class="keyword">self</span>.age)</span> 岁&quot;</span> <span class="comment">// 闭包捕获了self的强引用</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例，建立循环引用</span></span><br><span class="line"><span class="keyword">var</span> alice: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Alice&quot;</span>, age: <span class="number">25</span>)</span><br><span class="line"><span class="built_in">print</span>(alice<span class="operator">?</span>.description() <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，但由于循环引用，实例不会被销毁</span></span><br><span class="line">alice <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 没有输出，发生内存泄漏</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：在延迟属性的闭包中使用捕获列表</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">age</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">var</span> description: () -&gt; <span class="type">String</span> <span class="operator">=</span> &#123;</span><br><span class="line">        [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span> <span class="comment">// 使用捕获列表，将self声明为无主引用</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(<span class="keyword">self</span>.name)</span> 今年 <span class="subst">\(<span class="keyword">self</span>.age)</span> 岁&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> alice: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Alice&quot;</span>, age: <span class="number">25</span>)</span><br><span class="line"><span class="built_in">print</span>(alice<span class="operator">?</span>.description() <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放强引用，实例会被销毁</span></span><br><span class="line">alice <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：Alice 被销毁</span></span><br></pre></td></tr></table></figure>

<h3 id="5-不正确使用无主引用导致崩溃"><a href="#5-不正确使用无主引用导致崩溃" class="headerlink" title="5. 不正确使用无主引用导致崩溃"></a>5. 不正确使用无主引用导致崩溃</h3><p><strong>问题</strong>：使用无主引用引用已经被销毁的对象，导致运行时崩溃</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> creditCard: <span class="type">CreditCard</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCard</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> number: <span class="type">UInt64</span></span><br><span class="line">    <span class="keyword">unowned</span> <span class="keyword">let</span> owner: <span class="type">Person</span> <span class="comment">// 无主引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">number</span>: <span class="type">UInt64</span>, <span class="params">owner</span>: <span class="type">Person</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.number <span class="operator">=</span> number</span><br><span class="line">        <span class="keyword">self</span>.owner <span class="operator">=</span> owner</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;信用卡 <span class="subst">\(number)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> jack: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Jack&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> card: <span class="type">CreditCard</span>? <span class="operator">=</span> <span class="type">CreditCard</span>(number: <span class="number">1234_5678_9012_3456</span>, owner: jack<span class="operator">!</span>)</span><br><span class="line">jack<span class="operator">?</span>.creditCard <span class="operator">=</span> card</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放Person实例</span></span><br><span class="line">jack <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// 输出：Jack 被销毁</span></span><br><span class="line"><span class="comment">// 输出：信用卡 1234567890123456 被销毁</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问已销毁对象的无主引用，导致崩溃</span></span><br><span class="line"><span class="built_in">print</span>(card<span class="operator">?</span>.owner.name <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// 崩溃！</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：确保无主引用的对象在无主引用使用期间始终存在，或改用弱引用</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCard</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> number: <span class="type">UInt64</span></span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> owner: <span class="type">Person</span>? <span class="comment">// 改用弱引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">number</span>: <span class="type">UInt64</span>, <span class="params">owner</span>: <span class="type">Person</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.number <span class="operator">=</span> number</span><br><span class="line">        <span class="keyword">self</span>.owner <span class="operator">=</span> owner</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;信用卡 <span class="subst">\(number)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用弱引用访问</span></span><br><span class="line"><span class="built_in">print</span>(card<span class="operator">?</span>.owner<span class="operator">?</span>.name <span class="operator">??</span> <span class="string">&quot;所有者不存在&quot;</span>) <span class="comment">// 输出：所有者不存在</span></span><br></pre></td></tr></table></figure>

<h2 id="十、高阶用法"><a href="#十、高阶用法" class="headerlink" title="十、高阶用法"></a>十、高阶用法</h2><h3 id="1-高级内存管理技巧"><a href="#1-高级内存管理技巧" class="headerlink" title="1. 高级内存管理技巧"></a>1. 高级内存管理技巧</h3><h4 id="1-1-弱引用数组实现"><a href="#1-1-弱引用数组实现" class="headerlink" title="1.1 弱引用数组实现"></a>1.1 弱引用数组实现</h4><p>实现一个自动管理的弱引用数组，自动移除已销毁的对象：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 弱引用包装器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Weak</span>&lt;<span class="type">T</span>: <span class="type">AnyObject</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> value: <span class="type">T</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">value</span>: <span class="type">T</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.value <span class="operator">=</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 弱引用数组</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeakArray</span>&lt;<span class="type">T</span>: <span class="type">AnyObject</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> items: [<span class="type">Weak</span>&lt;<span class="type">T</span>&gt;] <span class="operator">=</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加元素</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">append</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">T</span>) &#123;</span><br><span class="line">        items.append(<span class="type">Weak</span>(value: item))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取所有有效的元素</span></span><br><span class="line">    <span class="keyword">var</span> validItems: [<span class="type">T</span>] &#123;</span><br><span class="line">        <span class="comment">// 过滤掉已销毁的对象，并清理数组</span></span><br><span class="line">        items <span class="operator">=</span> items.filter &#123; <span class="variable">$0</span>.value <span class="operator">!=</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        <span class="keyword">return</span> items.compactMap &#123; <span class="variable">$0</span>.value &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清空数组</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">removeAll</span>() &#123;</span><br><span class="line">        items.removeAll()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">update</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span> 收到更新通知&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建弱引用数组</span></span><br><span class="line"><span class="keyword">let</span> observers <span class="operator">=</span> <span class="type">WeakArray</span>&lt;<span class="type">Observer</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加观察者</span></span><br><span class="line"><span class="keyword">let</span> observer1 <span class="operator">=</span> <span class="type">Observer</span>(name: <span class="string">&quot;观察者1&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> observer2 <span class="operator">=</span> <span class="type">Observer</span>(name: <span class="string">&quot;观察者2&quot;</span>)</span><br><span class="line">observers.append(observer1)</span><br><span class="line">observers.append(observer2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通知所有观察者</span></span><br><span class="line"><span class="keyword">for</span> observer <span class="keyword">in</span> observers.validItems &#123;</span><br><span class="line">    observer.update()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放一个观察者</span></span><br><span class="line">observer1 <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通知所有有效观察者（自动移除已销毁的观察者）</span></span><br><span class="line"><span class="keyword">for</span> observer <span class="keyword">in</span> observers.validItems &#123;</span><br><span class="line">    observer.update()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-弱引用字典实现"><a href="#1-2-弱引用字典实现" class="headerlink" title="1.2 弱引用字典实现"></a>1.2 弱引用字典实现</h4><p>实现一个弱引用字典，键是强引用，值是弱引用：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WeakValueDictionary</span>&lt;<span class="type">Key</span>: <span class="type">Hashable</span>, <span class="type">Value</span>: <span class="type">AnyObject</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> dictionary: [<span class="type">Key</span>: <span class="type">Weak</span>&lt;<span class="type">Value</span>&gt;] <span class="operator">=</span> [:]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下标访问</span></span><br><span class="line">    <span class="keyword">subscript</span>(<span class="params">key</span>: <span class="type">Key</span>) -&gt; <span class="type">Value</span>? &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> dictionary[key]<span class="operator">?</span>.value</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> newValue <span class="operator">=</span> newValue &#123;</span><br><span class="line">                dictionary[key] <span class="operator">=</span> <span class="type">Weak</span>(value: newValue)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dictionary.removeValue(forKey: key)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清理已销毁的弱引用</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">clean</span>() &#123;</span><br><span class="line">        dictionary <span class="operator">=</span> dictionary.filter &#123; <span class="variable">$0</span>.value.value <span class="operator">!=</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 所有有效键值对</span></span><br><span class="line">    <span class="keyword">var</span> validPairs: [(<span class="type">Key</span>, <span class="type">Value</span>)] &#123;</span><br><span class="line">        clean()</span><br><span class="line">        <span class="keyword">return</span> dictionary.compactMap &#123; (key, weakValue) <span class="keyword">in</span></span><br><span class="line">            weakValue.value.map &#123; (key, <span class="variable">$0</span>) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">let</span> weakDict <span class="operator">=</span> <span class="type">WeakValueDictionary</span>&lt;<span class="type">String</span>, <span class="type">Observer</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加键值对</span></span><br><span class="line">weakDict[<span class="string">&quot;observer1&quot;</span>] <span class="operator">=</span> <span class="type">Observer</span>(name: <span class="string">&quot;字典观察者1&quot;</span>)</span><br><span class="line">weakDict[<span class="string">&quot;observer2&quot;</span>] <span class="operator">=</span> <span class="type">Observer</span>(name: <span class="string">&quot;字典观察者2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问值</span></span><br><span class="line"><span class="built_in">print</span>(weakDict[<span class="string">&quot;observer1&quot;</span>]<span class="operator">?</span>.name <span class="operator">??</span> <span class="string">&quot;不存在&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(weakDict[<span class="string">&quot;observer2&quot;</span>]<span class="operator">?</span>.name <span class="operator">??</span> <span class="string">&quot;不存在&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清理并获取有效键值对</span></span><br><span class="line"><span class="keyword">for</span> (key, observer) <span class="keyword">in</span> weakDict.validPairs &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;键：<span class="subst">\(key)</span>，值：<span class="subst">\(observer.name)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-循环引用的高级检测"><a href="#1-3-循环引用的高级检测" class="headerlink" title="1.3 循环引用的高级检测"></a>1.3 循环引用的高级检测</h4><p>使用运行时技术检测循环引用：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个协议，用于检测循环引用</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">LoopDetection</span>: <span class="title class_ inherited__">AnyObject</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">detectLoops</span>() -&gt; [<span class="type">String</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为NSObject扩展实现LoopDetection协议</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">NSObject</span>: <span class="title class_ inherited__">LoopDetection</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">detectLoops</span>() -&gt; [<span class="type">String</span>] &#123;</span><br><span class="line">        <span class="keyword">var</span> detectedLoops: [<span class="type">String</span>] <span class="operator">=</span> []</span><br><span class="line">        <span class="keyword">var</span> visited <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">ObjectIdentifier</span>&gt;()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 递归检测循环引用</span></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">dfs</span>(<span class="keyword">_</span> <span class="params">obj</span>: <span class="type">NSObject</span>, <span class="params">path</span>: [<span class="type">String</span>]) &#123;</span><br><span class="line">            <span class="keyword">let</span> id <span class="operator">=</span> <span class="type">ObjectIdentifier</span>(obj)</span><br><span class="line">            <span class="keyword">if</span> visited.contains(id) &#123;</span><br><span class="line">                <span class="comment">// 找到循环引用</span></span><br><span class="line">                <span class="keyword">let</span> loopPath <span class="operator">=</span> path <span class="operator">+</span> [<span class="type">String</span>(describing: obj)]</span><br><span class="line">                detectedLoops.append(<span class="string">&quot;循环引用路径：<span class="subst">\(loopPath.joined(separator: <span class="string">&quot; -&gt; &quot;</span>))</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            visited.insert(id)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 遍历所有属性</span></span><br><span class="line">            <span class="keyword">var</span> count: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">            <span class="keyword">let</span> properties <span class="operator">=</span> class_copyPropertyList(<span class="built_in">type</span>(of: obj), <span class="operator">&amp;</span>count)</span><br><span class="line">            <span class="keyword">defer</span> &#123; free(properties) &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="type">Int</span>(count) &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> property <span class="operator">=</span> properties<span class="operator">?</span>[i],</span><br><span class="line">                   <span class="keyword">let</span> propertyName <span class="operator">=</span> <span class="type">NSString</span>(utf8String: property_getName(property)) <span class="keyword">as</span> <span class="type">String</span>? &#123;</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// 获取属性值</span></span><br><span class="line">                    <span class="keyword">let</span> value <span class="operator">=</span> obj.value(forKey: propertyName)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// 如果是NSObject类型，继续检测</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> childObj <span class="operator">=</span> value <span class="keyword">as?</span> <span class="type">NSObject</span> &#123;</span><br><span class="line">                        dfs(childObj, path: path <span class="operator">+</span> [propertyName])</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            visited.remove(id)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        dfs(<span class="keyword">self</span>, path: [<span class="type">String</span>(describing: <span class="built_in">type</span>(of: <span class="keyword">self</span>))])</span><br><span class="line">        <span class="keyword">return</span> detectedLoops</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>: <span class="title class_ inherited__">NSObject</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> friend: <span class="type">Person</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建循环引用</span></span><br><span class="line"><span class="keyword">let</span> alice <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Alice&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> bob <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;Bob&quot;</span>)</span><br><span class="line">alice.friend <span class="operator">=</span> bob</span><br><span class="line">bob.friend <span class="operator">=</span> alice</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检测循环引用</span></span><br><span class="line"><span class="keyword">let</span> loops <span class="operator">=</span> alice.detectLoops()</span><br><span class="line"><span class="keyword">for</span> loop <span class="keyword">in</span> loops &#123;</span><br><span class="line">    <span class="built_in">print</span>(loop)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-内存优化策略"><a href="#2-内存优化策略" class="headerlink" title="2. 内存优化策略"></a>2. 内存优化策略</h3><h4 id="2-1-懒加载与预加载结合"><a href="#2-1-懒加载与预加载结合" class="headerlink" title="2.1 懒加载与预加载结合"></a>2.1 懒加载与预加载结合</h4><p>根据应用场景选择合适的加载策略：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ImageManager</span> &#123;</span><br><span class="line">    <span class="comment">// 小图片预加载</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> smallImages: [<span class="type">String</span>: <span class="type">UIImage</span>] <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> imageNames <span class="operator">=</span> [<span class="string">&quot;icon1&quot;</span>, <span class="string">&quot;icon2&quot;</span>, <span class="string">&quot;icon3&quot;</span>]</span><br><span class="line">        <span class="keyword">var</span> images: [<span class="type">String</span>: <span class="type">UIImage</span>] <span class="operator">=</span> [:]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> imageNames &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image <span class="operator">=</span> <span class="type">UIImage</span>(named: name) &#123;</span><br><span class="line">                images[name] <span class="operator">=</span> image</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> images</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 大图片懒加载</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> largeImages: [<span class="type">String</span>: <span class="type">UIImage</span>] <span class="operator">=</span> [:]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getImage</span>(<span class="params">named</span> <span class="params">name</span>: <span class="type">String</span>, <span class="params">isLarge</span>: <span class="type">Bool</span>) -&gt; <span class="type">UIImage</span>? &#123;</span><br><span class="line">        <span class="keyword">if</span> isLarge &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image <span class="operator">=</span> largeImages[name] &#123;</span><br><span class="line">                <span class="keyword">return</span> image</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> image <span class="operator">=</span> <span class="type">UIImage</span>(named: name) &#123;</span><br><span class="line">                largeImages[name] <span class="operator">=</span> image</span><br><span class="line">                <span class="keyword">return</span> image</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> smallImages[name]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清理大图片缓存</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">clearLargeImageCache</span>() &#123;</span><br><span class="line">        largeImages.removeAll()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-内存警告处理"><a href="#2-2-内存警告处理" class="headerlink" title="2.2 内存警告处理"></a>2.2 内存警告处理</h4><p>响应系统内存警告，释放不必要的资源：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> cache: [<span class="type">String</span>: <span class="type">Data</span>] <span class="operator">=</span> [:]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">// 监听内存警告通知</span></span><br><span class="line">        <span class="type">NotificationCenter</span>.default.addObserver(</span><br><span class="line">            <span class="keyword">self</span>,</span><br><span class="line">            selector: <span class="keyword">#selector</span>(handleMemoryWarning),</span><br><span class="line">            name: <span class="type">UIApplication</span>.didReceiveMemoryWarningNotification,</span><br><span class="line">            object: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">cache</span>(<span class="keyword">_</span> <span class="params">data</span>: <span class="type">Data</span>, <span class="params">forKey</span> <span class="params">key</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        cache[key] <span class="operator">=</span> data</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getData</span>(<span class="params">forKey</span> <span class="params">key</span>: <span class="type">String</span>) -&gt; <span class="type">Data</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> cache[key]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">handleMemoryWarning</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;收到内存警告，清理缓存&quot;</span>)</span><br><span class="line">        <span class="comment">// 清理部分或全部缓存</span></span><br><span class="line">        cache.removeAll()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="type">NotificationCenter</span>.default.removeObserver(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-内存泄漏检测工具的高级使用"><a href="#2-3-内存泄漏检测工具的高级使用" class="headerlink" title="2.3 内存泄漏检测工具的高级使用"></a>2.3 内存泄漏检测工具的高级使用</h4><p>使用Instruments进行高级内存泄漏检测：</p>
<ol>
<li><p><strong>Allocations工具</strong>：</p>
<ul>
<li>跟踪内存分配情况</li>
<li>识别内存增长趋势</li>
<li>查找内存泄漏的对象</li>
</ul>
</li>
<li><p><strong>Leaks工具</strong>：</p>
<ul>
<li>自动检测内存泄漏</li>
<li>显示泄漏对象的调用栈</li>
<li>提供修复建议</li>
</ul>
</li>
<li><p><strong>VM Tracker工具</strong>：</p>
<ul>
<li>分析虚拟内存使用情况</li>
<li>识别内存压力来源</li>
</ul>
</li>
<li><p><strong>Zombies工具</strong>：</p>
<ul>
<li>检测野指针访问</li>
<li>显示对象被释放后的访问情况</li>
</ul>
</li>
</ol>
<h3 id="3-性能优化最佳实践"><a href="#3-性能优化最佳实践" class="headerlink" title="3. 性能优化最佳实践"></a>3. 性能优化最佳实践</h3><ol>
<li><p><strong>值类型与引用类型的选择</strong>：</p>
<ul>
<li>优先使用值类型（结构体、枚举）存储简单数据</li>
<li>只有在需要继承或引用语义时使用类</li>
</ul>
</li>
<li><p><strong>引用类型的最佳实践</strong>：</p>
<ul>
<li>使用弱引用或无主引用打破循环引用</li>
<li>在委托模式中使用弱引用委托</li>
<li>在闭包中使用捕获列表避免循环引用</li>
</ul>
</li>
<li><p><strong>内存管理的自动化</strong>：</p>
<ul>
<li>使用自动引用计数（ARC），避免手动内存管理</li>
<li>利用<code>deinit</code>方法清理资源</li>
<li>响应内存警告，释放不必要的资源</li>
</ul>
</li>
<li><p><strong>性能监控与调试</strong>：</p>
<ul>
<li>定期使用Instruments检测内存泄漏</li>
<li>监控应用的内存使用情况</li>
<li>分析内存增长趋势，识别性能瓶颈</li>
</ul>
</li>
<li><p><strong>高级内存优化</strong>：</p>
<ul>
<li>实现高效的缓存策略</li>
<li>使用对象池减少对象创建销毁开销</li>
<li>优化大型数据结构的内存使用</li>
</ul>
</li>
</ol>
<h2 id="十一、实践练习"><a href="#十一、实践练习" class="headerlink" title="十一、实践练习"></a>十一、实践练习</h2><h3 id="1-内存管理基础练习"><a href="#1-内存管理基础练习" class="headerlink" title="1. 内存管理基础练习"></a>1. 内存管理基础练习</h3><h4 id="1-1-强引用与弱引用实践"><a href="#1-1-强引用与弱引用实践" class="headerlink" title="1.1 强引用与弱引用实践"></a>1.1 强引用与弱引用实践</h4><p>创建一个<code>Person</code>类和一个<code>Apartment</code>类，实现以下功能：</p>
<ol>
<li><code>Person</code>类有<code>name</code>属性和<code>apartment</code>属性</li>
<li><code>Apartment</code>类有<code>unit</code>属性和<code>tenant</code>属性</li>
<li>先使用强引用创建循环引用，演示内存泄漏</li>
<li>然后使用弱引用打破循环引用，确保对象能被正确销毁</li>
<li>使用<code>deinit</code>方法验证对象是否被销毁</li>
</ol>
<h4 id="1-2-闭包循环引用实践"><a href="#1-2-闭包循环引用实践" class="headerlink" title="1.2 闭包循环引用实践"></a>1.2 闭包循环引用实践</h4><p>创建一个<code>Logger</code>类，实现以下功能：</p>
<ol>
<li>有一个<code>log</code>数组用于存储日志消息</li>
<li>有一个<code>processLog</code>闭包属性，用于处理日志</li>
<li>在<code>init</code>方法中初始化闭包，使其引用<code>self</code></li>
<li>演示循环引用导致的内存泄漏</li>
<li>使用捕获列表解决循环引用问题</li>
</ol>
<h3 id="2-高级内存管理练习"><a href="#2-高级内存管理练习" class="headerlink" title="2. 高级内存管理练习"></a>2. 高级内存管理练习</h3><h4 id="2-1-实现弱引用数组"><a href="#2-1-实现弱引用数组" class="headerlink" title="2.1 实现弱引用数组"></a>2.1 实现弱引用数组</h4><p>创建一个<code>WeakArray</code>类，实现以下功能：</p>
<ol>
<li>能存储任意类类型的弱引用</li>
<li>自动清理已销毁的对象</li>
<li>提供<code>append</code>、<code>remove</code>、<code>count</code>等基本操作</li>
<li>实现<code>subscript</code>下标访问</li>
<li>演示在观察者模式中的应用</li>
</ol>
<h4 id="2-2-实现弱引用字典"><a href="#2-2-实现弱引用字典" class="headerlink" title="2.2 实现弱引用字典"></a>2.2 实现弱引用字典</h4><p>创建一个<code>WeakValueDictionary</code>类，实现以下功能：</p>
<ol>
<li>键是强引用，值是弱引用</li>
<li>自动清理值已销毁的键值对</li>
<li>提供标准字典的基本操作（<code>subscript</code>、<code>removeValue</code>等）</li>
<li>实现<code>clean()</code>方法手动清理无效条目</li>
<li>演示在缓存场景中的应用</li>
</ol>
<h3 id="3-综合应用练习"><a href="#3-综合应用练习" class="headerlink" title="3. 综合应用练习"></a>3. 综合应用练习</h3><h4 id="3-1-实现自动清理的缓存"><a href="#3-1-实现自动清理的缓存" class="headerlink" title="3.1 实现自动清理的缓存"></a>3.1 实现自动清理的缓存</h4><p>创建一个<code>AutoCleaningCache</code>类，实现以下功能：</p>
<ol>
<li>基于<code>WeakValueDictionary</code>存储缓存数据</li>
<li>提供<code>set</code>、<code>get</code>、<code>remove</code>、<code>clear</code>等方法</li>
<li>实现LRU（最近最少使用）淘汰策略</li>
<li>监听系统内存警告，自动清理部分或全部缓存</li>
<li>使用<code>deinit</code>方法确保资源正确释放</li>
</ol>
<h4 id="3-2-实现观察者模式"><a href="#3-2-实现观察者模式" class="headerlink" title="3.2 实现观察者模式"></a>3.2 实现观察者模式</h4><p>创建一个<code>Subject</code>协议和<code>Observer</code>协议，实现以下功能：</p>
<ol>
<li><code>Subject</code>能添加、移除和通知观察者</li>
<li>使用<code>WeakArray</code>存储观察者，避免内存泄漏</li>
<li>实现具体的<code>NewsPublisher</code>和<code>NewsSubscriber</code>类</li>
<li>演示订阅、发布和自动取消订阅的流程</li>
<li>验证所有对象都能被正确销毁</li>
</ol>
<h2 id="十二、总结"><a href="#十二、总结" class="headerlink" title="十二、总结"></a>十二、总结</h2><p>在这篇学习日记中，我们深入探讨了Swift的内存管理机制：</p>
<ol>
<li><p><strong>基本概念</strong>：内存管理涉及堆内存与栈内存、值类型与引用类型、对象的生命周期等概念。</p>
</li>
<li><p><strong>自动引用计数（ARC）</strong>：Swift使用ARC机制来管理类实例的内存，自动跟踪和管理对象的引用计数。</p>
</li>
<li><p><strong>引用类型</strong>：包括强引用、弱引用和无主引用：</p>
<ul>
<li><strong>强引用</strong>：默认的引用类型，会增加对象的引用计数</li>
<li><strong>弱引用</strong>：不会增加对象的引用计数，用于解决循环引用，对象被销毁时会自动变为nil</li>
<li><strong>无主引用</strong>：不会增加对象的引用计数，用于解决循环引用，对象被销毁时不会自动变为nil</li>
</ul>
</li>
<li><p><strong>循环引用</strong>：</p>
<ul>
<li>类实例之间的循环引用：使用弱引用或无主引用解决</li>
<li>闭包与类实例之间的循环引用：使用捕获列表解决</li>
</ul>
</li>
<li><p><strong>最佳实践</strong>：</p>
<ul>
<li>优先使用值类型</li>
<li>避免不必要的强引用</li>
<li>及时清理资源</li>
<li>使用内存分析工具</li>
<li>避免保留周期</li>
</ul>
</li>
</ol>
<p>内存管理是Swift编程中的重要组成部分，它直接影响应用的性能和稳定性。掌握Swift的内存管理机制，特别是自动引用计数和循环引用的解决方法，对于开发高质量的iOS应用至关重要。在下一篇学习日记中，我们将总结Swift的核心概念，并展望Swift的未来发展。</p>
]]></content>
      <tags>
        <tag>swift</tag>
      </tags>
  </entry>
  <entry>
    <title>swift学习日记(三)</title>
    <url>/ios.github.io/2025/12/05/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Swift学习日记（三）：控制流"><a href="#Swift学习日记（三）：控制流" class="headerlink" title="Swift学习日记（三）：控制流"></a>Swift学习日记（三）：控制流</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>控制流是编程中用于控制代码执行顺序的机制。在上一篇学习日记中，我们已经了解了Swift的基本数据类型和运算符。在这篇日记中，我们将深入探讨Swift的控制流语句，包括条件语句、循环语句以及控制转移语句的高级用法。</p>
<h2 id="二、条件语句"><a href="#二、条件语句" class="headerlink" title="二、条件语句"></a>二、条件语句</h2><p>条件语句用于根据不同的条件执行不同的代码块。Swift提供了多种条件语句，包括<code>if-else</code>、<code>guard</code>和<code>switch</code>。</p>
<h3 id="1-if-else语句"><a href="#1-if-else语句" class="headerlink" title="1. if-else语句"></a>1. if-else语句</h3><p><code>if-else</code>语句是最基本的条件语句，用于根据条件执行不同的代码块：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> score <span class="operator">=</span> <span class="number">85</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> score <span class="operator">&gt;=</span> <span class="number">90</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;优秀&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> score <span class="operator">&gt;=</span> <span class="number">80</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;良好&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> score <span class="operator">&gt;=</span> <span class="number">60</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;及格&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;不及格&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="嵌套if-else"><a href="#嵌套if-else" class="headerlink" title="嵌套if-else"></a>嵌套if-else</h4><p><code>if-else</code>语句可以嵌套使用，用于处理更复杂的条件判断：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> age <span class="operator">=</span> <span class="number">20</span></span><br><span class="line"><span class="keyword">let</span> hasID <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> age <span class="operator">&gt;=</span> <span class="number">18</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> hasID &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;可以进入网吧&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;需要出示身份证&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;未满18岁，禁止进入&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-guard语句"><a href="#2-guard语句" class="headerlink" title="2. guard语句"></a>2. guard语句</h3><p><code>guard</code>语句是Swift 2.0引入的新特性，用于提前退出函数、方法或循环。它的语法比嵌套的<code>if-else</code>更清晰，更易于阅读：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">enterInternetCafe</span>(<span class="params">age</span>: <span class="type">Int</span>, <span class="params">hasID</span>: <span class="type">Bool</span>) &#123;</span><br><span class="line">    <span class="keyword">guard</span> age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未满18岁，禁止进入&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">guard</span> hasID <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;需要出示身份证&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;可以进入网吧&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enterInternetCafe(age: <span class="number">20</span>, hasID: <span class="literal">true</span>) <span class="comment">// 输出：可以进入网吧</span></span><br><span class="line">enterInternetCafe(age: <span class="number">17</span>, hasID: <span class="literal">true</span>) <span class="comment">// 输出：未满18岁，禁止进入</span></span><br><span class="line">enterInternetCafe(age: <span class="number">20</span>, hasID: <span class="literal">false</span>) <span class="comment">// 输出：需要出示身份证</span></span><br></pre></td></tr></table></figure>

<p><code>guard</code>语句的优点是：</p>
<ol>
<li>提前退出，减少嵌套层级</li>
<li>提高代码可读性</li>
<li>确保后续代码执行时，条件一定为真</li>
</ol>
<h3 id="3-switch语句"><a href="#3-switch语句" class="headerlink" title="3. switch语句"></a>3. switch语句</h3><p><code>switch</code>语句用于根据不同的情况执行不同的代码块，比一系列的<code>if-else</code>语句更简洁：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> day <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> day &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;星期一&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;星期二&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;星期三&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;星期四&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;星期五&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>, <span class="number">7</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;周末&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;无效的星期&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Swift的<code>switch</code>语句具有以下特点：</p>
<h4 id="不需要显式的break"><a href="#不需要显式的break" class="headerlink" title="不需要显式的break"></a>不需要显式的break</h4><p>与其他语言不同，Swift的<code>switch</code>语句在每个<code>case</code>结束后会自动退出，不需要显式的<code>break</code>语句：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> number <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字1&quot;</span>) <span class="comment">// 只执行这一行</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字2&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他数字&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果需要执行多个<code>case</code>，可以使用<code>fallthrough</code>关键字：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> number <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字1&quot;</span>)</span><br><span class="line">    <span class="keyword">fallthrough</span> <span class="comment">// 继续执行下一个case</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字2&quot;</span>) <span class="comment">// 也会执行这一行</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他数字&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="支持多种匹配模式"><a href="#支持多种匹配模式" class="headerlink" title="支持多种匹配模式"></a>支持多种匹配模式</h4><p>Swift的<code>switch</code>语句支持多种匹配模式：</p>
<h5 id="1-区间匹配"><a href="#1-区间匹配" class="headerlink" title="1. 区间匹配"></a>1. 区间匹配</h5><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> score <span class="operator">=</span> <span class="number">85</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> score &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">60</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;不及格&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">60</span><span class="operator">..&lt;</span><span class="number">80</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;及格&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">80</span><span class="operator">..&lt;</span><span class="number">90</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;良好&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">90</span><span class="operator">...</span><span class="number">100</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;优秀&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;无效分数&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-元组匹配"><a href="#2-元组匹配" class="headerlink" title="2. 元组匹配"></a>2. 元组匹配</h5><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> point <span class="operator">=</span> (<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> point &#123;</span><br><span class="line"><span class="keyword">case</span> (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;原点&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> (<span class="keyword">_</span>, <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;x轴上的点&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> (<span class="number">0</span>, <span class="keyword">_</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;y轴上的点&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> (<span class="operator">-</span><span class="number">2</span><span class="operator">...</span><span class="number">2</span>, <span class="operator">-</span><span class="number">2</span><span class="operator">...</span><span class="number">2</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;在2x2的正方形内&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他点&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-值绑定"><a href="#3-值绑定" class="headerlink" title="3. 值绑定"></a>3. 值绑定</h5><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> point <span class="operator">=</span> (<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> point &#123;</span><br><span class="line"><span class="keyword">case</span> (<span class="keyword">let</span> x, <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;x轴上的点，x = <span class="subst">\(x)</span>&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> (<span class="number">0</span>, <span class="keyword">let</span> y):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;y轴上的点，y = <span class="subst">\(y)</span>&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> (x, y):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他点，坐标为(<span class="subst">\(x)</span>, <span class="subst">\(y)</span>)&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-where子句"><a href="#4-where子句" class="headerlink" title="4. where子句"></a>4. where子句</h5><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> point <span class="operator">=</span> (<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> point &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">where</span> x <span class="operator">==</span> y:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;在直线y = x上&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">where</span> x <span class="operator">==</span> <span class="operator">-</span>y:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;在直线y = -x上&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> (x, y):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他点，坐标为(<span class="subst">\(x)</span>, <span class="subst">\(y)</span>)&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-枚举成员匹配"><a href="#5-枚举成员匹配" class="headerlink" title="5. 枚举成员匹配"></a>5. 枚举成员匹配</h5><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> north, south, east, west</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> direction <span class="operator">=</span> <span class="type">Direction</span>.north</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> direction &#123;</span><br><span class="line"><span class="keyword">case</span> .north:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向北&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .south:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向南&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .east:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向东&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .west:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向西&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、循环语句"><a href="#三、循环语句" class="headerlink" title="三、循环语句"></a>三、循环语句</h2><p>循环语句用于重复执行一段代码，直到满足特定条件。Swift提供了三种循环语句：<code>for-in</code>、<code>while</code>和<code>repeat-while</code>。</p>
<h3 id="1-for-in循环"><a href="#1-for-in循环" class="headerlink" title="1. for-in循环"></a>1. for-in循环</h3><p><code>for-in</code>循环用于遍历序列、集合、范围或其他可迭代对象：</p>
<h4 id="遍历范围"><a href="#遍历范围" class="headerlink" title="遍历范围"></a>遍历范围</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 遍历闭区间</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i) <span class="comment">// 输出：1, 2, 3, 4, 5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历半开区间</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">..&lt;</span><span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i) <span class="comment">// 输出：1, 2, 3, 4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历单侧区间</span></span><br><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>numbers.count &#123;</span><br><span class="line">    <span class="built_in">print</span>(numbers[i])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="遍历集合"><a href="#遍历集合" class="headerlink" title="遍历集合"></a>遍历集合</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 遍历数组</span></span><br><span class="line"><span class="keyword">let</span> fruits <span class="operator">=</span> [<span class="string">&quot;苹果&quot;</span>, <span class="string">&quot;香蕉&quot;</span>, <span class="string">&quot;橙子&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> fruits &#123;</span><br><span class="line">    <span class="built_in">print</span>(fruit)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历集合</span></span><br><span class="line"><span class="keyword">let</span> colors: <span class="type">Set</span>&lt;<span class="type">String</span>&gt; <span class="operator">=</span> [<span class="string">&quot;红&quot;</span>, <span class="string">&quot;绿&quot;</span>, <span class="string">&quot;蓝&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> color <span class="keyword">in</span> colors &#123;</span><br><span class="line">    <span class="built_in">print</span>(color)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历字典</span></span><br><span class="line"><span class="keyword">let</span> scores <span class="operator">=</span> [<span class="string">&quot;语文&quot;</span>: <span class="number">90</span>, <span class="string">&quot;数学&quot;</span>: <span class="number">95</span>, <span class="string">&quot;英语&quot;</span>: <span class="number">88</span>]</span><br><span class="line"><span class="keyword">for</span> (subject, score) <span class="keyword">in</span> scores &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(subject)</span>：<span class="subst">\(score)</span>分&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="遍历字符串"><a href="#遍历字符串" class="headerlink" title="遍历字符串"></a>遍历字符串</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> text <span class="operator">=</span> <span class="string">&quot;Swift&quot;</span></span><br><span class="line"><span class="keyword">for</span> character <span class="keyword">in</span> text &#123;</span><br><span class="line">    <span class="built_in">print</span>(character)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用stride函数"><a href="#使用stride函数" class="headerlink" title="使用stride函数"></a>使用stride函数</h4><p><code>stride</code>函数用于创建一个按指定步长递增或递减的序列：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 从0开始，到10结束，步长为2</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">0</span>, to: <span class="number">10</span>, by: <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(i) <span class="comment">// 输出：0, 2, 4, 6, 8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从10开始，到0结束，步长为-2</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">10</span>, through: <span class="number">0</span>, by: <span class="operator">-</span><span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(i) <span class="comment">// 输出：10, 8, 6, 4, 2, 0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-while循环"><a href="#2-while循环" class="headerlink" title="2. while循环"></a>2. while循环</h3><p><code>while</code>循环在条件为真时重复执行代码块，先判断条件再执行：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count <span class="operator">&lt;</span> <span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">    count <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：0, 1, 2, 3, 4</span></span><br></pre></td></tr></table></figure>

<h3 id="3-repeat-while循环"><a href="#3-repeat-while循环" class="headerlink" title="3. repeat-while循环"></a>3. repeat-while循环</h3><p><code>repeat-while</code>循环（相当于其他语言中的<code>do-while</code>循环）先执行代码块，再判断条件：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> index <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(index)</span><br><span class="line">    index <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">while</span> index <span class="operator">&lt;</span> <span class="number">5</span></span><br><span class="line"><span class="comment">// 输出：0, 1, 2, 3, 4</span></span><br></pre></td></tr></table></figure>

<p><code>repeat-while</code>循环保证代码块至少执行一次：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> number <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(number)</span><br><span class="line">    number <span class="operator">-=</span> <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">while</span> number <span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line"><span class="comment">// 输出：5</span></span><br></pre></td></tr></table></figure>

<h3 id="4-函数式循环（高阶函数）"><a href="#4-函数式循环（高阶函数）" class="headerlink" title="4. 函数式循环（高阶函数）"></a>4. 函数式循环（高阶函数）</h3><p>除了传统的循环语句外，Swift还提供了函数式编程的方式来处理集合，这些方式更加简洁和声明式。常用的高阶函数包括<code>map</code>、<code>filter</code>、<code>reduce</code>等。</p>
<h4 id="1-map方法"><a href="#1-map方法" class="headerlink" title="1. map方法"></a>1. map方法</h4><p><code>map</code>方法用于对集合中的每个元素应用一个转换函数，并返回一个包含转换后元素的新集合：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 对数组中的每个元素进行平方运算</span></span><br><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> squaredNumbers <span class="operator">=</span> numbers.map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="variable">$0</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(squaredNumbers) <span class="comment">// 输出：[1, 4, 9, 16, 25]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将字符串转换为整数</span></span><br><span class="line"><span class="keyword">let</span> stringNumbers <span class="operator">=</span> [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> integers <span class="operator">=</span> stringNumbers.map &#123; <span class="type">Int</span>(<span class="variable">$0</span>)<span class="operator">!</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(integers) <span class="comment">// 输出：[1, 2, 3, 4, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用完整的闭包语法</span></span><br><span class="line"><span class="keyword">let</span> doubledNumbers <span class="operator">=</span> numbers.map(&#123; (number: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> number <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(doubledNumbers) <span class="comment">// 输出：[2, 4, 6, 8, 10]</span></span><br></pre></td></tr></table></figure>

<h4 id="2-filter方法"><a href="#2-filter方法" class="headerlink" title="2. filter方法"></a>2. filter方法</h4><p><code>filter</code>方法用于根据条件过滤集合中的元素，并返回一个包含满足条件元素的新集合：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 过滤出偶数</span></span><br><span class="line"><span class="keyword">let</span> evenNumbers <span class="operator">=</span> numbers.filter &#123; <span class="variable">$0</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(evenNumbers) <span class="comment">// 输出：[2, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤出大于3的数</span></span><br><span class="line"><span class="keyword">let</span> greaterThanThree <span class="operator">=</span> numbers.filter &#123; <span class="variable">$0</span> <span class="operator">&gt;</span> <span class="number">3</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(greaterThanThree) <span class="comment">// 输出：[4, 5]</span></span><br></pre></td></tr></table></figure>

<h4 id="3-reduce方法"><a href="#3-reduce方法" class="headerlink" title="3. reduce方法"></a>3. reduce方法</h4><p><code>reduce</code>方法用于将集合中的所有元素合并为一个值：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 计算数组元素的和</span></span><br><span class="line"><span class="keyword">let</span> sum <span class="operator">=</span> numbers.reduce(<span class="number">0</span>, &#123; <span class="variable">$0</span> <span class="operator">+</span> <span class="variable">$1</span> &#125;)</span><br><span class="line"><span class="built_in">print</span>(sum) <span class="comment">// 输出：15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用运算符函数</span></span><br><span class="line"><span class="keyword">let</span> product <span class="operator">=</span> numbers.reduce(<span class="number">1</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="built_in">print</span>(product) <span class="comment">// 输出：120</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 拼接字符串</span></span><br><span class="line"><span class="keyword">let</span> fruits <span class="operator">=</span> [<span class="string">&quot;苹果&quot;</span>, <span class="string">&quot;香蕉&quot;</span>, <span class="string">&quot;橙子&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> fruitString <span class="operator">=</span> fruits.reduce(<span class="string">&quot;水果列表：&quot;</span>) &#123; <span class="variable">$0</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="variable">$1</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(fruitString) <span class="comment">// 输出：水果列表：, 苹果, 香蕉, 橙子</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理初始值的情况</span></span><br><span class="line"><span class="keyword">let</span> cleanFruitString <span class="operator">=</span> fruits.reduce(<span class="string">&quot;&quot;</span>) &#123; result, fruit <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> result.isEmpty &#123;</span><br><span class="line">        <span class="keyword">return</span> fruit</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> result <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> fruit</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(cleanFruitString) <span class="comment">// 输出：苹果, 香蕉, 橙子</span></span><br></pre></td></tr></table></figure>

<h4 id="4-链式调用"><a href="#4-链式调用" class="headerlink" title="4. 链式调用"></a>4. 链式调用</h4><p>这些高阶函数可以链式调用，实现更复杂的操作：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 先过滤出偶数，然后对每个元素进行平方运算，最后计算总和</span></span><br><span class="line"><span class="keyword">let</span> evenSquaredSum <span class="operator">=</span> numbers.filter &#123; <span class="variable">$0</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#125;</span><br><span class="line">                             .map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="variable">$0</span> &#125;</span><br><span class="line">                             .reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line"><span class="built_in">print</span>(evenSquaredSum) <span class="comment">// 输出：20 (2² + 4² = 4 + 16 = 20)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 先将数字转换为字符串，然后过滤出长度大于1的字符串，最后拼接</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> numbers.map &#123; <span class="type">String</span>(<span class="variable">$0</span>) &#125;</span><br><span class="line">                    .filter &#123; <span class="variable">$0</span>.count <span class="operator">&gt;</span> <span class="number">1</span> &#125;</span><br><span class="line">                    .reduce(<span class="string">&quot;&quot;</span>, &#123; <span class="variable">$0</span>.isEmpty <span class="operator">?</span> <span class="variable">$1</span> : <span class="variable">$0</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="variable">$1</span> &#125;)</span><br><span class="line"><span class="built_in">print</span>(result) <span class="comment">// 输出：(空字符串，因为1-5转换为字符串后长度都为1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用更大的数字演示</span></span><br><span class="line"><span class="keyword">let</span> largerNumbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">20</span>, <span class="number">3</span>, <span class="number">30</span>]</span><br><span class="line"><span class="keyword">let</span> largeResult <span class="operator">=</span> largerNumbers.map &#123; <span class="type">String</span>(<span class="variable">$0</span>) &#125;</span><br><span class="line">                               .filter &#123; <span class="variable">$0</span>.count <span class="operator">&gt;</span> <span class="number">1</span> &#125;</span><br><span class="line">                               .reduce(<span class="string">&quot;&quot;</span>, &#123; <span class="variable">$0</span>.isEmpty <span class="operator">?</span> <span class="variable">$1</span> : <span class="variable">$0</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="variable">$1</span> &#125;)</span><br><span class="line"><span class="built_in">print</span>(largeResult) <span class="comment">// 输出：10, 20, 30</span></span><br></pre></td></tr></table></figure>

<p>这些高阶函数提供了一种更加声明式的方式来处理集合，使代码更加简洁和易读。在实际开发中，它们经常被用来替代传统的循环语句。</p>
<h2 id="四、控制转移语句"><a href="#四、控制转移语句" class="headerlink" title="四、控制转移语句"></a>四、控制转移语句</h2><p>控制转移语句用于改变代码的执行顺序，Swift提供了以下控制转移语句：<code>break</code>、<code>continue</code>、<code>fallthrough</code>、<code>return</code>和<code>throw</code>。</p>
<h3 id="1-break语句"><a href="#1-break语句" class="headerlink" title="1. break语句"></a>1. break语句</h3><p><code>break</code>语句用于终止循环或<code>switch</code>语句的执行：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 终止for-in循环</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> i <span class="operator">==</span> <span class="number">5</span> &#123;</span><br><span class="line">        <span class="keyword">break</span> <span class="comment">// 当i等于5时，终止循环</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：1, 2, 3, 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 终止while循环</span></span><br><span class="line"><span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count <span class="operator">&lt;</span> <span class="number">10</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> count <span class="operator">==</span> <span class="number">5</span> &#123;</span><br><span class="line">        <span class="keyword">break</span> <span class="comment">// 当count等于5时，终止循环</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">    count <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：0, 1, 2, 3, 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 终止switch语句</span></span><br><span class="line"><span class="keyword">let</span> number <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字1&quot;</span>)</span><br><span class="line">    <span class="keyword">break</span> <span class="comment">// 终止switch语句</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字2&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他数字&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-continue语句"><a href="#2-continue语句" class="headerlink" title="2. continue语句"></a>2. continue语句</h3><p><code>continue</code>语句用于跳过当前循环迭代，继续执行下一次迭代：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在for-in循环中使用continue</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> i <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">continue</span> <span class="comment">// 跳过偶数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：1, 3, 5, 7, 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在while循环中使用continue</span></span><br><span class="line"><span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count <span class="operator">&lt;</span> <span class="number">10</span> &#123;</span><br><span class="line">    count <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> count <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">continue</span> <span class="comment">// 跳过偶数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：1, 3, 5, 7, 9</span></span><br></pre></td></tr></table></figure>

<h3 id="3-fallthrough语句"><a href="#3-fallthrough语句" class="headerlink" title="3. fallthrough语句"></a>3. fallthrough语句</h3><p><code>fallthrough</code>语句用于在<code>switch</code>语句中执行完当前<code>case</code>后，继续执行下一个<code>case</code>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> number <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字1&quot;</span>)</span><br><span class="line">    <span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字2&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他数字&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// 数字1</span></span><br><span class="line"><span class="comment">// 数字2</span></span><br></pre></td></tr></table></figure>

<h3 id="4-return语句"><a href="#4-return语句" class="headerlink" title="4. return语句"></a>4. return语句</h3><p><code>return</code>语句用于从函数或方法中返回，并可选地返回一个值：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">add</span>(<span class="params">a</span>: <span class="type">Int</span>, <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a <span class="operator">+</span> b <span class="comment">// 返回a + b的值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">greet</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello, <span class="subst">\(name)</span>!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="comment">// 返回，后面的代码不会执行</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This line will not be executed.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、带标签的语句"><a href="#五、带标签的语句" class="headerlink" title="五、带标签的语句"></a>五、带标签的语句</h2><p>在Swift中，可以为循环或<code>switch</code>语句添加标签，以便在嵌套结构中精确控制：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">outerLoop: <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">    innerLoop: <span class="keyword">for</span> j <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> i <span class="operator">==</span> <span class="number">2</span> <span class="operator">&amp;&amp;</span> j <span class="operator">==</span> <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">break</span> outerLoop <span class="comment">// 终止外部循环</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;i = <span class="subst">\(i)</span>, j = <span class="subst">\(j)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// i = 1, j = 1</span></span><br><span class="line"><span class="comment">// i = 1, j = 2</span></span><br><span class="line"><span class="comment">// i = 1, j = 3</span></span><br><span class="line"><span class="comment">// i = 2, j = 1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">outerLoop: <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">    innerLoop: <span class="keyword">for</span> j <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> i <span class="operator">==</span> <span class="number">2</span> <span class="operator">&amp;&amp;</span> j <span class="operator">==</span> <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span> outerLoop <span class="comment">// 继续外部循环的下一次迭代</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;i = <span class="subst">\(i)</span>, j = <span class="subst">\(j)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// i = 1, j = 1</span></span><br><span class="line"><span class="comment">// i = 1, j = 2</span></span><br><span class="line"><span class="comment">// i = 1, j = 3</span></span><br><span class="line"><span class="comment">// i = 2, j = 1</span></span><br><span class="line"><span class="comment">// i = 3, j = 1</span></span><br><span class="line"><span class="comment">// i = 3, j = 2</span></span><br><span class="line"><span class="comment">// i = 3, j = 3</span></span><br></pre></td></tr></table></figure>

<h2 id="六、API可用性检查"><a href="#六、API可用性检查" class="headerlink" title="六、API可用性检查"></a>六、API可用性检查</h2><p>在Swift中，可以使用<code>#available</code>关键字检查API的可用性，确保代码在不同的iOS版本上都能正常运行：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">#available</span>(<span class="keyword">iOS</span> <span class="number">15.0</span>, <span class="operator">*</span>) &#123;</span><br><span class="line">    <span class="comment">// 使用iOS 15.0及以上版本可用的API</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;使用iOS 15.0的新特性&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 使用兼容旧版本的API</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;使用兼容旧版本的实现&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>#available</code>关键字的语法为：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">#available</span>(platform name version, <span class="operator">...</span>, <span class="operator">*</span>)</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li><code>platform name</code>是平台名称，如iOS、macOS、watchOS等</li>
<li><code>version</code>是版本号</li>
<li><code>*</code>表示在所有其他平台上可用</li>
</ul>
<h2 id="七、内容机制与知识点总结"><a href="#七、内容机制与知识点总结" class="headerlink" title="七、内容机制与知识点总结"></a>七、内容机制与知识点总结</h2><h3 id="1-内容机制"><a href="#1-内容机制" class="headerlink" title="1. 内容机制"></a>1. 内容机制</h3><p>Swift的控制流系统设计遵循以下核心原则：</p>
<ul>
<li><strong>简洁性</strong>：通过自动退出<code>switch</code>语句、可选绑定等特性，减少冗余代码</li>
<li><strong>安全性</strong>：<code>guard</code>语句强制处理错误情况，避免潜在的运行时错误</li>
<li><strong>灵活性</strong>：支持多种匹配模式和控制转移方式，适应不同的编程场景</li>
<li><strong>可读性</strong>：清晰的语法结构和命名约定，提高代码的可维护性</li>
</ul>
<h3 id="2-知识点总结"><a href="#2-知识点总结" class="headerlink" title="2. 知识点总结"></a>2. 知识点总结</h3><table>
<thead>
<tr>
<th>主题</th>
<th>核心知识点</th>
</tr>
</thead>
<tbody><tr>
<td>条件语句</td>
<td>if-else、嵌套if-else、guard语句、switch语句</td>
</tr>
<tr>
<td>Switch特性</td>
<td>自动退出、fallthrough、区间匹配、元组匹配、值绑定、where子句</td>
</tr>
<tr>
<td>循环语句</td>
<td>for-in循环、while循环、repeat-while循环、stride函数</td>
</tr>
<tr>
<td>函数式循环</td>
<td>map、filter、reduce、链式调用</td>
</tr>
<tr>
<td>控制转移</td>
<td>break、continue、fallthrough、return</td>
</tr>
<tr>
<td>带标签语句</td>
<td>标签定义、标签化break&#x2F;continue</td>
</tr>
<tr>
<td>API可用性</td>
<td>#available关键字、平台版本检查</td>
</tr>
</tbody></table>
<h2 id="八、遇到的问题及解决方案"><a href="#八、遇到的问题及解决方案" class="headerlink" title="八、遇到的问题及解决方案"></a>八、遇到的问题及解决方案</h2><h3 id="1-过多的嵌套if-else导致代码可读性差"><a href="#1-过多的嵌套if-else导致代码可读性差" class="headerlink" title="1. 过多的嵌套if-else导致代码可读性差"></a>1. 过多的嵌套if-else导致代码可读性差</h3><p><strong>问题</strong>：当有多个条件需要检查时，嵌套的if-else语句会使代码变得难以阅读和维护</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> condition1 &#123;</span><br><span class="line">    <span class="keyword">if</span> condition2 &#123;</span><br><span class="line">        <span class="keyword">if</span> condition3 &#123;</span><br><span class="line">            <span class="comment">// 代码逻辑</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 错误处理</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 错误处理</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 错误处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用guard语句提前退出，减少嵌套层级</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">guard</span> condition1 <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 错误处理</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> condition2 <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 错误处理</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> condition3 <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 错误处理</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码逻辑</span></span><br></pre></td></tr></table></figure>

<h3 id="2-Switch语句缺少默认分支"><a href="#2-Switch语句缺少默认分支" class="headerlink" title="2. Switch语句缺少默认分支"></a>2. Switch语句缺少默认分支</h3><p><strong>问题</strong>：当switch语句没有覆盖所有可能的情况且缺少default分支时，会导致编译错误</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span> &#123; <span class="keyword">case</span> north, south, east, west &#125;</span><br><span class="line"><span class="keyword">let</span> direction <span class="operator">=</span> <span class="type">Direction</span>.north</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> direction &#123;</span><br><span class="line"><span class="keyword">case</span> .north:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向北&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .south:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向南&quot;</span>)</span><br><span class="line"><span class="comment">// 缺少east和west的case，也没有default分支</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：确保覆盖所有可能的情况，或添加default分支</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> direction &#123;</span><br><span class="line"><span class="keyword">case</span> .north:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向北&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .south:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向南&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向东或向西&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-意外的fallthrough行为"><a href="#3-意外的fallthrough行为" class="headerlink" title="3. 意外的fallthrough行为"></a>3. 意外的fallthrough行为</h3><p><strong>问题</strong>：在switch语句中忘记fallthrough关键字会导致代码不按预期执行</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> number <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字1&quot;</span>)</span><br><span class="line">    <span class="comment">// 期望执行下一个case，但忘记了fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字2&quot;</span>) <span class="comment">// 不会执行</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他数字&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：明确使用fallthrough关键字，或重构代码以避免依赖fallthrough</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方法1：使用fallthrough</span></span><br><span class="line"><span class="keyword">switch</span> number &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字1&quot;</span>)</span><br><span class="line">    <span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字2&quot;</span>) <span class="comment">// 会执行</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他数字&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：重构代码</span></span><br><span class="line"><span class="keyword">if</span> number <span class="operator">==</span> <span class="number">1</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> number <span class="operator">==</span> <span class="number">1</span> <span class="operator">||</span> number <span class="operator">==</span> <span class="number">2</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数字2&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-死循环问题"><a href="#4-死循环问题" class="headerlink" title="4. 死循环问题"></a>4. 死循环问题</h3><p><strong>问题</strong>：循环条件永远为真，导致程序陷入死循环</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count <span class="operator">&lt;</span> <span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">    <span class="comment">// 忘记递增count，导致死循环</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：确保循环条件最终会变为假，并在循环体内更新相关变量</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count <span class="operator">&lt;</span> <span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">    count <span class="operator">+=</span> <span class="number">1</span> <span class="comment">// 递增count，确保循环最终会结束</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-高阶函数性能问题"><a href="#5-高阶函数性能问题" class="headerlink" title="5. 高阶函数性能问题"></a>5. 高阶函数性能问题</h3><p><strong>问题</strong>：在处理大型数据集时，链式调用多个高阶函数可能导致性能问题</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> largeArray <span class="operator">=</span> <span class="type">Array</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">1000000</span>)</span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> largeArray.filter &#123; <span class="variable">$0</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#125;</span><br><span class="line">                       .map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="variable">$0</span> &#125;</span><br><span class="line">                       .reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用传统循环或优化高阶函数调用</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方法1：使用传统循环（减少中间数组的创建）</span></span><br><span class="line"><span class="keyword">var</span> sum <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> largeArray &#123;</span><br><span class="line">    <span class="keyword">if</span> number <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">        sum <span class="operator">+=</span> number <span class="operator">*</span> number</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：使用lazy修饰符（延迟计算）</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> largeArray.lazy.filter &#123; <span class="variable">$0</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#125;</span><br><span class="line">                           .map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="variable">$0</span> &#125;</span><br><span class="line">                           .reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br></pre></td></tr></table></figure>

<h2 id="九、高阶用法"><a href="#九、高阶用法" class="headerlink" title="九、高阶用法"></a>九、高阶用法</h2><h3 id="1-高级条件语句技巧"><a href="#1-高级条件语句技巧" class="headerlink" title="1. 高级条件语句技巧"></a>1. 高级条件语句技巧</h3><h4 id="可选绑定的高级用法"><a href="#可选绑定的高级用法" class="headerlink" title="可选绑定的高级用法"></a>可选绑定的高级用法</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 同时绑定多个可选值</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> name <span class="operator">=</span> optionalName, <span class="keyword">let</span> age <span class="operator">=</span> optionalAge, age <span class="operator">&gt;=</span> <span class="number">18</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span>已满18岁&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在guard中使用可选绑定</span></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> name <span class="operator">=</span> optionalName, <span class="keyword">let</span> age <span class="operator">=</span> optionalAge <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span>的年龄是<span class="subst">\(age)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Switch语句的高级匹配模式"><a href="#Switch语句的高级匹配模式" class="headerlink" title="Switch语句的高级匹配模式"></a>Switch语句的高级匹配模式</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 枚举关联值匹配</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> success(<span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> failure(<span class="type">Error</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> <span class="type">Result</span>.success(<span class="number">42</span>)</span><br><span class="line"><span class="keyword">switch</span> result &#123;</span><br><span class="line"><span class="keyword">case</span> .success(<span class="keyword">let</span> value) <span class="keyword">where</span> value <span class="operator">&gt;</span> <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;成功，值为<span class="subst">\(value)</span>&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .success(<span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;成功，但值为0&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;失败，错误：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型匹配</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">processValue</span>(<span class="keyword">_</span> <span class="params">value</span>: <span class="keyword">Any</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> value &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> number <span class="keyword">as</span> <span class="type">Int</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;整数：<span class="subst">\(number)</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> text <span class="keyword">as</span> <span class="type">String</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;字符串：<span class="subst">\(text)</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> array <span class="keyword">as</span> [<span class="keyword">Any</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;数组，包含<span class="subst">\(array.count)</span>个元素&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;其他类型&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-高级循环技巧"><a href="#2-高级循环技巧" class="headerlink" title="2. 高级循环技巧"></a>2. 高级循环技巧</h3><h4 id="并发循环"><a href="#并发循环" class="headerlink" title="并发循环"></a>并发循环</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用DispatchQueue.concurrentPerform进行并行循环</span></span><br><span class="line"><span class="keyword">let</span> items <span class="operator">=</span> <span class="type">Array</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">100</span>)</span><br><span class="line"><span class="type">DispatchQueue</span>.concurrentPerform(iterations: items.count) &#123; index <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> item <span class="operator">=</span> items[index]</span><br><span class="line">    <span class="comment">// 并行处理每个item</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;处理项目：<span class="subst">\(item)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="无限循环的优雅退出"><a href="#无限循环的优雅退出" class="headerlink" title="无限循环的优雅退出"></a>无限循环的优雅退出</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用break和标签退出无限循环</span></span><br><span class="line">outerLoop:</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> input <span class="operator">=</span> <span class="built_in">readLine</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> input &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;quit&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span> outerLoop <span class="comment">// 退出无限循环</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;help&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;帮助信息&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;你输入了：<span class="subst">\(input <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-高级函数式编程"><a href="#3-高级函数式编程" class="headerlink" title="3. 高级函数式编程"></a>3. 高级函数式编程</h3><h4 id="自定义高阶函数"><a href="#自定义高阶函数" class="headerlink" title="自定义高阶函数"></a>自定义高阶函数</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自定义高阶函数：执行指定次数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">repeat</span>(<span class="params">times</span>: <span class="type">Int</span>, <span class="params">closure</span>: (<span class="type">Int</span>) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>times &#123;</span><br><span class="line">        closure(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用自定义高阶函数</span></span><br><span class="line"><span class="keyword">repeat</span>(times: <span class="number">5</span>) &#123; index <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行第<span class="subst">\(index <span class="operator">+</span> <span class="number">1</span>)</span>次&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义高阶函数：分组</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">group</span>&lt;<span class="type">T</span>, <span class="type">Key</span>: <span class="type">Hashable</span>&gt;(<span class="keyword">_</span> <span class="params">elements</span>: [<span class="type">T</span>], <span class="params">by</span> <span class="params">keyPath</span>: <span class="type">KeyPath</span>&lt;<span class="type">T</span>, <span class="type">Key</span>&gt;) -&gt; [<span class="type">Key</span>: [<span class="type">T</span>]] &#123;</span><br><span class="line">    <span class="keyword">var</span> result: [<span class="type">Key</span>: [<span class="type">T</span>]] <span class="operator">=</span> [:]</span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> elements &#123;</span><br><span class="line">        <span class="keyword">let</span> key <span class="operator">=</span> element[keyPath: keyPath]</span><br><span class="line">        result[key, <span class="keyword">default</span>: []].append(element)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用分组函数</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> age: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> people <span class="operator">=</span> [</span><br><span class="line">    <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">20</span>),</span><br><span class="line">    <span class="type">Person</span>(name: <span class="string">&quot;李四&quot;</span>, age: <span class="number">25</span>),</span><br><span class="line">    <span class="type">Person</span>(name: <span class="string">&quot;王五&quot;</span>, age: <span class="number">20</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> groupedByAge <span class="operator">=</span> group(people, by: \.age) <span class="comment">// [20: [张三, 王五], 25: [李四]]</span></span><br></pre></td></tr></table></figure>

<h4 id="函数式编程的性能优化"><a href="#函数式编程的性能优化" class="headerlink" title="函数式编程的性能优化"></a>函数式编程的性能优化</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用reduce替代多个高阶函数调用（减少中间数组）</span></span><br><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传统方式（创建两个中间数组）</span></span><br><span class="line"><span class="keyword">let</span> evenSum1 <span class="operator">=</span> numbers.filter &#123; <span class="variable">$0</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#125;</span><br><span class="line">                     .map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="variable">$0</span> &#125;</span><br><span class="line">                     .reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 优化方式（只遍历一次）</span></span><br><span class="line"><span class="keyword">let</span> evenSum2 <span class="operator">=</span> numbers.reduce(<span class="number">0</span>) &#123; sum, number <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span> number <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> sum &#125;</span><br><span class="line">    <span class="keyword">return</span> sum <span class="operator">+</span> number <span class="operator">*</span> number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-高级控制转移技巧"><a href="#4-高级控制转移技巧" class="headerlink" title="4. 高级控制转移技巧"></a>4. 高级控制转移技巧</h3><h4 id="带条件的return"><a href="#带条件的return" class="headerlink" title="带条件的return"></a>带条件的return</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">validateInput</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">String</span>?) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="comment">// 检查输入是否为nil</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> input <span class="operator">=</span> input <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查输入是否为空</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="operator">!</span>input.isEmpty <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查输入长度</span></span><br><span class="line">    <span class="keyword">guard</span> input.count <span class="operator">&gt;=</span> <span class="number">3</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="抛出错误替代多层return"><a href="#抛出错误替代多层return" class="headerlink" title="抛出错误替代多层return"></a>抛出错误替代多层return</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">ValidationError</span>: <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> nilInput</span><br><span class="line">    <span class="keyword">case</span> emptyInput</span><br><span class="line">    <span class="keyword">case</span> tooShort</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">validateInput</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">String</span>?) <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> input <span class="operator">=</span> input <span class="keyword">else</span> &#123; <span class="keyword">throw</span> <span class="type">ValidationError</span>.nilInput &#125;</span><br><span class="line">    <span class="keyword">guard</span> <span class="operator">!</span>input.isEmpty <span class="keyword">else</span> &#123; <span class="keyword">throw</span> <span class="type">ValidationError</span>.emptyInput &#125;</span><br><span class="line">    <span class="keyword">guard</span> input.count <span class="operator">&gt;=</span> <span class="number">3</span> <span class="keyword">else</span> &#123; <span class="keyword">throw</span> <span class="type">ValidationError</span>.tooShort &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用do-catch处理错误</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> validateInput(<span class="string">&quot;ab&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入有效&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">ValidationError</span>.nilInput &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入为nil&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">ValidationError</span>.emptyInput &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入为空&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">ValidationError</span>.tooShort &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入太短&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他错误：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-性能优化策略"><a href="#5-性能优化策略" class="headerlink" title="5. 性能优化策略"></a>5. 性能优化策略</h3><h4 id="循环优化"><a href="#循环优化" class="headerlink" title="循环优化"></a>循环优化</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 预计算边界条件</span></span><br><span class="line"><span class="keyword">let</span> items <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> count <span class="operator">=</span> items.count <span class="comment">// 预计算数组长度</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>count &#123;</span><br><span class="line">    <span class="built_in">print</span>(items[i])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用快速枚举（for-in）替代索引访问</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> items &#123;</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Switch语句优化"><a href="#Switch语句优化" class="headerlink" title="Switch语句优化"></a>Switch语句优化</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将最常见的case放在前面</span></span><br><span class="line"><span class="keyword">let</span> value <span class="operator">=</span> getSomeValue()</span><br><span class="line"><span class="keyword">switch</span> value &#123;</span><br><span class="line"><span class="keyword">case</span> .commonCase:</span><br><span class="line">    <span class="comment">// 处理最常见的情况</span></span><br><span class="line"><span class="keyword">case</span> .lessCommonCase:</span><br><span class="line">    <span class="comment">// 处理不太常见的情况</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">// 处理其他情况</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-最佳实践"><a href="#6-最佳实践" class="headerlink" title="6. 最佳实践"></a>6. 最佳实践</h3><h4 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h4><ul>
<li>优先使用<code>guard</code>语句处理错误情况，提高代码可读性</li>
<li>当有3个以上条件分支时，考虑使用<code>switch</code>语句替代<code>if-else</code></li>
<li>利用Swift的模式匹配功能，简化复杂的条件判断</li>
</ul>
<h4 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h4><ul>
<li>优先使用<code>for-in</code>循环遍历集合，除非需要显式的索引</li>
<li>对于简单的转换和过滤操作，考虑使用高阶函数</li>
<li>处理大型数据集时，注意避免创建不必要的中间数组</li>
</ul>
<h4 id="控制转移"><a href="#控制转移" class="headerlink" title="控制转移"></a>控制转移</h4><ul>
<li>避免使用<code>fallthrough</code>，除非有明确的理由</li>
<li>使用标签化语句时，确保标签名称具有描述性</li>
<li>尽量减少<code>break</code>和<code>continue</code>的使用，使代码流程更加清晰</li>
</ul>
<h2 id="十、实践练习"><a href="#十、实践练习" class="headerlink" title="十、实践练习"></a>十、实践练习</h2><h3 id="1-条件语句应用"><a href="#1-条件语句应用" class="headerlink" title="1. 条件语句应用"></a>1. 条件语句应用</h3><p><strong>题目1</strong>：使用switch语句实现一个简单的计算器，支持+、-、*、&#x2F;四种运算。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 简单计算器实现</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">calculate</span>(<span class="keyword">_</span> <span class="params">num1</span>: <span class="type">Double</span>, <span class="keyword">_</span> <span class="params">operation</span>: <span class="type">String</span>, <span class="keyword">_</span> <span class="params">num2</span>: <span class="type">Double</span>) -&gt; <span class="type">Double</span>? &#123;</span><br><span class="line">    <span class="keyword">switch</span> operation &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> num1 <span class="operator">+</span> num2</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> num1 <span class="operator">-</span> num2</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> num1 <span class="operator">*</span> num2</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;/&quot;</span>:</span><br><span class="line">        <span class="keyword">guard</span> num2 <span class="operator">!=</span> <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;除数不能为0&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num1 <span class="operator">/</span> num2</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;不支持的运算符号&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> result <span class="operator">=</span> calculate(<span class="number">10</span>, <span class="string">&quot;+&quot;</span>, <span class="number">5</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;10 + 5 = <span class="subst">\(result)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> result <span class="operator">=</span> calculate(<span class="number">10</span>, <span class="string">&quot;/&quot;</span>, <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;10 / 0 = <span class="subst">\(result)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>题目2</strong>：使用guard语句重写以下嵌套的if-else代码，提高可读性。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">processUser</span>(<span class="params">name</span>: <span class="type">String</span>?, <span class="params">age</span>: <span class="type">Int</span>?, <span class="params">email</span>: <span class="type">String</span>?) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> name <span class="operator">=</span> name &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> age <span class="operator">=</span> age &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> email <span class="operator">=</span> email &#123;</span><br><span class="line">                <span class="keyword">if</span> age <span class="operator">&gt;=</span> <span class="number">18</span> &#123;</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;用户<span class="subst">\(name)</span>（<span class="subst">\(age)</span>岁）注册成功，邮箱：<span class="subst">\(email)</span>&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;年龄必须满18岁&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;请提供邮箱地址&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请提供年龄&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请提供姓名&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">processUser</span>(<span class="params">name</span>: <span class="type">String</span>?, <span class="params">age</span>: <span class="type">Int</span>?, <span class="params">email</span>: <span class="type">String</span>?) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> name <span class="operator">=</span> name <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请提供姓名&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> age <span class="operator">=</span> age <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请提供年龄&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> email <span class="operator">=</span> email <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请提供邮箱地址&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">guard</span> age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;年龄必须满18岁&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;用户<span class="subst">\(name)</span>（<span class="subst">\(age)</span>岁）注册成功，邮箱：<span class="subst">\(email)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-循环语句应用"><a href="#2-循环语句应用" class="headerlink" title="2. 循环语句应用"></a>2. 循环语句应用</h3><p><strong>题目3</strong>：使用for-in循环遍历1到100，计算所有偶数的和。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 计算1到100之间所有偶数的和</span></span><br><span class="line"><span class="keyword">var</span> sum <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">100</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> number <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">        sum <span class="operator">+=</span> number</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;1到100之间所有偶数的和：<span class="subst">\(sum)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>题目4</strong>：使用while循环实现斐波那契数列的前20项。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 斐波那契数列的前20项</span></span><br><span class="line"><span class="keyword">var</span> first <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> second <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;斐波那契数列的前20项：&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> count <span class="operator">&lt;</span> <span class="number">20</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(first)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> next <span class="operator">=</span> first <span class="operator">+</span> second</span><br><span class="line">    first <span class="operator">=</span> second</span><br><span class="line">    second <span class="operator">=</span> next</span><br><span class="line">    </span><br><span class="line">    count <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-高阶函数应用"><a href="#3-高阶函数应用" class="headerlink" title="3. 高阶函数应用"></a>3. 高阶函数应用</h3><p><strong>题目5</strong>：使用map、filter和reduce函数处理以下数组，找出所有偶数并计算它们的平方和。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure>

<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法1：使用链式调用</span></span><br><span class="line"><span class="keyword">let</span> sumOfSquares <span class="operator">=</span> numbers.filter &#123; <span class="variable">$0</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#125;</span><br><span class="line">                         .map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="variable">$0</span> &#125;</span><br><span class="line">                         .reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;偶数的平方和：<span class="subst">\(sumOfSquares)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：使用lazy提高性能</span></span><br><span class="line"><span class="keyword">let</span> sumOfSquaresLazy <span class="operator">=</span> numbers.lazy.filter &#123; <span class="variable">$0</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#125;</span><br><span class="line">                                  .map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="variable">$0</span> &#125;</span><br><span class="line">                                  .reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;偶数的平方和（使用lazy）：<span class="subst">\(sumOfSquaresLazy)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>题目6</strong>：使用switch语句的元组匹配功能，根据坐标点所在象限进行分类。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据坐标点所在象限进行分类</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">classifyPoint</span>(<span class="keyword">_</span> <span class="params">point</span>: (x: <span class="type">Double</span>, y: <span class="type">Double</span>)) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> point &#123;</span><br><span class="line">    <span class="keyword">case</span> (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;原点&quot;</span></span><br><span class="line">    <span class="keyword">case</span> (<span class="keyword">_</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;在x轴上&quot;</span></span><br><span class="line">    <span class="keyword">case</span> (<span class="number">0</span>, <span class="keyword">_</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;在y轴上&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">where</span> x <span class="operator">&gt;</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> y <span class="operator">&gt;</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;第一象限&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">where</span> x <span class="operator">&lt;</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> y <span class="operator">&gt;</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;第二象限&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">where</span> x <span class="operator">&lt;</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> y <span class="operator">&lt;</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;第三象限&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">where</span> x <span class="operator">&gt;</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> y <span class="operator">&lt;</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;第四象限&quot;</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;未知&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="built_in">print</span>(classifyPoint((<span class="number">0</span>, <span class="number">0</span>))) <span class="comment">// 原点</span></span><br><span class="line"><span class="built_in">print</span>(classifyPoint((<span class="number">5</span>, <span class="number">0</span>))) <span class="comment">// 在x轴上</span></span><br><span class="line"><span class="built_in">print</span>(classifyPoint((<span class="number">3</span>, <span class="number">4</span>))) <span class="comment">// 第一象限</span></span><br><span class="line"><span class="built_in">print</span>(classifyPoint((<span class="operator">-</span><span class="number">2</span>, <span class="number">3</span>))) <span class="comment">// 第二象限</span></span><br><span class="line"><span class="built_in">print</span>(classifyPoint((<span class="operator">-</span><span class="number">1</span>, <span class="operator">-</span><span class="number">1</span>))) <span class="comment">// 第三象限</span></span><br><span class="line"><span class="built_in">print</span>(classifyPoint((<span class="number">4</span>, <span class="operator">-</span><span class="number">5</span>))) <span class="comment">// 第四象限</span></span><br></pre></td></tr></table></figure>

<h2 id="十一、总结"><a href="#十一、总结" class="headerlink" title="十一、总结"></a>十一、总结</h2><p>在这篇学习日记中，我们深入探讨了Swift的控制流语句：</p>
<ol>
<li><p><strong>条件语句</strong>：包括<code>if-else</code>、<code>guard</code>和<code>switch</code>语句，其中<code>guard</code>语句可以提前退出，减少嵌套层级，<code>switch</code>语句支持多种匹配模式</p>
</li>
<li><p><strong>循环语句</strong>：包括<code>for-in</code>、<code>while</code>和<code>repeat-while</code>循环，以及函数式编程中的<code>map</code>、<code>filter</code>和<code>reduce</code></p>
</li>
<li><p><strong>控制转移语句</strong>：包括<code>break</code>、<code>continue</code>、<code>fallthrough</code>和<code>return</code>，用于改变代码的执行顺序</p>
</li>
<li><p><strong>高级用法</strong>：包括高级条件语句技巧、高级循环技巧、高级函数式编程、高级控制转移技巧以及性能优化策略</p>
</li>
</ol>
<p>掌握控制流语句是编程的基础，它们使我们能够根据不同的条件执行不同的代码块，或者重复执行一段代码。在下一篇学习日记中，我们将继续学习Swift的函数和闭包。</p>
]]></content>
      <tags>
        <tag>swift</tag>
      </tags>
  </entry>
  <entry>
    <title>swift学习日记(十)</title>
    <url>/ios.github.io/2025/12/16/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E5%8D%81%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Swift学习日记（十）：Swift高级特性与未来展望"><a href="#Swift学习日记（十）：Swift高级特性与未来展望" class="headerlink" title="Swift学习日记（十）：Swift高级特性与未来展望"></a>Swift学习日记（十）：Swift高级特性与未来展望</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>在前面的学习日记中，我们已经学习了Swift的核心概念和基础特性，包括语法规则、数据类型、控制流、函数、面向对象编程、枚举、协议、扩展、泛型、错误处理和内存管理等。在这篇日记中，我们将探讨Swift的一些高级特性，并展望Swift的未来发展。这些高级特性包括SwiftUI、并发编程、Swift Package Manager等，它们代表了Swift的最新发展方向。</p>
<!-- CATEGORY: SwiftUI -->
<!-- INTERVIEW_TOPIC: SwiftUI基础 -->
<!-- HIGH_FREQUENCY_INTERVIEW: 声明式UI -->

<h2 id="二、SwiftUI"><a href="#二、SwiftUI" class="headerlink" title="二、SwiftUI"></a>二、SwiftUI</h2><p>SwiftUI是苹果在2019年WWDC上推出的一个全新的用户界面框架，它使用声明式语法来构建跨平台的用户界面。SwiftUI支持iOS、iPadOS、macOS、tvOS和watchOS等多个平台，可以大大减少代码量，提高开发效率。</p>
<h3 id="1-SwiftUI的基本概念"><a href="#1-SwiftUI的基本概念" class="headerlink" title="1. SwiftUI的基本概念"></a>1. SwiftUI的基本概念</h3><p>SwiftUI的核心概念是声明式编程，它允许我们描述界面应该是什么样子，而不是如何构建界面。SwiftUI的主要特点包括：</p>
<ul>
<li><strong>声明式语法</strong>：使用简洁的语法描述界面</li>
<li><strong>跨平台支持</strong>：一套代码可以运行在多个苹果平台上</li>
<li><strong>实时预览</strong>：在Xcode中实时查看界面效果</li>
<li><strong>响应式编程</strong>：使用<code>@State</code>、<code>@Binding</code>、<code>@ObservedObject</code>等属性包装器实现数据与界面的绑定</li>
</ul>
<h3 id="2-SwiftUI的基本用法"><a href="#2-SwiftUI的基本用法" class="headerlink" title="2. SwiftUI的基本用法"></a>2. SwiftUI的基本用法</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个视图结构体</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">// 声明一个状态变量</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 描述界面内容</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;计数器：<span class="subst">\(count)</span>&quot;</span>)</span><br><span class="line">                .font(.largeTitle)</span><br><span class="line">                .padding()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;增加&quot;</span>) &#123;</span><br><span class="line">                count <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">            .background(<span class="type">Color</span>.blue)</span><br><span class="line">            .foregroundColor(.white)</span><br><span class="line">            .cornerRadius(<span class="number">8</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预览视图</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-SwiftUI的布局系统"><a href="#3-SwiftUI的布局系统" class="headerlink" title="3. SwiftUI的布局系统"></a>3. SwiftUI的布局系统</h3><p>SwiftUI使用弹性布局系统，它提供了多种布局容器，如<code>VStack</code>、<code>HStack</code>、<code>ZStack</code>、<code>List</code>、<code>Grid</code>等：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LayoutExample</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// 垂直布局</span></span><br><span class="line">        <span class="type">VStack</span>(spacing: <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="comment">// 水平布局</span></span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;左侧&quot;</span>)</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;右侧&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 列表布局</span></span><br><span class="line">            <span class="type">List</span>(<span class="number">1</span><span class="operator">..&lt;</span><span class="number">5</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;项目 <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .frame(height: <span class="number">150</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 网格布局（iOS 16+）</span></span><br><span class="line">            <span class="type">Grid</span> &#123;</span><br><span class="line">                <span class="type">GridRow</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;行1列1&quot;</span>)</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;行1列2&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">GridRow</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;行2列1&quot;</span>)</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;行2列2&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<!-- INTERVIEW_TOPIC: SwiftUI数据绑定 -->
<!-- HIGH_FREQUENCY_INTERVIEW: 状态管理 -->

<h3 id="4-SwiftUI的数据绑定"><a href="#4-SwiftUI的数据绑定" class="headerlink" title="4. SwiftUI的数据绑定"></a>4. SwiftUI的数据绑定</h3><p>SwiftUI使用属性包装器来实现数据与界面的绑定：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个可观察对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserData</span>: <span class="title class_ inherited__">ObservableObject</span> &#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;张三&quot;</span></span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> age <span class="operator">=</span> <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">DataBindingExample</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">// 使用环境对象</span></span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 本地状态</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isEditing <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> isEditing &#123;</span><br><span class="line">                <span class="type">TextField</span>(<span class="string">&quot;姓名&quot;</span>, text: <span class="variable">$userData</span>.name)</span><br><span class="line">                    .padding()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Stepper</span>(<span class="string">&quot;年龄：<span class="subst">\(userData.age)</span>&quot;</span>, value: <span class="variable">$userData</span>.age, in: <span class="number">0</span><span class="operator">...</span><span class="number">150</span>)</span><br><span class="line">                    .padding()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;姓名：<span class="subst">\(userData.name)</span>&quot;</span>)</span><br><span class="line">                    .padding()</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;年龄：<span class="subst">\(userData.age)</span>&quot;</span>)</span><br><span class="line">                    .padding()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Button</span>(isEditing <span class="operator">?</span> <span class="string">&quot;保存&quot;</span> : <span class="string">&quot;编辑&quot;</span>) &#123;</span><br><span class="line">                isEditing.toggle()</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">            .background(<span class="type">Color</span>.blue)</span><br><span class="line">            .foregroundColor(.white)</span><br><span class="line">            .cornerRadius(<span class="number">8</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<!-- CATEGORY: 并发编程 -->
<!-- INTERVIEW_TOPIC: async/await -->
<!-- HIGH_FREQUENCY_INTERVIEW: Swift并发模型 -->

<h2 id="三、并发编程"><a href="#三、并发编程" class="headerlink" title="三、并发编程"></a>三、并发编程</h2><p>并发编程是指在同一时间执行多个任务的能力，它可以提高应用的性能和响应速度。Swift 5.5引入了新的并发编程模型，包括<code>async/await</code>、<code>Task</code>、<code>Actor</code>等特性，使并发编程更加安全和简洁。</p>
<h3 id="1-async-await"><a href="#1-async-await" class="headerlink" title="1. async&#x2F;await"></a>1. async&#x2F;await</h3><p><code>async/await</code>是Swift并发编程的核心特性，它允许我们编写异步代码，就像编写同步代码一样：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个异步函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchData</span>(<span class="params">from</span> <span class="params">url</span>: <span class="type">URL</span>) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> (data, response) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">URLSession</span>.shared.data(from: url)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> httpResponse <span class="operator">=</span> response <span class="keyword">as?</span> <span class="type">HTTPURLResponse</span>,</span><br><span class="line">          httpResponse.statusCode <span class="operator">==</span> <span class="number">200</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">URLError</span>(.badServerResponse)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用异步函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">func</span> <span class="title function_">processData</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://example.com/data.json&quot;</span>)<span class="operator">!</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> fetchData(from: url)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;获取到数据：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理数据</span></span><br><span class="line">        <span class="keyword">let</span> result <span class="operator">=</span> <span class="keyword">try</span> <span class="type">JSONDecoder</span>().decode(<span class="type">ResponseData</span>.<span class="keyword">self</span>, from: data)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;解析结果：<span class="subst">\(result)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请求失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用异步函数</span></span><br><span class="line"><span class="type">Task</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> processData()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<!-- INTERVIEW_TOPIC: Task -->
<!-- HIGH_FREQUENCY_INTERVIEW: 异步任务管理 -->

<h3 id="2-Task"><a href="#2-Task" class="headerlink" title="2. Task"></a>2. Task</h3><p><code>Task</code>是Swift并发编程中的基本执行单元，它代表了一个异步执行的任务：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建一个任务</span></span><br><span class="line"><span class="keyword">let</span> task <span class="operator">=</span> <span class="type">Task</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始执行任务&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">Task</span>.sleep(nanoseconds: <span class="number">1_000_000_000</span>) <span class="comment">// 等待1秒</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;任务执行完成&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;任务结果&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消任务</span></span><br><span class="line">task.cancel()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取任务结果</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> result <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> task.value</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;任务结果：<span class="subst">\(result)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;任务失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<!-- INTERVIEW_TOPIC: Actor -->
<!-- HIGH_FREQUENCY_INTERVIEW: 并发安全 -->

<h3 id="3-Actor"><a href="#3-Actor" class="headerlink" title="3. Actor"></a>3. Actor</h3><p><code>Actor</code>是Swift并发编程中的新类型，它提供了数据隔离和线程安全的保障：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个Actor</span></span><br><span class="line"><span class="keyword">actor</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> value <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Actor的方法默认是异步的</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">increment</span>() &#123;</span><br><span class="line">        value <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getValue</span>() -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Actor</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">func</span> <span class="title function_">useCounter</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> counter <span class="operator">=</span> <span class="type">Counter</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用Actor的方法需要使用await</span></span><br><span class="line">    <span class="keyword">await</span> counter.increment()</span><br><span class="line">    <span class="keyword">let</span> value <span class="operator">=</span> <span class="keyword">await</span> counter.getValue()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;计数器值：<span class="subst">\(value)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line"><span class="type">Task</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> useCounter()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-并发同步原语"><a href="#4-并发同步原语" class="headerlink" title="4. 并发同步原语"></a>4. 并发同步原语</h3><p>Swift提供了多种并发同步原语，如<code>async let</code>、<code>TaskGroup</code>、<code>AsyncSequence</code>等：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用async let并行执行任务</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">func</span> <span class="title function_">fetchMultipleData</span>() <span class="keyword">async</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> url1 <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://example.com/data1.json&quot;</span>)<span class="operator">!</span></span><br><span class="line">    <span class="keyword">let</span> url2 <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://example.com/data2.json&quot;</span>)<span class="operator">!</span></span><br><span class="line">    <span class="keyword">let</span> url3 <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://example.com/data3.json&quot;</span>)<span class="operator">!</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 并行执行三个异步任务</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">let</span> data1 <span class="operator">=</span> fetchData(from: url1)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">let</span> data2 <span class="operator">=</span> fetchData(from: url2)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">let</span> data3 <span class="operator">=</span> fetchData(from: url3)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 等待所有任务完成</span></span><br><span class="line">    <span class="keyword">let</span> results <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> [data1, data2, data3]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;获取到所有数据：<span class="subst">\(results)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用TaskGroup</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">func</span> <span class="title function_">fetchDataWithTaskGroup</span>() <span class="keyword">async</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> urls <span class="operator">=</span> [</span><br><span class="line">        <span class="type">URL</span>(string: <span class="string">&quot;https://example.com/data1.json&quot;</span>)<span class="operator">!</span>,</span><br><span class="line">        <span class="type">URL</span>(string: <span class="string">&quot;https://example.com/data2.json&quot;</span>)<span class="operator">!</span>,</span><br><span class="line">        <span class="type">URL</span>(string: <span class="string">&quot;https://example.com/data3.json&quot;</span>)<span class="operator">!</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> results <span class="operator">=</span> [<span class="type">Data</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建TaskGroup</span></span><br><span class="line">    <span class="keyword">try</span> <span class="keyword">await</span> withThrowingTaskGroup(of: <span class="type">Data</span>.<span class="keyword">self</span>) &#123; group <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> urls &#123;</span><br><span class="line">            <span class="comment">// 添加任务到TaskGroup</span></span><br><span class="line">            group.addTask &#123; <span class="keyword">try</span> <span class="keyword">await</span> fetchData(from: url) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理任务结果</span></span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">try</span> <span class="keyword">await</span> result <span class="keyword">in</span> group &#123;</span><br><span class="line">            results.append(result)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;获取到所有数据：<span class="subst">\(results)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、Swift-Package-Manager"><a href="#四、Swift-Package-Manager" class="headerlink" title="四、Swift Package Manager"></a>四、Swift Package Manager</h2><p>Swift Package Manager（SPM）是Swift的官方包管理工具，它允许我们创建、分发和使用Swift包。SPM支持iOS、macOS、tvOS、watchOS和Linux等多个平台。</p>
<h3 id="1-创建Swift包"><a href="#1-创建Swift包" class="headerlink" title="1. 创建Swift包"></a>1. 创建Swift包</h3><p>使用Xcode可以轻松创建Swift包：</p>
<ol>
<li>打开Xcode，选择”File” &gt; “New” &gt; “Package”</li>
<li>输入包名称和保存位置</li>
<li>选择包的平台支持</li>
<li>点击”Create”按钮</li>
</ol>
<p>也可以使用命令行创建Swift包：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">swift package init --<span class="built_in">type</span> library</span><br></pre></td></tr></table></figure>

<h3 id="2-定义Swift包"><a href="#2-定义Swift包" class="headerlink" title="2. 定义Swift包"></a>2. 定义Swift包</h3><p>Swift包的结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyPackage/</span><br><span class="line">├── Package.swift          # 包的配置文件</span><br><span class="line">├── Sources/              # 源代码目录</span><br><span class="line">│   └── MyPackage/        # 包的模块目录</span><br><span class="line">│       └── MyPackage.swift</span><br><span class="line">└── Tests/                # 测试代码目录</span><br><span class="line">    └── MyPackageTests/   # 测试模块目录</span><br><span class="line">        └── MyPackageTests.swift</span><br></pre></td></tr></table></figure>

<p><code>Package.swift</code>是Swift包的配置文件，它定义了包的名称、平台支持、依赖关系等：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// swift-tools-version:5.7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> PackageDescription</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">package</span> <span class="operator">=</span> <span class="type">Package</span>(</span><br><span class="line">    name: <span class="string">&quot;MyPackage&quot;</span>,</span><br><span class="line">    platforms: [</span><br><span class="line">        .iOS(.v13),</span><br><span class="line">        .macOS(.v10_15)</span><br><span class="line">    ],</span><br><span class="line">    products: [</span><br><span class="line">        .library(</span><br><span class="line">            name: <span class="string">&quot;MyPackage&quot;</span>,</span><br><span class="line">            targets: [<span class="string">&quot;MyPackage&quot;</span>]),</span><br><span class="line">    ],</span><br><span class="line">    dependencies: [</span><br><span class="line">        <span class="comment">// 添加依赖</span></span><br><span class="line">        .package(url: <span class="string">&quot;https://github.com/Alamofire/Alamofire.git&quot;</span>, from: <span class="string">&quot;5.5.0&quot;</span>)</span><br><span class="line">    ],</span><br><span class="line">    targets: [</span><br><span class="line">        .target(</span><br><span class="line">            name: <span class="string">&quot;MyPackage&quot;</span>,</span><br><span class="line">            dependencies: [<span class="string">&quot;Alamofire&quot;</span>]),</span><br><span class="line">        .testTarget(</span><br><span class="line">            name: <span class="string">&quot;MyPackageTests&quot;</span>,</span><br><span class="line">            dependencies: [<span class="string">&quot;MyPackage&quot;</span>]),</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="3-使用Swift包"><a href="#3-使用Swift包" class="headerlink" title="3. 使用Swift包"></a>3. 使用Swift包</h3><p>在Xcode项目中使用Swift包的步骤如下：</p>
<ol>
<li>打开Xcode项目</li>
<li>选择”File” &gt; “Add Packages…”</li>
<li>输入包的URL（如”<a href="https://github.com/Alamofire/Alamofire.git%22%EF%BC%89">https://github.com/Alamofire/Alamofire.git&quot;）</a></li>
<li>选择包的版本</li>
<li>点击”Add Package”按钮</li>
<li>在项目中导入包并使用</li>
</ol>
<h3 id="4-分发Swift包"><a href="#4-分发Swift包" class="headerlink" title="4. 分发Swift包"></a>4. 分发Swift包</h3><p>Swift包可以通过GitHub、GitLab等代码托管平台进行分发。要分发Swift包，只需将包的代码推送到远程仓库，然后在其他项目中通过包的URL引用即可。</p>
<h2 id="五、Swift的未来展望"><a href="#五、Swift的未来展望" class="headerlink" title="五、Swift的未来展望"></a>五、Swift的未来展望</h2><p>Swift自2014年发布以来，经历了快速的发展和演变。苹果每年都会在WWDC上发布Swift的新版本，添加新的特性和改进。以下是Swift的一些未来发展方向：</p>
<h3 id="1-更好的跨平台支持"><a href="#1-更好的跨平台支持" class="headerlink" title="1. 更好的跨平台支持"></a>1. 更好的跨平台支持</h3><p>苹果正在努力提高Swift在非苹果平台上的支持，特别是在服务器端开发和Web开发领域。Swift已经可以在Linux、Windows和Android等平台上运行，未来还将进一步完善跨平台支持。</p>
<h3 id="2-更强大的并发编程"><a href="#2-更强大的并发编程" class="headerlink" title="2. 更强大的并发编程"></a>2. 更强大的并发编程</h3><p>并发编程是Swift的一个重要发展方向。苹果已经在Swift 5.5中引入了新的并发编程模型，未来还将继续改进和扩展这些特性，使并发编程更加安全和高效。</p>
<h3 id="3-机器学习支持"><a href="#3-机器学习支持" class="headerlink" title="3. 机器学习支持"></a>3. 机器学习支持</h3><p>苹果正在将Swift与机器学习结合，推出了Create ML和Core ML等框架，使开发者可以使用Swift轻松创建和部署机器学习模型。未来，Swift可能会添加更多的机器学习相关特性和API。</p>
<h3 id="4-更好的工具支持"><a href="#4-更好的工具支持" class="headerlink" title="4. 更好的工具支持"></a>4. 更好的工具支持</h3><p>苹果正在不断改进Swift的工具链，包括Xcode、Swift Package Manager、Swift Playgrounds等。未来，这些工具将提供更好的代码补全、调试、性能分析等功能，提高开发效率。</p>
<h3 id="5-更简洁的语法"><a href="#5-更简洁的语法" class="headerlink" title="5. 更简洁的语法"></a>5. 更简洁的语法</h3><p>Swift的语法一直在不断优化和简化，未来可能会添加更多的语法糖和便捷特性，使代码更加简洁和易读。</p>
<h2 id="六、Swift学习总结"><a href="#六、Swift学习总结" class="headerlink" title="六、Swift学习总结"></a>六、Swift学习总结</h2><p>在这个系列的学习日记中，我们系统地学习了Swift的核心概念和特性：</p>
<ol>
<li><p><strong>Swift语言概述与基础语法</strong>：学习了Swift的历史、特点、变量常量、数据类型、字符串操作、控制流和函数等基础内容。</p>
</li>
<li><p><strong>数据类型与运算符</strong>：深入学习了Swift的各种数据类型，包括数值类型、布尔类型、字符串类型、集合类型、元组类型和可选类型，以及各种运算符。</p>
</li>
<li><p><strong>控制流</strong>：学习了Swift的条件语句（if-else、guard、switch）和循环语句（for-in、while、repeat-while），以及控制转移语句。</p>
</li>
<li><p><strong>函数与闭包</strong>：学习了Swift函数的定义、调用、参数特性，以及闭包的基本概念和使用方法。</p>
</li>
<li><p><strong>面向对象编程（类与结构体）</strong>：学习了Swift的类和结构体的定义、区别、属性、方法、构造函数和继承等。</p>
</li>
<li><p><strong>枚举与协议</strong>：学习了Swift的枚举和协议的定义、使用方法，以及委托模式和多态等概念。</p>
</li>
<li><p><strong>扩展与泛型</strong>：学习了Swift的扩展和泛型，它们是编写灵活、可重用代码的重要工具。</p>
</li>
<li><p><strong>错误处理</strong>：学习了Swift的错误处理机制，包括表示错误、抛出错误、捕获错误、传播错误和恢复错误等。</p>
</li>
<li><p><strong>内存管理</strong>：学习了Swift的内存管理机制，包括自动引用计数（ARC）、强引用、弱引用、无主引用和循环引用等。</p>
</li>
<li><p><strong>Swift高级特性与未来展望</strong>：学习了Swift的高级特性，如SwiftUI、并发编程、Swift Package Manager等，并展望了Swift的未来发展。</p>
</li>
</ol>
<h2 id="七、内容机制与知识点总结"><a href="#七、内容机制与知识点总结" class="headerlink" title="七、内容机制与知识点总结"></a>七、内容机制与知识点总结</h2><h3 id="1-Swift高级特性的设计原则"><a href="#1-Swift高级特性的设计原则" class="headerlink" title="1. Swift高级特性的设计原则"></a>1. Swift高级特性的设计原则</h3><p>Swift的高级特性体现了几个核心设计原则：</p>
<ul>
<li><strong>声明式优先</strong>：SwiftUI采用声明式语法，提高开发效率和代码可读性</li>
<li><strong>安全并发</strong>：通过Actor模型和结构化并发，保证并发代码的安全性</li>
<li><strong>模块化设计</strong>：Swift Package Manager促进代码的模块化和复用</li>
<li><strong>跨平台一致性</strong>：在不同平台上提供统一的API和开发体验</li>
<li><strong>渐进式采用</strong>：新特性可以逐步集成到现有代码库中</li>
</ul>
<h3 id="2-核心知识点总结"><a href="#2-核心知识点总结" class="headerlink" title="2. 核心知识点总结"></a>2. 核心知识点总结</h3><table>
<thead>
<tr>
<th>概念</th>
<th>描述</th>
<th>主要特性</th>
</tr>
</thead>
<tbody><tr>
<td>SwiftUI</td>
<td>声明式UI框架</td>
<td>跨平台、实时预览、响应式数据绑定</td>
</tr>
<tr>
<td><code>@State</code></td>
<td>存储视图本地状态</td>
<td>值变化时自动更新UI</td>
</tr>
<tr>
<td><code>@Binding</code></td>
<td>双向绑定状态</td>
<td>在父视图和子视图间共享状态</td>
</tr>
<tr>
<td><code>@ObservedObject</code></td>
<td>观察对象状态变化</td>
<td>对象需遵循ObservableObject协议</td>
</tr>
<tr>
<td><code>@EnvironmentObject</code></td>
<td>全局环境对象</td>
<td>跨多个视图共享数据</td>
</tr>
<tr>
<td><code>async/await</code></td>
<td>异步编程语法</td>
<td>编写异步代码如同同步代码</td>
</tr>
<tr>
<td><code>Task</code></td>
<td>并发执行单元</td>
<td>代表一个异步执行的任务</td>
</tr>
<tr>
<td><code>Actor</code></td>
<td>线程安全类型</td>
<td>提供数据隔离，防止并发访问冲突</td>
</tr>
<tr>
<td><code>TaskGroup</code></td>
<td>任务组</td>
<td>并发执行一组相关任务</td>
</tr>
<tr>
<td>Swift Package Manager</td>
<td>官方包管理工具</td>
<td>创建、分发和使用Swift包</td>
</tr>
<tr>
<td><code>Package.swift</code></td>
<td>包配置文件</td>
<td>定义包的名称、平台、依赖等</td>
</tr>
</tbody></table>
<h2 id="八、遇到的问题及解决方案"><a href="#八、遇到的问题及解决方案" class="headerlink" title="八、遇到的问题及解决方案"></a>八、遇到的问题及解决方案</h2><h3 id="1-SwiftUI视图更新不及时"><a href="#1-SwiftUI视图更新不及时" class="headerlink" title="1. SwiftUI视图更新不及时"></a>1. SwiftUI视图更新不及时</h3><p><strong>问题</strong>：当状态变量变化时，SwiftUI视图没有及时更新</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> items <span class="operator">=</span> [<span class="string">&quot;Item 1&quot;</span>, <span class="string">&quot;Item 2&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">List</span>(items, id: \.<span class="keyword">self</span>) &#123; item <span class="keyword">in</span></span><br><span class="line">                <span class="type">Text</span>(item)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;添加项目&quot;</span>) &#123;</span><br><span class="line">                <span class="comment">// 问题：直接修改数组元素，视图不会更新</span></span><br><span class="line">                items.append(<span class="string">&quot;Item <span class="subst">\(items.count <span class="operator">+</span> <span class="number">1</span>)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：确保使用可变的<code>@State</code>变量并触发值类型的更新</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> items <span class="operator">=</span> [<span class="string">&quot;Item 1&quot;</span>, <span class="string">&quot;Item 2&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">List</span>(items, id: \.<span class="keyword">self</span>) &#123; item <span class="keyword">in</span></span><br><span class="line">                <span class="type">Text</span>(item)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;添加项目&quot;</span>) &#123;</span><br><span class="line">                <span class="comment">// 解决方案：SwiftUI会自动检测数组的变化</span></span><br><span class="line">                items.append(<span class="string">&quot;Item <span class="subst">\(items.count <span class="operator">+</span> <span class="number">1</span>)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-异步函数中的内存泄漏"><a href="#2-异步函数中的内存泄漏" class="headerlink" title="2. 异步函数中的内存泄漏"></a>2. 异步函数中的内存泄漏</h3><p><strong>问题</strong>：在异步函数中捕获了self的强引用，导致内存泄漏</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataManager</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> data <span class="operator">=</span> [<span class="type">String</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fetchData</span>() &#123;</span><br><span class="line">        <span class="type">Task</span> &#123;</span><br><span class="line">            <span class="comment">// 问题：闭包捕获了self的强引用</span></span><br><span class="line">            <span class="keyword">let</span> newData <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> loadData()</span><br><span class="line">            <span class="keyword">self</span>.data <span class="operator">=</span> newData</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">loadData</span>() <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; [<span class="type">String</span>] &#123;</span><br><span class="line">        <span class="comment">// 模拟网络请求</span></span><br><span class="line">        <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">Task</span>.sleep(nanoseconds: <span class="number">1_000_000_000</span>)</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;New Item 1&quot;</span>, <span class="string">&quot;New Item 2&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DataManager被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用弱引用或无主引用避免循环引用</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataManager</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> data <span class="operator">=</span> [<span class="type">String</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fetchData</span>() &#123;</span><br><span class="line">        <span class="type">Task</span> &#123;</span><br><span class="line">            <span class="comment">// 解决方案：使用弱引用</span></span><br><span class="line">            [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> newData <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> loadData()</span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.data <span class="operator">=</span> newData</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">loadData</span>() <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; [<span class="type">String</span>] &#123;</span><br><span class="line">        <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">Task</span>.sleep(nanoseconds: <span class="number">1_000_000_000</span>)</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;New Item 1&quot;</span>, <span class="string">&quot;New Item 2&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;DataManager被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Actor方法调用死锁"><a href="#3-Actor方法调用死锁" class="headerlink" title="3. Actor方法调用死锁"></a>3. Actor方法调用死锁</h3><p><strong>问题</strong>：在Actor的同步方法中调用异步方法，导致死锁</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">actor</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> value <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">incrementAndGetValue</span>() -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="comment">// 问题：在同步方法中调用异步方法会导致死锁</span></span><br><span class="line">        <span class="type">Task</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> increment()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">increment</span>() &#123;</span><br><span class="line">        value <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：将方法改为异步方法，确保正确的并发访问</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">actor</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> value <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解决方案：将方法改为异步方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">incrementAndGetValue</span>() <span class="keyword">async</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> increment()</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">increment</span>() &#123;</span><br><span class="line">        value <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-SwiftUI环境对象不存在错误"><a href="#4-SwiftUI环境对象不存在错误" class="headerlink" title="4. SwiftUI环境对象不存在错误"></a>4. SwiftUI环境对象不存在错误</h3><p><strong>问题</strong>：尝试访问不存在的环境对象，导致运行时崩溃</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">DetailView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">// 问题：视图需要环境对象，但没有提供</span></span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> userData: <span class="type">UserData</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;姓名：<span class="subst">\(userData.name)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误的调用方式</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">DetailView</span>() <span class="comment">// 没有注入环境对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：在父视图中注入环境对象</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义环境对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserData</span>: <span class="title class_ inherited__">ObservableObject</span> &#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;张三&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">// 创建环境对象</span></span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">private</span> <span class="keyword">var</span> userData <span class="operator">=</span> <span class="type">UserData</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// 解决方案：注入环境对象</span></span><br><span class="line">        <span class="type">DetailView</span>()</span><br><span class="line">            .environmentObject(userData)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-Swift-Package依赖冲突"><a href="#5-Swift-Package依赖冲突" class="headerlink" title="5. Swift Package依赖冲突"></a>5. Swift Package依赖冲突</h3><p><strong>问题</strong>：不同的依赖包要求相同库的不同版本，导致冲突</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Package.swift</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">package</span> <span class="operator">=</span> <span class="type">Package</span>(</span><br><span class="line">    name: <span class="string">&quot;MyApp&quot;</span>,</span><br><span class="line">    dependencies: [</span><br><span class="line">        <span class="comment">// 冲突：两个包依赖不同版本的Alamofire</span></span><br><span class="line">        .package(url: <span class="string">&quot;https://github.com/Alamofire/Alamofire.git&quot;</span>, from: <span class="string">&quot;5.5.0&quot;</span>),</span><br><span class="line">        .package(url: <span class="string">&quot;https://github.com/SomePackage/SomePackage.git&quot;</span>, from: <span class="string">&quot;1.0.0&quot;</span>) <span class="comment">// 依赖Alamofire 5.0.0</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用依赖解析策略或更新依赖包</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 解决方案1：使用统一的依赖版本</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">package</span> <span class="operator">=</span> <span class="type">Package</span>(</span><br><span class="line">    name: <span class="string">&quot;MyApp&quot;</span>,</span><br><span class="line">    dependencies: [</span><br><span class="line">        .package(url: <span class="string">&quot;https://github.com/Alamofire/Alamofire.git&quot;</span>, from: <span class="string">&quot;5.5.0&quot;</span>),</span><br><span class="line">        .package(url: <span class="string">&quot;https://github.com/SomePackage/SomePackage.git&quot;</span>, revision: <span class="string">&quot;main&quot;</span>) <span class="comment">// 更新到依赖最新Alamofire的版本</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案2：使用依赖解析器自动解决冲突</span></span><br><span class="line"><span class="comment">// Swift Package Manager会尝试找到兼容的版本</span></span><br></pre></td></tr></table></figure>

<h2 id="九、高阶用法"><a href="#九、高阶用法" class="headerlink" title="九、高阶用法"></a>九、高阶用法</h2><h3 id="1-高级SwiftUI技巧"><a href="#1-高级SwiftUI技巧" class="headerlink" title="1. 高级SwiftUI技巧"></a>1. 高级SwiftUI技巧</h3><h4 id="1-1-自定义视图修饰符"><a href="#1-1-自定义视图修饰符" class="headerlink" title="1.1 自定义视图修饰符"></a>1.1 自定义视图修饰符</h4><p>创建可重用的视图修饰符：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自定义修饰符</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PrimaryButtonStyle</span>: <span class="title class_ inherited__">ViewModifier</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: <span class="type">Content</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        content</span><br><span class="line">            .padding(<span class="number">12</span>)</span><br><span class="line">            .background(<span class="type">Color</span>.blue)</span><br><span class="line">            .foregroundColor(.white)</span><br><span class="line">            .cornerRadius(<span class="number">8</span>)</span><br><span class="line">            .font(.headline)</span><br><span class="line">            .shadow(color: .gray.opacity(<span class="number">0.3</span>), radius: <span class="number">4</span>, x: <span class="number">0</span>, y: <span class="number">2</span>)</span><br><span class="line">            .transition(.scale)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展View协议</span></span><br><span class="line"> <span class="keyword">extension</span> <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">primaryButtonStyle</span>() -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.modifier(<span class="type">PrimaryButtonStyle</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用自定义修饰符</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(<span class="string">&quot;点击我&quot;</span>) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;按钮被点击&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .primaryButtonStyle()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-自定义动画"><a href="#1-2-自定义动画" class="headerlink" title="1.2 自定义动画"></a>1.2 自定义动画</h4><p>创建复杂的动画效果：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">AnimatedView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isAnimating <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Circle</span>()</span><br><span class="line">            .fill(<span class="type">Color</span>.red)</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">            .scaleEffect(isAnimating <span class="operator">?</span> <span class="number">1.5</span> : <span class="number">1.0</span>)</span><br><span class="line">            .rotationEffect(.degrees(isAnimating <span class="operator">?</span> <span class="number">360</span> : <span class="number">0</span>))</span><br><span class="line">            .animation(</span><br><span class="line">                <span class="type">Animation</span>.easeInOut(duration: <span class="number">2</span>)</span><br><span class="line">                    .repeatForever(autoreverses: <span class="literal">true</span>)</span><br><span class="line">            )</span><br><span class="line">            .onAppear &#123;</span><br><span class="line">                isAnimating <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-高级并发编程技巧"><a href="#2-高级并发编程技巧" class="headerlink" title="2. 高级并发编程技巧"></a>2. 高级并发编程技巧</h3><h4 id="2-1-自定义异步序列"><a href="#2-1-自定义异步序列" class="headerlink" title="2.1 自定义异步序列"></a>2.1 自定义异步序列</h4><p>实现自定义的异步序列：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自定义异步序列</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CounterAsyncSequence</span>: <span class="title class_ inherited__">AsyncSequence</span> &#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Element</span> <span class="operator">=</span> <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> limit: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeAsyncIterator</span>() -&gt; <span class="type">AsyncIterator</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">AsyncIterator</span>(limit: limit)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">AsyncIterator</span>: <span class="title class_ inherited__">AsyncIteratorProtocol</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> limit: <span class="type">Int</span></span><br><span class="line">        <span class="keyword">var</span> current <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">next</span>() <span class="keyword">async</span> -&gt; <span class="type">Int</span>? &#123;</span><br><span class="line">            <span class="keyword">guard</span> current <span class="operator">&lt;</span> limit <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> value <span class="operator">=</span> current</span><br><span class="line">            current <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 模拟异步操作</span></span><br><span class="line">            <span class="keyword">try?</span> <span class="keyword">await</span> <span class="type">Task</span>.sleep(nanoseconds: <span class="number">500_000_000</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用异步序列</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">func</span> <span class="title function_">iterateCounter</span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">await</span> value <span class="keyword">in</span> <span class="type">CounterAsyncSequence</span>(limit: <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;计数器值：<span class="subst">\(value)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-并发安全的缓存实现"><a href="#2-2-并发安全的缓存实现" class="headerlink" title="2.2 并发安全的缓存实现"></a>2.2 并发安全的缓存实现</h4><p>使用Actor实现并发安全的缓存：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 并发安全的缓存</span></span><br><span class="line"><span class="keyword">actor</span> <span class="title class_">Cache</span>&lt;<span class="type">Key</span>: <span class="type">Hashable</span>, <span class="type">Value</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> storage: [<span class="type">Key</span>: <span class="type">Value</span>] <span class="operator">=</span> [:]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">setValue</span>(<span class="keyword">_</span> <span class="params">value</span>: <span class="type">Value</span>, <span class="params">forKey</span> <span class="params">key</span>: <span class="type">Key</span>) &#123;</span><br><span class="line">        storage[key] <span class="operator">=</span> value</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getValue</span>(<span class="params">forKey</span> <span class="params">key</span>: <span class="type">Key</span>) -&gt; <span class="type">Value</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> storage[key]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">removeValue</span>(<span class="params">forKey</span> <span class="params">key</span>: <span class="type">Key</span>) &#123;</span><br><span class="line">        storage.removeValue(forKey: key)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">clear</span>() &#123;</span><br><span class="line">        storage.removeAll()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用并发安全缓存</span></span><br><span class="line"><span class="keyword">let</span> cache <span class="operator">=</span> <span class="type">Cache</span>&lt;<span class="type">String</span>, <span class="type">Data</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">func</span> <span class="title function_">useCache</span>() &#123;</span><br><span class="line">    <span class="comment">// 并发访问是安全的</span></span><br><span class="line">    <span class="keyword">await</span> cache.setValue(<span class="string">&quot;data1&quot;</span>.data(using: .utf8)<span class="operator">!</span>, forKey: <span class="string">&quot;key1&quot;</span>)</span><br><span class="line">    <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">await</span> cache.getValue(forKey: <span class="string">&quot;key1&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Swift-Package-Manager高级用法"><a href="#3-Swift-Package-Manager高级用法" class="headerlink" title="3. Swift Package Manager高级用法"></a>3. Swift Package Manager高级用法</h3><h4 id="3-1-创建可执行包"><a href="#3-1-创建可执行包" class="headerlink" title="3.1 创建可执行包"></a>3.1 创建可执行包</h4><p>创建命令行工具包：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Package.swift</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">package</span> <span class="operator">=</span> <span class="type">Package</span>(</span><br><span class="line">    name: <span class="string">&quot;MyCLI&quot;</span>,</span><br><span class="line">    platforms: [.macOS(.v10_15)],</span><br><span class="line">    products: [</span><br><span class="line">        .executable(name: <span class="string">&quot;mycli&quot;</span>, targets: [<span class="string">&quot;MyCLI&quot;</span>]),</span><br><span class="line">    ],</span><br><span class="line">    dependencies: [</span><br><span class="line">        <span class="comment">// 添加命令行接口依赖</span></span><br><span class="line">        .package(url: <span class="string">&quot;https://github.com/apple/swift-argument-parser.git&quot;</span>, from: <span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line">    ],</span><br><span class="line">    targets: [</span><br><span class="line">        .executableTarget(</span><br><span class="line">            name: <span class="string">&quot;MyCLI&quot;</span>,</span><br><span class="line">            dependencies: [</span><br><span class="line">                .product(name: <span class="string">&quot;ArgumentParser&quot;</span>, package: <span class="string">&quot;swift-argument-parser&quot;</span>)</span><br><span class="line">            ]</span><br><span class="line">        ),</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="3-2-创建多平台包"><a href="#3-2-创建多平台包" class="headerlink" title="3.2 创建多平台包"></a>3.2 创建多平台包</h4><p>创建支持多个平台的包：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Package.swift</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">package</span> <span class="operator">=</span> <span class="type">Package</span>(</span><br><span class="line">    name: <span class="string">&quot;CrossPlatformKit&quot;</span>,</span><br><span class="line">    platforms: [</span><br><span class="line">        .iOS(.v14),</span><br><span class="line">        .macOS(.v11),</span><br><span class="line">        .tvOS(.v14),</span><br><span class="line">        .watchOS(.v7)</span><br><span class="line">    ],</span><br><span class="line">    products: [</span><br><span class="line">        .library(name: <span class="string">&quot;CrossPlatformKit&quot;</span>, targets: [<span class="string">&quot;CrossPlatformKit&quot;</span>]),</span><br><span class="line">    ],</span><br><span class="line">    targets: [</span><br><span class="line">        .target(</span><br><span class="line">            name: <span class="string">&quot;CrossPlatformKit&quot;</span>,</span><br><span class="line">            dependencies: [],</span><br><span class="line">            path: <span class="string">&quot;Sources/CrossPlatformKit&quot;</span></span><br><span class="line">        ),</span><br><span class="line">        .testTarget(</span><br><span class="line">            name: <span class="string">&quot;CrossPlatformKitTests&quot;</span>,</span><br><span class="line">            dependencies: [<span class="string">&quot;CrossPlatformKit&quot;</span>]</span><br><span class="line">        ),</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="4-性能优化策略"><a href="#4-性能优化策略" class="headerlink" title="4. 性能优化策略"></a>4. 性能优化策略</h3><h4 id="4-1-SwiftUI性能优化"><a href="#4-1-SwiftUI性能优化" class="headerlink" title="4.1 SwiftUI性能优化"></a>4.1 SwiftUI性能优化</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> items <span class="operator">=</span> <span class="type">Array</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// 优化1：使用id: \.self避免不必要的重渲染</span></span><br><span class="line">        <span class="type">List</span>(items, id: \.<span class="keyword">self</span>) &#123; item <span class="keyword">in</span></span><br><span class="line">            <span class="comment">// 优化2：使用EquatableView避免不必要的视图更新</span></span><br><span class="line">            <span class="type">EquatableView</span>(content: <span class="type">ItemView</span>(item: item))</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Button</span>(<span class="string">&quot;打乱顺序&quot;</span>) &#123;</span><br><span class="line">            <span class="comment">// 优化3：使用原地修改提高性能</span></span><br><span class="line">            items.shuffleInPlace()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 优化4：实现Equatable协议</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ItemView</span>: <span class="title class_ inherited__">View</span>, <span class="title class_ inherited__">Equatable</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> item: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">==</span> (<span class="params">lhs</span>: <span class="type">ItemView</span>, <span class="params">rhs</span>: <span class="type">ItemView</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.item <span class="operator">==</span> rhs.item</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;项目 <span class="subst">\(item)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-并发性能优化"><a href="#4-2-并发性能优化" class="headerlink" title="4.2 并发性能优化"></a>4.2 并发性能优化</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 优化：限制并发任务数量</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">func</span> <span class="title function_">fetchMultipleURLs</span>(<span class="params">urls</span>: [<span class="type">URL</span>]) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; [<span class="type">Data</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> results <span class="operator">=</span> [<span class="type">Data</span>]()</span><br><span class="line">    results.reserveCapacity(urls.count)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 优化：使用limited task group限制并发数</span></span><br><span class="line">    <span class="keyword">try</span> <span class="keyword">await</span> withThrowingLimitedTaskGroup(of: <span class="type">Data</span>.<span class="keyword">self</span>, limit: <span class="number">4</span>) &#123; group <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> urls &#123;</span><br><span class="line">            group.addTask &#123;</span><br><span class="line">                <span class="keyword">let</span> (data, response) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">URLSession</span>.shared.data(from: url)</span><br><span class="line">                <span class="keyword">guard</span> <span class="keyword">let</span> httpResponse <span class="operator">=</span> response <span class="keyword">as?</span> <span class="type">HTTPURLResponse</span>,</span><br><span class="line">                      httpResponse.statusCode <span class="operator">==</span> <span class="number">200</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="type">URLError</span>(.badServerResponse)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">try</span> <span class="keyword">await</span> data <span class="keyword">in</span> group &#123;</span><br><span class="line">            results.append(data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-最佳实践指南"><a href="#5-最佳实践指南" class="headerlink" title="5. 最佳实践指南"></a>5. 最佳实践指南</h3><ol>
<li><p><strong>SwiftUI最佳实践</strong>：</p>
<ul>
<li>使用不可变数据模型</li>
<li>拆分复杂视图为更小的可重用组件</li>
<li>合理使用状态管理属性包装器</li>
<li>避免在视图中执行耗时操作</li>
</ul>
</li>
<li><p><strong>并发编程最佳实践</strong>：</p>
<ul>
<li>优先使用结构化并发（async&#x2F;await）</li>
<li>使用Actor保护共享数据</li>
<li>避免使用锁和条件变量</li>
<li>及时取消不再需要的任务</li>
</ul>
</li>
<li><p><strong>Swift Package Manager最佳实践</strong>：</p>
<ul>
<li>保持包的单一职责</li>
<li>使用语义化版本控制</li>
<li>提供完整的文档和测试</li>
<li>避免循环依赖</li>
</ul>
</li>
</ol>
<h2 id="十、实践练习"><a href="#十、实践练习" class="headerlink" title="十、实践练习"></a>十、实践练习</h2><h3 id="1-SwiftUI基础练习"><a href="#1-SwiftUI基础练习" class="headerlink" title="1. SwiftUI基础练习"></a>1. SwiftUI基础练习</h3><p><strong>练习1：创建简单的待办事项应用</strong></p>
<p>实现一个具有以下功能的待办事项应用：</p>
<ul>
<li>显示待办事项列表</li>
<li>添加新的待办事项</li>
<li>标记待办事项为已完成&#x2F;未完成</li>
<li>删除待办事项</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 实现待办事项应用</span></span><br></pre></td></tr></table></figure>

<p><strong>练习2：实现响应式表单验证</strong></p>
<p>创建一个用户注册表单，包含以下字段并实现实时验证：</p>
<ul>
<li>用户名（至少3个字符）</li>
<li>邮箱（有效的邮箱格式）</li>
<li>密码（至少8个字符，包含大小写字母和数字）</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 实现响应式表单验证</span></span><br></pre></td></tr></table></figure>

<h3 id="2-并发编程练习"><a href="#2-并发编程练习" class="headerlink" title="2. 并发编程练习"></a>2. 并发编程练习</h3><p><strong>练习3：实现并发安全的数据存储</strong></p>
<p>使用Actor实现一个并发安全的键值存储，支持以下操作：</p>
<ul>
<li>设置值</li>
<li>获取值</li>
<li>删除值</li>
<li>清空存储</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 使用Actor实现并发安全存储</span></span><br></pre></td></tr></table></figure>

<p><strong>练习4：实现异步图像加载器</strong></p>
<p>创建一个异步图像加载器，支持：</p>
<ul>
<li>从URL异步加载图像</li>
<li>缓存已加载的图像</li>
<li>取消正在进行的加载任务</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 实现异步图像加载器</span></span><br></pre></td></tr></table></figure>

<h3 id="3-Swift-Package-Manager练习"><a href="#3-Swift-Package-Manager练习" class="headerlink" title="3. Swift Package Manager练习"></a>3. Swift Package Manager练习</h3><p><strong>练习5：创建自定义Swift Package</strong></p>
<p>创建一个名为”Networking”的Swift Package，提供以下功能：</p>
<ul>
<li>基于URLSession的网络请求封装</li>
<li>支持GET、POST、PUT、DELETE等HTTP方法</li>
<li>提供请求结果的类型安全解析</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Package.swift文件结构</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 创建Networking包</span></span><br></pre></td></tr></table></figure>

<p><strong>练习6：集成第三方依赖</strong></p>
<p>在练习5创建的Networking包中，集成一个JSON解析库（如SwiftyJSON或Codable），并提供JSON数据解析功能。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 集成JSON解析库</span></span><br></pre></td></tr></table></figure>

<h2 id="十一、实践建议"><a href="#十一、实践建议" class="headerlink" title="十一、实践建议"></a>十一、实践建议</h2><p>要成为一名优秀的Swift开发者，除了学习理论知识外，还需要不断地实践和探索：</p>
<ol>
<li><p><strong>编写代码</strong>：多写代码是学习Swift的最好方法，尝试解决各种编程问题，提高编程能力。</p>
</li>
<li><p><strong>阅读文档</strong>：仔细阅读苹果的官方文档和Swift的语言参考，深入理解Swift的特性和最佳实践。</p>
</li>
<li><p><strong>参与开源项目</strong>：参与Swift的开源项目，学习他人的代码，贡献自己的力量。</p>
</li>
<li><p><strong>学习优秀的代码</strong>：阅读优秀的Swift代码，如苹果的示例代码、开源库等，学习好的编程风格和设计模式。</p>
</li>
<li><p><strong>关注最新动态</strong>：关注Swift的最新发展动态，如WWDC的演讲、Swift Evolution的提案等，及时了解Swift的新特性和改进。</p>
</li>
</ol>
<h2 id="十二、总结"><a href="#十二、总结" class="headerlink" title="十二、总结"></a>十二、总结</h2><p>Swift是一种强大、现代、安全的编程语言，它具有简洁的语法、强大的类型系统、灵活的面向对象编程模型和优秀的性能。Swift适用于iOS、macOS、tvOS、watchOS和Linux等多个平台，可以用于开发各种应用，如移动应用、桌面应用、服务器端应用等。</p>
<p>通过这个系列的学习日记，我们系统地学习了Swift的核心概念和特性，从基础语法到高级特性，再到未来展望。希望这些学习日记能够帮助你全面夯实Swift编程基础，成为一名优秀的Swift开发者。</p>
<p>最后，学习编程是一个持续的过程，需要不断地实践和探索。祝愿你在Swift的学习之旅中取得成功！</p>
]]></content>
      <tags>
        <tag>swift</tag>
      </tags>
  </entry>
  <entry>
    <title>swift学习日记(四)</title>
    <url>/ios.github.io/2025/12/06/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Swift学习日记（四）：函数与闭包"><a href="#Swift学习日记（四）：函数与闭包" class="headerlink" title="Swift学习日记（四）：函数与闭包"></a>Swift学习日记（四）：函数与闭包</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>函数和闭包是Swift编程语言中的核心概念，它们允许我们将代码组织成可重用的模块。在上一篇学习日记中，我们已经了解了Swift的控制流语句。在这篇日记中，我们将深入探讨Swift函数的定义、调用、参数类型、返回值以及闭包的各种用法。</p>
<h2 id="二、函数的定义与调用"><a href="#二、函数的定义与调用" class="headerlink" title="二、函数的定义与调用"></a>二、函数的定义与调用</h2><p>函数是执行特定任务的代码块，它可以接受输入参数并返回输出结果。</p>
<h3 id="1-函数的基本定义"><a href="#1-函数的基本定义" class="headerlink" title="1. 函数的基本定义"></a>1. 函数的基本定义</h3><p>Swift中函数的基本定义格式如下：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">函数名</span>(<span class="params">参数名1</span>: 参数类型<span class="number">1</span>, <span class="params">参数名2</span>: 参数类型<span class="number">2</span>, <span class="operator">...</span>) -&gt; 返回值类型 &#123;</span><br><span class="line">    <span class="comment">// 函数体</span></span><br><span class="line">    <span class="keyword">return</span> 返回值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个简单的加法函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">add</span>(<span class="params">a</span>: <span class="type">Int</span>, <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a <span class="operator">+</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> add(a: <span class="number">3</span>, b: <span class="number">5</span>) <span class="comment">// result = 8</span></span><br></pre></td></tr></table></figure>

<h3 id="2-无参数函数"><a href="#2-无参数函数" class="headerlink" title="2. 无参数函数"></a>2. 无参数函数</h3><p>函数可以不接受任何参数：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sayHello</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeting <span class="operator">=</span> sayHello() <span class="comment">// greeting = &quot;Hello, World!&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-无返回值函数"><a href="#3-无返回值函数" class="headerlink" title="3. 无返回值函数"></a>3. 无返回值函数</h3><p>函数可以不返回任何值，此时返回值类型可以省略，或者使用<code>Void</code>（相当于空元组<code>()</code>）：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方式1：省略返回值类型</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">printHello</span>() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式2：使用Void</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">printHello2</span>() -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式3：使用空元组</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">printHello3</span>() -&gt; () &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用无返回值函数</span></span><br><span class="line">printHello()</span><br><span class="line">printHello2()</span><br><span class="line">printHello3()</span><br></pre></td></tr></table></figure>

<h3 id="4-多返回值函数"><a href="#4-多返回值函数" class="headerlink" title="4. 多返回值函数"></a>4. 多返回值函数</h3><p>函数可以返回多个值，使用元组类型：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">calculate</span>(<span class="params">a</span>: <span class="type">Int</span>, <span class="params">b</span>: <span class="type">Int</span>) -&gt; (sum: <span class="type">Int</span>, difference: <span class="type">Int</span>, product: <span class="type">Int</span>, quotient: <span class="type">Int</span>?) &#123;</span><br><span class="line">    <span class="keyword">let</span> sum <span class="operator">=</span> a <span class="operator">+</span> b</span><br><span class="line">    <span class="keyword">let</span> difference <span class="operator">=</span> a <span class="operator">-</span> b</span><br><span class="line">    <span class="keyword">let</span> product <span class="operator">=</span> a <span class="operator">*</span> b</span><br><span class="line">    <span class="keyword">let</span> quotient <span class="operator">=</span> b <span class="operator">!=</span> <span class="number">0</span> <span class="operator">?</span> a <span class="operator">/</span> b : <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">return</span> (sum, difference, product, quotient)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> calculate(a: <span class="number">10</span>, b: <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;和：<span class="subst">\(result.sum)</span>&quot;</span>) <span class="comment">// 输出：和：13</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;差：<span class="subst">\(result.difference)</span>&quot;</span>) <span class="comment">// 输出：差：7</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;积：<span class="subst">\(result.product)</span>&quot;</span>) <span class="comment">// 输出：积：30</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;商：<span class="subst">\(result.quotient <span class="operator">??</span> <span class="number">0</span>)</span>&quot;</span>) <span class="comment">// 输出：商：3</span></span><br></pre></td></tr></table></figure>

<h2 id="三、函数参数"><a href="#三、函数参数" class="headerlink" title="三、函数参数"></a>三、函数参数</h2><p>Swift提供了多种参数类型，使函数更加灵活和强大。</p>
<h3 id="1-外部参数名"><a href="#1-外部参数名" class="headerlink" title="1. 外部参数名"></a>1. 外部参数名</h3><p>外部参数名用于提高函数调用的可读性，它出现在函数调用时，而内部参数名用于函数体内部：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义带有外部参数名的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">greet</span>(<span class="params">to</span> <span class="params">name</span>: <span class="type">String</span>, <span class="params">with</span> <span class="params">message</span>: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(message)</span>, <span class="subst">\(name)</span>!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数，使用外部参数名</span></span><br><span class="line"><span class="keyword">let</span> greeting <span class="operator">=</span> greet(to: <span class="string">&quot;张三&quot;</span>, with: <span class="string">&quot;你好&quot;</span>) <span class="comment">// greeting = &quot;你好, 张三!&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-参数标签"><a href="#2-参数标签" class="headerlink" title="2. 参数标签"></a>2. 参数标签</h3><p>参数标签是Swift 3.0引入的概念，用于替代外部参数名，它的语法更简洁：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义带有参数标签的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">greet</span>(<span class="keyword">_</span> <span class="params">name</span>: <span class="type">String</span>, <span class="params">with</span> <span class="params">message</span>: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(message)</span>, <span class="subst">\(name)</span>!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数，_表示省略参数标签</span></span><br><span class="line"><span class="keyword">let</span> greeting <span class="operator">=</span> greet(<span class="string">&quot;张三&quot;</span>, with: <span class="string">&quot;你好&quot;</span>) <span class="comment">// greeting = &quot;你好, 张三!&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-默认参数值"><a href="#3-默认参数值" class="headerlink" title="3. 默认参数值"></a>3. 默认参数值</h3><p>函数参数可以设置默认值，当调用函数时可以省略这些参数：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义带有默认参数值的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">greet</span>(<span class="keyword">_</span> <span class="params">name</span>: <span class="type">String</span>, <span class="params">with</span> <span class="params">message</span>: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(message)</span>, <span class="subst">\(name)</span>!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数，使用默认参数值</span></span><br><span class="line"><span class="keyword">let</span> greeting1 <span class="operator">=</span> greet(<span class="string">&quot;张三&quot;</span>) <span class="comment">// greeting1 = &quot;Hello, 张三!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数，自定义参数值</span></span><br><span class="line"><span class="keyword">let</span> greeting2 <span class="operator">=</span> greet(<span class="string">&quot;张三&quot;</span>, with: <span class="string">&quot;你好&quot;</span>) <span class="comment">// greeting2 = &quot;你好, 张三!&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-可变参数"><a href="#4-可变参数" class="headerlink" title="4. 可变参数"></a>4. 可变参数</h3><p>可变参数允许函数接受任意数量的特定类型参数，使用<code>...</code>表示：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义带有可变参数的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">sum</span>(<span class="keyword">_</span> <span class="params">numbers</span>: <span class="type">Int</span>...) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> total <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        total <span class="operator">+=</span> number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数，传递任意数量的参数</span></span><br><span class="line"><span class="keyword">let</span> result1 <span class="operator">=</span> sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) <span class="comment">// result1 = 6</span></span><br><span class="line"><span class="keyword">let</span> result2 <span class="operator">=</span> sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) <span class="comment">// result2 = 15</span></span><br><span class="line"><span class="keyword">let</span> result3 <span class="operator">=</span> sum() <span class="comment">// result3 = 0</span></span><br></pre></td></tr></table></figure>

<h3 id="5-输入输出参数"><a href="#5-输入输出参数" class="headerlink" title="5. 输入输出参数"></a>5. 输入输出参数</h3><p>输入输出参数允许函数修改传递给它的参数值，并将修改后的值反映到函数外部。使用<code>inout</code>关键字表示：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义带有输入输出参数的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">swap</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="keyword">inout</span> <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="keyword">inout</span> <span class="type">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> temp <span class="operator">=</span> a</span><br><span class="line">    a <span class="operator">=</span> b</span><br><span class="line">    b <span class="operator">=</span> temp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数，传递变量的引用</span></span><br><span class="line"><span class="keyword">var</span> x <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> y <span class="operator">=</span> <span class="number">20</span></span><br><span class="line"><span class="built_in">swap</span>(<span class="operator">&amp;</span>x, <span class="operator">&amp;</span>y) <span class="comment">// x = 20, y = 10</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：输入输出参数不能有默认值，也不能是可变参数。</p>
<h2 id="四、函数类型"><a href="#四、函数类型" class="headerlink" title="四、函数类型"></a>四、函数类型</h2><p>每个函数都有一个特定的类型，由参数类型和返回值类型组成。</p>
<h3 id="1-函数类型的定义"><a href="#1-函数类型的定义" class="headerlink" title="1. 函数类型的定义"></a>1. 函数类型的定义</h3><p>函数类型的定义格式为：<code>(参数类型1, 参数类型2, ...) -&gt; 返回值类型</code></p>
<p>例如：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个变量，类型为函数类型</span></span><br><span class="line"><span class="keyword">var</span> mathFunction: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将函数赋值给变量</span></span><br><span class="line">mathFunction <span class="operator">=</span> add <span class="comment">// add是之前定义的加法函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用变量调用函数</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> mathFunction(<span class="number">3</span>, <span class="number">5</span>) <span class="comment">// result = 8</span></span><br></pre></td></tr></table></figure>

<h3 id="2-函数类型作为参数"><a href="#2-函数类型作为参数" class="headerlink" title="2. 函数类型作为参数"></a>2. 函数类型作为参数</h3><p>函数类型可以作为另一个函数的参数：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个接受函数类型参数的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">apply</span>(<span class="keyword">_</span> <span class="params">function</span>: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span>, <span class="params">to</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="params">and</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> function(a, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数，传递add函数作为参数</span></span><br><span class="line"><span class="keyword">let</span> sumResult <span class="operator">=</span> apply(add, to: <span class="number">3</span>, and: <span class="number">5</span>) <span class="comment">// sumResult = 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个乘法函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">multiply</span>(<span class="params">a</span>: <span class="type">Int</span>, <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a <span class="operator">*</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数，传递multiply函数作为参数</span></span><br><span class="line"><span class="keyword">let</span> multiplyResult <span class="operator">=</span> apply(multiply, to: <span class="number">3</span>, and: <span class="number">5</span>) <span class="comment">// multiplyResult = 15</span></span><br></pre></td></tr></table></figure>

<h3 id="3-函数类型作为返回值"><a href="#3-函数类型作为返回值" class="headerlink" title="3. 函数类型作为返回值"></a>3. 函数类型作为返回值</h3><p>函数类型可以作为另一个函数的返回值：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个返回函数类型的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">chooseOperation</span>(<span class="keyword">_</span> <span class="params">operation</span>: <span class="type">String</span>) -&gt; (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> operation &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> add</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> multiply</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> add</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数，获取返回的函数</span></span><br><span class="line"><span class="keyword">let</span> operation <span class="operator">=</span> chooseOperation(<span class="string">&quot;*&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用返回的函数</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> operation(<span class="number">3</span>, <span class="number">5</span>) <span class="comment">// result = 15</span></span><br></pre></td></tr></table></figure>

<h2 id="五、嵌套函数"><a href="#五、嵌套函数" class="headerlink" title="五、嵌套函数"></a>五、嵌套函数</h2><p>函数可以嵌套在其他函数内部：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">calculate</span>(<span class="keyword">_</span> <span class="params">operation</span>: <span class="type">String</span>, <span class="params">a</span>: <span class="type">Int</span>, <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="comment">// 嵌套的加法函数</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">add</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a <span class="operator">+</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 嵌套的乘法函数</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">multiply</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a <span class="operator">*</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据操作类型调用不同的嵌套函数</span></span><br><span class="line">    <span class="keyword">switch</span> operation &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> add(a, b)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> multiply(a, b)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> add(a, b)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sumResult <span class="operator">=</span> calculate(<span class="string">&quot;+&quot;</span>, a: <span class="number">3</span>, b: <span class="number">5</span>) <span class="comment">// sumResult = 8</span></span><br><span class="line"><span class="keyword">let</span> multiplyResult <span class="operator">=</span> calculate(<span class="string">&quot;*&quot;</span>, a: <span class="number">3</span>, b: <span class="number">5</span>) <span class="comment">// multiplyResult = 15</span></span><br></pre></td></tr></table></figure>

<p>嵌套函数只在外部函数内部可见，但可以被外部函数返回，从而在外部函数外部使用。</p>
<h2 id="六、闭包"><a href="#六、闭包" class="headerlink" title="六、闭包"></a>六、闭包</h2><p>闭包是自包含的函数代码块，可以在代码中被传递和使用。闭包类似于其他语言中的匿名函数或 lambda 表达式。</p>
<h3 id="1-闭包的基本语法"><a href="#1-闭包的基本语法" class="headerlink" title="1. 闭包的基本语法"></a>1. 闭包的基本语法</h3><p>闭包的基本语法格式如下：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">&#123; (参数名1: 参数类型<span class="number">1</span>, 参数名2: 参数类型<span class="number">2</span>, <span class="operator">...</span>) -&gt; 返回值类型 <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// 闭包体</span></span><br><span class="line">    <span class="keyword">return</span> 返回值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个闭包</span></span><br><span class="line"><span class="keyword">let</span> addClosure <span class="operator">=</span> &#123; (a: <span class="type">Int</span>, b: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> a <span class="operator">+</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用闭包</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> addClosure(<span class="number">3</span>, <span class="number">5</span>) <span class="comment">// result = 8</span></span><br></pre></td></tr></table></figure>

<h3 id="2-闭包的类型推断"><a href="#2-闭包的类型推断" class="headerlink" title="2. 闭包的类型推断"></a>2. 闭包的类型推断</h3><p>闭包可以根据上下文进行类型推断，简化语法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 类型推断后可以省略参数类型和返回值类型</span></span><br><span class="line"><span class="keyword">let</span> addClosure: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="operator">=</span> &#123; a, b <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> a <span class="operator">+</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单行闭包可以省略return关键字</span></span><br><span class="line"><span class="keyword">let</span> addClosure2: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="operator">=</span> &#123; a, b <span class="keyword">in</span> a <span class="operator">+</span> b &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-参数名称缩写"><a href="#3-参数名称缩写" class="headerlink" title="3. 参数名称缩写"></a>3. 参数名称缩写</h3><p>Swift提供了参数名称缩写（$0, $1, $2等），可以进一步简化闭包语法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用参数名称缩写</span></span><br><span class="line"><span class="keyword">let</span> addClosure: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="operator">=</span> &#123; <span class="variable">$0</span> <span class="operator">+</span> <span class="variable">$1</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// $0表示第一个参数，$1表示第二个参数</span></span><br><span class="line"><span class="keyword">let</span> subtractClosure: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="operator">=</span> &#123; <span class="variable">$0</span> <span class="operator">-</span> <span class="variable">$1</span> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-尾随闭包"><a href="#4-尾随闭包" class="headerlink" title="4. 尾随闭包"></a>4. 尾随闭包</h3><p>如果函数的最后一个参数是闭包，可以将闭包写在函数调用的括号外面，这种语法称为尾随闭包：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个接受闭包参数的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">calculate</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>, <span class="params">operation</span>: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> operation(a, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用尾随闭包调用函数</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> calculate(<span class="number">3</span>, <span class="number">5</span>) &#123; <span class="variable">$0</span> <span class="operator">+</span> <span class="variable">$1</span> &#125; <span class="comment">// result = 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果闭包是函数的唯一参数，可以省略函数调用的括号</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">performOperation</span>(<span class="params">operation</span>: () -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    operation()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数，省略括号</span></span><br><span class="line">performOperation &#123; </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行操作&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-捕获值"><a href="#5-捕获值" class="headerlink" title="5. 捕获值"></a>5. 捕获值</h3><p>闭包可以捕获和存储其所在上下文中的常量和变量，即使这些常量和变量在原始上下文中已经不存在：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">makeIncrementer</span>(<span class="params">incrementAmount</span>: <span class="type">Int</span>) -&gt; () -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> total <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 闭包捕获了total和incrementAmount变量</span></span><br><span class="line">    <span class="keyword">let</span> incrementer: () -&gt; <span class="type">Int</span> <span class="operator">=</span> &#123; </span><br><span class="line">        total <span class="operator">+=</span> incrementAmount</span><br><span class="line">        <span class="keyword">return</span> total</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> incrementer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个增量器，每次增加2</span></span><br><span class="line"><span class="keyword">let</span> incrementByTwo <span class="operator">=</span> makeIncrementer(incrementAmount: <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(incrementByTwo()) <span class="comment">// 输出：2</span></span><br><span class="line"><span class="built_in">print</span>(incrementByTwo()) <span class="comment">// 输出：4</span></span><br><span class="line"><span class="built_in">print</span>(incrementByTwo()) <span class="comment">// 输出：6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建另一个增量器，每次增加3</span></span><br><span class="line"><span class="keyword">let</span> incrementByThree <span class="operator">=</span> makeIncrementer(incrementAmount: <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(incrementByThree()) <span class="comment">// 输出：3</span></span><br><span class="line"><span class="built_in">print</span>(incrementByTwo()) <span class="comment">// 输出：8（继续使用之前的total值）</span></span><br></pre></td></tr></table></figure>

<h3 id="6-闭包的内存管理"><a href="#6-闭包的内存管理" class="headerlink" title="6. 闭包的内存管理"></a>6. 闭包的内存管理</h3><p>当闭包捕获了引用类型的变量时，可能会导致循环引用。Swift提供了<code>weak</code>和<code>unowned</code>关键字来解决这个问题：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> greeting: (() -&gt; <span class="type">String</span>)<span class="operator">?</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span>被销毁了&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个Person实例</span></span><br><span class="line"><span class="keyword">var</span> person: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 闭包捕获了person实例的强引用，导致循环引用</span></span><br><span class="line">person<span class="operator">?</span>.greeting <span class="operator">=</span> &#123; [<span class="keyword">weak</span> person] <span class="keyword">in</span> <span class="comment">// 使用weak关键字</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> strongPerson <span class="operator">=</span> person <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Person已被销毁&quot;</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(strongPerson.name)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者使用unowned关键字</span></span><br><span class="line">person<span class="operator">?</span>.greeting <span class="operator">=</span> &#123; [<span class="keyword">unowned</span> person] <span class="keyword">in</span> <span class="comment">// 使用unowned关键字</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(person<span class="operator">!</span>.name)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用闭包</span></span><br><span class="line"><span class="built_in">print</span>(person<span class="operator">?</span>.greeting<span class="operator">?</span>() <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放person实例</span></span><br><span class="line">person <span class="operator">=</span> <span class="literal">nil</span> <span class="comment">// 输出：张三被销毁了</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：</p>
<ul>
<li><code>weak</code>关键字表示闭包对捕获的实例是弱引用，实例可能为nil，所以需要使用可选绑定</li>
<li><code>unowned</code>关键字表示闭包对捕获的实例是无主引用，实例不会为nil，但如果实例被销毁后继续使用，会导致运行时错误</li>
</ul>
<h2 id="七、内容机制与知识点总结"><a href="#七、内容机制与知识点总结" class="headerlink" title="七、内容机制与知识点总结"></a>七、内容机制与知识点总结</h2><h3 id="1-内容机制"><a href="#1-内容机制" class="headerlink" title="1. 内容机制"></a>1. 内容机制</h3><p>Swift的函数和闭包系统设计遵循以下核心原则：</p>
<ul>
<li><strong>模块化</strong>：将代码组织成可重用的模块，提高代码的可维护性</li>
<li><strong>灵活性</strong>：支持多种参数类型和返回值类型，适应不同的编程场景</li>
<li><strong>功能性</strong>：支持函数式编程范式，使代码更加简洁和表达力强</li>
<li><strong>安全性</strong>：通过类型安全和捕获值机制，避免潜在的运行时错误</li>
</ul>
<h3 id="2-知识点总结"><a href="#2-知识点总结" class="headerlink" title="2. 知识点总结"></a>2. 知识点总结</h3><table>
<thead>
<tr>
<th>主题</th>
<th>核心知识点</th>
</tr>
</thead>
<tbody><tr>
<td>函数定义</td>
<td>基本定义、无参数函数、无返回值函数、多返回值函数</td>
</tr>
<tr>
<td>函数参数</td>
<td>外部参数名、参数标签、默认参数值、可变参数、输入输出参数</td>
</tr>
<tr>
<td>函数类型</td>
<td>函数类型定义、作为参数、作为返回值</td>
</tr>
<tr>
<td>嵌套函数</td>
<td>嵌套定义、作用域、访问外部函数变量</td>
</tr>
<tr>
<td>闭包基础</td>
<td>基本语法、类型推断、参数名称缩写</td>
</tr>
<tr>
<td>闭包高级特性</td>
<td>尾随闭包、捕获值、内存管理(weak&#x2F;unowned)</td>
</tr>
</tbody></table>
<h2 id="八、遇到的问题及解决方案"><a href="#八、遇到的问题及解决方案" class="headerlink" title="八、遇到的问题及解决方案"></a>八、遇到的问题及解决方案</h2><h3 id="1-函数参数标签与外部参数名混淆"><a href="#1-函数参数标签与外部参数名混淆" class="headerlink" title="1. 函数参数标签与外部参数名混淆"></a>1. 函数参数标签与外部参数名混淆</h3><p><strong>问题</strong>：在Swift 3.0之前使用外部参数名，升级到Swift 3.0及以后版本时，代码编译失败</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift 2.x的外部参数名语法</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">greet</span>(<span class="params">to</span> <span class="params">name</span>: <span class="type">String</span>, <span class="params">with</span> <span class="params">message</span>: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(message)</span>, <span class="subst">\(name)</span>!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Swift 3.0+需要使用参数标签语法</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">greet</span>(<span class="keyword">_</span> <span class="params">name</span>: <span class="type">String</span>, <span class="params">with</span> <span class="params">message</span>: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(message)</span>, <span class="subst">\(name)</span>!&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用下划线<code>_</code>作为第一个参数的标签，使函数调用时可以省略第一个参数的标签</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift 3.0+的正确语法</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">greet</span>(<span class="keyword">_</span> <span class="params">name</span>: <span class="type">String</span>, <span class="params">with</span> <span class="params">message</span>: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(message)</span>, <span class="subst">\(name)</span>!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用方式</span></span><br><span class="line"><span class="keyword">let</span> greeting <span class="operator">=</span> greet(<span class="string">&quot;张三&quot;</span>, with: <span class="string">&quot;你好&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-闭包导致的循环引用"><a href="#2-闭包导致的循环引用" class="headerlink" title="2. 闭包导致的循环引用"></a>2. 闭包导致的循环引用</h3><p><strong>问题</strong>：当闭包捕获了self或其他引用类型变量时，可能导致循环引用，使对象无法被释放</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> greeting: (() -&gt; <span class="type">String</span>)<span class="operator">?</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(name)</span>被销毁了&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person: <span class="type">Person</span>? <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导致循环引用</span></span><br><span class="line">person<span class="operator">?</span>.greeting <span class="operator">=</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(<span class="keyword">self</span>.name)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person <span class="operator">=</span> <span class="literal">nil</span> <span class="comment">// 不会调用deinit，因为存在循环引用</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用weak或unowned关键字打破循环引用</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用weak关键字</span></span><br><span class="line">person<span class="operator">?</span>.greeting <span class="operator">=</span> &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span> </span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> strongSelf <span class="operator">=</span> <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Person已被销毁&quot;</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(strongSelf.name)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者使用unowned关键字</span></span><br><span class="line">person<span class="operator">?</span>.greeting <span class="operator">=</span> &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(<span class="keyword">self</span>.name)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person <span class="operator">=</span> <span class="literal">nil</span> <span class="comment">// 现在会调用deinit</span></span><br></pre></td></tr></table></figure>

<h3 id="3-可变参数与输入输出参数的混淆"><a href="#3-可变参数与输入输出参数的混淆" class="headerlink" title="3. 可变参数与输入输出参数的混淆"></a>3. 可变参数与输入输出参数的混淆</h3><p><strong>问题</strong>：试图将可变参数声明为inout参数，导致编译错误</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 错误的语法</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">modifyNumbers</span>(<span class="keyword">_</span> <span class="params">numbers</span>: <span class="keyword">inout</span> <span class="type">Int</span>...) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>numbers.count &#123;</span><br><span class="line">        numbers[i] <span class="operator">*=</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用数组代替可变参数作为inout参数</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 正确的语法</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">modifyNumbers</span>(<span class="keyword">_</span> <span class="params">numbers</span>: <span class="keyword">inout</span> [<span class="type">Int</span>]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>numbers.count &#123;</span><br><span class="line">        numbers[i] <span class="operator">*=</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用方式</span></span><br><span class="line"><span class="keyword">var</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">modifyNumbers(<span class="operator">&amp;</span>numbers) <span class="comment">// numbers现在是[2, 4, 6, 8, 10]</span></span><br></pre></td></tr></table></figure>

<h3 id="4-函数类型作为返回值时的类型推断问题"><a href="#4-函数类型作为返回值时的类型推断问题" class="headerlink" title="4. 函数类型作为返回值时的类型推断问题"></a>4. 函数类型作为返回值时的类型推断问题</h3><p><strong>问题</strong>：当函数返回另一个函数时，类型推断可能不准确，导致编译错误</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 编译错误：无法推断返回类型</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">chooseOperation</span>(<span class="keyword">_</span> <span class="params">operation</span>: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> operation &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; (a: <span class="type">Int</span>, b: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span> a <span class="operator">+</span> b &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; (a: <span class="type">Int</span>, b: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span> a <span class="operator">*</span> b &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; (a: <span class="type">Int</span>, b: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span> a <span class="operator">+</span> b &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：显式声明函数的返回类型</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 显式声明返回类型</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">chooseOperation</span>(<span class="keyword">_</span> <span class="params">operation</span>: <span class="type">String</span>) -&gt; (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> operation &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="variable">$0</span> <span class="operator">+</span> <span class="variable">$1</span> &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="variable">$1</span> &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="variable">$0</span> <span class="operator">+</span> <span class="variable">$1</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-闭包捕获值的时机问题"><a href="#5-闭包捕获值的时机问题" class="headerlink" title="5. 闭包捕获值的时机问题"></a>5. 闭包捕获值的时机问题</h3><p><strong>问题</strong>：闭包捕获值的时机与预期不符，导致结果错误</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> closures: [() -&gt; <span class="type">Int</span>] <span class="operator">=</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">    closures.append &#123; number &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预期输出：1, 2, 3, 4, 5</span></span><br><span class="line"><span class="comment">// 实际输出：5, 5, 5, 5, 5</span></span><br><span class="line"><span class="keyword">for</span> closure <span class="keyword">in</span> closures &#123;</span><br><span class="line">    <span class="built_in">print</span>(closure())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：在循环内部创建一个局部变量，捕获该局部变量而不是循环变量</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> closures: [() -&gt; <span class="type">Int</span>] <span class="operator">=</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">    <span class="keyword">let</span> localNumber <span class="operator">=</span> number <span class="comment">// 创建局部变量</span></span><br><span class="line">    closures.append &#123; localNumber &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在输出：1, 2, 3, 4, 5</span></span><br><span class="line"><span class="keyword">for</span> closure <span class="keyword">in</span> closures &#123;</span><br><span class="line">    <span class="built_in">print</span>(closure())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Swift 3.0+的另一种解决方案：使用闭包参数</span></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">    closures.append &#123; [number] <span class="keyword">in</span> number &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="九、高阶用法"><a href="#九、高阶用法" class="headerlink" title="九、高阶用法"></a>九、高阶用法</h2><h3 id="1-高级函数技巧"><a href="#1-高级函数技巧" class="headerlink" title="1. 高级函数技巧"></a>1. 高级函数技巧</h3><h4 id="柯里化函数"><a href="#柯里化函数" class="headerlink" title="柯里化函数"></a>柯里化函数</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义柯里化函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">add</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>) -&gt; (<span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; b <span class="keyword">in</span> a <span class="operator">+</span> b &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用柯里化函数</span></span><br><span class="line"><span class="keyword">let</span> add5 <span class="operator">=</span> add(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> add5(<span class="number">3</span>) <span class="comment">// result = 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 链式调用</span></span><br><span class="line"><span class="keyword">let</span> add10 <span class="operator">=</span> add(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">let</span> result2 <span class="operator">=</span> add10(add5(<span class="number">3</span>)) <span class="comment">// result2 = 18</span></span><br></pre></td></tr></table></figure>

<h4 id="泛型函数"><a href="#泛型函数" class="headerlink" title="泛型函数"></a>泛型函数</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义泛型函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">swapValues</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">_</span> <span class="params">a</span>: <span class="keyword">inout</span> <span class="type">T</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="keyword">inout</span> <span class="type">T</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> temp <span class="operator">=</span> a</span><br><span class="line">    a <span class="operator">=</span> b</span><br><span class="line">    b <span class="operator">=</span> temp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用泛型函数</span></span><br><span class="line"><span class="keyword">var</span> x <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> y <span class="operator">=</span> <span class="number">20</span></span><br><span class="line">swapValues(<span class="operator">&amp;</span>x, <span class="operator">&amp;</span>y) <span class="comment">// x = 20, y = 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str1 <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span></span><br><span class="line"><span class="keyword">var</span> str2 <span class="operator">=</span> <span class="string">&quot;World&quot;</span></span><br><span class="line">swapValues(<span class="operator">&amp;</span>str1, <span class="operator">&amp;</span>str2) <span class="comment">// str1 = &quot;World&quot;, str2 = &quot;Hello&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-高级闭包技巧"><a href="#2-高级闭包技巧" class="headerlink" title="2. 高级闭包技巧"></a>2. 高级闭包技巧</h3><h4 id="逃逸闭包与非逃逸闭包"><a href="#逃逸闭包与非逃逸闭包" class="headerlink" title="逃逸闭包与非逃逸闭包"></a>逃逸闭包与非逃逸闭包</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 非逃逸闭包（默认）：闭包在函数返回前执行完成</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">performNonEscaping</span>(<span class="params">closure</span>: () -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    closure()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 逃逸闭包：闭包可能在函数返回后执行</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">performEscaping</span>(<span class="params">closure</span>: <span class="keyword">@escaping</span> () -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="type">DispatchQueue</span>.main.async &#123; <span class="comment">// 将闭包传递到函数外部</span></span><br><span class="line">        closure()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用逃逸闭包需要显式捕获self</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ViewController</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> completionHandlers: [() -&gt; <span class="type">Void</span>] <span class="operator">=</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">addCompletionHandler</span>() &#123;</span><br><span class="line">        performEscaping &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;闭包执行&quot;</span>)</span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.completionHandlers.append &#123; <span class="built_in">print</span>(<span class="string">&quot;新的闭包&quot;</span>) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自动闭包"><a href="#自动闭包" class="headerlink" title="自动闭包"></a>自动闭包</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义接受自动闭包的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">evaluate</span>(<span class="params">condition</span>: <span class="keyword">@autoclosure</span> () -&gt; <span class="type">Bool</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;评估条件&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> condition()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用自动闭包</span></span><br><span class="line"><span class="keyword">let</span> x <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> y <span class="operator">=</span> <span class="number">20</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> evaluate(condition: x <span class="operator">&gt;</span> y) <span class="comment">// 自动将x &gt; y包装成闭包</span></span><br></pre></td></tr></table></figure>

<h3 id="3-函数式编程模式"><a href="#3-函数式编程模式" class="headerlink" title="3. 函数式编程模式"></a>3. 函数式编程模式</h3><h4 id="函数组合"><a href="#函数组合" class="headerlink" title="函数组合"></a>函数组合</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义函数组合运算符</span></span><br><span class="line"><span class="keyword">infix</span> <span class="keyword">operator</span> <span class="title">&gt;&gt;&gt;</span>: <span class="type">AdditionPrecedence</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">&gt;&gt;&gt;</span> &lt;<span class="type">A</span>, <span class="type">B</span>, <span class="type">C</span>&gt;(<span class="params">f</span>: <span class="keyword">@escaping</span> (<span class="type">A</span>) -&gt; <span class="type">B</span>, <span class="params">g</span>: <span class="keyword">@escaping</span> (<span class="type">B</span>) -&gt; <span class="type">C</span>) -&gt; (<span class="type">A</span>) -&gt; <span class="type">C</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; g(f(<span class="variable">$0</span>)) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义两个函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">double</span>(<span class="keyword">_</span> <span class="params">x</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; x <span class="operator">*</span> <span class="number">2</span> &#125;</span><br><span class="line"><span class="keyword">func</span> <span class="title function_">square</span>(<span class="keyword">_</span> <span class="params">x</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; x <span class="operator">*</span> x &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合函数</span></span><br><span class="line"><span class="keyword">let</span> doubleThenSquare <span class="operator">=</span> double <span class="operator">&gt;&gt;&gt;</span> square</span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> doubleThenSquare(<span class="number">3</span>) <span class="comment">// 先double得到6，再square得到36</span></span><br></pre></td></tr></table></figure>

<h4 id="部分应用"><a href="#部分应用" class="headerlink" title="部分应用"></a>部分应用</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个接受多个参数的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">greet</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">message</span>: <span class="type">String</span>, <span class="params">punctuation</span>: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(message)</span>, <span class="subst">\(name)</span><span class="subst">\(punctuation)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 部分应用：固定部分参数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">greetWithHello</span>(<span class="params">name</span>: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> greet(name: name, message: <span class="string">&quot;Hello&quot;</span>, punctuation: <span class="string">&quot;!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用部分应用的函数</span></span><br><span class="line"><span class="keyword">let</span> greeting <span class="operator">=</span> greetWithHello(name: <span class="string">&quot;张三&quot;</span>) <span class="comment">// &quot;Hello, 张三!&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-性能优化策略"><a href="#4-性能优化策略" class="headerlink" title="4. 性能优化策略"></a>4. 性能优化策略</h3><h4 id="闭包内存优化"><a href="#闭包内存优化" class="headerlink" title="闭包内存优化"></a>闭包内存优化</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用逃逸闭包时，避免强引用循环</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataManager</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> data: [<span class="type">Int</span>] <span class="operator">=</span> []</span><br><span class="line">    <span class="keyword">var</span> completion: (([<span class="type">Int</span>]) -&gt; <span class="type">Void</span>)<span class="operator">?</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fetchData</span>(<span class="params">completion</span>: <span class="keyword">@escaping</span> ([<span class="type">Int</span>]) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.completion <span class="operator">=</span> completion</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 模拟网络请求</span></span><br><span class="line">        <span class="type">DispatchQueue</span>.global().async &#123;</span><br><span class="line">            <span class="comment">// 获取数据</span></span><br><span class="line">            <span class="keyword">let</span> newData <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                <span class="keyword">self</span>.data <span class="operator">=</span> newData</span><br><span class="line">                completion(newData)</span><br><span class="line">                <span class="keyword">self</span>.completion <span class="operator">=</span> <span class="literal">nil</span> <span class="comment">// 释放闭包引用</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="函数类型优化"><a href="#函数类型优化" class="headerlink" title="函数类型优化"></a>函数类型优化</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用内联函数减少函数调用开销</span></span><br><span class="line"><span class="meta">@inline</span>(__always) <span class="keyword">func</span> <span class="title function_">isEven</span>(<span class="keyword">_</span> <span class="params">number</span>: <span class="type">Int</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> number <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用isEven函数</span></span><br><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> evenNumbers <span class="operator">=</span> numbers.filter &#123; isEven(<span class="variable">$0</span>) &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-最佳实践"><a href="#5-最佳实践" class="headerlink" title="5. 最佳实践"></a>5. 最佳实践</h3><h4 id="函数设计"><a href="#函数设计" class="headerlink" title="函数设计"></a>函数设计</h4><ul>
<li><strong>单一职责</strong>：每个函数只负责一个特定的任务</li>
<li><strong>清晰命名</strong>：函数名应该清晰地表达其功能和参数</li>
<li><strong>合理参数</strong>：避免过多的参数，如果参数超过4个，考虑使用结构体或元组</li>
<li><strong>类型安全</strong>：利用Swift的类型系统确保函数的安全性</li>
</ul>
<h4 id="闭包使用"><a href="#闭包使用" class="headerlink" title="闭包使用"></a>闭包使用</h4><ul>
<li><strong>简洁性</strong>：使用类型推断、参数名称缩写和尾随闭包简化语法</li>
<li><strong>内存管理</strong>：在捕获self或其他引用类型时，使用weak或unowned避免循环引用</li>
<li><strong>性能考虑</strong>：在处理大型数据集时，注意闭包的性能影响</li>
<li><strong>可读性</strong>：避免过于复杂的闭包，如果闭包体超过3行，考虑使用命名函数</li>
</ul>
<h4 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h4><ul>
<li><strong>适度使用</strong>：根据场景选择合适的编程范式，不要为了函数式而函数式</li>
<li><strong>组合优先</strong>：通过函数组合创建复杂功能，提高代码的可维护性</li>
<li><strong>不可变性</strong>：尽量使用不可变值，减少副作用</li>
</ul>
<h2 id="十、实践练习"><a href="#十、实践练习" class="headerlink" title="十、实践练习"></a>十、实践练习</h2><h3 id="1-函数基础练习"><a href="#1-函数基础练习" class="headerlink" title="1. 函数基础练习"></a>1. 函数基础练习</h3><h4 id="练习1：温度转换函数"><a href="#练习1：温度转换函数" class="headerlink" title="练习1：温度转换函数"></a>练习1：温度转换函数</h4><p>创建一个函数，将摄氏度转换为华氏度。公式：华氏度 &#x3D; 摄氏度 × 9&#x2F;5 + 32</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">celsiusToFahrenheit</span>(<span class="keyword">_</span> <span class="params">celsius</span>: <span class="type">Double</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> celsius <span class="operator">*</span> <span class="number">9</span><span class="operator">/</span><span class="number">5</span> <span class="operator">+</span> <span class="number">32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="built_in">print</span>(celsiusToFahrenheit(<span class="number">0</span>))   <span class="comment">// 32.0</span></span><br><span class="line"><span class="built_in">print</span>(celsiusToFahrenheit(<span class="number">100</span>)) <span class="comment">// 212.0</span></span><br></pre></td></tr></table></figure>

<h4 id="练习2：计算数组总和"><a href="#练习2：计算数组总和" class="headerlink" title="练习2：计算数组总和"></a>练习2：计算数组总和</h4><p>创建一个函数，计算整数数组的总和。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">sumArray</span>(<span class="keyword">_</span> <span class="params">array</span>: [<span class="type">Int</span>]) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> total <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> array &#123;</span><br><span class="line">        total <span class="operator">+=</span> number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者使用reduce</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">sumArrayReduce</span>(<span class="keyword">_</span> <span class="params">array</span>: [<span class="type">Int</span>]) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> array.reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="built_in">print</span>(sumArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]))         <span class="comment">// 15</span></span><br><span class="line"><span class="built_in">print</span>(sumArrayReduce([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]))    <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>

<h3 id="2-函数参数练习"><a href="#2-函数参数练习" class="headerlink" title="2. 函数参数练习"></a>2. 函数参数练习</h3><h4 id="练习3：带有默认参数的函数"><a href="#练习3：带有默认参数的函数" class="headerlink" title="练习3：带有默认参数的函数"></a>练习3：带有默认参数的函数</h4><p>创建一个函数，计算商品的折扣价格，默认折扣为10%。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">calculateDiscountPrice</span>(<span class="params">originalPrice</span>: <span class="type">Double</span>, <span class="params">discountPercentage</span>: <span class="type">Double</span> <span class="operator">=</span> <span class="number">10</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> discount <span class="operator">=</span> originalPrice <span class="operator">*</span> (discountPercentage <span class="operator">/</span> <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> originalPrice <span class="operator">-</span> discount</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="built_in">print</span>(calculateDiscountPrice(originalPrice: <span class="number">100</span>))                  <span class="comment">// 90.0</span></span><br><span class="line"><span class="built_in">print</span>(calculateDiscountPrice(originalPrice: <span class="number">100</span>, discountPercentage: <span class="number">20</span>)) <span class="comment">// 80.0</span></span><br></pre></td></tr></table></figure>

<h4 id="练习4：输入输出参数"><a href="#练习4：输入输出参数" class="headerlink" title="练习4：输入输出参数"></a>练习4：输入输出参数</h4><p>创建一个函数，使用输入输出参数交换两个整数的值。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">swapValues</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="keyword">inout</span> <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="keyword">inout</span> <span class="type">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> temp <span class="operator">=</span> a</span><br><span class="line">    a <span class="operator">=</span> b</span><br><span class="line">    b <span class="operator">=</span> temp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> x <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">var</span> y <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">swapValues(<span class="operator">&amp;</span>x, <span class="operator">&amp;</span>y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;x = <span class="subst">\(x)</span>, y = <span class="subst">\(y)</span>&quot;</span>) <span class="comment">// x = 10, y = 5</span></span><br></pre></td></tr></table></figure>

<h3 id="3-闭包练习"><a href="#3-闭包练习" class="headerlink" title="3. 闭包练习"></a>3. 闭包练习</h3><h4 id="练习5：使用闭包排序"><a href="#练习5：使用闭包排序" class="headerlink" title="练习5：使用闭包排序"></a>练习5：使用闭包排序</h4><p>创建一个字符串数组，然后使用闭包按字符串长度排序。</p>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fruits <span class="operator">=</span> [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;cherry&quot;</span>, <span class="string">&quot;date&quot;</span>, <span class="string">&quot;elderberry&quot;</span>]</span><br><span class="line">fruits.sort &#123; <span class="variable">$0</span>.count <span class="operator">&lt;</span> <span class="variable">$1</span>.count &#125;</span><br><span class="line"><span class="built_in">print</span>(fruits) <span class="comment">// [&quot;date&quot;, &quot;apple&quot;, &quot;cherry&quot;, &quot;banana&quot;, &quot;elderberry&quot;]</span></span><br></pre></td></tr></table></figure>

<h4 id="练习6：高阶函数应用"><a href="#练习6：高阶函数应用" class="headerlink" title="练习6：高阶函数应用"></a>练习6：高阶函数应用</h4><p>使用map、filter和reduce实现以下功能：</p>
<ol>
<li>将整数数组中的每个元素平方</li>
<li>过滤出平方后的偶数</li>
<li>计算过滤后数组的总和</li>
</ol>
<p><strong>代码示例：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请在这里实现你的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>答案：</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> numbers</span><br><span class="line">    .map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="variable">$0</span> &#125;      <span class="comment">// [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</span></span><br><span class="line">    .filter &#123; <span class="variable">$0</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#125; <span class="comment">// [4, 16, 36, 64, 100]</span></span><br><span class="line">    .reduce(<span class="number">0</span>, <span class="operator">+</span>)         <span class="comment">// 220</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result) <span class="comment">// 220</span></span><br></pre></td></tr></table></figure>

<h2 id="十一、总结"><a href="#十一、总结" class="headerlink" title="十一、总结"></a>十一、总结</h2><p>在这篇学习日记中，我们深入探讨了Swift的函数和闭包：</p>
<ol>
<li><p><strong>函数的定义与调用</strong>：包括基本定义、无参数函数、无返回值函数和多返回值函数</p>
</li>
<li><p><strong>函数参数</strong>：包括外部参数名、参数标签、默认参数值、可变参数和输入输出参数</p>
</li>
<li><p><strong>函数类型</strong>：函数可以作为变量、参数或返回值使用</p>
</li>
<li><p><strong>嵌套函数</strong>：函数可以嵌套在其他函数内部</p>
</li>
<li><p><strong>闭包</strong>：包括闭包的基本语法、类型推断、参数名称缩写、尾随闭包和值捕获</p>
</li>
<li><p><strong>高级用法</strong>：包括柯里化函数、泛型函数、逃逸闭包、自动闭包、函数组合和部分应用</p>
</li>
</ol>
<p>函数和闭包是Swift编程中的核心概念，它们使代码更加模块化、可重用和灵活。在下一篇学习日记中，我们将继续学习Swift的面向对象编程特性，包括类和结构体。</p>
]]></content>
      <tags>
        <tag>swift</tag>
      </tags>
  </entry>
  <entry>
    <title>swift学习日记(二)</title>
    <url>/ios.github.io/2025/12/04/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Swift学习日记（二）：数据类型与运算符"><a href="#Swift学习日记（二）：数据类型与运算符" class="headerlink" title="Swift学习日记（二）：数据类型与运算符"></a>Swift学习日记（二）：数据类型与运算符</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>在上一篇学习日记中，我们初步了解了Swift的基本语法、变量与常量的声明方式以及一些简单的数据类型。在这篇日记中，我们将深入探讨Swift的数据类型系统和运算符，这些是Swift编程的基础构建块。</p>
<h2 id="二、数据类型详解"><a href="#二、数据类型详解" class="headerlink" title="二、数据类型详解"></a>二、数据类型详解</h2><h3 id="1-数值类型"><a href="#1-数值类型" class="headerlink" title="1. 数值类型"></a>1. 数值类型</h3><h4 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h4><p>Swift提供了不同位数的整数类型，以满足不同的存储需求：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 有符号整数</span></span><br><span class="line"><span class="keyword">var</span> int8: <span class="type">Int8</span> <span class="operator">=</span> <span class="number">127</span> <span class="comment">// 8位有符号整数，范围：-128到127</span></span><br><span class="line"><span class="keyword">var</span> int16: <span class="type">Int16</span> <span class="operator">=</span> <span class="number">32767</span> <span class="comment">// 16位有符号整数，范围：-32768到32767</span></span><br><span class="line"><span class="keyword">var</span> int32: <span class="type">Int32</span> <span class="operator">=</span> <span class="number">2147483647</span> <span class="comment">// 32位有符号整数，范围：-2147483648到2147483647</span></span><br><span class="line"><span class="keyword">var</span> int64: <span class="type">Int64</span> <span class="operator">=</span> <span class="number">9223372036854775807</span> <span class="comment">// 64位有符号整数，范围：-9223372036854775808到9223372036854775807</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 无符号整数</span></span><br><span class="line"><span class="keyword">var</span> uint8: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">255</span> <span class="comment">// 8位无符号整数，范围：0到255</span></span><br><span class="line"><span class="keyword">var</span> uint16: <span class="type">UInt16</span> <span class="operator">=</span> <span class="number">65535</span> <span class="comment">// 16位无符号整数，范围：0到65535</span></span><br><span class="line"><span class="keyword">var</span> uint32: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">4294967295</span> <span class="comment">// 32位无符号整数，范围：0到4294967295</span></span><br><span class="line"><span class="keyword">var</span> uint64: <span class="type">UInt64</span> <span class="operator">=</span> <span class="number">18446744073709551615</span> <span class="comment">// 64位无符号整数，范围：0到18446744073709551615</span></span><br></pre></td></tr></table></figure>

<p>在实际开发中，我们通常使用<code>Int</code>类型，它会根据平台自动适配为32位或64位：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> count: <span class="type">Int</span> <span class="operator">=</span> <span class="number">100</span> <span class="comment">// 在32位平台上为Int32，在64位平台上为Int64</span></span><br></pre></td></tr></table></figure>

<h4 id="浮点类型"><a href="#浮点类型" class="headerlink" title="浮点类型"></a>浮点类型</h4><p>Swift提供了两种浮点类型：<code>Float</code>和<code>Double</code>。<code>Double</code>的精度更高，通常优先使用：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> floatValue: <span class="type">Float</span> <span class="operator">=</span> <span class="number">3.14159</span> <span class="comment">// 单精度浮点数，精度约为6位小数</span></span><br><span class="line"><span class="keyword">var</span> doubleValue: <span class="type">Double</span> <span class="operator">=</span> <span class="number">3.141592653589793</span> <span class="comment">// 双精度浮点数，精度约为15位小数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数值字面量</span></span><br><span class="line"><span class="keyword">let</span> decimal <span class="operator">=</span> <span class="number">123.45</span> <span class="comment">// 十进制浮点数</span></span><br><span class="line"><span class="keyword">let</span> hexadecimal <span class="operator">=</span> <span class="number">0x1F.3E</span> <span class="comment">// 十六进制浮点数</span></span><br><span class="line"><span class="keyword">let</span> exponent <span class="operator">=</span> <span class="number">1.23e-4</span> <span class="comment">// 科学计数法，相当于0.000123</span></span><br></pre></td></tr></table></figure>

<h3 id="2-布尔类型"><a href="#2-布尔类型" class="headerlink" title="2. 布尔类型"></a>2. 布尔类型</h3><p>布尔类型<code>Bool</code>只有两个值：<code>true</code>和<code>false</code>，用于表示逻辑值：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> isActive: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">var</span> isEmpty: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 布尔值常用于条件判断</span></span><br><span class="line"><span class="keyword">if</span> isActive &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;系统已激活&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;系统未激活&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-字符串类型"><a href="#3-字符串类型" class="headerlink" title="3. 字符串类型"></a>3. 字符串类型</h3><p>String类型用于表示字符序列，在Swift中是值类型，具有良好的性能和安全性：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字符串创建</span></span><br><span class="line"><span class="keyword">let</span> emptyString <span class="operator">=</span> <span class="string">&quot;&quot;</span> <span class="comment">// 空字符串</span></span><br><span class="line"><span class="keyword">let</span> stringWithContent <span class="operator">=</span> <span class="string">&quot;Hello Swift&quot;</span></span><br><span class="line"><span class="keyword">let</span> multiLineString <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">这是一个</span></span><br><span class="line"><span class="string">多行字符串</span></span><br><span class="line"><span class="string">示例</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串属性</span></span><br><span class="line"><span class="keyword">let</span> length <span class="operator">=</span> stringWithContent.count <span class="comment">// 字符串长度</span></span><br><span class="line"><span class="keyword">let</span> isEmpty <span class="operator">=</span> emptyString.isEmpty <span class="comment">// 检查是否为空</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串操作</span></span><br><span class="line"><span class="keyword">let</span> concatenated <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span> <span class="operator">+</span> <span class="string">&quot; &quot;</span> <span class="operator">+</span> <span class="string">&quot;Swift&quot;</span> <span class="comment">// 字符串拼接</span></span><br><span class="line"><span class="keyword">let</span> interpolated <span class="operator">=</span> <span class="string">&quot;Hello, <span class="subst">\(name)</span>!&quot;</span> <span class="comment">// 字符串插值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串遍历</span></span><br><span class="line"><span class="keyword">for</span> character <span class="keyword">in</span> <span class="string">&quot;Swift&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(character)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-集合类型"><a href="#4-集合类型" class="headerlink" title="4. 集合类型"></a>4. 集合类型</h3><h4 id="数组-Array"><a href="#数组-Array" class="headerlink" title="数组(Array)"></a>数组(Array)</h4><p>数组是有序的相同类型元素集合，可以动态添加或删除元素：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 数组创建</span></span><br><span class="line"><span class="keyword">var</span> numbers: [<span class="type">Int</span>] <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> emptyArray: [<span class="type">String</span>] <span class="operator">=</span> []</span><br><span class="line"><span class="keyword">var</span> repeatedArray <span class="operator">=</span> <span class="type">Array</span>(repeating: <span class="number">0</span>, count: <span class="number">5</span>) <span class="comment">// 创建包含5个0的数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组操作</span></span><br><span class="line">numbers.append(<span class="number">6</span>) <span class="comment">// 添加元素到末尾</span></span><br><span class="line">numbers.insert(<span class="number">0</span>, at: <span class="number">0</span>) <span class="comment">// 在指定位置插入元素</span></span><br><span class="line">numbers.remove(at: <span class="number">0</span>) <span class="comment">// 删除指定位置的元素</span></span><br><span class="line">numbers.removeLast() <span class="comment">// 删除最后一个元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组访问</span></span><br><span class="line"><span class="keyword">let</span> firstNumber <span class="operator">=</span> numbers[<span class="number">0</span>] <span class="comment">// 访问第一个元素</span></span><br><span class="line"><span class="keyword">let</span> lastNumber <span class="operator">=</span> numbers.last <span class="comment">// 访问最后一个元素（可选类型）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组遍历</span></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">    <span class="built_in">print</span>(number)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (index, number) <span class="keyword">in</span> numbers.enumerated() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;索引<span class="subst">\(index)</span>：<span class="subst">\(number)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="集合-Set"><a href="#集合-Set" class="headerlink" title="集合(Set)"></a>集合(Set)</h4><p>集合是无序的唯一类型元素集合，适合需要快速查找和唯一性的场景：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 集合创建</span></span><br><span class="line"><span class="keyword">var</span> colors: <span class="type">Set</span>&lt;<span class="type">String</span>&gt; <span class="operator">=</span> [<span class="string">&quot;红&quot;</span>, <span class="string">&quot;绿&quot;</span>, <span class="string">&quot;蓝&quot;</span>]</span><br><span class="line"><span class="keyword">var</span> emptySet: <span class="type">Set</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> []</span><br><span class="line"></span><br><span class="line"><span class="comment">// 集合操作</span></span><br><span class="line">colors.insert(<span class="string">&quot;黄&quot;</span>) <span class="comment">// 添加元素</span></span><br><span class="line">colors.remove(<span class="string">&quot;红&quot;</span>) <span class="comment">// 删除元素</span></span><br><span class="line"><span class="keyword">let</span> containsGreen <span class="operator">=</span> colors.contains(<span class="string">&quot;绿&quot;</span>) <span class="comment">// 检查是否包含元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 集合遍历</span></span><br><span class="line"><span class="keyword">for</span> color <span class="keyword">in</span> colors &#123;</span><br><span class="line">    <span class="built_in">print</span>(color)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 集合运算</span></span><br><span class="line"><span class="keyword">let</span> setA: <span class="type">Set</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">let</span> setB: <span class="type">Set</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> intersection <span class="operator">=</span> setA.intersection(setB) <span class="comment">// 交集：[3, 4]</span></span><br><span class="line"><span class="keyword">let</span> union <span class="operator">=</span> setA.union(setB) <span class="comment">// 并集：[1, 2, 3, 4, 5, 6]</span></span><br><span class="line"><span class="keyword">let</span> symmetricDifference <span class="operator">=</span> setA.symmetricDifference(setB) <span class="comment">// 对称差集：[1, 2, 5, 6]</span></span><br><span class="line"><span class="keyword">let</span> subtracting <span class="operator">=</span> setA.subtracting(setB) <span class="comment">// 差集：[1, 2]</span></span><br></pre></td></tr></table></figure>

<h4 id="字典-Dictionary"><a href="#字典-Dictionary" class="headerlink" title="字典(Dictionary)"></a>字典(Dictionary)</h4><p>字典是键值对集合，键必须唯一，值可以重复：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字典创建</span></span><br><span class="line"><span class="keyword">var</span> person: [<span class="type">String</span>: <span class="keyword">Any</span>] <span class="operator">=</span> [<span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>, <span class="string">&quot;isStudent&quot;</span>: <span class="literal">true</span>]</span><br><span class="line"><span class="keyword">var</span> emptyDictionary: [<span class="type">String</span>: <span class="type">Int</span>] <span class="operator">=</span> [:]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字典操作</span></span><br><span class="line">person[<span class="string">&quot;gender&quot;</span>] <span class="operator">=</span> <span class="string">&quot;男&quot;</span> <span class="comment">// 添加或修改键值对</span></span><br><span class="line">person.removeValue(forKey: <span class="string">&quot;isStudent&quot;</span>) <span class="comment">// 删除键值对</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字典访问</span></span><br><span class="line"><span class="keyword">let</span> name <span class="operator">=</span> person[<span class="string">&quot;name&quot;</span>] <span class="keyword">as?</span> <span class="type">String</span> <span class="comment">// 安全访问，返回可选类型</span></span><br><span class="line"><span class="keyword">let</span> age <span class="operator">=</span> person[<span class="string">&quot;age&quot;</span>] <span class="keyword">as?</span> <span class="type">Int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字典遍历</span></span><br><span class="line"><span class="keyword">for</span> (key, value) <span class="keyword">in</span> person &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(key)</span>：<span class="subst">\(value)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> person.keys &#123;</span><br><span class="line">    <span class="built_in">print</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> person.values &#123;</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-元组类型"><a href="#5-元组类型" class="headerlink" title="5. 元组类型"></a>5. 元组类型</h3><p>元组用于将多个不同类型的值组合成一个复合值：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 元组创建</span></span><br><span class="line"><span class="keyword">let</span> personInfo <span class="operator">=</span> (<span class="string">&quot;张三&quot;</span>, <span class="number">25</span>, <span class="string">&quot;男&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> namedPerson <span class="operator">=</span> (name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">25</span>, gender: <span class="string">&quot;男&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 元组访问</span></span><br><span class="line"><span class="keyword">let</span> name <span class="operator">=</span> personInfo.<span class="number">0</span> <span class="comment">// 通过索引访问</span></span><br><span class="line"><span class="keyword">let</span> age <span class="operator">=</span> personInfo.<span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> gender <span class="operator">=</span> personInfo.<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> namedName <span class="operator">=</span> namedPerson.name <span class="comment">// 通过名称访问</span></span><br><span class="line"><span class="keyword">let</span> namedAge <span class="operator">=</span> namedPerson.age</span><br><span class="line"></span><br><span class="line"><span class="comment">// 元组分解</span></span><br><span class="line"><span class="keyword">let</span> (personName, personAge, personGender) <span class="operator">=</span> personInfo</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;姓名：<span class="subst">\(personName)</span>，年龄：<span class="subst">\(personAge)</span>，性别：<span class="subst">\(personGender)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 忽略元组中的某个值</span></span><br><span class="line"><span class="keyword">let</span> (justName, <span class="keyword">_</span>, justGender) <span class="operator">=</span> personInfo</span><br></pre></td></tr></table></figure>

<h3 id="6-可选类型"><a href="#6-可选类型" class="headerlink" title="6. 可选类型"></a>6. 可选类型</h3><p>可选类型是Swift的一个重要特性，用于表示一个值可能存在或不存在：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 可选类型声明</span></span><br><span class="line"><span class="keyword">var</span> optionalName: <span class="type">String</span>? <span class="operator">=</span> <span class="string">&quot;张三&quot;</span></span><br><span class="line"><span class="keyword">var</span> optionalAge: <span class="type">Int</span>? <span class="operator">=</span> <span class="literal">nil</span> <span class="comment">// 明确表示没有值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选类型解包</span></span><br><span class="line"><span class="comment">// 1. 强制解包（危险，只有确定有值时才使用）</span></span><br><span class="line"><span class="keyword">let</span> name <span class="operator">=</span> optionalName<span class="operator">!</span> <span class="comment">// 如果optionalName为nil，会导致运行时错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 可选绑定（安全，推荐使用）</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> unwrappedName <span class="operator">=</span> optionalName &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;姓名：<span class="subst">\(unwrappedName)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;姓名未知&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 空合并运算符（??）</span></span><br><span class="line"><span class="keyword">let</span> displayName <span class="operator">=</span> optionalName <span class="operator">??</span> <span class="string">&quot;未知用户&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 可选链</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> address: <span class="type">Address</span>?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> city: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">city</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.city <span class="operator">=</span> city</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person <span class="operator">=</span> <span class="type">Person</span>()</span><br><span class="line"><span class="keyword">let</span> city <span class="operator">=</span> person.address<span class="operator">?</span>.city <span class="comment">// 如果address为nil，整个表达式返回nil</span></span><br></pre></td></tr></table></figure>

<h2 id="三、运算符详解"><a href="#三、运算符详解" class="headerlink" title="三、运算符详解"></a>三、运算符详解</h2><h3 id="1-算术运算符"><a href="#1-算术运算符" class="headerlink" title="1. 算术运算符"></a>1. 算术运算符</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基本算术运算符</span></span><br><span class="line"><span class="keyword">let</span> sum <span class="operator">=</span> <span class="number">10</span> <span class="operator">+</span> <span class="number">5</span> <span class="comment">// 加法</span></span><br><span class="line"><span class="keyword">let</span> difference <span class="operator">=</span> <span class="number">10</span> <span class="operator">-</span> <span class="number">5</span> <span class="comment">// 减法</span></span><br><span class="line"><span class="keyword">let</span> product <span class="operator">=</span> <span class="number">10</span> <span class="operator">*</span> <span class="number">5</span> <span class="comment">// 乘法</span></span><br><span class="line"><span class="keyword">let</span> quotient <span class="operator">=</span> <span class="number">10</span> <span class="operator">/</span> <span class="number">5</span> <span class="comment">// 除法</span></span><br><span class="line"><span class="keyword">let</span> remainder <span class="operator">=</span> <span class="number">10</span> <span class="operator">%</span> <span class="number">3</span> <span class="comment">// 取余</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 复合赋值运算符</span></span><br><span class="line"><span class="keyword">var</span> value <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">value <span class="operator">+=</span> <span class="number">5</span> <span class="comment">// 等价于 value = value + 5</span></span><br><span class="line">value <span class="operator">-=</span> <span class="number">3</span> <span class="comment">// 等价于 value = value - 3</span></span><br><span class="line">value <span class="operator">*=</span> <span class="number">2</span> <span class="comment">// 等价于 value = value * 2</span></span><br><span class="line">value <span class="regexp">/= 4 /</span><span class="operator">/</span> 等价于 value <span class="operator">=</span> value <span class="operator">/</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一元运算符</span></span><br><span class="line"><span class="keyword">let</span> positive <span class="operator">=</span> <span class="operator">+</span><span class="number">5</span></span><br><span class="line"><span class="keyword">let</span> negative <span class="operator">=</span> <span class="operator">-</span><span class="number">5</span></span><br><span class="line"><span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">count <span class="operator">+=</span> <span class="number">1</span> <span class="comment">// 递增</span></span><br><span class="line">count <span class="operator">-=</span> <span class="number">1</span> <span class="comment">// 递减</span></span><br></pre></td></tr></table></figure>

<h3 id="2-比较运算符"><a href="#2-比较运算符" class="headerlink" title="2. 比较运算符"></a>2. 比较运算符</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> b <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isEqual <span class="operator">=</span> a <span class="operator">==</span> b <span class="comment">// 等于</span></span><br><span class="line"><span class="keyword">let</span> isNotEqual <span class="operator">=</span> a <span class="operator">!=</span> b <span class="comment">// 不等于</span></span><br><span class="line"><span class="keyword">let</span> isGreater <span class="operator">=</span> a <span class="operator">&gt;</span> b <span class="comment">// 大于</span></span><br><span class="line"><span class="keyword">let</span> isLess <span class="operator">=</span> a <span class="operator">&lt;</span> b <span class="comment">// 小于</span></span><br><span class="line"><span class="keyword">let</span> isGreaterOrEqual <span class="operator">=</span> a <span class="operator">&gt;=</span> b <span class="comment">// 大于等于</span></span><br><span class="line"><span class="keyword">let</span> isLessOrEqual <span class="operator">=</span> a <span class="operator">&lt;=</span> b <span class="comment">// 小于等于</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 比较运算符返回布尔值，常用于条件判断</span></span><br><span class="line"><span class="keyword">if</span> a <span class="operator">&gt;</span> b &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;a大于b&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-逻辑运算符"><a href="#3-逻辑运算符" class="headerlink" title="3. 逻辑运算符"></a>3. 逻辑运算符</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> isTrue <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">let</span> isFalse <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> andResult <span class="operator">=</span> isTrue <span class="operator">&amp;&amp;</span> isFalse <span class="comment">// 逻辑与，只有都为true时才返回true</span></span><br><span class="line"><span class="keyword">let</span> orResult <span class="operator">=</span> isTrue <span class="operator">||</span> isFalse <span class="comment">// 逻辑或，只要有一个为true就返回true</span></span><br><span class="line"><span class="keyword">let</span> notResult <span class="operator">=</span> <span class="operator">!</span>isTrue <span class="comment">// 逻辑非，取反</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 逻辑运算符短路特性</span></span><br><span class="line"><span class="keyword">if</span> isFalse <span class="operator">&amp;&amp;</span> someExpensiveOperation() &#123;</span><br><span class="line">    <span class="comment">// someExpensiveOperation()不会执行，因为isFalse已经是false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> isTrue <span class="operator">||</span> someExpensiveOperation() &#123;</span><br><span class="line">    <span class="comment">// someExpensiveOperation()不会执行，因为isTrue已经是true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-位运算符"><a href="#4-位运算符" class="headerlink" title="4. 位运算符"></a>4. 位运算符</h3><p>位运算符用于操作二进制位：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b1010</span> <span class="comment">// 10</span></span><br><span class="line"><span class="keyword">let</span> b: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b1100</span> <span class="comment">// 12</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 位与</span></span><br><span class="line"><span class="keyword">let</span> andResult <span class="operator">=</span> a <span class="operator">&amp;</span> b <span class="comment">// 0b1000 (8)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 位或</span></span><br><span class="line"><span class="keyword">let</span> orResult <span class="operator">=</span> a <span class="operator">|</span> b <span class="comment">// 0b1110 (14)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 位异或</span></span><br><span class="line"><span class="keyword">let</span> xorResult <span class="operator">=</span> a <span class="operator">^</span> b <span class="comment">// 0b0110 (6)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 位非</span></span><br><span class="line"><span class="keyword">let</span> notResult <span class="operator">=</span> <span class="operator">~</span>a <span class="comment">// 0b0101 (5)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 左移</span></span><br><span class="line"><span class="keyword">let</span> leftShift <span class="operator">=</span> a <span class="operator">&lt;&lt;</span> <span class="number">1</span> <span class="comment">// 0b10100 (20)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 右移</span></span><br><span class="line"><span class="keyword">let</span> rightShift <span class="operator">=</span> a <span class="operator">&gt;&gt;</span> <span class="number">1</span> <span class="comment">// 0b101 (5)</span></span><br></pre></td></tr></table></figure>

<h3 id="5-范围运算符"><a href="#5-范围运算符" class="headerlink" title="5. 范围运算符"></a>5. 范围运算符</h3><p>范围运算符用于表示值的范围：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 闭区间运算符（包含上下界）</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i) <span class="comment">// 输出：1, 2, 3, 4, 5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 半开区间运算符（包含下界，不包含上界）</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">..&lt;</span><span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i) <span class="comment">// 输出：1, 2, 3, 4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单侧区间</span></span><br><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> firstThree <span class="operator">=</span> numbers[<span class="number">0</span><span class="operator">...</span><span class="number">2</span>] <span class="comment">// [1, 2, 3]</span></span><br><span class="line"><span class="keyword">let</span> fromSecond <span class="operator">=</span> numbers[<span class="number">1</span><span class="operator">...</span>]</span><br><span class="line"><span class="keyword">let</span> upToThird <span class="operator">=</span> numbers[<span class="operator">..&lt;</span><span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<h2 id="四、类型转换"><a href="#四、类型转换" class="headerlink" title="四、类型转换"></a>四、类型转换</h2><h3 id="1-数值类型转换"><a href="#1-数值类型转换" class="headerlink" title="1. 数值类型转换"></a>1. 数值类型转换</h3><p>Swift是类型安全语言，不同数值类型之间的转换需要显式进行：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> intValue: <span class="type">Int</span> <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> doubleValue: <span class="type">Double</span> <span class="operator">=</span> <span class="number">3.14</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 整数转浮点数</span></span><br><span class="line"><span class="keyword">let</span> intToDouble <span class="operator">=</span> <span class="type">Double</span>(intValue) <span class="comment">// 100.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 浮点数转整数（会截断小数部分）</span></span><br><span class="line"><span class="keyword">let</span> doubleToInt <span class="operator">=</span> <span class="type">Int</span>(doubleValue) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不同整数类型之间转换</span></span><br><span class="line"><span class="keyword">let</span> int8Value: <span class="type">Int8</span> <span class="operator">=</span> <span class="number">127</span></span><br><span class="line"><span class="keyword">let</span> int16Value <span class="operator">=</span> <span class="type">Int16</span>(int8Value)</span><br></pre></td></tr></table></figure>

<h3 id="2-字符串与数值之间的转换"><a href="#2-字符串与数值之间的转换" class="headerlink" title="2. 字符串与数值之间的转换"></a>2. 字符串与数值之间的转换</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 数值转字符串</span></span><br><span class="line"><span class="keyword">let</span> number <span class="operator">=</span> <span class="number">123</span></span><br><span class="line"><span class="keyword">let</span> numberString <span class="operator">=</span> <span class="type">String</span>(number)</span><br><span class="line"><span class="keyword">let</span> decimalString <span class="operator">=</span> <span class="type">String</span>(<span class="number">123.45</span>)</span><br><span class="line"><span class="keyword">let</span> hexString <span class="operator">=</span> <span class="type">String</span>(<span class="number">255</span>, radix: <span class="number">16</span>) <span class="comment">// 十六进制字符串：&quot;ff&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串转数值</span></span><br><span class="line"><span class="keyword">let</span> stringToInt <span class="operator">=</span> <span class="type">Int</span>(<span class="string">&quot;123&quot;</span>) <span class="comment">// Optional(123)</span></span><br><span class="line"><span class="keyword">let</span> stringToDouble <span class="operator">=</span> <span class="type">Double</span>(<span class="string">&quot;123.45&quot;</span>) <span class="comment">// Optional(123.45)</span></span><br><span class="line"><span class="keyword">let</span> invalidString <span class="operator">=</span> <span class="type">Int</span>(<span class="string">&quot;abc&quot;</span>) <span class="comment">// nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用可选绑定安全转换</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> value <span class="operator">=</span> <span class="type">Int</span>(<span class="string">&quot;123&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;转换成功：<span class="subst">\(value)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;转换失败&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、内容机制与知识点总结"><a href="#五、内容机制与知识点总结" class="headerlink" title="五、内容机制与知识点总结"></a>五、内容机制与知识点总结</h2><h3 id="1-内容机制"><a href="#1-内容机制" class="headerlink" title="1. 内容机制"></a>1. 内容机制</h3><p>Swift的数据类型系统和运算符设计遵循以下核心原则：</p>
<ul>
<li><strong>类型安全</strong>：在编译时检查类型，避免运行时错误</li>
<li><strong>值语义</strong>：大多数数据类型（如String、Array、Dictionary）都是值类型，赋值和传递时会创建副本</li>
<li><strong>一致性</strong>：运算符行为在不同类型之间保持一致</li>
<li><strong>表达性</strong>：提供丰富的类型和运算符，允许开发者用简洁的代码表达复杂的逻辑</li>
</ul>
<h3 id="2-知识点总结"><a href="#2-知识点总结" class="headerlink" title="2. 知识点总结"></a>2. 知识点总结</h3><table>
<thead>
<tr>
<th>主题</th>
<th>核心知识点</th>
</tr>
</thead>
<tbody><tr>
<td>数值类型</td>
<td>Int、Int8&#x2F;16&#x2F;32&#x2F;64、UInt、UInt8&#x2F;16&#x2F;32&#x2F;64、Float、Double</td>
</tr>
<tr>
<td>布尔类型</td>
<td>Bool、true&#x2F;false值</td>
</tr>
<tr>
<td>字符串类型</td>
<td>字符串创建、属性、操作、遍历</td>
</tr>
<tr>
<td>集合类型</td>
<td>Array（有序可重复）、Set（无序唯一）、Dictionary（键值对）</td>
</tr>
<tr>
<td>元组类型</td>
<td>复合值、索引访问、命名访问、分解</td>
</tr>
<tr>
<td>可选类型</td>
<td>声明、强制解包、可选绑定、空合并运算符、可选链</td>
</tr>
<tr>
<td>算术运算符</td>
<td>+、-、*、&#x2F;、%、复合赋值运算符</td>
</tr>
<tr>
<td>比较运算符</td>
<td>&#x3D;&#x3D;、!&#x3D;、&gt;、&lt;、&gt;&#x3D;、&lt;&#x3D;</td>
</tr>
<tr>
<td>逻辑运算符</td>
<td>&amp;&amp;、</td>
</tr>
<tr>
<td>位运算符</td>
<td>&amp;、</td>
</tr>
<tr>
<td>范围运算符</td>
<td>闭区间(…)、半开区间(..&lt;)、单侧区间</td>
</tr>
<tr>
<td>类型转换</td>
<td>数值类型转换、字符串与数值转换</td>
</tr>
</tbody></table>
<h2 id="六、遇到的问题及解决方案"><a href="#六、遇到的问题及解决方案" class="headerlink" title="六、遇到的问题及解决方案"></a>六、遇到的问题及解决方案</h2><h3 id="1-可选类型的强制解包崩溃"><a href="#1-可选类型的强制解包崩溃" class="headerlink" title="1. 可选类型的强制解包崩溃"></a>1. 可选类型的强制解包崩溃</h3><p><strong>问题</strong>：使用<code>!</code>强制解包可选类型时，如果值为<code>nil</code>，会导致运行时崩溃</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> optionalString: <span class="type">String</span>? <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> unwrappedString <span class="operator">=</span> optionalString<span class="operator">!</span> <span class="comment">// 运行时崩溃</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用可选绑定或空合并运算符进行安全解包</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 可选绑定</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> unwrappedString <span class="operator">=</span> optionalString &#123;</span><br><span class="line">    <span class="built_in">print</span>(unwrappedString)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;字符串为nil&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 空合并运算符</span></span><br><span class="line"><span class="keyword">let</span> displayString <span class="operator">=</span> optionalString <span class="operator">??</span> <span class="string">&quot;默认值&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-类型推断失败"><a href="#2-类型推断失败" class="headerlink" title="2. 类型推断失败"></a>2. 类型推断失败</h3><p><strong>问题</strong>：当Swift无法推断类型时出现编译错误</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers <span class="operator">=</span> [] <span class="comment">// 错误：Cannot infer contextual base in reference to member &#x27;append&#x27;</span></span><br><span class="line">numbers.append(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：显式指定类型</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers: [<span class="type">Int</span>] <span class="operator">=</span> [] <span class="comment">// 显式指定为Int类型数组</span></span><br><span class="line">numbers.append(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-集合类型的类型不匹配"><a href="#3-集合类型的类型不匹配" class="headerlink" title="3. 集合类型的类型不匹配"></a>3. 集合类型的类型不匹配</h3><p><strong>问题</strong>：尝试将不同类型的元素添加到集合中</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers: [<span class="type">Int</span>] <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">numbers.append(<span class="string">&quot;4&quot;</span>) <span class="comment">// 错误：Cannot convert value of type &#x27;String&#x27; to expected argument type &#x27;Int&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：确保添加的元素类型与集合类型一致，或使用类型转换</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方法1：添加相同类型</span></span><br><span class="line">numbers.append(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：类型转换</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> num <span class="operator">=</span> <span class="type">Int</span>(<span class="string">&quot;4&quot;</span>) &#123;</span><br><span class="line">    numbers.append(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-字符串与数值转换失败"><a href="#4-字符串与数值转换失败" class="headerlink" title="4. 字符串与数值转换失败"></a>4. 字符串与数值转换失败</h3><p><strong>问题</strong>：尝试将无效字符串转换为数值</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> stringToInt <span class="operator">=</span> <span class="type">Int</span>(<span class="string">&quot;abc&quot;</span>) <span class="comment">// 返回nil</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用可选绑定处理转换失败的情况</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> value <span class="operator">=</span> <span class="type">Int</span>(<span class="string">&quot;abc&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;转换成功：<span class="subst">\(value)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;转换失败，使用默认值&quot;</span>)</span><br><span class="line">    <span class="keyword">let</span> value <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-字典的安全访问"><a href="#5-字典的安全访问" class="headerlink" title="5. 字典的安全访问"></a>5. 字典的安全访问</h3><p><strong>问题</strong>：从字典中获取值时类型不确定</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> person: [<span class="type">String</span>: <span class="keyword">Any</span>] <span class="operator">=</span> [<span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>]</span><br><span class="line"><span class="keyword">let</span> age <span class="operator">=</span> person[<span class="string">&quot;age&quot;</span>] <span class="comment">// 返回Any?类型</span></span><br><span class="line">age <span class="operator">+</span> <span class="number">1</span> <span class="comment">// 错误：Binary operator &#x27;+&#x27; cannot be applied to operands of type &#x27;Any?&#x27; and &#x27;Int&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用类型转换进行安全访问</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> age <span class="operator">=</span> person[<span class="string">&quot;age&quot;</span>] <span class="keyword">as?</span> <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> nextYearAge <span class="operator">=</span> age <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;明年年龄：<span class="subst">\(nextYearAge)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、高阶用法"><a href="#七、高阶用法" class="headerlink" title="七、高阶用法"></a>七、高阶用法</h2><h3 id="1-高级数据类型技巧"><a href="#1-高级数据类型技巧" class="headerlink" title="1. 高级数据类型技巧"></a>1. 高级数据类型技巧</h3><h4 id="类型别名的高级应用"><a href="#类型别名的高级应用" class="headerlink" title="类型别名的高级应用"></a>类型别名的高级应用</h4><p>使用类型别名创建复杂类型的简化表示：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 复杂字典类型的简化</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">UserDictionary</span> <span class="operator">=</span> [<span class="type">String</span>: [<span class="type">String</span>: <span class="keyword">Any</span>]]</span><br><span class="line"><span class="keyword">let</span> users: <span class="type">UserDictionary</span> <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;user1&quot;</span>: [<span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>],</span><br><span class="line">    <span class="string">&quot;user2&quot;</span>: [<span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数类型的简化</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">CompletionHandler</span>&lt;<span class="type">T</span>&gt; <span class="operator">=</span> (<span class="type">Result</span>&lt;<span class="type">T</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchData</span>(<span class="params">completion</span>: <span class="type">CompletionHandler</span>&lt;<span class="type">Data</span>&gt;) &#123;</span><br><span class="line">    <span class="comment">// 实现</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型类型的简化</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Coordinates</span>&lt;<span class="type">T</span>&gt; <span class="operator">=</span> (latitude: <span class="type">T</span>, longitude: <span class="type">T</span>)</span><br><span class="line"><span class="keyword">let</span> location: <span class="type">Coordinates</span>&lt;<span class="type">Double</span>&gt; <span class="operator">=</span> (<span class="number">39.9042</span>, <span class="number">116.4074</span>)</span><br></pre></td></tr></table></figure>

<h4 id="自定义运算符"><a href="#自定义运算符" class="headerlink" title="自定义运算符"></a>自定义运算符</h4><p>Swift允许创建自定义运算符，增强代码的可读性：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义自定义中缀运算符</span></span><br><span class="line"><span class="keyword">infix</span> <span class="keyword">operator</span> <span class="title">**</span>: <span class="type">MultiplicationPrecedence</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现自定义运算符</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">**</span>(<span class="params">base</span>: <span class="type">Double</span>, <span class="params">exponent</span>: <span class="type">Double</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> pow(base, exponent)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用自定义运算符</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> <span class="number">2.0</span> <span class="operator">**</span> <span class="number">3.0</span> <span class="comment">// 输出：8.0</span></span><br></pre></td></tr></table></figure>

<h3 id="2-高级字符串操作"><a href="#2-高级字符串操作" class="headerlink" title="2. 高级字符串操作"></a>2. 高级字符串操作</h3><h4 id="字符串的高级遍历"><a href="#字符串的高级遍历" class="headerlink" title="字符串的高级遍历"></a>字符串的高级遍历</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> text <span class="operator">=</span> <span class="string">&quot;Hello Swift!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 按单词遍历</span></span><br><span class="line"><span class="keyword">let</span> words <span class="operator">=</span> text.split(separator: <span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> words &#123;</span><br><span class="line">    <span class="built_in">print</span>(word) <span class="comment">// 输出：Hello, Swift!</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按行遍历（多行字符串）</span></span><br><span class="line"><span class="keyword">let</span> multiLine <span class="operator">=</span> <span class="string">&quot;Line 1<span class="subst">\n</span>Line 2<span class="subst">\n</span>Line 3&quot;</span></span><br><span class="line"><span class="keyword">let</span> lines <span class="operator">=</span> multiLine.split(separator: <span class="string">&quot;<span class="subst">\n</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用enumerated()获取字符和索引</span></span><br><span class="line"><span class="keyword">for</span> (index, character) <span class="keyword">in</span> text.enumerated() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;索引<span class="subst">\(index)</span>: <span class="subst">\(character)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="字符串的高级搜索"><a href="#字符串的高级搜索" class="headerlink" title="字符串的高级搜索"></a>字符串的高级搜索</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> text <span class="operator">=</span> <span class="string">&quot;Hello Swift, Swift is great!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找第一个匹配的范围</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> range <span class="operator">=</span> text.range(of: <span class="string">&quot;Swift&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> matchedText <span class="operator">=</span> text[range] <span class="comment">// &quot;Swift&quot;</span></span><br><span class="line">    <span class="keyword">let</span> startIndex <span class="operator">=</span> range.lowerBound</span><br><span class="line">    <span class="keyword">let</span> endIndex <span class="operator">=</span> range.upperBound</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找所有匹配项</span></span><br><span class="line"><span class="keyword">var</span> searchRange <span class="operator">=</span> text.startIndex<span class="operator">..&lt;</span>text.endIndex</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">let</span> range <span class="operator">=</span> text.range(of: <span class="string">&quot;Swift&quot;</span>, range: searchRange) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;找到匹配：<span class="subst">\(text[range])</span>&quot;</span>)</span><br><span class="line">    searchRange <span class="operator">=</span> range.upperBound<span class="operator">..&lt;</span>text.endIndex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 忽略大小写搜索</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> range <span class="operator">=</span> text.range(of: <span class="string">&quot;swift&quot;</span>, options: .caseInsensitive) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;忽略大小写找到：<span class="subst">\(text[range])</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-高级集合操作"><a href="#3-高级集合操作" class="headerlink" title="3. 高级集合操作"></a>3. 高级集合操作</h3><h4 id="数组的高级操作"><a href="#数组的高级操作" class="headerlink" title="数组的高级操作"></a>数组的高级操作</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用高阶函数处理数组</span></span><br><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 映射：将数组中的每个元素转换为新值</span></span><br><span class="line"><span class="keyword">let</span> squared <span class="operator">=</span> numbers.map &#123; <span class="variable">$0</span> <span class="operator">*</span> <span class="variable">$0</span> &#125; <span class="comment">// [1, 4, 9, 16, 25]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤：根据条件筛选元素</span></span><br><span class="line"><span class="keyword">let</span> evenNumbers <span class="operator">=</span> numbers.filter &#123; <span class="variable">$0</span> <span class="operator">%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span> &#125; <span class="comment">// [2, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 归约：将数组中的元素合并为单个值</span></span><br><span class="line"><span class="keyword">let</span> sum <span class="operator">=</span> numbers.reduce(<span class="number">0</span>, <span class="operator">+</span>) <span class="comment">// 15</span></span><br><span class="line"><span class="keyword">let</span> product <span class="operator">=</span> numbers.reduce(<span class="number">1</span>, <span class="operator">*</span>) <span class="comment">// 120</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 扁平映射：将嵌套数组转换为一维数组</span></span><br><span class="line"><span class="keyword">let</span> nestedArray <span class="operator">=</span> [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]]</span><br><span class="line"><span class="keyword">let</span> flattenedArray <span class="operator">=</span> nestedArray.flatMap &#123; <span class="variable">$0</span> &#125; <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure>

<h4 id="集合的高级运算"><a href="#集合的高级运算" class="headerlink" title="集合的高级运算"></a>集合的高级运算</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> setA: <span class="type">Set</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> setB: <span class="type">Set</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查子集和超集</span></span><br><span class="line"><span class="keyword">let</span> isSubset <span class="operator">=</span> setA.isSubset(of: setB) <span class="comment">// false</span></span><br><span class="line"><span class="keyword">let</span> isSuperset <span class="operator">=</span> setA.isSuperset(of: setB) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查交集是否为空</span></span><br><span class="line"><span class="keyword">let</span> isDisjoint <span class="operator">=</span> setA.isDisjoint(with: setB) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 集合转换</span></span><br><span class="line"><span class="keyword">let</span> sortedArray <span class="operator">=</span> setA.sorted() <span class="comment">// [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="keyword">let</span> arrayToSet <span class="operator">=</span> <span class="type">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>]) <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<h4 id="字典的高级操作"><a href="#字典的高级操作" class="headerlink" title="字典的高级操作"></a>字典的高级操作</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字典转换</span></span><br><span class="line"><span class="keyword">let</span> numbers <span class="operator">=</span> [<span class="number">1</span>: <span class="string">&quot;一&quot;</span>, <span class="number">2</span>: <span class="string">&quot;二&quot;</span>, <span class="number">3</span>: <span class="string">&quot;三&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将字典转换为元组数组</span></span><br><span class="line"><span class="keyword">let</span> keyValuePairs <span class="operator">=</span> <span class="type">Array</span>(numbers) <span class="comment">// [(1, &quot;一&quot;), (2, &quot;二&quot;), (3, &quot;三&quot;)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据键排序</span></span><br><span class="line"><span class="keyword">let</span> sortedByKey <span class="operator">=</span> numbers.sorted &#123; <span class="variable">$0</span>.key <span class="operator">&lt;</span> <span class="variable">$1</span>.key &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据值排序</span></span><br><span class="line"><span class="keyword">let</span> sortedByValue <span class="operator">=</span> numbers.sorted &#123; <span class="variable">$0</span>.value <span class="operator">&lt;</span> <span class="variable">$1</span>.value &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤字典</span></span><br><span class="line"><span class="keyword">let</span> filteredDictionary <span class="operator">=</span> numbers.filter &#123; <span class="variable">$0</span>.key <span class="operator">&gt;</span> <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-高级类型转换"><a href="#4-高级类型转换" class="headerlink" title="4. 高级类型转换"></a>4. 高级类型转换</h3><h4 id="自定义类型转换"><a href="#自定义类型转换" class="headerlink" title="自定义类型转换"></a>自定义类型转换</h4><p>为自定义类型实现<code>ExpressibleBy...</code>协议，支持字面量初始化：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自定义时间间隔类型</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TimeInterval</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> seconds: <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现ExpressibleByFloatLiteral协议</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">TimeInterval</span>: <span class="title class_ inherited__">ExpressibleByFloatLiteral</span> &#123;</span><br><span class="line">    <span class="keyword">init</span>(<span class="params">floatLiteral</span> <span class="params">value</span>: <span class="type">FloatLiteralType</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.seconds <span class="operator">=</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现ExpressibleByIntegerLiteral协议</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">TimeInterval</span>: <span class="title class_ inherited__">ExpressibleByIntegerLiteral</span> &#123;</span><br><span class="line">    <span class="keyword">init</span>(<span class="params">integerLiteral</span> <span class="params">value</span>: <span class="type">IntegerLiteralType</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.seconds <span class="operator">=</span> <span class="type">Double</span>(value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在可以使用字面量初始化</span></span><br><span class="line"><span class="keyword">let</span> interval1: <span class="type">TimeInterval</span> <span class="operator">=</span> <span class="number">10.5</span> <span class="comment">// 10.5秒</span></span><br><span class="line"><span class="keyword">let</span> interval2: <span class="type">TimeInterval</span> <span class="operator">=</span> <span class="number">5</span> <span class="comment">// 5秒</span></span><br></pre></td></tr></table></figure>

<h3 id="5-性能优化策略"><a href="#5-性能优化策略" class="headerlink" title="5. 性能优化策略"></a>5. 性能优化策略</h3><h4 id="集合性能优化"><a href="#集合性能优化" class="headerlink" title="集合性能优化"></a>集合性能优化</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 预分配数组容量</span></span><br><span class="line"><span class="keyword">var</span> numbers: [<span class="type">Int</span>] <span class="operator">=</span> []</span><br><span class="line">numbers.reserveCapacity(<span class="number">1000</span>) <span class="comment">// 预分配1000个元素的空间</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">1000</span> &#123;</span><br><span class="line">    numbers.append(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Set进行快速查找</span></span><br><span class="line"><span class="keyword">let</span> largeArray <span class="operator">=</span> <span class="type">Array</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">10000</span>)</span><br><span class="line"><span class="keyword">let</span> largeSet <span class="operator">=</span> <span class="type">Set</span>(largeArray)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set的contains操作是O(1)，Array是O(n)</span></span><br><span class="line"><span class="keyword">let</span> contains <span class="operator">=</span> largeSet.contains(<span class="number">9999</span>) <span class="comment">// 快速查找</span></span><br></pre></td></tr></table></figure>

<h4 id="字符串性能优化"><a href="#字符串性能优化" class="headerlink" title="字符串性能优化"></a>字符串性能优化</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 大量字符串拼接时使用String.append</span></span><br><span class="line"><span class="keyword">var</span> result <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">result.reserveCapacity(<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">1000</span> &#123;</span><br><span class="line">    result.append(<span class="type">String</span>(i))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 避免不必要的字符串转换</span></span><br><span class="line"><span class="keyword">let</span> number <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> string <span class="operator">=</span> <span class="type">String</span>(number) <span class="comment">// 只转换一次</span></span><br></pre></td></tr></table></figure>

<h3 id="6-最佳实践"><a href="#6-最佳实践" class="headerlink" title="6. 最佳实践"></a>6. 最佳实践</h3><h4 id="数据类型选择"><a href="#数据类型选择" class="headerlink" title="数据类型选择"></a>数据类型选择</h4><ul>
<li>优先使用<code>Int</code>而不是具体的位数类型（如Int32），除非有特定的存储需求</li>
<li>优先使用<code>Double</code>而不是<code>Float</code>，除非有严格的内存限制</li>
<li>选择合适的集合类型：<ul>
<li>需要有序集合时使用<code>Array</code></li>
<li>需要唯一元素时使用<code>Set</code></li>
<li>需要键值对映射时使用<code>Dictionary</code></li>
</ul>
</li>
</ul>
<h4 id="可选类型处理"><a href="#可选类型处理" class="headerlink" title="可选类型处理"></a>可选类型处理</h4><ul>
<li>尽量避免使用<code>!</code>强制解包</li>
<li>使用<code>guard let</code>提前退出，减少嵌套</li>
<li>使用<code>??</code>提供合理的默认值</li>
</ul>
<h4 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h4><ul>
<li>始终使用可选绑定处理类型转换结果</li>
<li>为自定义类型实现适当的转换协议</li>
<li>避免不必要的类型转换</li>
</ul>
<h2 id="八、实践练习"><a href="#八、实践练习" class="headerlink" title="八、实践练习"></a>八、实践练习</h2><h3 id="1-数据类型基础"><a href="#1-数据类型基础" class="headerlink" title="1. 数据类型基础"></a>1. 数据类型基础</h3><p><strong>题目1</strong>：创建一个包含5个不同类型元素的元组，并使用命名和索引两种方式访问元素。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建元组</span></span><br><span class="line"><span class="keyword">let</span> person <span class="operator">=</span> (name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">25</span>, isStudent: <span class="literal">true</span>, height: <span class="number">1.75</span>, weight: <span class="number">65.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用命名访问</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;姓名：<span class="subst">\(person.name)</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;年龄：<span class="subst">\(person.age)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用索引访问</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;身高：<span class="subst">\(person.<span class="number">3</span>)</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;体重：<span class="subst">\(person.<span class="number">4</span>)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>题目2</strong>：创建一个包含10个整数的数组，然后：</p>
<ul>
<li>添加一个元素到末尾</li>
<li>移除第一个元素</li>
<li>计算数组所有元素的和</li>
</ul>
<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建数组</span></span><br><span class="line"><span class="keyword">var</span> numbers <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加元素到末尾</span></span><br><span class="line">numbers.append(<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除第一个元素</span></span><br><span class="line">numbers.removeFirst()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算数组所有元素的和</span></span><br><span class="line"><span class="keyword">let</span> sum <span class="operator">=</span> numbers.reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;数组所有元素的和：<span class="subst">\(sum)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-集合类型应用"><a href="#2-集合类型应用" class="headerlink" title="2. 集合类型应用"></a>2. 集合类型应用</h3><p><strong>题目3</strong>：创建两个字符串数组，使用Set找出它们的交集和并集。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建数组</span></span><br><span class="line"><span class="keyword">let</span> array1 <span class="operator">=</span> [<span class="string">&quot;苹果&quot;</span>, <span class="string">&quot;香蕉&quot;</span>, <span class="string">&quot;橙子&quot;</span>, <span class="string">&quot;葡萄&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> array2 <span class="operator">=</span> [<span class="string">&quot;橙子&quot;</span>, <span class="string">&quot;葡萄&quot;</span>, <span class="string">&quot;西瓜&quot;</span>, <span class="string">&quot;草莓&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换为Set</span></span><br><span class="line"><span class="keyword">let</span> set1 <span class="operator">=</span> <span class="type">Set</span>(array1)</span><br><span class="line"><span class="keyword">let</span> set2 <span class="operator">=</span> <span class="type">Set</span>(array2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找出交集</span></span><br><span class="line"><span class="keyword">let</span> intersection <span class="operator">=</span> set1.intersection(set2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;交集：<span class="subst">\(intersection)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找出并集</span></span><br><span class="line"><span class="keyword">let</span> union <span class="operator">=</span> set1.union(set2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;并集：<span class="subst">\(union)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>题目4</strong>：创建一个字典，键为字符串（表示姓名），值为整数（表示年龄）。然后：</p>
<ul>
<li>添加一个新的键值对</li>
<li>修改一个现有键的值</li>
<li>检查是否包含某个键</li>
</ul>
<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建字典</span></span><br><span class="line"><span class="keyword">var</span> ages <span class="operator">=</span> [<span class="string">&quot;张三&quot;</span>: <span class="number">25</span>, <span class="string">&quot;李四&quot;</span>: <span class="number">30</span>, <span class="string">&quot;王五&quot;</span>: <span class="number">35</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加新的键值对</span></span><br><span class="line">ages[<span class="string">&quot;赵六&quot;</span>] <span class="operator">=</span> <span class="number">40</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改现有键的值</span></span><br><span class="line">ages[<span class="string">&quot;李四&quot;</span>] <span class="operator">=</span> <span class="number">31</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查是否包含某个键</span></span><br><span class="line"><span class="keyword">if</span> ages.contains(where: &#123; <span class="variable">$0</span>.key <span class="operator">==</span> <span class="string">&quot;王五&quot;</span> &#125;) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;字典包含&#x27;王五&#x27;&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;字典不包含&#x27;王五&#x27;&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-运算符与类型转换"><a href="#3-运算符与类型转换" class="headerlink" title="3. 运算符与类型转换"></a>3. 运算符与类型转换</h3><p><strong>题目5</strong>：实现一个自定义的时间间隔结构<code>TimeInterval</code>，支持通过整数和浮点数字面量初始化。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自定义时间间隔类型</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TimeInterval</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> seconds: <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现ExpressibleByFloatLiteral协议</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">TimeInterval</span>: <span class="title class_ inherited__">ExpressibleByFloatLiteral</span> &#123;</span><br><span class="line">    <span class="keyword">init</span>(<span class="params">floatLiteral</span> <span class="params">value</span>: <span class="type">FloatLiteralType</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.seconds <span class="operator">=</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现ExpressibleByIntegerLiteral协议</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">TimeInterval</span>: <span class="title class_ inherited__">ExpressibleByIntegerLiteral</span> &#123;</span><br><span class="line">    <span class="keyword">init</span>(<span class="params">integerLiteral</span> <span class="params">value</span>: <span class="type">IntegerLiteralType</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.seconds <span class="operator">=</span> <span class="type">Double</span>(value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用字面量初始化</span></span><br><span class="line"><span class="keyword">let</span> interval1: <span class="type">TimeInterval</span> <span class="operator">=</span> <span class="number">10.5</span> <span class="comment">// 10.5秒</span></span><br><span class="line"><span class="keyword">let</span> interval2: <span class="type">TimeInterval</span> <span class="operator">=</span> <span class="number">5</span> <span class="comment">// 5秒</span></span><br></pre></td></tr></table></figure>

<p><strong>题目6</strong>：将字符串”123.45”转换为Double类型，然后将结果转换为Int类型。</p>
<p><strong>答案</strong>：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字符串转Double</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> doubleValue <span class="operator">=</span> <span class="type">Double</span>(<span class="string">&quot;123.45&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Double值：<span class="subst">\(doubleValue)</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Double转Int</span></span><br><span class="line">    <span class="keyword">let</span> intValue <span class="operator">=</span> <span class="type">Int</span>(doubleValue)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Int值：<span class="subst">\(intValue)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;转换失败&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="九、总结"><a href="#九、总结" class="headerlink" title="九、总结"></a>九、总结</h2><p>在这篇学习日记中，我们深入探讨了Swift的数据类型和运算符：</p>
<ol>
<li><strong>数据类型</strong>：包括数值类型、布尔类型、字符串类型、集合类型（数组、集合、字典）、元组类型和可选类型</li>
<li><strong>运算符</strong>：包括算术运算符、比较运算符、逻辑运算符、位运算符和范围运算符</li>
<li><strong>类型转换</strong>：不同数值类型之间的转换以及字符串与数值之间的转换</li>
<li><strong>高级用法</strong>：包括自定义运算符、高级集合操作、性能优化策略等</li>
</ol>
<p>理解这些基础概念对于Swift编程至关重要，它们是构建更复杂功能的基础。在下一篇学习日记中，我们将继续学习Swift的控制流语句，包括条件语句和循环语句的高级用法。</p>
]]></content>
      <tags>
        <tag>swift</tag>
      </tags>
  </entry>
  <entry>
    <title>swift学习日记(六)</title>
    <url>/ios.github.io/2025/12/08/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Swift学习日记（六）：枚举与协议"><a href="#Swift学习日记（六）：枚举与协议" class="headerlink" title="Swift学习日记（六）：枚举与协议"></a>Swift学习日记（六）：枚举与协议</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>在上一篇学习日记中，我们已经了解了Swift的类和结构体，这是面向对象编程的基础。在这篇日记中，我们将继续探讨Swift的两个重要特性：枚举和协议。枚举用于定义一组相关的值，协议用于定义方法、属性和其他要求的蓝图，它们都是Swift面向对象编程的重要组成部分。</p>
<h2 id="二、枚举的定义与使用"><a href="#二、枚举的定义与使用" class="headerlink" title="二、枚举的定义与使用"></a>二、枚举的定义与使用</h2><p>枚举（Enumeration）是一种数据类型，用于定义一组相关的值。Swift的枚举比其他语言的枚举更加强大，可以包含关联值、原始值和方法。</p>
<h3 id="1-基本枚举定义"><a href="#1-基本枚举定义" class="headerlink" title="1. 基本枚举定义"></a>1. 基本枚举定义</h3><p>枚举的定义使用<code>enum</code>关键字：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> north</span><br><span class="line">    <span class="keyword">case</span> south</span><br><span class="line">    <span class="keyword">case</span> east</span><br><span class="line">    <span class="keyword">case</span> west</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建枚举实例</span></span><br><span class="line"><span class="keyword">var</span> direction <span class="operator">=</span> <span class="type">Direction</span>.north</span><br><span class="line"></span><br><span class="line"><span class="comment">// 由于Swift的类型推断，可以省略枚举名称</span></span><br><span class="line">direction <span class="operator">=</span> .south</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用switch语句匹配枚举值</span></span><br><span class="line"><span class="keyword">switch</span> direction &#123;</span><br><span class="line"><span class="keyword">case</span> .north:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向北&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .south:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向南&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .east:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向东&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .west:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;向西&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以在一行中定义多个枚举成员：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> north, south, east, west</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-关联值"><a href="#2-关联值" class="headerlink" title="2. 关联值"></a>2. 关联值</h3><p>Swift的枚举可以为成员添加关联值，关联值可以是不同类型的：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个包含关联值的枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Barcode</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> upc(<span class="type">Int</span>, <span class="type">Int</span>, <span class="type">Int</span>, <span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> qrCode(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建包含关联值的枚举实例</span></span><br><span class="line"><span class="keyword">var</span> productBarcode <span class="operator">=</span> <span class="type">Barcode</span>.upc(<span class="number">8</span>, <span class="number">85909</span>, <span class="number">51226</span>, <span class="number">3</span>)</span><br><span class="line">productBarcode <span class="operator">=</span> .qrCode(<span class="string">&quot;ABCDEFGHIJKLMNOP&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配关联值</span></span><br><span class="line"><span class="keyword">switch</span> productBarcode &#123;</span><br><span class="line"><span class="keyword">case</span> .upc(<span class="keyword">let</span> numberSystem, <span class="keyword">let</span> manufacturer, <span class="keyword">let</span> product, <span class="keyword">let</span> check):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;UPC: <span class="subst">\(numberSystem)</span>-<span class="subst">\(manufacturer)</span>-<span class="subst">\(product)</span>-<span class="subst">\(check)</span>&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .qrCode(<span class="keyword">let</span> productCode):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;QR Code: <span class="subst">\(productCode)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：QR Code: ABCDEFGHIJKLMNOP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果所有关联值都需要被提取，可以将let或var放在case前面</span></span><br><span class="line"><span class="keyword">switch</span> productBarcode &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .upc(numberSystem, manufacturer, product, check):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;UPC: <span class="subst">\(numberSystem)</span>-<span class="subst">\(manufacturer)</span>-<span class="subst">\(product)</span>-<span class="subst">\(check)</span>&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .qrCode(productCode):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;QR Code: <span class="subst">\(productCode)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：QR Code: ABCDEFGHIJKLMNOP</span></span><br></pre></td></tr></table></figure>

<h3 id="3-原始值"><a href="#3-原始值" class="headerlink" title="3. 原始值"></a>3. 原始值</h3><p>枚举成员可以设置原始值，原始值的类型必须相同：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个包含原始值的枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Planet</span>: <span class="title class_ inherited__">Int</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> mercury <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> venus</span><br><span class="line">    <span class="keyword">case</span> earth</span><br><span class="line">    <span class="keyword">case</span> mars</span><br><span class="line">    <span class="keyword">case</span> jupiter</span><br><span class="line">    <span class="keyword">case</span> saturn</span><br><span class="line">    <span class="keyword">case</span> uranus</span><br><span class="line">    <span class="keyword">case</span> neptune</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问枚举成员的原始值</span></span><br><span class="line"><span class="keyword">let</span> earthsOrder <span class="operator">=</span> <span class="type">Planet</span>.earth.rawValue <span class="comment">// 输出：3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用原始值初始化枚举实例</span></span><br><span class="line"><span class="keyword">let</span> possiblePlanet <span class="operator">=</span> <span class="type">Planet</span>(rawValue: <span class="number">7</span>) <span class="comment">// 返回Planet.uranus</span></span><br><span class="line"><span class="keyword">let</span> impossiblePlanet <span class="operator">=</span> <span class="type">Planet</span>(rawValue: <span class="number">10</span>) <span class="comment">// 返回nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串原始值</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">CompassPoint</span>: <span class="title class_ inherited__">String</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> north <span class="operator">=</span> <span class="string">&quot;North&quot;</span></span><br><span class="line">    <span class="keyword">case</span> south <span class="operator">=</span> <span class="string">&quot;South&quot;</span></span><br><span class="line">    <span class="keyword">case</span> east <span class="operator">=</span> <span class="string">&quot;East&quot;</span></span><br><span class="line">    <span class="keyword">case</span> west <span class="operator">=</span> <span class="string">&quot;West&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> northDirection <span class="operator">=</span> <span class="type">CompassPoint</span>.north.rawValue <span class="comment">// 输出：&quot;North&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-递归枚举"><a href="#4-递归枚举" class="headerlink" title="4. 递归枚举"></a>4. 递归枚举</h3><p>递归枚举是指枚举成员可以关联一个包含该枚举类型的值，使用<code>indirect</code>关键字定义：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个递归枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ArithmeticExpression</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> number(<span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">indirect</span> <span class="keyword">case</span> addition(<span class="type">ArithmeticExpression</span>, <span class="type">ArithmeticExpression</span>)</span><br><span class="line">    <span class="keyword">indirect</span> <span class="keyword">case</span> multiplication(<span class="type">ArithmeticExpression</span>, <span class="type">ArithmeticExpression</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以将indirect放在枚举定义前面</span></span><br><span class="line">def <span class="keyword">indirect</span> <span class="keyword">enum</span> <span class="title class_">ArithmeticExpression</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> number(<span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> addition(<span class="type">ArithmeticExpression</span>, <span class="type">ArithmeticExpression</span>)</span><br><span class="line">    <span class="keyword">case</span> multiplication(<span class="type">ArithmeticExpression</span>, <span class="type">ArithmeticExpression</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建递归枚举实例</span></span><br><span class="line"><span class="keyword">let</span> five <span class="operator">=</span> <span class="type">ArithmeticExpression</span>.number(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">let</span> four <span class="operator">=</span> <span class="type">ArithmeticExpression</span>.number(<span class="number">4</span>)</span><br><span class="line"><span class="keyword">let</span> sum <span class="operator">=</span> <span class="type">ArithmeticExpression</span>.addition(five, four)</span><br><span class="line"><span class="keyword">let</span> product <span class="operator">=</span> <span class="type">ArithmeticExpression</span>.multiplication(sum, <span class="type">ArithmeticExpression</span>.number(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算表达式的值</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">evaluate</span>(<span class="keyword">_</span> <span class="params">expression</span>: <span class="type">ArithmeticExpression</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> expression &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> .number(value):</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> .addition(left, right):</span><br><span class="line">        <span class="keyword">return</span> evaluate(left) <span class="operator">+</span> evaluate(right)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> .multiplication(left, right):</span><br><span class="line">        <span class="keyword">return</span> evaluate(left) <span class="operator">*</span> evaluate(right)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(evaluate(product)) <span class="comment">// 输出：18</span></span><br></pre></td></tr></table></figure>

<h3 id="5-枚举的方法"><a href="#5-枚举的方法" class="headerlink" title="5. 枚举的方法"></a>5. 枚举的方法</h3><p>Swift的枚举可以包含方法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> north, south, east, west</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">description</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .north:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;北方&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .south:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;南方&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .east:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;东方&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .west:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;西方&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">allDirections</span>() -&gt; [<span class="type">Direction</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [.north, .south, .east, .west]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> direction <span class="operator">=</span> <span class="type">Direction</span>.north</span><br><span class="line"><span class="built_in">print</span>(direction.description()) <span class="comment">// 输出：北方</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> allDirections <span class="operator">=</span> <span class="type">Direction</span>.allDirections()</span><br><span class="line"><span class="keyword">for</span> dir <span class="keyword">in</span> allDirections &#123;</span><br><span class="line">    <span class="built_in">print</span>(dir.description())</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// 北方</span></span><br><span class="line"><span class="comment">// 南方</span></span><br><span class="line"><span class="comment">// 东方</span></span><br><span class="line"><span class="comment">// 西方</span></span><br></pre></td></tr></table></figure>

<h2 id="三、协议的定义与使用"><a href="#三、协议的定义与使用" class="headerlink" title="三、协议的定义与使用"></a>三、协议的定义与使用</h2><p>协议（Protocol）是一种定义方法、属性和其他要求的蓝图，它本身不提供实现，而是由类、结构体或枚举来遵循和实现。</p>
<h3 id="1-基本协议定义"><a href="#1-基本协议定义" class="headerlink" title="1. 基本协议定义"></a>1. 基本协议定义</h3><p>协议的定义使用<code>protocol</code>关键字：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanGreet</span> &#123;</span><br><span class="line">    <span class="comment">// 要求实现一个方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 要求实现一个属性</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类遵循协议</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>: <span class="title class_ inherited__">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实现协议要求的方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(name)</span>。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体遵循协议</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Student</span>: <span class="title class_ inherited__">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实现协议要求的方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是学生<span class="subst">\(name)</span>。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用协议类型</span></span><br><span class="line"><span class="keyword">let</span> person: <span class="type">CanGreet</span> <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> student: <span class="type">CanGreet</span> <span class="operator">=</span> <span class="type">Student</span>(name: <span class="string">&quot;李四&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(person.greet()) <span class="comment">// 输出：你好，我是张三。</span></span><br><span class="line"><span class="built_in">print</span>(student.greet()) <span class="comment">// 输出：你好，我是学生李四。</span></span><br></pre></td></tr></table></figure>

<h3 id="2-协议的属性要求"><a href="#2-协议的属性要求" class="headerlink" title="2. 协议的属性要求"></a>2. 协议的属性要求</h3><p>协议可以要求遵循者实现特定的属性：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">Named</span> &#123;</span><br><span class="line">    <span class="comment">// 只读属性</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读写属性</span></span><br><span class="line">    <span class="keyword">var</span> fullName: <span class="type">String</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span>: <span class="title class_ inherited__">Named</span> &#123;</span><br><span class="line">    <span class="comment">// 存储属性可以同时满足get和set要求</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> fullName: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>: <span class="title class_ inherited__">Named</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> fullName: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>, <span class="params">fullName</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.fullName <span class="operator">=</span> fullName</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-协议的方法要求"><a href="#3-协议的方法要求" class="headerlink" title="3. 协议的方法要求"></a>3. 协议的方法要求</h3><p>协议可以要求遵循者实现特定的方法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">IntStack</span> &#123;</span><br><span class="line">    <span class="comment">// 要求实现一个方法</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">push</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">Int</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 要求实现另一个方法</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">pop</span>() -&gt; <span class="type">Int</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 要求实现一个只读计算属性</span></span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Stack</span>: <span class="title class_ inherited__">IntStack</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> items <span class="operator">=</span> [<span class="type">Int</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">push</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">pop</span>() -&gt; <span class="type">Int</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> items.popLast()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.count</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stack <span class="operator">=</span> <span class="type">Stack</span>()</span><br><span class="line">stack.push(<span class="number">1</span>)</span><br><span class="line">stack.push(<span class="number">2</span>)</span><br><span class="line">stack.push(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(stack.count) <span class="comment">// 输出：3</span></span><br><span class="line"><span class="built_in">print</span>(stack.pop()) <span class="comment">// 输出：Optional(3)</span></span><br><span class="line"><span class="built_in">print</span>(stack.count) <span class="comment">// 输出：2</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：如果协议方法会修改结构体或枚举的实例，需要在协议方法要求前加上<code>mutating</code>关键字。</p>
<h3 id="4-协议继承"><a href="#4-协议继承" class="headerlink" title="4. 协议继承"></a>4. 协议继承</h3><p>协议可以继承一个或多个其他协议：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个基础协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanWalk</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">walk</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义另一个基础协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanTalk</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">talk</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承两个协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanWalkAndTalk</span>: <span class="title class_ inherited__">CanWalk</span>, <span class="title class_ inherited__">CanTalk</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">introduce</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遵循继承的协议</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>: <span class="title class_ inherited__">CanWalkAndTalk</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">walk</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;走路&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">talk</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;说话&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">introduce</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;你好，我是一个人。&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person <span class="operator">=</span> <span class="type">Person</span>()</span><br><span class="line">person.walk()</span><br><span class="line">person.talk()</span><br><span class="line">person.introduce()</span><br></pre></td></tr></table></figure>

<h3 id="5-协议组合"><a href="#5-协议组合" class="headerlink" title="5. 协议组合"></a>5. 协议组合</h3><p>协议组合允许将多个协议组合成一个临时协议，使用<code>&amp;</code>符号：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanEat</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">eat</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanSleep</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">sleep</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>: <span class="title class_ inherited__">CanEat</span>, <span class="title class_ inherited__">CanSleep</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">eat</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;吃饭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">sleep</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;睡觉&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用协议组合</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">performActions</span>(<span class="params">on</span> <span class="params">creature</span>: <span class="type">CanEat</span> &amp; <span class="type">CanSleep</span>) &#123;</span><br><span class="line">    creature.eat()</span><br><span class="line">    creature.sleep()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person <span class="operator">=</span> <span class="type">Person</span>()</span><br><span class="line">performActions(on: person)</span><br></pre></td></tr></table></figure>

<h3 id="6-可选协议要求"><a href="#6-可选协议要求" class="headerlink" title="6. 可选协议要求"></a>6. 可选协议要求</h3><p>可选协议要求允许遵循者选择是否实现特定的方法或属性，使用<code>@objc</code>关键字标记协议，并使用<code>optional</code>关键字标记可选要求：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@objc</span> <span class="keyword">protocol</span> <span class="title class_">OptionalProtocol</span> &#123;</span><br><span class="line">    <span class="comment">// 必需实现的方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">requiredMethod</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可选实现的方法</span></span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">optional</span> <span class="keyword">func</span> <span class="title function_">optionalMethod</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可选实现的属性</span></span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">optional</span> <span class="keyword">var</span> optionalProperty: <span class="type">String</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>: <span class="title class_ inherited__">OptionalProtocol</span> &#123;</span><br><span class="line">    <span class="comment">// 必须实现这个方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">requiredMethod</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;实现了必需方法&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可以选择不实现可选方法和属性</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myClass <span class="operator">=</span> <span class="type">MyClass</span>()</span><br><span class="line">myClass.requiredMethod()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用可选方法前需要检查是否实现</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> optionalMethod <span class="operator">=</span> myClass.optionalMethod &#123;</span><br><span class="line">    optionalMethod()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：可选协议要求只能用于类，不能用于结构体或枚举。</p>
<h3 id="7-协议扩展"><a href="#7-协议扩展" class="headerlink" title="7. 协议扩展"></a>7. 协议扩展</h3><p>协议扩展允许为协议添加默认实现，遵循者可以选择重写或使用默认实现：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展协议，添加默认实现</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(name)</span>。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加新方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greetWithMessage</span>(<span class="keyword">_</span> <span class="params">message</span>: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(message)</span>，我是<span class="subst">\(name)</span>。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span>: <span class="title class_ inherited__">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用默认实现的greet方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>: <span class="title class_ inherited__">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重写默认实现</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是学生<span class="subst">\(name)</span>。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person <span class="operator">=</span> <span class="type">Person</span>(name: <span class="string">&quot;张三&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(person.greet()) <span class="comment">// 输出：你好，我是张三。</span></span><br><span class="line"><span class="built_in">print</span>(person.greetWithMessage(<span class="string">&quot;大家好&quot;</span>)) <span class="comment">// 输出：大家好，我是张三。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> student <span class="operator">=</span> <span class="type">Student</span>(name: <span class="string">&quot;李四&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(student.greet()) <span class="comment">// 输出：你好，我是学生李四。</span></span><br><span class="line"><span class="built_in">print</span>(student.greetWithMessage(<span class="string">&quot;大家好&quot;</span>)) <span class="comment">// 输出：大家好，我是学生李四。</span></span><br></pre></td></tr></table></figure>

<h2 id="四、协议的应用场景"><a href="#四、协议的应用场景" class="headerlink" title="四、协议的应用场景"></a>四、协议的应用场景</h2><p>协议在Swift中有很多应用场景，下面介绍几个常见的应用场景：</p>
<h3 id="1-委托模式"><a href="#1-委托模式" class="headerlink" title="1. 委托模式"></a>1. 委托模式</h3><p>委托模式是一种设计模式，用于将一个类或结构体的责任委托给另一个类或结构体。协议通常用于定义委托的接口：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义委托协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">UserInputDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidInputText</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>)</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidPressButton</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个类，使用委托</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInputView</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> delegate: <span class="type">UserInputDelegate</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">textFieldDidChange</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        delegate<span class="operator">?</span>.userDidInputText(text)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">buttonDidPress</span>() &#123;</span><br><span class="line">        delegate<span class="operator">?</span>.userDidPressButton()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遵循委托协议</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ViewController</span>: <span class="title class_ inherited__">UserInputDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> inputView <span class="operator">=</span> <span class="type">UserInputView</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">// 设置委托</span></span><br><span class="line">        inputView.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实现委托方法</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidInputText</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用户输入了：<span class="subst">\(text)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidPressButton</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用户按下了按钮&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> viewController <span class="operator">=</span> <span class="type">ViewController</span>()</span><br><span class="line">viewController.inputView.textFieldDidChange(<span class="string">&quot;Hello&quot;</span>) <span class="comment">// 输出：用户输入了：Hello</span></span><br><span class="line">viewController.inputView.buttonDidPress() <span class="comment">// 输出：用户按下了按钮</span></span><br></pre></td></tr></table></figure>

<h3 id="2-多态"><a href="#2-多态" class="headerlink" title="2. 多态"></a>2. 多态</h3><p>协议可以用于实现多态，允许不同类型的对象以统一的方式处理：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">area</span>() -&gt; <span class="type">Double</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">perimeter</span>() -&gt; <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span>: <span class="title class_ inherited__">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">area</span>() -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Double</span>.pi <span class="operator">*</span> radius <span class="operator">*</span> radius</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">perimeter</span>() -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> <span class="operator">*</span> <span class="type">Double</span>.pi <span class="operator">*</span> radius</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span>: <span class="title class_ inherited__">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> width: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">area</span>() -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width <span class="operator">*</span> height</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">perimeter</span>() -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> <span class="operator">*</span> (width <span class="operator">+</span> height)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用协议类型的数组</span></span><br><span class="line"><span class="keyword">let</span> shapes: [<span class="type">Shape</span>] <span class="operator">=</span> [</span><br><span class="line">    <span class="type">Circle</span>(radius: <span class="number">5.0</span>),</span><br><span class="line">    <span class="type">Rectangle</span>(width: <span class="number">3.0</span>, height: <span class="number">4.0</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多态调用</span></span><br><span class="line"><span class="keyword">for</span> shape <span class="keyword">in</span> shapes &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;面积：<span class="subst">\(shape.area())</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;周长：<span class="subst">\(shape.perimeter())</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、内容机制与知识点总结"><a href="#五、内容机制与知识点总结" class="headerlink" title="五、内容机制与知识点总结"></a>五、内容机制与知识点总结</h2><h3 id="1-Swift枚举与协议的设计原则"><a href="#1-Swift枚举与协议的设计原则" class="headerlink" title="1. Swift枚举与协议的设计原则"></a>1. Swift枚举与协议的设计原则</h3><p>Swift的枚举与协议体现了几个核心设计原则：</p>
<ul>
<li><strong>类型安全</strong>：通过严格的类型定义确保代码的可靠性</li>
<li><strong>抽象与复用</strong>：协议提供了一种抽象机制，允许不同类型共享相同的接口</li>
<li><strong>灵活性</strong>：枚举支持关联值和原始值，提供了灵活的数据建模方式</li>
<li><strong>组合优于继承</strong>：协议支持多继承和组合，比类的单继承更加灵活</li>
<li><strong>默认实现</strong>：协议扩展允许为协议方法提供默认实现，提高代码复用性</li>
</ul>
<h3 id="2-核心知识点总结"><a href="#2-核心知识点总结" class="headerlink" title="2. 核心知识点总结"></a>2. 核心知识点总结</h3><table>
<thead>
<tr>
<th>概念</th>
<th>描述</th>
<th>主要特性</th>
</tr>
</thead>
<tbody><tr>
<td>枚举基本定义</td>
<td>使用<code>enum</code>关键字定义一组相关的值</td>
<td>支持多种成员值定义方式</td>
</tr>
<tr>
<td>关联值</td>
<td>枚举成员可以关联不同类型的值</td>
<td>允许枚举承载额外信息</td>
</tr>
<tr>
<td>原始值</td>
<td>枚举成员可以有相同类型的默认值</td>
<td>支持自动递增原始值</td>
</tr>
<tr>
<td>递归枚举</td>
<td>枚举成员可以关联包含自身类型的值</td>
<td>使用<code>indirect</code>关键字标记</td>
</tr>
<tr>
<td>枚举方法</td>
<td>枚举可以包含实例方法和类型方法</td>
<td>增强枚举的功能性</td>
</tr>
<tr>
<td>协议基本定义</td>
<td>使用<code>protocol</code>关键字定义接口蓝图</td>
<td>定义方法和属性要求</td>
</tr>
<tr>
<td>协议继承</td>
<td>协议可以继承一个或多个其他协议</td>
<td>支持多继承</td>
</tr>
<tr>
<td>协议组合</td>
<td>将多个协议组合成临时协议</td>
<td>使用<code>&amp;</code>符号组合</td>
</tr>
<tr>
<td>可选协议</td>
<td>允许遵循者选择是否实现某些要求</td>
<td>使用<code>@objc optional</code>标记</td>
</tr>
<tr>
<td>协议扩展</td>
<td>为协议添加默认实现和新方法</td>
<td>提高代码复用性</td>
</tr>
<tr>
<td>委托模式</td>
<td>通过协议将责任委托给其他对象</td>
<td>实现对象间的松耦合通信</td>
</tr>
<tr>
<td>多态</td>
<td>通过协议类型实现多态行为</td>
<td>统一处理不同类型的对象</td>
</tr>
</tbody></table>
<h2 id="六、遇到的问题及解决方案"><a href="#六、遇到的问题及解决方案" class="headerlink" title="六、遇到的问题及解决方案"></a>六、遇到的问题及解决方案</h2><h3 id="1-枚举成员名称与系统类型冲突"><a href="#1-枚举成员名称与系统类型冲突" class="headerlink" title="1. 枚举成员名称与系统类型冲突"></a>1. 枚举成员名称与系统类型冲突</h3><p><strong>问题</strong>：定义枚举成员时，名称与系统类型或函数冲突。</p>
<p><strong>解决方案</strong>：使用前缀或更具体的名称，或者使用命名空间。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 冲突示例</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> success</span><br><span class="line">    <span class="keyword">case</span> failure</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可能与Swift标准库中的Result冲突</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案：使用前缀或更具体的名称</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">OperationResult</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> success</span><br><span class="line">    <span class="keyword">case</span> failure</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或使用命名空间</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Network</span> &#123;</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> success</span><br><span class="line">        <span class="keyword">case</span> failure</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-协议方法未实现导致编译错误"><a href="#2-协议方法未实现导致编译错误" class="headerlink" title="2. 协议方法未实现导致编译错误"></a>2. 协议方法未实现导致编译错误</h3><p><strong>问题</strong>：遵循协议时，忘记实现某些必需的方法或属性。</p>
<p><strong>解决方案</strong>：仔细检查协议要求，确保所有必需的方法和属性都已实现。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">area</span>() -&gt; <span class="type">Double</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">perimeter</span>() -&gt; <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span>: <span class="title class_ inherited__">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 忘记实现perimeter()方法，会导致编译错误</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">area</span>() -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Double</span>.pi <span class="operator">*</span> radius <span class="operator">*</span> radius</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加缺失的实现</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">perimeter</span>() -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> <span class="operator">*</span> <span class="type">Double</span>.pi <span class="operator">*</span> radius</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-协议扩展中的默认实现未被调用"><a href="#3-协议扩展中的默认实现未被调用" class="headerlink" title="3. 协议扩展中的默认实现未被调用"></a>3. 协议扩展中的默认实现未被调用</h3><p><strong>问题</strong>：遵循协议的类型实现了协议方法，但希望在某些情况下调用默认实现。</p>
<p><strong>解决方案</strong>：在类型的实现中显式调用协议的默认实现。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;你好，我是<span class="subst">\(name)</span>。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>: <span class="title class_ inherited__">CanGreet</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">greet</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="comment">// 先调用默认实现</span></span><br><span class="line">        <span class="keyword">let</span> defaultGreeting <span class="operator">=</span> (<span class="keyword">self</span> <span class="keyword">as</span> <span class="type">CanGreet</span>).greet()</span><br><span class="line">        <span class="comment">// 再添加额外逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;学生：<span class="subst">\(defaultGreeting)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-递归枚举导致栈溢出"><a href="#4-递归枚举导致栈溢出" class="headerlink" title="4. 递归枚举导致栈溢出"></a>4. 递归枚举导致栈溢出</h3><p><strong>问题</strong>：复杂的递归枚举表达式可能导致栈溢出。</p>
<p><strong>解决方案</strong>：优化递归算法，或考虑使用迭代方式替代递归。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">ArithmeticExpression</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> number(<span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">indirect</span> <span class="keyword">case</span> addition(<span class="type">ArithmeticExpression</span>, <span class="type">ArithmeticExpression</span>)</span><br><span class="line">    <span class="keyword">indirect</span> <span class="keyword">case</span> multiplication(<span class="type">ArithmeticExpression</span>, <span class="type">ArithmeticExpression</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 优化前可能导致栈溢出</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">evaluate</span>(<span class="keyword">_</span> <span class="params">expression</span>: <span class="type">ArithmeticExpression</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> expression &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> .number(value):</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> .addition(left, right):</span><br><span class="line">        <span class="keyword">return</span> evaluate(left) <span class="operator">+</span> evaluate(right)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> .multiplication(left, right):</span><br><span class="line">        <span class="keyword">return</span> evaluate(left) <span class="operator">*</span> evaluate(right)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 优化后使用迭代方式</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">evaluateIterative</span>(<span class="keyword">_</span> <span class="params">expression</span>: <span class="type">ArithmeticExpression</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> stack <span class="operator">=</span> [expression]</span><br><span class="line">    <span class="keyword">var</span> values <span class="operator">=</span> [<span class="type">Int</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="operator">!</span>stack.isEmpty &#123;</span><br><span class="line">        <span class="keyword">let</span> current <span class="operator">=</span> stack.removeLast()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> current &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .number(value):</span><br><span class="line">            values.append(value)</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .addition(left, right):</span><br><span class="line">            stack.append(current)</span><br><span class="line">            stack.append(right)</span><br><span class="line">            stack.append(left)</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .multiplication(left, right):</span><br><span class="line">            stack.append(current)</span><br><span class="line">            stack.append(right)</span><br><span class="line">            stack.append(left)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理可以计算的表达式</span></span><br><span class="line">        <span class="keyword">if</span> stack.count <span class="operator">&gt;=</span> <span class="number">3</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> third <span class="operator">=</span> stack[stack.count <span class="operator">-</span> <span class="number">3</span>]</span><br><span class="line">            <span class="keyword">let</span> second <span class="operator">=</span> stack[stack.count <span class="operator">-</span> <span class="number">2</span>]</span><br><span class="line">            <span class="keyword">let</span> first <span class="operator">=</span> stack[stack.count <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">case</span> .number <span class="operator">=</span> first, <span class="keyword">case</span> .number <span class="operator">=</span> second &#123;</span><br><span class="line">                <span class="keyword">let</span> a <span class="operator">=</span> values.removeLast()</span><br><span class="line">                <span class="keyword">let</span> b <span class="operator">=</span> values.removeLast()</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">switch</span> third &#123;</span><br><span class="line">                <span class="keyword">case</span> .addition:</span><br><span class="line">                    values.append(a <span class="operator">+</span> b)</span><br><span class="line">                    stack.removeLast(<span class="number">3</span>)</span><br><span class="line">                    stack.append(.number(a <span class="operator">+</span> b))</span><br><span class="line">                <span class="keyword">case</span> .multiplication:</span><br><span class="line">                    values.append(a <span class="operator">*</span> b)</span><br><span class="line">                    stack.removeLast(<span class="number">3</span>)</span><br><span class="line">                    stack.append(.number(a <span class="operator">*</span> b))</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> values.first <span class="operator">??</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-委托循环引用"><a href="#5-委托循环引用" class="headerlink" title="5. 委托循环引用"></a>5. 委托循环引用</h3><p><strong>问题</strong>：委托模式中，委托对象和被委托对象之间可能形成循环引用。</p>
<p><strong>解决方案</strong>：在委托属性上使用<code>weak</code>关键字。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">UserInputDelegate</span>: <span class="title class_ inherited__">AnyObject</span> &#123; <span class="comment">// 限制为类协议</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidInputText</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInputView</span> &#123;</span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">UserInputDelegate</span>? <span class="comment">// 使用weak避免循环引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">textFieldDidChange</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        delegate<span class="operator">?</span>.userDidInputText(text)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ViewController</span>: <span class="title class_ inherited__">UserInputDelegate</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> inputView <span class="operator">=</span> <span class="type">UserInputView</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        inputView.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDidInputText</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用户输入：<span class="subst">\(text)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、高阶用法"><a href="#七、高阶用法" class="headerlink" title="七、高阶用法"></a>七、高阶用法</h2><h3 id="1-高级枚举技巧"><a href="#1-高级枚举技巧" class="headerlink" title="1. 高级枚举技巧"></a>1. 高级枚举技巧</h3><h4 id="1-1-枚举与泛型结合"><a href="#1-1-枚举与泛型结合" class="headerlink" title="1.1 枚举与泛型结合"></a>1.1 枚举与泛型结合</h4><p>将枚举与泛型结合，可以创建更灵活的数据结构。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;<span class="type">T</span>, <span class="type">E</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">case</span> success(<span class="type">T</span>)</span><br><span class="line">    <span class="keyword">case</span> failure(<span class="type">E</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用泛型枚举</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchData</span>() -&gt; <span class="type">Result</span>&lt;<span class="type">String</span>, <span class="type">Error</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟成功获取数据</span></span><br><span class="line">        <span class="keyword">let</span> data <span class="operator">=</span> <span class="string">&quot;成功获取的数据&quot;</span></span><br><span class="line">        <span class="keyword">return</span> .success(data)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .failure(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> fetchData()</span><br><span class="line"><span class="keyword">switch</span> result &#123;</span><br><span class="line"><span class="keyword">case</span> .success(<span class="keyword">let</span> data):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;错误：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-枚举与协议结合"><a href="#1-2-枚举与协议结合" class="headerlink" title="1.2 枚举与协议结合"></a>1.2 枚举与协议结合</h4><p>枚举可以遵循协议，增强其功能。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span>: <span class="title class_ inherited__">CustomStringConvertible</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> north, south, east, west</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .north:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;北&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .south:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;南&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .east:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;东&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .west:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;西&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> direction <span class="operator">=</span> <span class="type">Direction</span>.north</span><br><span class="line"><span class="built_in">print</span>(direction) <span class="comment">// 输出：北</span></span><br></pre></td></tr></table></figure>

<h4 id="1-3-枚举与扩展结合"><a href="#1-3-枚举与扩展结合" class="headerlink" title="1.3 枚举与扩展结合"></a>1.3 枚举与扩展结合</h4><p>使用扩展为枚举添加新功能，保持代码整洁。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Weekday</span>: <span class="title class_ inherited__">Int</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> monday <span class="operator">=</span> <span class="number">1</span>, tuesday, wednesday, thursday, friday, saturday, sunday</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用扩展添加功能</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Weekday</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> isWeekend: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span> <span class="operator">==</span> .saturday <span class="operator">||</span> <span class="keyword">self</span> <span class="operator">==</span> .sunday</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> names <span class="operator">=</span> [<span class="string">&quot;周一&quot;</span>, <span class="string">&quot;周二&quot;</span>, <span class="string">&quot;周三&quot;</span>, <span class="string">&quot;周四&quot;</span>, <span class="string">&quot;周五&quot;</span>, <span class="string">&quot;周六&quot;</span>, <span class="string">&quot;周日&quot;</span>]</span><br><span class="line">        <span class="keyword">return</span> names[rawValue <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">nextDay</span>() -&gt; <span class="type">Weekday</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> nextRawValue <span class="operator">=</span> (rawValue <span class="operator">%</span> <span class="number">7</span>) <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">Weekday</span>(rawValue: nextRawValue)<span class="operator">!</span> <span class="comment">// 安全解包，因为nextRawValue范围是1-7</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> today <span class="operator">=</span> <span class="type">Weekday</span>.monday</span><br><span class="line"><span class="built_in">print</span>(today.isWeekend) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(today.name) <span class="comment">// 周一</span></span><br><span class="line"><span class="built_in">print</span>(today.nextDay().name) <span class="comment">// 周二</span></span><br></pre></td></tr></table></figure>

<h3 id="2-高级协议技巧"><a href="#2-高级协议技巧" class="headerlink" title="2. 高级协议技巧"></a>2. 高级协议技巧</h3><h4 id="2-1-泛型协议"><a href="#2-1-泛型协议" class="headerlink" title="2.1 泛型协议"></a>2.1 泛型协议</h4><p>使用泛型协议定义更通用的接口。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">Container</span>&lt;<span class="type">Element</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Element</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">append</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">Element</span>)</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">remove</span>(<span class="params">at</span> <span class="params">index</span>: <span class="type">Int</span>) -&gt; <span class="type">Element</span>?</span><br><span class="line">    <span class="keyword">subscript</span>(<span class="params">index</span>: <span class="type">Int</span>) -&gt; <span class="type">Element</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Stack</span>&lt;<span class="type">Element</span>&gt;: <span class="title class_ inherited__">Container</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> items <span class="operator">=</span> [<span class="type">Element</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">Int</span> &#123; items.count &#125;</span><br><span class="line">    <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123; items.isEmpty &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">append</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">Element</span>) &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">remove</span>(<span class="params">at</span> <span class="params">index</span>: <span class="type">Int</span>) -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> index <span class="operator">&gt;=</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> index <span class="operator">&lt;</span> items.count <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        <span class="keyword">return</span> items.remove(at: index)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">subscript</span>(<span class="params">index</span>: <span class="type">Int</span>) -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> index <span class="operator">&gt;=</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> index <span class="operator">&lt;</span> items.count <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        <span class="keyword">return</span> items[index]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stack <span class="operator">=</span> <span class="type">Stack</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">stack.append(<span class="number">1</span>)</span><br><span class="line">stack.append(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(stack[<span class="number">0</span>]) <span class="comment">// Optional(1)</span></span><br><span class="line"><span class="built_in">print</span>(stack.remove(at: <span class="number">1</span>)) <span class="comment">// Optional(2)</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-协议的条件扩展"><a href="#2-2-协议的条件扩展" class="headerlink" title="2.2 协议的条件扩展"></a>2.2 协议的条件扩展</h4><p>根据泛型类型的约束为协议添加扩展。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">Container</span> <span class="keyword">where</span> <span class="type">Element</span>: <span class="type">Equatable</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">contains</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">Element</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>count &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>[i] <span class="operator">==</span> item &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> intStack <span class="operator">=</span> <span class="type">Stack</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">intStack.append(<span class="number">1</span>)</span><br><span class="line">intStack.append(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(intStack.contains(<span class="number">1</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">print</span>(intStack.contains(<span class="number">3</span>)) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-协议的关联类型约束"><a href="#2-3-协议的关联类型约束" class="headerlink" title="2.3 协议的关联类型约束"></a>2.3 协议的关联类型约束</h4><p>为协议的关联类型添加约束，增强类型安全性。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">OrderedContainer</span>: <span class="title class_ inherited__">Container</span> <span class="keyword">where</span> <span class="title class_ inherited__">Element</span>: <span class="title class_ inherited__">Comparable</span> &#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">sort</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Stack</span>: <span class="title class_ inherited__">OrderedContainer</span> <span class="keyword">where</span> <span class="title class_ inherited__">Element</span>: <span class="title class_ inherited__">Comparable</span> &#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">sort</span>() &#123;</span><br><span class="line">        items.sort()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> numbers <span class="operator">=</span> <span class="type">Stack</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">numbers.append(<span class="number">3</span>)</span><br><span class="line">numbers.append(<span class="number">1</span>)</span><br><span class="line">numbers.append(<span class="number">2</span>)</span><br><span class="line">numbers.sort()</span><br><span class="line"><span class="built_in">print</span>(numbers[<span class="number">0</span>]) <span class="comment">// Optional(1)</span></span><br><span class="line"><span class="built_in">print</span>(numbers[<span class="number">1</span>]) <span class="comment">// Optional(2)</span></span><br><span class="line"><span class="built_in">print</span>(numbers[<span class="number">2</span>]) <span class="comment">// Optional(3)</span></span><br></pre></td></tr></table></figure>

<h3 id="3-高级委托与多态技巧"><a href="#3-高级委托与多态技巧" class="headerlink" title="3. 高级委托与多态技巧"></a>3. 高级委托与多态技巧</h3><h4 id="3-1-协议组合与类型擦除"><a href="#3-1-协议组合与类型擦除" class="headerlink" title="3.1 协议组合与类型擦除"></a>3.1 协议组合与类型擦除</h4><p>使用协议组合和类型擦除处理复杂的多态场景。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义多个协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanFly</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fly</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanSwim</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">swim</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Duck</span>: <span class="title class_ inherited__">CanFly</span>, <span class="title class_ inherited__">CanSwim</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fly</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;鸭子飞翔&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">swim</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;鸭子游泳&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Penguin</span>: <span class="title class_ inherited__">CanSwim</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">swim</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;企鹅游泳&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用协议组合</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">performActions</span>(<span class="params">on</span> <span class="params">creature</span>: <span class="type">CanFly</span> &amp; <span class="type">CanSwim</span>) &#123;</span><br><span class="line">    creature.fly()</span><br><span class="line">    creature.swim()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用类型擦除</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AnySwimmer</span>: <span class="title class_ inherited__">CanSwim</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> swimImpl: () -&gt; <span class="type">Void</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>&lt;<span class="type">T</span>: <span class="type">CanSwim</span>&gt;(<span class="keyword">_</span> <span class="params">swimmer</span>: <span class="type">T</span>) &#123;</span><br><span class="line">        swimImpl <span class="operator">=</span> swimmer.swim</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">swim</span>() &#123;</span><br><span class="line">        swimImpl()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> duck <span class="operator">=</span> <span class="type">Duck</span>()</span><br><span class="line"><span class="keyword">let</span> penguin <span class="operator">=</span> <span class="type">Penguin</span>()</span><br><span class="line"></span><br><span class="line">performActions(on: duck) <span class="comment">// 输出鸭子飞翔和游泳</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> swimmers: [<span class="type">AnySwimmer</span>] <span class="operator">=</span> [<span class="type">AnySwimmer</span>(duck), <span class="type">AnySwimmer</span>(penguin)]</span><br><span class="line"><span class="keyword">for</span> swimmer <span class="keyword">in</span> swimmers &#123;</span><br><span class="line">    swimmer.swim()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-基于协议的依赖注入"><a href="#3-2-基于协议的依赖注入" class="headerlink" title="3.2 基于协议的依赖注入"></a>3.2 基于协议的依赖注入</h4><p>使用协议实现依赖注入，提高代码的可测试性。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义服务协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">DataServiceProtocol</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fetchData</span>() -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RealDataService</span>: <span class="title class_ inherited__">DataServiceProtocol</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fetchData</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;真实数据&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟实现（用于测试）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MockDataService</span>: <span class="title class_ inherited__">DataServiceProtocol</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fetchData</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;模拟数据&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用依赖注入的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> dataService: <span class="type">DataServiceProtocol</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过构造函数注入依赖</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">dataService</span>: <span class="type">DataServiceProtocol</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dataService <span class="operator">=</span> dataService</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">process</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> data <span class="operator">=</span> dataService.fetchData()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;处理数据：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用真实服务</span></span><br><span class="line"><span class="keyword">let</span> realProcessor <span class="operator">=</span> <span class="type">DataProcessor</span>(dataService: <span class="type">RealDataService</span>())</span><br><span class="line">realProcessor.process() <span class="comment">// 输出：处理数据：真实数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用模拟服务（测试场景）</span></span><br><span class="line"><span class="keyword">let</span> mockProcessor <span class="operator">=</span> <span class="type">DataProcessor</span>(dataService: <span class="type">MockDataService</span>())</span><br><span class="line">mockProcessor.process() <span class="comment">// 输出：处理数据：模拟数据</span></span><br></pre></td></tr></table></figure>

<h3 id="4-性能优化策略"><a href="#4-性能优化策略" class="headerlink" title="4. 性能优化策略"></a>4. 性能优化策略</h3><h4 id="4-1-枚举的内存优化"><a href="#4-1-枚举的内存优化" class="headerlink" title="4.1 枚举的内存优化"></a>4.1 枚举的内存优化</h4><p>Swift的枚举在内存使用上非常高效，关联值的存储经过了优化。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 内存优化示例：使用枚举替代类层次结构</span></span><br><span class="line"><span class="comment">// 传统方式：使用类层次结构</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">area</span>() -&gt; <span class="type">Double</span> &#123; <span class="built_in">fatalError</span>(<span class="string">&quot;未实现&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>: <span class="title class_ inherited__">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> radius: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">radius</span>: <span class="type">Double</span>) &#123; <span class="keyword">self</span>.radius <span class="operator">=</span> radius &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">area</span>() -&gt; <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="type">Double</span>.pi <span class="operator">*</span> radius <span class="operator">*</span> radius &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>: <span class="title class_ inherited__">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> width: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">let</span> height: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">width</span>: <span class="type">Double</span>, <span class="params">height</span>: <span class="type">Double</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.width <span class="operator">=</span> width</span><br><span class="line">        <span class="keyword">self</span>.height <span class="operator">=</span> height</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">area</span>() -&gt; <span class="type">Double</span> &#123; <span class="keyword">return</span> width <span class="operator">*</span> height &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 优化方式：使用枚举</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">OptimizedShape</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> circle(radius: <span class="type">Double</span>)</span><br><span class="line">    <span class="keyword">case</span> rectangle(width: <span class="type">Double</span>, height: <span class="type">Double</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">area</span>() -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .circle(radius):</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Double</span>.pi <span class="operator">*</span> radius <span class="operator">*</span> radius</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .rectangle(width, height):</span><br><span class="line">            <span class="keyword">return</span> width <span class="operator">*</span> height</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举方式通常比类层次结构更节省内存和CPU</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-协议扩展的性能考量"><a href="#4-2-协议扩展的性能考量" class="headerlink" title="4.2 协议扩展的性能考量"></a>4.2 协议扩展的性能考量</h4><p>使用协议扩展提供默认实现可以减少重复代码，但需要注意性能影响。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 性能优化示例：为频繁调用的方法提供高效的默认实现</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">FastProcessing</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">process</span>(<span class="params">data</span>: [<span class="type">Int</span>]) -&gt; <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 高效的默认实现</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">FastProcessing</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">process</span>(<span class="params">data</span>: [<span class="type">Int</span>]) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="comment">// 使用高效的实现</span></span><br><span class="line">        <span class="keyword">return</span> data.reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要时可以提供更优的实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpecialProcessor</span>: <span class="title class_ inherited__">FastProcessing</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">process</span>(<span class="params">data</span>: [<span class="type">Int</span>]) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="comment">// 针对特殊情况的优化实现</span></span><br><span class="line">        <span class="keyword">var</span> sum <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> number <span class="keyword">in</span> data <span class="keyword">where</span> number <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            sum <span class="operator">+=</span> number</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-3-避免过度使用协议"><a href="#4-3-避免过度使用协议" class="headerlink" title="4.3 避免过度使用协议"></a>4.3 避免过度使用协议</h4><p>虽然协议提供了很多好处，但过度使用可能导致性能下降。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 避免不必要的协议抽象</span></span><br><span class="line"><span class="comment">// 不好的示例：为简单功能创建过多协议</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanAdd</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">add</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">CanSubtract</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">subtract</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Calculator</span>: <span class="title class_ inherited__">CanAdd</span>, <span class="title class_ inherited__">CanSubtract</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">add</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; a <span class="operator">+</span> b &#125;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">subtract</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; a <span class="operator">-</span> b &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更好的示例：直接实现功能</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BetterCalculator</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">add</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; a <span class="operator">+</span> b &#125;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">subtract</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">Int</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; a <span class="operator">-</span> b &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-最佳实践指南"><a href="#5-最佳实践指南" class="headerlink" title="5. 最佳实践指南"></a>5. 最佳实践指南</h3><ol>
<li><strong>优先使用枚举而非布尔值</strong>：枚举提供了更清晰的语义和类型安全</li>
<li><strong>合理设计协议接口</strong>：协议接口应该简洁明了，避免过多的要求</li>
<li><strong>使用协议扩展提供默认实现</strong>：减少重复代码，提高一致性</li>
<li><strong>谨慎使用可选协议</strong>：优先考虑使用协议扩展提供默认实现</li>
<li><strong>使用<code>weak</code>引用避免委托循环</strong>：确保对象能够被正确释放</li>
<li><strong>利用泛型协议提高代码复用</strong>：创建通用的、类型安全的接口</li>
<li><strong>使用协议组合替代复杂的继承层次</strong>：实现更灵活的类型系统</li>
<li><strong>为协议添加文档注释</strong>：清晰说明协议的用途和要求</li>
</ol>
<h2 id="七、实践练习"><a href="#七、实践练习" class="headerlink" title="七、实践练习"></a>七、实践练习</h2><h3 id="1-枚举基础练习"><a href="#1-枚举基础练习" class="headerlink" title="1. 枚举基础练习"></a>1. 枚举基础练习</h3><ol>
<li><p><strong>定义一个表示方向的枚举</strong>：</p>
<ul>
<li>创建一个包含东、南、西、北四个方向的枚举</li>
<li>为枚举添加计算属性<code>opposite</code>，返回相反方向</li>
<li>实现一个方法<code>turnRight</code>，返回向右转90度的方向</li>
</ul>
</li>
<li><p><strong>实现一个表示HTTP状态码的枚举</strong>：</p>
<ul>
<li>创建一个包含常见HTTP状态码的枚举（如200, 400, 404, 500等）</li>
<li>为枚举添加原始值类型为Int</li>
<li>为枚举添加计算属性<code>statusMessage</code>，返回对应状态码的描述</li>
<li>添加方法<code>isSuccess</code>，判断是否为成功状态码</li>
</ul>
</li>
</ol>
<h3 id="2-协议基础练习"><a href="#2-协议基础练习" class="headerlink" title="2. 协议基础练习"></a>2. 协议基础练习</h3><ol>
<li><p><strong>实现一个<code>Shape</code>协议</strong>：</p>
<ul>
<li>定义一个包含<code>area</code>和<code>perimeter</code>方法的协议</li>
<li>创建实现该协议的<code>Square</code>、<code>Circle</code>和<code>Triangle</code>结构体</li>
<li>为<code>Square</code>结构体添加扩展，实现一个<code>diagonal</code>方法计算对角线长度</li>
</ul>
</li>
<li><p><strong>实现一个<code>Sortable</code>协议</strong>：</p>
<ul>
<li>定义一个包含<code>sort()</code>方法的协议</li>
<li>为<code>Array</code>类型添加扩展，使其遵循该协议（使用冒泡排序算法）</li>
<li>创建一个函数，接受<code>Sortable</code>类型的参数并调用其<code>sort()</code>方法</li>
</ul>
</li>
</ol>
<h3 id="3-高级应用练习"><a href="#3-高级应用练习" class="headerlink" title="3. 高级应用练习"></a>3. 高级应用练习</h3><ol>
<li><p><strong>实现基于协议的委托模式</strong>：</p>
<ul>
<li>创建一个<code>UserAuthenticationProtocol</code>协议，包含<code>userDidLogin</code>和<code>userDidLogout</code>方法</li>
<li>实现一个<code>AuthenticationManager</code>类，使用委托模式通知登录状态变化</li>
<li>创建一个<code>AppController</code>类作为委托，处理登录状态变化</li>
</ul>
</li>
<li><p><strong>实现泛型协议和条件扩展</strong>：</p>
<ul>
<li>定义一个<code>StorageProtocol</code>泛型协议，包含存储和检索数据的方法</li>
<li>实现一个<code>MemoryStorage</code>结构体，遵循该协议</li>
<li>为协议添加条件扩展，只有当存储的类型是<code>Equatable</code>时，添加<code>contains</code>方法</li>
<li>为协议添加条件扩展，只有当存储的类型是<code>Comparable</code>时，添加<code>sort</code>方法</li>
</ul>
</li>
</ol>
<h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><p>在这篇学习日记中，我们深入探讨了Swift的枚举和协议：</p>
<ol>
<li><p><strong>枚举</strong>：</p>
<ul>
<li>基本枚举定义，使用<code>enum</code>关键字</li>
<li>关联值，为枚举成员添加不同类型的值</li>
<li>原始值，为枚举成员设置相同类型的原始值</li>
<li>递归枚举，枚举成员可以关联包含自身类型的值</li>
<li>枚举方法，枚举可以包含实例方法和类型方法</li>
</ul>
</li>
<li><p><strong>协议</strong>：</p>
<ul>
<li>基本协议定义，使用<code>protocol</code>关键字</li>
<li>协议的属性要求，要求遵循者实现特定的属性</li>
<li>协议的方法要求，要求遵循者实现特定的方法</li>
<li>协议继承，协议可以继承一个或多个其他协议</li>
<li>协议组合，将多个协议组合成一个临时协议</li>
<li>可选协议要求，允许遵循者选择是否实现特定的方法或属性</li>
<li>协议扩展，为协议添加默认实现</li>
</ul>
</li>
<li><p><strong>协议的应用场景</strong>：</p>
<ul>
<li>委托模式，将一个类或结构体的责任委托给另一个类或结构体</li>
<li>多态，允许不同类型的对象以统一的方式处理</li>
</ul>
</li>
</ol>
<p>通过补充的内容机制与知识点总结、遇到的问题及解决方案和高阶用法章节，我们更加全面地理解了Swift枚举和协议的核心概念和高级应用。枚举和协议是Swift面向对象编程的重要组成部分，它们提供了强大的抽象能力和代码复用机制。掌握枚举和协议对于开发高质量的Swift应用程序至关重要。在下一篇学习日记中，我们将继续学习Swift的高级特性，包括扩展和泛型。</p>
]]></content>
      <tags>
        <tag>swift</tag>
      </tags>
  </entry>
  <entry>
    <title>swift学习日记(八)</title>
    <url>/ios.github.io/2025/12/12/swift%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E5%85%AB%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Swift学习日记（八）：错误处理"><a href="#Swift学习日记（八）：错误处理" class="headerlink" title="Swift学习日记（八）：错误处理"></a>Swift学习日记（八）：错误处理</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><p>在上一篇学习日记中，我们学习了Swift的扩展和泛型，它们是编写灵活、可重用代码的重要工具。在这篇日记中，我们将探讨Swift的错误处理机制。错误处理是编程中不可或缺的一部分，它允许我们在程序运行时处理可能出现的错误情况，使代码更加健壮和可靠。</p>
<!-- CATEGORY: 错误处理 -->
<!-- INTERVIEW_TOPIC: 错误处理基础 -->
<!-- HIGH_FREQUENCY_INTERVIEW: 错误处理概念 -->

<h2 id="二、错误处理的基本概念"><a href="#二、错误处理的基本概念" class="headerlink" title="二、错误处理的基本概念"></a>二、错误处理的基本概念</h2><p>在Swift中，错误是指在程序运行时可能出现的异常情况，例如文件不存在、网络连接失败、数据格式错误等。Swift的错误处理机制允许我们：</p>
<ol>
<li><strong>表示错误</strong>：使用枚举等类型来表示不同类型的错误</li>
<li><strong>抛出错误</strong>：当遇到错误情况时，将错误抛出</li>
<li><strong>捕获错误</strong>：在适当的地方捕获并处理错误</li>
<li><strong>传播错误</strong>：将错误从一个函数传递到另一个函数</li>
<li><strong>恢复错误</strong>：在处理错误后，尝试恢复程序的正常执行</li>
</ol>
<!-- INTERVIEW_TOPIC: 错误表示 -->
<!-- HIGH_FREQUENCY_INTERVIEW: Error协议 -->

<h2 id="三、表示错误"><a href="#三、表示错误" class="headerlink" title="三、表示错误"></a>三、表示错误</h2><p>在Swift中，我们可以使用遵循<code>Error</code>协议的类型来表示错误。<code>Error</code>协议是空协议，它只是作为错误类型的标记。通常，我们使用枚举来表示错误，因为枚举可以关联相关的值，使错误信息更加丰富。</p>
<h3 id="1-使用枚举表示错误"><a href="#1-使用枚举表示错误" class="headerlink" title="1. 使用枚举表示错误"></a>1. 使用枚举表示错误</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个枚举，表示网络请求错误</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">NetworkError</span>: <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> invalidURL <span class="comment">// 无效的URL</span></span><br><span class="line">    <span class="keyword">case</span> requestFailed(statusCode: <span class="type">Int</span>) <span class="comment">// 请求失败，关联状态码</span></span><br><span class="line">    <span class="keyword">case</span> timeout <span class="comment">// 请求超时</span></span><br><span class="line">    <span class="keyword">case</span> unknown <span class="comment">// 未知错误</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义另一个枚举，表示文件操作错误</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">FileError</span>: <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> fileNotFound(path: <span class="type">String</span>) <span class="comment">// 文件不存在，关联文件路径</span></span><br><span class="line">    <span class="keyword">case</span> permissionDenied(path: <span class="type">String</span>) <span class="comment">// 权限拒绝，关联文件路径</span></span><br><span class="line">    <span class="keyword">case</span> fileIsDirectory(path: <span class="type">String</span>) <span class="comment">// 文件是目录，关联文件路径</span></span><br><span class="line">    <span class="keyword">case</span> writeFailed(reason: <span class="type">String</span>) <span class="comment">// 写入失败，关联失败原因</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-使用结构体表示错误"><a href="#2-使用结构体表示错误" class="headerlink" title="2. 使用结构体表示错误"></a>2. 使用结构体表示错误</h3><p>我们也可以使用结构体来表示错误：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个结构体，表示数据验证错误</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ValidationError</span>: <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> field: <span class="type">String</span> <span class="comment">// 验证失败的字段</span></span><br><span class="line">    <span class="keyword">let</span> message: <span class="type">String</span> <span class="comment">// 错误信息</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">field</span>: <span class="type">String</span>, <span class="params">message</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.field <span class="operator">=</span> field</span><br><span class="line">        <span class="keyword">self</span>.message <span class="operator">=</span> message</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<!-- INTERVIEW_TOPIC: 错误抛出与捕获 -->
<!-- HIGH_FREQUENCY_INTERVIEW: do-catch语句 -->

<h2 id="四、抛出错误"><a href="#四、抛出错误" class="headerlink" title="四、抛出错误"></a>四、抛出错误</h2><p>在Swift中，我们使用<code>throw</code>关键字来抛出错误。只有在标记为<code>throws</code>的函数、方法或初始化器中才能抛出错误。</p>
<h3 id="1-抛出错误的函数"><a href="#1-抛出错误的函数" class="headerlink" title="1. 抛出错误的函数"></a>1. 抛出错误的函数</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个可能抛出错误的函数</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchData</span>(<span class="params">from</span> <span class="params">urlString</span>: <span class="type">String</span>) <span class="keyword">throws</span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">    <span class="comment">// 检查URL是否有效</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: urlString) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">NetworkError</span>.invalidURL</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 尝试发送请求（这里只是模拟，实际中应该使用URLSession）</span></span><br><span class="line">    <span class="keyword">let</span> statusCode <span class="operator">=</span> <span class="number">404</span> <span class="comment">// 模拟请求失败，状态码为404</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">guard</span> statusCode <span class="operator">==</span> <span class="number">200</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">NetworkError</span>.requestFailed(statusCode: statusCode)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果请求成功，返回数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">Data</span>() <span class="comment">// 模拟返回空数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-抛出错误的方法"><a href="#2-抛出错误的方法" class="headerlink" title="2. 抛出错误的方法"></a>2. 抛出错误的方法</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个类，包含可能抛出错误的方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileManager</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">writeFile</span>(<span class="params">data</span>: <span class="type">Data</span>, <span class="params">to</span> <span class="params">path</span>: <span class="type">String</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="comment">// 检查文件是否存在</span></span><br><span class="line">        <span class="keyword">let</span> fileExists <span class="operator">=</span> <span class="literal">false</span> <span class="comment">// 模拟文件不存在</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">guard</span> fileExists <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">FileError</span>.fileNotFound(path: path)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查是否有写入权限</span></span><br><span class="line">        <span class="keyword">let</span> hasPermission <span class="operator">=</span> <span class="literal">false</span> <span class="comment">// 模拟没有写入权限</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">guard</span> hasPermission <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">FileError</span>.permissionDenied(path: path)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 尝试写入文件（这里只是模拟）</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;文件写入成功&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-抛出错误的初始化器"><a href="#3-抛出错误的初始化器" class="headerlink" title="3. 抛出错误的初始化器"></a>3. 抛出错误的初始化器</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个结构体，包含可能抛出错误的初始化器</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> email: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> password: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可能抛出错误的初始化器</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">email</span>: <span class="type">String</span>, <span class="params">password</span>: <span class="type">String</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="comment">// 验证邮箱格式</span></span><br><span class="line">        <span class="keyword">let</span> emailRegex <span class="operator">=</span> <span class="string">&quot;[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+<span class="subst">\\</span>.[A-Za-z]&#123;2,64&#125;&quot;</span></span><br><span class="line">        <span class="keyword">let</span> emailPredicate <span class="operator">=</span> <span class="type">NSPredicate</span>(format:<span class="string">&quot;SELF MATCHES %@&quot;</span>, emailRegex)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">guard</span> emailPredicate.evaluate(with: email) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">ValidationError</span>(field: <span class="string">&quot;email&quot;</span>, message: <span class="string">&quot;无效的邮箱格式&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证密码长度</span></span><br><span class="line">        <span class="keyword">guard</span> password.count <span class="operator">&gt;=</span> <span class="number">6</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">ValidationError</span>(field: <span class="string">&quot;password&quot;</span>, message: <span class="string">&quot;密码长度不能少于6个字符&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.email <span class="operator">=</span> email</span><br><span class="line">        <span class="keyword">self</span>.password <span class="operator">=</span> password</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、捕获错误"><a href="#五、捕获错误" class="headerlink" title="五、捕获错误"></a>五、捕获错误</h2><p>在Swift中，我们使用<code>do-catch</code>语句来捕获和处理错误。<code>do</code>块中包含可能抛出错误的代码，<code>catch</code>块中包含处理错误的代码。</p>
<h3 id="1-基本的do-catch语句"><a href="#1-基本的do-catch语句" class="headerlink" title="1. 基本的do-catch语句"></a>1. 基本的do-catch语句</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 尝试调用可能抛出错误的函数</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> fetchData(from: <span class="string">&quot;https://example.com/data.json&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求成功，获取到数据：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-捕获特定类型的错误"><a href="#2-捕获特定类型的错误" class="headerlink" title="2. 捕获特定类型的错误"></a>2. 捕获特定类型的错误</h3><p>我们可以使用<code>catch</code>块来捕获特定类型的错误：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> fetchData(from: <span class="string">&quot;https://example.com/data.json&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求成功，获取到数据：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">NetworkError</span>.invalidURL &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;无效的URL&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">NetworkError</span>.requestFailed(<span class="keyword">let</span> statusCode) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求失败，状态码：<span class="subst">\(statusCode)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">NetworkError</span>.timeout &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求超时&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他错误：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-捕获所有错误"><a href="#3-捕获所有错误" class="headerlink" title="3. 捕获所有错误"></a>3. 捕获所有错误</h3><p>我们可以使用<code>catch</code>块捕获所有错误，并将错误绑定到一个变量：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> user <span class="operator">=</span> <span class="keyword">try</span> <span class="type">User</span>(email: <span class="string">&quot;invalid-email&quot;</span>, password: <span class="string">&quot;123&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;用户创建成功：<span class="subst">\(user)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">ValidationError</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;验证失败：<span class="subst">\(error.field)</span> - <span class="subst">\(error.message)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="keyword">let</span> error &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他错误：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、传播错误"><a href="#六、传播错误" class="headerlink" title="六、传播错误"></a>六、传播错误</h2><p>在Swift中，我们可以将错误从一个函数传播到另一个函数，这意味着如果一个函数调用了可能抛出错误的函数，那么它也可以将错误抛出，让调用者来处理。</p>
<h3 id="1-传播错误的函数"><a href="#1-传播错误的函数" class="headerlink" title="1. 传播错误的函数"></a>1. 传播错误的函数</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个函数，它调用了可能抛出错误的函数，并将错误传播出去</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">processData</span>(<span class="params">from</span> <span class="params">urlString</span>: <span class="type">String</span>) <span class="keyword">throws</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// 调用fetchData函数，将错误传播出去</span></span><br><span class="line">    <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> fetchData(from: urlString)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理数据（这里只是模拟）</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> result <span class="operator">=</span> <span class="type">String</span>(data: data, encoding: .utf8) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">ValidationError</span>(field: <span class="string">&quot;data&quot;</span>, message: <span class="string">&quot;数据格式错误&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-传播错误的方法"><a href="#2-传播错误的方法" class="headerlink" title="2. 传播错误的方法"></a>2. 传播错误的方法</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个类，包含传播错误的方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">loadData</span>(<span class="params">from</span> <span class="params">urlString</span>: <span class="type">String</span>) <span class="keyword">throws</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="comment">// 调用processData函数，将错误传播出去</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> processData(from: urlString)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、错误处理的高级用法"><a href="#七、错误处理的高级用法" class="headerlink" title="七、错误处理的高级用法"></a>七、错误处理的高级用法</h2><h3 id="1-try-和try"><a href="#1-try-和try" class="headerlink" title="1. try?和try!"></a>1. try?和try!</h3><p>除了使用<code>do-catch</code>语句捕获错误外，Swift还提供了两种简化的错误处理方式：<code>try?</code>和<code>try!</code>。</p>
<h4 id="try"><a href="#try" class="headerlink" title="try?"></a>try?</h4><p><code>try?</code>将错误转换为可选值，如果函数抛出错误，则返回<code>nil</code>，否则返回函数的返回值。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用try?将错误转换为可选值</span></span><br><span class="line"><span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try?</span> fetchData(from: <span class="string">&quot;https://example.com/data.json&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> data <span class="operator">=</span> data &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求成功，获取到数据：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求失败&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="try-1"><a href="#try-1" class="headerlink" title="try!"></a>try!</h4><p><code>try!</code>用于确保函数不会抛出错误，如果函数抛出错误，则会导致运行时崩溃。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用try!确保函数不会抛出错误（谨慎使用）</span></span><br><span class="line"><span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try!</span> fetchData(from: <span class="string">&quot;https://example.com/data.json&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;请求成功，获取到数据：<span class="subst">\(data)</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：<code>try!</code>应该谨慎使用，只有在确定函数不会抛出错误的情况下才使用。</p>
<h3 id="2-defer语句"><a href="#2-defer语句" class="headerlink" title="2. defer语句"></a>2. defer语句</h3><p><code>defer</code>语句用于延迟执行代码，无论函数是否抛出错误，<code>defer</code>语句中的代码都会在函数返回前执行。<code>defer</code>语句通常用于资源清理，例如关闭文件、释放内存等。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">processFile</span>(<span class="params">at</span> <span class="params">path</span>: <span class="type">String</span>) <span class="keyword">throws</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="comment">// 打开文件（这里只是模拟）</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;打开文件：<span class="subst">\(path)</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用defer语句延迟关闭文件</span></span><br><span class="line">    <span class="keyword">defer</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;关闭文件：<span class="subst">\(path)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 尝试读取文件内容</span></span><br><span class="line">    <span class="keyword">let</span> fileExists <span class="operator">=</span> <span class="literal">false</span> <span class="comment">// 模拟文件不存在</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">guard</span> fileExists <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">FileError</span>.fileNotFound(path: path)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读取文件内容（这里只是模拟）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;文件内容&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> content <span class="operator">=</span> <span class="keyword">try</span> processFile(at: <span class="string">&quot;/path/to/file.txt&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;文件内容：<span class="subst">\(content)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;处理文件失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// 打开文件：/path/to/file.txt</span></span><br><span class="line"><span class="comment">// 关闭文件：/path/to/file.txt</span></span><br><span class="line"><span class="comment">// 处理文件失败：fileNotFound(&quot;/path/to/file.txt&quot;)</span></span><br></pre></td></tr></table></figure>

<h3 id="3-重新抛出错误"><a href="#3-重新抛出错误" class="headerlink" title="3. 重新抛出错误"></a>3. 重新抛出错误</h3><p>如果一个函数接受一个可能抛出错误的闭包，那么它可以使用<code>rethrows</code>关键字来重新抛出闭包中的错误。<code>rethrows</code>关键字表示该函数只有在闭包抛出错误时才会抛出错误。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个函数，它接受一个可能抛出错误的闭包，并重新抛出错误</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">processItems</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">_</span> <span class="params">items</span>: [<span class="type">T</span>], <span class="params">using</span> <span class="params">closure</span>: (<span class="type">T</span>) <span class="keyword">throws</span> -&gt; <span class="type">Void</span>) <span class="keyword">rethrows</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items &#123;</span><br><span class="line">        <span class="keyword">try</span> closure(item)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个可能抛出错误的闭包</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">validateItem</span>(<span class="keyword">_</span> <span class="params">item</span>: <span class="type">Int</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> item <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">ValidationError</span>(field: <span class="string">&quot;item&quot;</span>, message: <span class="string">&quot;项目必须大于0&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> items <span class="operator">=</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    <span class="keyword">try</span> processItems(items, using: validateItem)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;所有项目验证通过&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;验证失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-自定义错误处理"><a href="#4-自定义错误处理" class="headerlink" title="4. 自定义错误处理"></a>4. 自定义错误处理</h3><p>我们可以自定义错误处理逻辑，例如重试机制、错误转换等。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个函数，实现重试机制</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchDataWithRetry</span>(<span class="params">from</span> <span class="params">urlString</span>: <span class="type">String</span>, <span class="params">maxRetries</span>: <span class="type">Int</span> <span class="operator">=</span> <span class="number">3</span>) <span class="keyword">throws</span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> retries <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> retries <span class="operator">&lt;</span> maxRetries &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">try</span> fetchData(from: urlString)</span><br><span class="line">        &#125; <span class="keyword">catch</span> <span class="type">NetworkError</span>.timeout &#123;</span><br><span class="line">            retries <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请求超时，重试第<span class="subst">\(retries)</span>次&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="comment">// 其他错误，直接抛出</span></span><br><span class="line">            <span class="keyword">throw</span> error</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 超过最大重试次数，抛出超时错误</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="type">NetworkError</span>.timeout</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> fetchDataWithRetry(from: <span class="string">&quot;https://example.com/data.json&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求成功，获取到数据：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、错误恢复"><a href="#八、错误恢复" class="headerlink" title="八、错误恢复"></a>八、错误恢复</h2><p>在处理错误后，我们可以尝试恢复程序的正常执行。错误恢复的方式取决于具体的应用场景，例如：</p>
<ol>
<li><strong>使用默认值</strong>：当遇到错误时，使用默认值代替</li>
<li><strong>回退到备选方案</strong>：当一个方案失败时，尝试另一个方案</li>
<li><strong>提示用户</strong>：向用户显示错误信息，并请求用户输入正确的信息</li>
<li><strong>记录错误</strong>：将错误信息记录到日志文件中，以便后续分析</li>
</ol>
<h3 id="1-使用默认值"><a href="#1-使用默认值" class="headerlink" title="1. 使用默认值"></a>1. 使用默认值</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 尝试加载配置文件，如果失败则使用默认配置</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> config <span class="operator">=</span> <span class="keyword">try</span> loadConfig(from: <span class="string">&quot;/path/to/config.json&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;使用配置：<span class="subst">\(config)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;加载配置文件失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;使用默认配置&quot;</span>)</span><br><span class="line">    <span class="comment">// 使用默认配置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-回退到备选方案"><a href="#2-回退到备选方案" class="headerlink" title="2. 回退到备选方案"></a>2. 回退到备选方案</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 尝试从主服务器获取数据，如果失败则从备用服务器获取</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> fetchData(from: <span class="string">&quot;https://primary-server.com/data.json&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;从主服务器获取数据成功：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;从主服务器获取数据失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;尝试从备用服务器获取数据&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> fetchData(from: <span class="string">&quot;https://backup-server.com/data.json&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;从备用服务器获取数据成功：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;从备用服务器获取数据失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="九、内容机制与知识点总结"><a href="#九、内容机制与知识点总结" class="headerlink" title="九、内容机制与知识点总结"></a>九、内容机制与知识点总结</h2><h3 id="1-Swift错误处理的设计原则"><a href="#1-Swift错误处理的设计原则" class="headerlink" title="1. Swift错误处理的设计原则"></a>1. Swift错误处理的设计原则</h3><p>Swift的错误处理机制体现了几个核心设计原则：</p>
<ul>
<li><strong>明确性</strong>：错误必须显式声明和处理，提高代码的可读性和可维护性</li>
<li><strong>安全第一</strong>：编译时检查错误处理，减少运行时错误</li>
<li><strong>灵活性</strong>：支持多种错误处理方式，适应不同的应用场景</li>
<li><strong>无缝集成</strong>：与Swift的其他特性（如泛型、闭包）无缝集成</li>
<li><strong>可扩展性</strong>：允许自定义错误类型和处理逻辑</li>
</ul>
<h3 id="2-核心知识点总结"><a href="#2-核心知识点总结" class="headerlink" title="2. 核心知识点总结"></a>2. 核心知识点总结</h3><table>
<thead>
<tr>
<th>概念</th>
<th>描述</th>
<th>主要特性</th>
</tr>
</thead>
<tbody><tr>
<td>错误表示</td>
<td>使用遵循<code>Error</code>协议的类型表示错误</td>
<td>通常使用枚举或结构体</td>
</tr>
<tr>
<td>抛出错误</td>
<td>使用<code>throw</code>关键字抛出错误</td>
<td>需在<code>throws</code>函数中使用</td>
</tr>
<tr>
<td>捕获错误</td>
<td>使用<code>do-catch</code>语句捕获和处理错误</td>
<td>支持捕获特定类型的错误</td>
</tr>
<tr>
<td>传播错误</td>
<td>将错误从一个函数传递到另一个函数</td>
<td>简化错误处理逻辑</td>
</tr>
<tr>
<td><code>try?</code></td>
<td>将错误转换为可选值</td>
<td>错误时返回<code>nil</code></td>
</tr>
<tr>
<td><code>try!</code></td>
<td>强制解包错误</td>
<td>错误时导致运行时崩溃</td>
</tr>
<tr>
<td><code>defer</code></td>
<td>延迟执行代码</td>
<td>用于资源清理</td>
</tr>
<tr>
<td><code>rethrows</code></td>
<td>重新抛出闭包中的错误</td>
<td>只有闭包抛出错误时才抛出</td>
</tr>
<tr>
<td>错误恢复</td>
<td>处理错误后恢复程序执行</td>
<td>使用默认值、备选方案等</td>
</tr>
</tbody></table>
<h2 id="十、遇到的问题及解决方案"><a href="#十、遇到的问题及解决方案" class="headerlink" title="十、遇到的问题及解决方案"></a>十、遇到的问题及解决方案</h2><h3 id="1-过度使用try-导致崩溃"><a href="#1-过度使用try-导致崩溃" class="headerlink" title="1. 过度使用try!导致崩溃"></a>1. 过度使用try!导致崩溃</h3><p><strong>问题</strong>：使用<code>try!</code>强制解包错误，当实际抛出错误时导致运行时崩溃</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try!</span> fetchData(from: <span class="string">&quot;https://example.com/data.json&quot;</span>) <span class="comment">// 如果URL无效，会导致崩溃</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用<code>do-catch</code>或<code>try?</code>进行安全的错误处理</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用do-catch</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> fetchData(from: <span class="string">&quot;https://example.com/data.json&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;获取数据成功：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;获取数据失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用try?</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try?</span> fetchData(from: <span class="string">&quot;https://example.com/data.json&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;获取数据成功：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;获取数据失败&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-错误处理代码嵌套过深"><a href="#2-错误处理代码嵌套过深" class="headerlink" title="2. 错误处理代码嵌套过深"></a>2. 错误处理代码嵌套过深</h3><p><strong>问题</strong>：多层<code>do-catch</code>导致代码嵌套过深，可读性差</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> config <span class="operator">=</span> <span class="keyword">try</span> loadConfig()</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> connection <span class="operator">=</span> <span class="keyword">try</span> establishConnection(config: config)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> fetchData(connection: connection)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取数据成功：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取数据失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;建立连接失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;加载配置失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：使用错误传播和<code>guard</code>语句减少嵌套</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> config <span class="operator">=</span> <span class="keyword">try</span> loadConfig()</span><br><span class="line">    <span class="keyword">let</span> connection <span class="operator">=</span> <span class="keyword">try</span> establishConnection(config: config)</span><br><span class="line">    <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> fetchData(connection: connection)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;获取数据成功：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">ConfigError</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;配置错误：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">ConnectionError</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;连接错误：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">DataError</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据错误：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他错误：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-忽略错误处理"><a href="#3-忽略错误处理" class="headerlink" title="3. 忽略错误处理"></a>3. 忽略错误处理</h3><p><strong>问题</strong>：使用<code>_</code>忽略错误处理，导致潜在问题被掩盖</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try?</span> fetchData(from: <span class="string">&quot;https://example.com/data.json&quot;</span>) <span class="comment">// 忽略错误</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：至少记录错误，以便后续分析</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> error <span class="operator">=</span> <span class="keyword">try?</span> fetchData(from: <span class="string">&quot;https://example.com/data.json&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 处理数据</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;获取数据失败&quot;</span>)</span><br><span class="line">    <span class="comment">// 记录错误日志</span></span><br><span class="line">    <span class="type">Logger</span>.error(<span class="string">&quot;Failed to fetch data&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-defer语句的执行顺序问题"><a href="#4-defer语句的执行顺序问题" class="headerlink" title="4. defer语句的执行顺序问题"></a>4. defer语句的执行顺序问题</h3><p><strong>问题</strong>：不了解<code>defer</code>语句的执行顺序，导致资源管理错误</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">processFile</span>() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;1. 开始处理文件&quot;</span>)</span><br><span class="line">    <span class="keyword">defer</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;4. 清理资源1&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;5. 清理资源2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;2. 处理文件内容&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;3. 结束处理文件&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出顺序：1, 2, 3, 5, 4</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：了解<code>defer</code>语句的执行顺序（后进先出）</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">processFile</span>() &#123;</span><br><span class="line">    <span class="comment">// 先声明的defer后执行</span></span><br><span class="line">    <span class="keyword">defer</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;最后执行的清理&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;中间执行的清理&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;最先执行的清理&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 处理文件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-自定义错误类型信息不足"><a href="#5-自定义错误类型信息不足" class="headerlink" title="5. 自定义错误类型信息不足"></a>5. 自定义错误类型信息不足</h3><p><strong>问题</strong>：自定义错误类型缺少足够的信息，导致调试困难</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">NetworkError</span>: <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> requestFailed <span class="comment">// 错误信息不足</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决方案</strong>：为错误类型关联详细信息</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">NetworkError</span>: <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> requestFailed(statusCode: <span class="type">Int</span>, message: <span class="type">String</span>) <span class="comment">// 关联状态码和错误信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">throw</span> <span class="type">NetworkError</span>.requestFailed(statusCode: <span class="number">404</span>, message: <span class="string">&quot;资源未找到&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="十一、高阶用法"><a href="#十一、高阶用法" class="headerlink" title="十一、高阶用法"></a>十一、高阶用法</h2><h3 id="1-高级错误处理模式"><a href="#1-高级错误处理模式" class="headerlink" title="1. 高级错误处理模式"></a>1. 高级错误处理模式</h3><h4 id="1-1-错误转换与包装"><a href="#1-1-错误转换与包装" class="headerlink" title="1.1 错误转换与包装"></a>1.1 错误转换与包装</h4><p>将底层错误转换为更有意义的上层错误：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 底层网络错误</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">InternalNetworkError</span>: <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> socketError(code: <span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> dnsResolutionFailed(hostname: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上层应用错误</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">AppError</span>: <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> networkError(reason: <span class="type">String</span>, underlyingError: <span class="type">Error</span>?)</span><br><span class="line">    <span class="keyword">case</span> validationError(field: <span class="type">String</span>, message: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换错误</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchUserData</span>(<span class="params">userId</span>: <span class="type">String</span>) <span class="keyword">throws</span> -&gt; <span class="type">User</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> internalFetchUserData(userId: userId)</span><br><span class="line">    &#125; <span class="keyword">catch</span> <span class="type">InternalNetworkError</span>.socketError(<span class="keyword">let</span> code) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">AppError</span>.networkError(reason: <span class="string">&quot;网络连接失败，错误码：<span class="subst">\(code)</span>&quot;</span>, underlyingError: <span class="literal">nil</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> <span class="type">InternalNetworkError</span>.dnsResolutionFailed(<span class="keyword">let</span> hostname) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">AppError</span>.networkError(reason: <span class="string">&quot;无法解析主机名：<span class="subst">\(hostname)</span>&quot;</span>, underlyingError: <span class="literal">nil</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> <span class="keyword">let</span> error &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">AppError</span>.networkError(reason: <span class="string">&quot;网络请求失败&quot;</span>, underlyingError: error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-函数式错误处理"><a href="#1-2-函数式错误处理" class="headerlink" title="1.2 函数式错误处理"></a>1.2 函数式错误处理</h4><p>结合Swift的函数式特性处理错误：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用Result类型封装错误</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchData</span>(<span class="params">from</span> <span class="params">urlString</span>: <span class="type">String</span>) -&gt; <span class="type">Result</span>&lt;<span class="type">Data</span>, <span class="type">NetworkError</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: urlString) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .failure(.invalidURL)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 模拟网络请求</span></span><br><span class="line">    <span class="keyword">let</span> success <span class="operator">=</span> <span class="type">Bool</span>.random()</span><br><span class="line">    <span class="keyword">if</span> success &#123;</span><br><span class="line">        <span class="keyword">return</span> .success(<span class="type">Data</span>())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .failure(.requestFailed(statusCode: <span class="number">500</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链式调用处理错误</span></span><br><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> fetchData(from: <span class="string">&quot;https://example.com/data.json&quot;</span>)</span><br><span class="line">    .map &#123; data <span class="keyword">in</span></span><br><span class="line">        <span class="comment">// 处理数据</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(data: data, encoding: .utf8) <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    .flatMap &#123; string <span class="keyword">in</span></span><br><span class="line">        <span class="comment">// 进一步处理</span></span><br><span class="line">        <span class="keyword">if</span> string.isEmpty &#123;</span><br><span class="line">            <span class="keyword">return</span> .failure(.unknown)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> .success(string)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理最终结果</span></span><br><span class="line"><span class="keyword">switch</span> result &#123;</span><br><span class="line"><span class="keyword">case</span> .success(<span class="keyword">let</span> data):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;成功：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-异步错误处理"><a href="#1-3-异步错误处理" class="headerlink" title="1.3 异步错误处理"></a>1.3 异步错误处理</h4><p>在异步代码中处理错误（Swift 5.5+）：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 异步函数抛出错误</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchDataAsync</span>(<span class="params">from</span> <span class="params">urlString</span>: <span class="type">String</span>) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: urlString) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">NetworkError</span>.invalidURL</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> (data, response) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">URLSession</span>.shared.data(from: url)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> httpResponse <span class="operator">=</span> response <span class="keyword">as?</span> <span class="type">HTTPURLResponse</span>, httpResponse.statusCode <span class="operator">==</span> <span class="number">200</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">NetworkError</span>.requestFailed(statusCode: (response <span class="keyword">as?</span> <span class="type">HTTPURLResponse</span>)<span class="operator">?</span>.statusCode <span class="operator">??</span> <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用异步函数并处理错误</span></span><br><span class="line"><span class="type">Task</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> fetchDataAsync(from: <span class="string">&quot;https://example.com/data.json&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;获取数据成功：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;获取数据失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">### <span class="number">2</span>. 高级错误恢复策略</span><br><span class="line"></span><br><span class="line">#### <span class="number">2.1</span> 智能重试机制</span><br><span class="line"></span><br><span class="line">实现基于错误类型和重试次数的智能重试：</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">RetryPolicy</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> immediate(maxRetries: <span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> exponentialBackoff(maxRetries: <span class="type">Int</span>, initialDelay: <span class="type">TimeInterval</span>)</span><br><span class="line">    <span class="keyword">case</span> custom(delay: (<span class="type">Int</span>) -&gt; <span class="type">TimeInterval</span>, maxRetries: <span class="type">Int</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchWithRetry</span>(<span class="params">from</span> <span class="params">urlString</span>: <span class="type">String</span>, <span class="params">policy</span>: <span class="type">RetryPolicy</span>) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> retries <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> maxRetries: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> delay: (<span class="type">Int</span>) -&gt; <span class="type">TimeInterval</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 配置重试策略</span></span><br><span class="line">    <span class="keyword">switch</span> policy &#123;</span><br><span class="line">    <span class="keyword">case</span> .immediate(<span class="keyword">let</span> count):</span><br><span class="line">        maxRetries <span class="operator">=</span> count</span><br><span class="line">        delay <span class="operator">=</span> &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">0</span> &#125;</span><br><span class="line">    <span class="keyword">case</span> .exponentialBackoff(<span class="keyword">let</span> count, <span class="keyword">let</span> initialDelay):</span><br><span class="line">        maxRetries <span class="operator">=</span> count</span><br><span class="line">        delay <span class="operator">=</span> &#123; attempt <span class="keyword">in</span> initialDelay <span class="operator">*</span> pow(<span class="number">2.0</span>, <span class="type">Double</span>(attempt)) &#125;</span><br><span class="line">    <span class="keyword">case</span> .custom(<span class="keyword">let</span> delayFunc, <span class="keyword">let</span> count):</span><br><span class="line">        maxRetries <span class="operator">=</span> count</span><br><span class="line">        delay <span class="operator">=</span> delayFunc</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">try</span> <span class="keyword">await</span> fetchDataAsync(from: urlString)</span><br><span class="line">        &#125; <span class="keyword">catch</span> <span class="type">NetworkError</span>.timeout, <span class="type">NetworkError</span>.requestFailed(<span class="keyword">let</span> statusCode) <span class="keyword">where</span> statusCode <span class="operator">&gt;=</span> <span class="number">500</span> &#123;</span><br><span class="line">            <span class="comment">// 只对特定错误进行重试</span></span><br><span class="line">            retries <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> retries <span class="operator">&gt;</span> maxRetries &#123;</span><br><span class="line">                <span class="keyword">throw</span> error</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 延迟后重试</span></span><br><span class="line">            <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">Task</span>.sleep(nanoseconds: <span class="type">UInt64</span>(delay(retries) <span class="operator">*</span> <span class="number">1_000_000_000</span>))</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="comment">// 其他错误直接抛出</span></span><br><span class="line">            <span class="keyword">throw</span> error</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用智能重试</span></span><br><span class="line"><span class="type">Task</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> fetchWithRetry(</span><br><span class="line">            from: <span class="string">&quot;https://example.com/data.json&quot;</span>,</span><br><span class="line">            policy: .exponentialBackoff(maxRetries: <span class="number">3</span>, initialDelay: <span class="number">1.0</span>)</span><br><span class="line">        )</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;获取数据成功：<span class="subst">\(data)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;获取数据失败：<span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-错误聚合"><a href="#2-2-错误聚合" class="headerlink" title="2.2 错误聚合"></a>2.2 错误聚合</h4><p>聚合多个错误信息：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 错误聚合类型</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AggregateError</span>: <span class="title class_ inherited__">Error</span>, <span class="title class_ inherited__">CustomStringConvertible</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> errors: [<span class="type">Error</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Multiple errors occurred: <span class="subst">\(errors.map &#123; \<span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span><span class="subst">\&quot;</span> &#125;.joined(separator: &quot;</span>, <span class="string">&quot;))&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span></span></span><br><span class="line"><span class="subst"><span class="string">&#125;</span></span></span><br><span class="line"><span class="subst"><span class="string"></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="operator">//</span> 并行验证函数</span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="keyword">func</span> validateAllFields(_ fields: [String: String]) <span class="keyword">throws</span> &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="keyword">var</span> errors <span class="operator">=</span> [Error]</span></span></span><br><span class="line"><span class="subst"><span class="string">    </span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="operator">//</span> 验证邮箱</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="keyword">if</span> <span class="keyword">let</span> email <span class="operator">=</span> fields[<span class="string">&quot;email&quot;</span>] &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        <span class="keyword">do</span> &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="keyword">try</span> validateEmail(email)</span></span></span><br><span class="line"><span class="subst"><span class="string">        &#125; <span class="keyword">catch</span> &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            errors.append(error)</span></span></span><br><span class="line"><span class="subst"><span class="string">        &#125;</span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span></span></span><br><span class="line"><span class="subst"><span class="string">    </span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="operator">//</span> 验证密码</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="keyword">if</span> <span class="keyword">let</span> password <span class="operator">=</span> fields[<span class="string">&quot;password&quot;</span>] &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        <span class="keyword">do</span> &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="keyword">try</span> validatePassword(password)</span></span></span><br><span class="line"><span class="subst"><span class="string">        &#125; <span class="keyword">catch</span> &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            errors.append(error)</span></span></span><br><span class="line"><span class="subst"><span class="string">        &#125;</span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span></span></span><br><span class="line"><span class="subst"><span class="string">    </span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="operator">//</span> 验证用户名</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="keyword">if</span> <span class="keyword">let</span> username <span class="operator">=</span> fields[<span class="string">&quot;username&quot;</span>] &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        <span class="keyword">do</span> &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="keyword">try</span> validateUsername(username)</span></span></span><br><span class="line"><span class="subst"><span class="string">        &#125; <span class="keyword">catch</span> &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            errors.append(error)</span></span></span><br><span class="line"><span class="subst"><span class="string">        &#125;</span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span></span></span><br><span class="line"><span class="subst"><span class="string">    </span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="operator">//</span> 如果有错误，抛出聚合错误</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="keyword">if</span> <span class="operator">!</span>errors.isEmpty &#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        <span class="keyword">throw</span> AggregateError(errors: errors)</span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span></span></span><br><span class="line"><span class="subst"><span class="string">&#125;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="3-性能优化策略"><a href="#3-性能优化策略" class="headerlink" title="3. 性能优化策略"></a>3. 性能优化策略</h3><h4 id="3-1-减少错误处理开销"><a href="#3-1-减少错误处理开销" class="headerlink" title="3.1 减少错误处理开销"></a>3.1 减少错误处理开销</h4><p>避免在性能敏感的代码中过度使用错误处理：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 性能敏感的代码，避免使用错误处理</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fastArraySum</span>(<span class="keyword">_</span> <span class="params">numbers</span>: [<span class="type">Int</span>]) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> sum <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        sum <span class="operator">+=</span> number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非性能敏感的代码，可以使用错误处理</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">safeArraySum</span>(<span class="keyword">_</span> <span class="params">numbers</span>: [<span class="type">Int</span>?]) <span class="keyword">throws</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> sum <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> number <span class="operator">=</span> number <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">ValidationError</span>(field: <span class="string">&quot;numbers&quot;</span>, message: <span class="string">&quot;数组包含nil值&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        sum <span class="operator">+=</span> number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-缓存错误结果"><a href="#3-2-缓存错误结果" class="headerlink" title="3.2 缓存错误结果"></a>3.2 缓存错误结果</h4><p>缓存频繁发生的错误结果，避免重复计算：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> cache: [<span class="type">String</span>: <span class="type">Error</span>] <span class="operator">=</span> [:]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> lock <span class="operator">=</span> <span class="type">NSLock</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getError</span>(<span class="params">for</span> <span class="params">key</span>: <span class="type">String</span>) -&gt; <span class="type">Error</span>? &#123;</span><br><span class="line">        lock.lock()</span><br><span class="line">        <span class="keyword">defer</span> &#123; lock.unlock() &#125;</span><br><span class="line">        <span class="keyword">return</span> cache[key]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">setError</span>(<span class="keyword">_</span> <span class="params">error</span>: <span class="type">Error</span>, <span class="params">for</span> <span class="params">key</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        lock.lock()</span><br><span class="line">        <span class="keyword">defer</span> &#123; lock.unlock() &#125;</span><br><span class="line">        cache[key] <span class="operator">=</span> error</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">clear</span>() &#123;</span><br><span class="line">        lock.lock()</span><br><span class="line">        <span class="keyword">defer</span> &#123; lock.unlock() &#125;</span><br><span class="line">        cache.removeAll()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用错误缓存</span></span><br><span class="line"><span class="keyword">let</span> errorCache <span class="operator">=</span> <span class="type">ErrorCache</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fetchDataWithCache</span>(<span class="params">from</span> <span class="params">urlString</span>: <span class="type">String</span>) <span class="keyword">throws</span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">    <span class="comment">// 检查缓存</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> cachedError <span class="operator">=</span> errorCache.getError(for: urlString) &#123;</span><br><span class="line">        <span class="keyword">throw</span> cachedError</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data <span class="operator">=</span> <span class="keyword">try</span> fetchData(from: urlString)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="comment">// 缓存错误</span></span><br><span class="line">        errorCache.setError(error, for: urlString)</span><br><span class="line">        <span class="keyword">throw</span> error</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-最佳实践指南"><a href="#4-最佳实践指南" class="headerlink" title="4. 最佳实践指南"></a>4. 最佳实践指南</h3><ol>
<li><p><strong>错误处理策略</strong>：</p>
<ul>
<li>优先使用<code>do-catch</code>进行明确的错误处理</li>
<li>只有在确定不会出错时才使用<code>try!</code></li>
<li>适当使用<code>try?</code>简化代码，但不要忽略错误</li>
</ul>
</li>
<li><p><strong>自定义错误类型</strong>：</p>
<ul>
<li>为不同的错误场景创建不同的错误类型</li>
<li>为错误类型关联足够的调试信息</li>
<li>实现<code>CustomStringConvertible</code>或<code>LocalizedError</code>协议，提供友好的错误描述</li>
</ul>
</li>
<li><p><strong>资源管理</strong>：</p>
<ul>
<li>始终使用<code>defer</code>语句清理资源（文件、网络连接等）</li>
<li>确保<code>defer</code>语句的执行顺序正确</li>
</ul>
</li>
<li><p><strong>性能考量</strong>：</p>
<ul>
<li>避免在性能敏感的代码中过度使用错误处理</li>
<li>考虑使用<code>Result</code>类型进行异步错误处理</li>
<li>缓存频繁发生的错误结果</li>
</ul>
</li>
<li><p><strong>测试与调试</strong>：</p>
<ul>
<li>编写单元测试覆盖各种错误场景</li>
<li>使用断言验证错误处理逻辑</li>
<li>在开发环境中提供详细的错误信息</li>
</ul>
</li>
</ol>
<h2 id="十二、实践练习"><a href="#十二、实践练习" class="headerlink" title="十二、实践练习"></a>十二、实践练习</h2><h3 id="1-错误表示与处理基础练习"><a href="#1-错误表示与处理基础练习" class="headerlink" title="1. 错误表示与处理基础练习"></a>1. 错误表示与处理基础练习</h3><h4 id="1-1-创建自定义错误类型"><a href="#1-1-创建自定义错误类型" class="headerlink" title="1.1 创建自定义错误类型"></a>1.1 创建自定义错误类型</h4><p>创建一个表示网络错误的枚举<code>NetworkError</code>，包含以下错误情况：</p>
<ul>
<li><code>invalidURL</code>：URL格式错误</li>
<li><code>requestFailed(statusCode: Int)</code>：请求失败，包含HTTP状态码</li>
<li><code>timeout</code>：请求超时</li>
<li><code>unknown(error: Error)</code>：未知错误，包含原始错误信息</li>
</ul>
<p>确保该枚举遵循<code>Error</code>协议和<code>LocalizedError</code>协议，提供友好的错误描述。</p>
<h4 id="1-2-实现带错误处理的函数"><a href="#1-2-实现带错误处理的函数" class="headerlink" title="1.2 实现带错误处理的函数"></a>1.2 实现带错误处理的函数</h4><p>创建一个函数<code>fetchData(from urlString: String) throws -&gt; String</code>，该函数：</p>
<ol>
<li>检查URL格式是否有效，如果无效则抛出<code>NetworkError.invalidURL</code></li>
<li>模拟网络请求，如果请求耗时超过2秒则抛出<code>NetworkError.timeout</code></li>
<li>模拟不同的HTTP状态码，如果状态码不是200则抛出<code>NetworkError.requestFailed</code></li>
<li>如果请求成功，返回模拟的响应数据</li>
</ol>
<h3 id="2-高级错误处理练习"><a href="#2-高级错误处理练习" class="headerlink" title="2. 高级错误处理练习"></a>2. 高级错误处理练习</h3><h4 id="2-1-实现重试机制"><a href="#2-1-实现重试机制" class="headerlink" title="2.1 实现重试机制"></a>2.1 实现重试机制</h4><p>基于上面的<code>fetchData</code>函数，创建一个新函数<code>fetchDataWithRetry(from urlString: String, maxRetries: Int) throws -&gt; String</code>，该函数：</p>
<ol>
<li>尝试调用<code>fetchData</code>函数获取数据</li>
<li>如果遇到<code>NetworkError.timeout</code>或<code>NetworkError.requestFailed</code>（状态码为500-599），则自动重试，最多重试<code>maxRetries</code>次</li>
<li>如果重试次数用完仍失败，则抛出最后一次遇到的错误</li>
<li>使用<code>defer</code>语句记录请求的开始和结束时间</li>
</ol>
<h4 id="2-2-使用Result类型处理异步操作"><a href="#2-2-使用Result类型处理异步操作" class="headerlink" title="2.2 使用Result类型处理异步操作"></a>2.2 使用Result类型处理异步操作</h4><p>创建一个模拟异步网络请求的函数<code>fetchDataAsync(from urlString: String, completion: @escaping (Result&lt;String, NetworkError&gt;) -&gt; Void)</code>，该函数：</p>
<ol>
<li>使用GCD或<code>DispatchQueue</code>模拟异步网络请求</li>
<li>根据不同情况返回成功或失败的结果</li>
<li>在主线程中调用完成闭包</li>
</ol>
<p>然后编写代码调用该函数，并处理成功和失败的情况。</p>
<h3 id="3-综合应用练习"><a href="#3-综合应用练习" class="headerlink" title="3. 综合应用练习"></a>3. 综合应用练习</h3><h4 id="3-1-实现文件操作错误处理"><a href="#3-1-实现文件操作错误处理" class="headerlink" title="3.1 实现文件操作错误处理"></a>3.1 实现文件操作错误处理</h4><p>创建一个<code>FileManager</code>的扩展，添加以下方法：</p>
<ol>
<li><code>readText(from fileURL: URL) throws -&gt; String</code>：读取文件内容，处理文件不存在、没有权限、文件内容不是文本等错误</li>
<li><code>writeText(_ text: String, to fileURL: URL) throws -&gt; Void</code>：写入文件内容，处理文件不能创建、没有权限等错误</li>
<li><code>copyFile(from sourceURL: URL, to destinationURL: URL) throws -&gt; Void</code>：复制文件，处理源文件不存在、目标位置不能写入等错误</li>
</ol>
<p>确保所有方法都正确处理错误，并提供清晰的错误信息。</p>
<h4 id="3-2-实现错误转换与包装"><a href="#3-2-实现错误转换与包装" class="headerlink" title="3.2 实现错误转换与包装"></a>3.2 实现错误转换与包装</h4><p>创建一个函数<code>loadConfiguration(from fileURL: URL) throws -&gt; [String: Any]</code>，该函数：</p>
<ol>
<li>调用上面的<code>readText</code>方法读取文件内容</li>
<li>将文本内容解析为JSON</li>
<li>如果解析失败，将JSON解析错误包装为自定义的<code>ConfigurationError.parsingFailed</code>错误</li>
<li>如果JSON不是字典类型，抛出<code>ConfigurationError.invalidFormat</code>错误</li>
</ol>
<p>创建自定义的<code>ConfigurationError</code>枚举，包含<code>fileNotFound</code>、<code>parsingFailed</code>和<code>invalidFormat</code>等错误情况。</p>
<h2 id="十三、总结"><a href="#十三、总结" class="headerlink" title="十三、总结"></a>十三、总结</h2><p>在这篇学习日记中，我们深入探讨了Swift的错误处理机制：</p>
<ol>
<li><p><strong>基本概念</strong>：错误是指在程序运行时可能出现的异常情况，Swift的错误处理机制允许我们表示、抛出、捕获、传播和恢复错误</p>
</li>
<li><p><strong>表示错误</strong>：使用遵循<code>Error</code>协议的类型（通常是枚举）来表示错误</p>
</li>
<li><p><strong>抛出错误</strong>：使用<code>throw</code>关键字抛出错误，只有在标记为<code>throws</code>的函数、方法或初始化器中才能抛出错误</p>
</li>
<li><p><strong>捕获错误</strong>：使用<code>do-catch</code>语句捕获和处理错误，可以捕获特定类型的错误或所有错误</p>
</li>
<li><p><strong>传播错误</strong>：将错误从一个函数传播到另一个函数，让调用者来处理</p>
</li>
<li><p><strong>高级用法</strong>：</p>
<ul>
<li><code>try?</code>和<code>try!</code>：简化的错误处理方式</li>
<li><code>defer</code>语句：延迟执行代码，用于资源清理</li>
<li><code>rethrows</code>关键字：重新抛出闭包中的错误</li>
<li>自定义错误处理：例如重试机制、错误转换等</li>
</ul>
</li>
<li><p><strong>错误恢复</strong>：在处理错误后，尝试恢复程序的正常执行，例如使用默认值、回退到备选方案等</p>
</li>
</ol>
<p>错误处理是Swift编程中的重要组成部分，它使得我们的代码更加健壮和可靠。掌握错误处理机制对于开发高质量的Swift应用程序至关重要。在下一篇学习日记中，我们将继续学习Swift的内存管理机制。</p>
]]></content>
      <tags>
        <tag>swift</tag>
      </tags>
  </entry>
</search>
